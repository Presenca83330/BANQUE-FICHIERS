------------------
1. src/components/HOOKS-STRATEGIQUE/6.HOOK-AccesRoutesUtilisateurs/DroitsAccesRoutes.ts :
----------------------

import { useCurrentUser } from "@/components/HOOKS-STRATEGIQUE/2.HOOK-useCurrentUser/useCurrentUser";

// Types d'espaces de routes disponibles
export type RouteSpace = 
  | "ADMIN-PRESENCA" 
  | "RESEAU-ESPACE" 
  | "CLIENT-ESPACE" 
  | "COLLABORATEUR-ESPACE";

// Hook pour vérifier les droits d'accès aux routes
export function useDroitsAccesRoutes() {
  const { user, isLoading } = useCurrentUser();

  // Fonction pour obtenir tous les espaces autorisés pour l'utilisateur
  const getEspacesAutorises = (): RouteSpace[] => {
    if (isLoading || !user) return [];

    // Admin PRESENCA : accès total
    if (user.roleSysteme === "admin_presenca") {
      return ["ADMIN-PRESENCA", "RESEAU-ESPACE", "CLIENT-ESPACE", "COLLABORATEUR-ESPACE"];
    }

    // Réseau et Réseau Direction
    if (["reseau", "reseau_direction"].includes(user.utilisateurTypeCompte || "")) {
      return ["RESEAU-ESPACE"];
    }

    // Agences (réseau et indépendantes) + leurs responsables
    if ([
      "reseau_agence", 
      "reseau_agence_responsable",
      "agence_independante", 
      "agence_independante_responsable"
    ].includes(user.utilisateurTypeCompte || "")) {
      return ["CLIENT-ESPACE"];
    }

    // Collaborateurs
    if ([
      "reseau_agence_collaborateur",
      "agence_independante_collaborateur"
    ].includes(user.utilisateurTypeCompte || "")) {
      return ["COLLABORATEUR-ESPACE"];
    }

    // Aucun accès par défaut
    return [];
  };

  // Fonction pour vérifier si l'utilisateur a accès à un espace spécifique
  const aAccesEspace = (espace: RouteSpace): boolean => {
    const espacesAutorises = getEspacesAutorises();
    return espacesAutorises.includes(espace);
  };

  return {
    espacesAutorises: getEspacesAutorises(),
    aAccesEspace,
    isLoading
  };
}
------------------
2. src/components/HOOKS-STRATEGIQUE/7.HOOK-InterdictionRoutesUtilisateurs/InterdictionAccesRoutes.ts :
------------------------

import { useCurrentUser } from "@/components/HOOKS-STRATEGIQUE/2.HOOK-useCurrentUser/useCurrentUser";
import { RouteSpace } from "@/components/HOOKS-STRATEGIQUE/6.HOOK-AccesRoutesUtilisateurs/DroitsAccesRoutes";

// Hook pour vérifier les interdictions d'accès aux routes
export function useInterdictionAccesRoutes() {
  const { user, isLoading } = useCurrentUser();

  // Fonction pour obtenir tous les espaces interdits pour l'utilisateur
  const getEspacesInterdits = (): RouteSpace[] => {
    if (isLoading || !user) return ["ADMIN-PRESENCA", "RESEAU-ESPACE", "CLIENT-ESPACE", "COLLABORATEUR-ESPACE"];

    // Admin PRESENCA : aucune interdiction
    if (user.roleSysteme === "admin_presenca") {
      return [];
    }

    // Réseau et Réseau Direction : interdiction à tout sauf RESEAU-ESPACE
    if (["reseau", "reseau_direction"].includes(user.utilisateurTypeCompte || "")) {
      return ["ADMIN-PRESENCA", "CLIENT-ESPACE", "COLLABORATEUR-ESPACE"];
    }

    // Agences (réseau et indépendantes) + leurs responsables : interdiction à tout sauf CLIENT-ESPACE
    if ([
      "reseau_agence", 
      "reseau_agence_responsable",
      "agence_independante", 
      "agence_independante_responsable"
    ].includes(user.utilisateurTypeCompte || "")) {
      return ["ADMIN-PRESENCA", "RESEAU-ESPACE", "COLLABORATEUR-ESPACE"];
    }

    // Collaborateurs : interdiction à tout sauf COLLABORATEUR-ESPACE
    if ([
      "reseau_agence_collaborateur",
      "agence_independante_collaborateur"
    ].includes(user.utilisateurTypeCompte || "")) {
      return ["ADMIN-PRESENCA", "RESEAU-ESPACE", "CLIENT-ESPACE"];
    }

    // Interdiction totale par défaut
    return ["ADMIN-PRESENCA", "RESEAU-ESPACE", "CLIENT-ESPACE", "COLLABORATEUR-ESPACE"];
  };

  // Fonction pour vérifier si l'utilisateur est interdit d'accès à un espace spécifique
  const estInterditEspace = (espace: RouteSpace): boolean => {
    const espacesInterdits = getEspacesInterdits();
    return espacesInterdits.includes(espace);
  };

  return {
    espacesInterdits: getEspacesInterdits(),
    estInterditEspace,
    isLoading
  };
}

--------------
3. Apps.tsx
------------
App.tsx :


import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route } from "react-router-dom";
import Index from "./pages/Index";
import { Login } from "./components/INTERFACE-CONNEXION/5.GestiondesExports/FichiersExports";
import Etape1 from "./1.etapes-generation-annonces/etape1/Etape1";
import Etape2 from "./1.etapes-generation-annonces/etape2/Etape2";
import Etape3 from "./1.etapes-generation-annonces/etape3/Etape3";
import Etape4 from "./1.etapes-generation-annonces/etape4/Etape4";
import Etape5 from "./1.etapes-generation-annonces/etape5/Etape5";
import Animation from "./1.etapes-generation-annonces/etape5/Animation";
import Etape6Communication from "./1.etapes-restitution-utilisateur/0.Etape6Communication/Etape6Communication";
import Etape1ZonedeChalandise from "./2.zone-de-chalandise/ZoneEtape1/Etape1ZonedeChalandise";
import Etape2ZonedeChalandise from "./2.zone-de-chalandise/ZoneEtape2/Etape2ZonedeChalandise";
import Etape3ZonedeChalandiseAnimation from "./2.zone-de-chalandise/ZoneEtape3Animation/Etape3ZonedeChalandiseAnimation";
import Etape4ZonedeChalandiseSources from "./2.zone-de-chalandise/ZoneEtape4/Etape4ZonedeChalandiseSources";
import BibliothequeFormulaires from "./0.structure-type-page/structure6Formulaires/BibliothequeFormulaires";
import NotFound from "./pages/NotFound";
import { OpenAIProvider } from "./contexts/OpenAIContext";
import { ImpersonationProvider } from "./contexts/ImpersonationContext";
import "./App.css";
import AccueilLeadGenAIAdBuilder from "./4.home-page-leadgenai/ACCUEIL-LEADGENAI/accueil-leadgenai-adbuilder";
import EspaceClient from "./components/CLIENT-ESPACE/EspaceClient";
import NewsletterBuilder from "./components/NEWSLETTER-BUILDER/NewsletterBuilder";
import AdminPanel from "./components/ADMIN-PRESENCA/AdminPanel";
import EspaceReseau from "./components/RESEAU-ESPACE/EspaceReseau";
import EspaceCollaborateur from "./components/COLLABORATEUR-ESPACE/EspaceCollaborateur";
import { useNavigate } from "react-router-dom";
import { ProtectedRoute } from "./components/HOOKS-STRATEGIQUE/8.HOOK-GardienRoutesUtilisateurs/GardienAcccesRoutes";

const queryClient = new QueryClient();

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <TooltipProvider>
        <ImpersonationProvider>
          <OpenAIProvider>
          <Toaster />
          <Sonner />
          <BrowserRouter>
            <Routes>
              <Route path="/" element={<Index />} />
              <Route path="/login" element={<LoginWithRedirect />} />
              
              <Route path="/accueil-leadgenai" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <AccueilLeadGenAIAdBuilder />
                </ProtectedRoute>
              } />
              
              <Route path="/espace-client" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <EspaceClient />
                </ProtectedRoute>
              } />
              
              <Route path="/admin-presenca" element={
                <ProtectedRoute requiredSpace="ADMIN-PRESENCA">
                  <AdminPanel />
                </ProtectedRoute>
              } />
              
              <Route path="/espace-reseau" element={
                <ProtectedRoute requiredSpace="RESEAU-ESPACE">
                  <EspaceReseau />
                </ProtectedRoute>
              } />
              
              <Route path="/espace-collaborateur" element={
                <ProtectedRoute requiredSpace="COLLABORATEUR-ESPACE">
                  <EspaceCollaborateur />
                </ProtectedRoute>
              } />
              
              <Route path="/etape1" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape1 />
                </ProtectedRoute>
              } />
              
              <Route path="/etape2" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape2 />
                </ProtectedRoute>
              } />
              
              <Route path="/etape3" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape3 />
                </ProtectedRoute>
              } />
              
              <Route path="/etape4" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape4 />
                </ProtectedRoute>
              } />
              
              <Route path="/etape5" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape5 />
                </ProtectedRoute>
              } />
              
              <Route path="/etape5/animation" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Animation />
                </ProtectedRoute>
              } />
              
              <Route path="/etape6communication" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape6Communication />
                </ProtectedRoute>
              } />
              
              <Route path="/zone-chalandise" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape1ZonedeChalandise />
                </ProtectedRoute>
              } />
              
              <Route path="/zone-chalandise/resultat" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape2ZonedeChalandise />
                </ProtectedRoute>
              } />
              
              <Route path="/zone-chalandise/animation" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape3ZonedeChalandiseAnimation />
                </ProtectedRoute>
              } />
              
              <Route path="/zone-chalandise/sources" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <Etape4ZonedeChalandiseSources />
                </ProtectedRoute>
              } />
              
              <Route path="/structure-forms" element={
                <ProtectedRoute requiredSpace="ADMIN-PRESENCA">
                  <BibliothequeFormulaires />
                </ProtectedRoute>
              } />
              
              <Route path="/newsletter-builder" element={
                <ProtectedRoute requiredSpace="CLIENT-ESPACE">
                  <NewsletterBuilder />
                </ProtectedRoute>
              } />
              
              <Route path="/404" element={<NotFound />} />
              <Route path="*" element={<NotFound />} />
            </Routes>
          </BrowserRouter>
          </OpenAIProvider>
        </ImpersonationProvider>
      </TooltipProvider>
    </QueryClientProvider>
  );
}

const LoginWithRedirect = () => {
  const navigate = useNavigate();
  
  const handleNavigateToApp = () => {
    navigate('/accueil-leadgenai');
  };

  return <Login onNavigateToApp={handleNavigateToApp} />;
};

export default App;

---------------
4. src/components/HOOKS-STRATEGIQUE/8.HOOK-GardienRoutesUtilisateurs/GardienAcccesRoutes.ts
-------------------
import React from 'react';
import { Navigate } from 'react-router-dom';
import { useDroitsAccesRoutes, RouteSpace } from '../6.HOOK-AccesRoutesUtilisateurs/DroitsAccesRoutes';
import { useInterdictionAccesRoutes } from '../7.HOOK-InterdictionRoutesUtilisateurs/InterdictionAccesRoutes';
import { useAuth } from '../1.HOOK-Auth/useAuth';

interface ProtectedRouteProps {
  children: React.ReactNode;
  requiredSpace: RouteSpace;
}

export const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ 
  children, 
  requiredSpace 
}) => {
  const { user, isLoading } = useAuth();
  const { espacesAutorises, isLoading: isLoadingDroits } = useDroitsAccesRoutes();
  const { espacesInterdits, isLoading: isLoadingInterdictions } = useInterdictionAccesRoutes();

  // Affichage de chargement pendant la vérification
  if (isLoading || isLoadingDroits || isLoadingInterdictions) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>
    );
  }

  // Redirection vers login si non connecté
  if (!user) {
    return <Navigate to="/login" replace />;
  }

  // Vérification des interdictions (priorité absolue)
  if (espacesInterdits.includes(requiredSpace)) {
    return <Navigate to="/404" replace />;
  }

  // Vérification des autorisations
  if (!espacesAutorises.includes(requiredSpace)) {
    return <Navigate to="/404" replace />;
  }

  // Accès autorisé - affichage du composant
  return <>{children}</>;
};

