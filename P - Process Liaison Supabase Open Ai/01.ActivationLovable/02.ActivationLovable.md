<mark># ATTENTION </mark> 
<mark># TOUJOURS METTRE EN MODE CHAT LIGHT</mark> 
---
---
## **1/ Pr√©sentation**
Bonjour 
- Tu es un expert en Ia no code et int√©gration supabese.
- Tu maitrises parfaitement les environnement Saas, les meilleures logiciels
- Tu es un expert qui applique les directives avec rigueur, pr√©cision, tu es m√©ticuleux
- Tu ne modifies pas ce qu on ne t a pas demand√©
- Tu es un vrai expert professionnel
  - Je vais t'expliquer dans le chat suivant ce que nous allons faire ensemble.
  - DIRECTIVE ABSOLUE NON NEGOCIABLE 
  - Interdiction totale et absolue de commencer √† lire les documents en ressources et de relire les messages pr√©c√©dents
  - Tu dois √™tre concentr√©s sur la mission et les ressources que je vais te donner 
  - Attends mon message suivant
---
## **2/ Docs Strat√©giques**
J'aimerais que tu aies une vision compl√®te de mon application commence par lire les documents suivants : 
  - public/1. Documents Strat√©giques/01. Pr√©sentation LeadGenAi.md
  - public/1. Documents Strat√©giques/02. Pr√©sentation Structure LeadGenAi.md
  - public/1. Documents Strat√©giques/03. Logique Organisations.md
  - public/1. Documents Strat√©giques/04. Relations Business entre Tables.md
  - public/1. Documents Strat√©giques/05. Relations Users Utilisateurs.md
  - public/1. Documents Strat√©giques/06. R√©f√©rence des Hooks Strat√©giques.md
  - public/1. Documents Strat√©giques/07.1. FormCreationReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - public/1. Documents Strat√©giques/07.2. FormGestionReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - public/1. Documents Strat√©giques/08. Gestion du Menu Gauche.md
  - public/1. Documents Strat√©giques/09. Structure - Organisation | Client_id.md
  - public/1. Documents Strat√©giques/10. Structure des Tables de Connexion & R√®gles Collaborateurs.md
    - Ces fichiers te permettront de te souvenir de mon application, des rapports entre les tables, des notions d'organisation, utilisateurs, client_id, etc qui sont propres √† mon application.
    - Quand tu auras fini, je te donnerai d'autres ressources √† lire, ne fais pas autre chose avant ma commande suivante il faut analyser les fichiers dans l'ordre
    - (ce n est pas la peine de me faire de synth√®se)
---
## **3/ Analyse de mon application**
- Avant toute chose je te demande d'analyser :
- 1/ Tous les fichiers de mon application
- 2/ Toutes les tables et fonctions de supabase
- Quand tu auras fini, je te donnerai d'autres informations sur notre mission du jour.
- (ce n est pas la peine de me faire de synth√®se)
---
## **4/ Migration LocalStorage -> Supabase**
- Maintenant que les process d'authentification et de cr√©ation de tables sont en place
- Je souhaite reprendre le travail sur mon application
  - Lors du travail pr√©paratoire MVP, j'ai travaill√© en localstorage pour param√©trer mes api avec Open ai et pr√©parer tous les codes
  - Maintenant je veux travailler sur mon application et mes fonctions afin de les sauvegarder dans Supabase

### Mon Objectif global
 - Cr√©er une architecture SaaS multi-tenant compl√®te permettant
   - √† chaque utilisateur, (r√©seau, r√©seau direction, r√©seau agence, r√©seau agence responsable, r√©seau agence collaborateur, agence ind√©pendante, agence ind√©pendante responsable, agence ind√©pendante collaborateur)
   - d‚Äôacc√©der √† leur espace et tout particuli√®rement leur espace de cr√©ation d‚Äôannonces en 5 √©tapes reli√© √† OpenAI,
   - avec gestion s√©curis√©e des donn√©es via Supabase.
   - Concr√®tement dans mon objectif, je souhaite mettre en place la structre avec Supabse pour que lorsqu'un utilisateur se connecte (reseau, reseau direction, agence independante etc)
   - Il puisse travailler sur son espace
     - pour cr√©er des annonces via mon process en 5 √©tapes (etape1/2/3/4/5/5animation)
     - pour envoyer les informations vers open ai
     - qui restituera les donn√©es pour √™tre utilis√©e dans etape6communication
     - et √† partir de l√†, l'utilisateur pourra choisir les fonctions qu'il souhaite (annonce site internet, outils seo, emailing, sms etc...)

### Structure multi-tenant Supabase
- Chaque entit√© dispose d‚Äôun espace de travail isol√© et s√©curis√©, bas√© sur son organisation_id ou client_id.
- La visibilit√© hi√©rarchique est contr√¥l√©e par admin_presenca, selon la logique :
  - Pour les structures R√©seaux
    - reseau et reseau_direction -> acc√®dent √† leur espace cr√©ation (/accueil-leadgenai) et acc√®dent uniquement leurs projets (reseau et reseau_direction)
    - reseau_agence et reseau_agence_responsable -> acc√®dent √† leur espace cr√©ation (/accueil-leadgenai) et acc√®dent aux projets (reseau_agence, reseau_agence_responsable, reseau_agence_collaborateur)
    - reseau_agence_collaborateur -> acc√®de √† son espace cr√©ation (/accueil-leadgenai) et acc√®de uniquement √† ses projets (reseau_agence_collaborateur)
  - Pour les structures Agences Ind√©pendantes
    - agence_independante et agence_independante_responsable -> acc√®dent √† leur espace cr√©ation (/accueil-leadgenai) et acc√®dent aux projets (agence_independante, agence_independante_responsable et agence_independante_collaborateur)
    - agence_independante__collaborateur -> acc√®de √† son espace cr√©ation (/accueil-leadgenai) et acc√®de uniquement √† ses projets (agence_independante__collaborateur)
  - - Cette structure repose notamment sur les tables : organisations, users, utilisateurs, reseau, reseau_direction, reseau_agence, reseau_agence_responsable, reseau_agence_collaborateur, agence_independante, agence_independante_responsable, agence_independante_collaborateur 

### Flux utilisateur global
- Connexion / Authentification
  - Authentification via Supabase (email / mot de passe)
- Acc√®s √† l‚Äôespace personnel
  - Redirection automatique selon le r√¥le :
    - RESEAU-ESPACE
    - CLIENT-ESPACE
    - COLLABORATEUR-ESPACE
      - Chaque espace ouvre un acc√®s aux donn√©es propres accessibles √† l'utilisateur et au module accueil-leadgenai pour lancer le g√©n√©rateur d'annonces et d'outils seo
      - Prochainement il permettra de r√©cup√©rer les historiques des annonces en fonction de ses projets propres ou de son statut dans la structure multi tenant.

- POur permettre une migration parfaites localstorage vers supabase
  - J'ai souhait√© avoir une vision compl√®te et exhaustive de tous les process, champs, fonctions, hooks utilis√©s, l'utilisation des boutons, de tous les codes localstorage

- As tu compris ma d√©marche?
  - Si oui je te donnerai des documents √† √©tudier dans le message suivant
  - Ne fais pas autre chose avant ma commande suivante il faut analyser les fichiers dans l'ordre
  - (ce n est pas la peine de me faire de synth√®se)
---
## 5/ Mission Phase 1
- Pour ne commettre aucune erreur dans la pr√©paration de la migration.
- Nous avons travaill√© sur l'√©tablissements de diff√©rents documents d'√©tudes non n√©gociables
- **Directives en 7 points des documents pr√©paratoires**
  - **1/ Les audits des √©tapes et process**
  - **2/ La pr√©paration de la table**
  - **3/ Une bible recenssant toutes les fichiers, codes, hooks, localstorage utilis√©s actuellement**
  - **4/ Une pr√©sentation de la strat√©gie**
  - **5/ Un document pr√©paratoire avec identiifications des fichiers, hooks, sql... √† cr√©er, avec le cahier des charges pr√©cis √† int√©grer**
  - **6/ Un document pr√©paratoire avec tous les codes complets**
  - **7/ La migration ne pourra √™tre lanc√©e avant la validation du document 6**
  - Tu vas √©tudier tous mes documents pr√©paratoires

### **Etude des audits 
**1/ Audit des Etapes -> Jusqu'√† envoi OpenAI**
**Nous avons analys√© tous les process des √©tapes 1 √† 5 qui concernent la r√©cup√©ration des informations de l'utilisateur jusqu'√† l'envoi √† OPenAi**
  - Lis et analyse ces documents
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/01.Etape1.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/02.Etape2.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/03.Etape3.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/04.Etape4.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/05.Etape5.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/06.Etape5animation.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/07.BilanEtape1aEtape5.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/08.ProcessEnvoiInfosOpenAI.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/09.ProcessPassageEtapeSuivante.md
    - Quand tu auras fini, je te donnerai d'autres ressources √† lire, ne fais pas autre chose avant ma commande suivante il faut analyser les fichiers dans l'ordre
    - (ce n est pas la peine de me faire de synth√®se)
---
## 6/ **Suite - Etude des audits** 
**2/ Audit de la r√©ecup√©ration des donn√©es de OpenAI -> Jusqu'√† leur utilisation par etape6communication**
**Nous avons ensuite analys√© tous les process de r√©cup√©ration des Donn√©es de OPen Ai et l'utilisation faite par etape6communication**
  - Lis et analyse ces documents
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/00.ProcessRecuperationOpenAI.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/01.SiteInternetAnnonces.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/02.SiteInternetOutilsSeo.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/03.PortailsImmobiliers.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/04.Cr√©erEmailingCampagneNewsletter.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/05.EnvoyerCampagneSMS.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/06.Cr√©erLandingPage.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/07.DiffuserGoogleMB.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/08.DiffuserReseaux.md.
      - Quand tu auras fini, je te donnerai d'autres ressources √† lire, ne fais pas autre chose avant ma commande suivante il faut analyser les fichiers dans l'ordre
      - (ce n est pas la peine de me faire de synth√®se)
---
## **7 Infos Importantes sur notre Strat√©gie** 
**Voici 3 informations imporantes sur notre strat√©gie de migration**

**1/** **Strat√©gie de migration en 2 phases**
  - Pour faciliter la migration, nous allons utiliser une strat√©gie de migration en 2 phases
- **Phase 1** :
    - Migrer le process Localstorage vers -> Supabase
        - Pour les √©tapes 1 √† 5
        - C√†d, jusqu'√† l"envoi des prompts vers OpenAI
- **Phase 2** :
    - Migrer le process Localstorage vers -> Supabase
        - De Etape5animation √† la r√©cup√©ration des donn√©es g√©n√©r√©es par Open ai 
        - Jusqu'√† la r√©cup√©ration par etape6communication
        - Et l'utilisation par les 8 canaux

- **Nous allons travailler aujourd'hui exclusivement sur la phase 1**

**2/** **Imp√©ratif : CONSERVATION DU NOMMAGE camelCase**
  - Nous suivons √©galement une architecture avec CONSERVATION DU NOMMAGE camelCase
  - Tous les hooks, fonctions, et interactions Supabase cr√©√©s lors de la migration
    - DOIVENT imp√©rativement :
      - Conserver la structure camelCase existante pour les champs m√©tier (agencyName, propertyType, saleType, price, rentAmount, rentPeriodicity, keyElements, propertyDescription, financials, details, exclusivite, location, reference).
      - Utiliser snake_case uniquement pour les champs syst√®me Supabase (organisation_id, user_id, created_at, updated_at, etc.).
     
**REGLES CONCERNANT LE NOMMAGE DES camelCase**
- **R√®gle SQL - Cr√©ation de table**
    - Champs m√©tier : `"camelCase"` (avec guillemets doubles)
    - Champs syst√®me : `snake_case` (sans guillemets)
- **R√®gle TypeScript - Hooks & Services**
    - Utilisation directe du `camelCase` pour champs m√©tier
    - Utilisation directe du `snake_case` pour champs syst√®me
    - **AUCUNE fonction de conversion n'est n√©cessaire**
- **R√®gle Triggers**
    - Utiliser : `NEW."camelCase"` ou `NEW.snake_case`
    - Pr√©f√©rer les fonctions g√©n√©riques r√©utilisables
  - Cette directive s'apppliquera √† chacune de tes creations de fichier
    - J'ai encore d autres informations √† te faire p√¢sser
    - (ce n est pas la peine de me faire de synth√®se)

**3/** **Structure Multi tenant**
- Nous suivons une structure multi tenant avec une structure de visibilit√© impos√©e.
- 
- **Pour les structures** **R√©seaux**
| Type utilisateur | Acc√®s espace | Voit les projets de |
|------------------|--------------|---------------------|
| `reseau` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au r√©seau et √† sa direction) (Par respect confidentialit√© : Ne voit pas les projets des agences du r√©seau) |
| `reseau_direction` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au r√©seau et √† sa direction) (Par respect confidentialit√© : Ne voit pas les projets des agences du r√©seau)  |
| `reseau_agence` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_responsable` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |

- **Pour les structures** **Agences Ind√©pendantes**
| Type utilisateur | Acc√®s espace | Voit les projets de |
|------------------|--------------|---------------------|
| `agence_independante` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_responsable` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |

Est-ce clair, si oui je vais poursuivre dans le chat suivant
    - (ce n est pas la peine de me faire de synth√®se)

---
---
## 8/ Autres documents pr√©paratoires 
- Parfait
- Comme tu le sais je souhaite tout pr√©parer avant de m'attaquer aux codes.
- Car si on ne passe pas par cette etape pr√©paratoire on fait des erreurs.
  - Donc
  - **Nous avons √©tabli** :
  - 1- **Les bases de la strat√©gie de migration** ici :
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/00.StrategiePhase1.md
  - 2- **La table pr√©paratoire pour la migration** ici :
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.0.Table_etapes1to5.md
      - -> Une table qui respecte la strat√©gie multi tenant  :
        - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.1.GestionStrategieMultiTenant.md
      - -> Nous avons laiss√© en stand by la fonction Timer
        - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.2.FonctionTimer.md
      - -> Nous avons r√©dig√© un document explicatif de tous les champs de la table
        - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.3.ExplicationdesChamps.md
- 3- **Une bible recenssant toutes les fichiers, codes, hooks, localstorage utilis√©s actuellement pour avoir tout sous la main pour ne faire aucune erreur de codage final**
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/02.0.BibleR√©f√©rences.md
- 4- **Une pr√©sentation de la strat√©gie**
  - -> Nous avons dress√© les grandes lignes de notre strat√©gie
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/03.0.D√©tailStrat√©giePhase1.md

- **Merci de lire ces fichiers, car ma question va poser sur l'√©tape 5, le document pr√©paratoire sans codage**
  - ce n est pas la peine de r√©sumer
---
---
## **9/** **Document pr√©paratoire au codage**
**Dans cette √©tape, nous cherchons √† √©tablir des documents pr√©paratoires sans codage pour identifier les fichiers, hooks, sql... √† cr√©er, avec un cahier des charges pr√©cis pour faciliter le codage final**
- Voici le document avec les directives de prise en compte des ressources et de pr√©sentation
  - **public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.0.DocumentPr√©paratoirePhase1.md**
- Ce document pr√©voit un plan de r√©daction en 5 √©tapes ou sections pour faciliter notre mission
- Nous avons d√©j√† valid√© trois sections : 
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.3.1.VALIDATION-SECTION 1.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.3.2.VALIDATION-SECTION 2.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.3.3.VALIDATION-SECTION 3.md
- Nous allons travailler ensemble sur la section N¬∞
- Et r√©diger le fichier pr√©paratoire complet
  - est-ce clair?
  - Je vais te donner des directives pr√©cises dans le chat suivant pour r√©diger parfaitement ce document
  - ce n est pas la peine de r√©sumer
----
---
## **9/** **DIRECTIVE ‚Äì PHASE PR√âPARATOIRE SECTION 4 : SERVICES OPENAI**
# üß≠ 

---

## üéØ **Mission**

| √âl√©ment                         | Description                                                                                                                                                                                                                                                                    |
| :------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **√âtat actuel**                 | Aucune fonction SQL, trigger, RLS, ni hook sp√©cifique aux agents IA d‚Äôannonces n‚Äôexiste encore dans Supabase. Tous les composants doivent √™tre d√©finis **√† partir de z√©ro**.                                                                                                   |
| **Mission confi√©e √† Lovable**   | Pr√©parer le **document pr√©paratoire complet** de la **Section 4 ‚Äì SERVICES OPENAI** (phase d‚Äôanalyse avant codage).                                                                                                                                                            |
| **Objectif principal**          | G√©n√©rer des **cahiers des charges pr√©paratoires** d√©taillant les 7 services OpenAI (fonctions, validations, liaisons, appels, tables, contraintes, etc.) compatibles avec l‚Äô√©cosyst√®me LeadGenAI.                                                                              |
| **R√©f√©rence obligatoire**       | üìò `public/4.ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.1.v1.SECTION 4-1 - SERVICES OPENAI.md`                                                                                                                                                              |
| **R√©f√©rences des tables li√©es** | üìó Table OpenAI Keys ‚Üí `public/4.ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.1.v1.SECTION 4-2 - SERVICES OPENAI.md`<br>üìô Table OpenAI Logs ‚Üí `public/4.ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.1.v1.SECTION 4-3 - SERVICES OPENAI.md` |

---

## ‚öôÔ∏è **Objectif de la phase pr√©paratoire**

| √âl√©ment                         | Description                                                                                                                                                                                                                                                                                                                                    |
| :------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **But global**                  | Pr√©parer la **Section 4 ‚Äì SERVICES OPENAI** sans coder, mais en d√©crivant :<br>- les 7 services √† g√©n√©rer<br>- leurs interactions avec les hooks et tables existants<br>- les contraintes multi-tenant<br>- les correspondances avec les champs LocalStorage<br>- les s√©quences d‚Äôappel OpenAI<br>- les r√®gles de d√©clenchement et de stockage |
| **Livrable attendu**            | Un **document pr√©paratoire clair et complet**, au format des Sections 1, 2 et 3, contenant des **tableaux de conception** (fonctions, triggers, contraintes, RLS, hooks, composants).                                                                                                                                                          |
| **But final de la restitution** | Pr√©parer le **codage d√©finitif** de la section sans ambigu√Øt√© technique ni interpr√©tation.                                                                                                                                                                                                                                                     |

---

## üß± **Contexte technique √† respecter**

| √âl√©ment                    | Directive                                                                                                                                                                                                                                                                                                                                                                                 |
| :------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Structure multi-tenant** | La hi√©rarchie d‚Äôacc√®s reste inchang√©e :<br>‚Äì `reseau`, `reseau_direction` ‚Üí acc√®s √† leurs propres projets<br>‚Äì `reseau_agence`, `reseau_agence_responsable`, `reseau_agence_collaborateur` ‚Üí visibilit√© restreinte √† leur organisation<br>‚Äì `agence_independante`, `agence_independante_responsable`, `agence_independante_collaborateur` ‚Üí visibilit√© restreinte √† leurs propres projets |
| **Table de r√©f√©rence**     | `etapes_1to5` (structure, contraintes, camelCase/snake_case)                                                                                                                                                                                                                                                                                                                              |
| **Tables IA √† int√©grer**   | `openai_api_keys` (gestion des cl√©s multi-tenant) et `openai_usage_logs` (suivi des tokens et appels IA)                                                                                                                                                                                                                                                                                  |
| **Hooks √† respecter**      | `useSupabaseOperations`, `useMultiTenant`, `useCurrentUser`, et les fonctions de validation Section 2                                                                                                                                                                                                                                                                                     |
| **Champs et donn√©es**      | Tous les champs et cl√©s utilis√©s dans les √©tapes 1‚Üí5 et le process d‚Äôenvoi vers OpenAI (`n8_Etape1to5_ProcessEnvoiInfosOpenAI.md`) doivent √™tre repris tels quels.                                                                                                                                                                                                                        |
| **Prompts OpenAI**         | Aucun changement autoris√©. Tous les prompts sont utilis√©s tels qu‚Äôils existent dans `/src/services/openai/1.GenerateurAnnoncesOutilsSeo/7.PromptsOpenAi/`                                                                                                                                                                                                                                 |

---

## üìä **M√©thode de travail attendue**

| √âtape   | Description                                                                                                          |
| :------ | :------------------------------------------------------------------------------------------------------------------- |
| **1Ô∏è‚É£** | Identifier les 7 services OpenAI √† cr√©er et leur lien avec les √©tapes LocalStorage.                                  |
| **2Ô∏è‚É£** | Lister les fonctions, hooks, et champs utilis√©s par chaque service.                                                  |
| **3Ô∏è‚É£** | D√©crire dans un tableau la logique d‚Äôex√©cution s√©quentielle (await ‚Üí 1‚Üí7).                                           |
| **4Ô∏è‚É£** | Pr√©ciser les appels API (endpoint, param√®tres, mod√®le, structure message).                                           |
| **5Ô∏è‚É£** | Indiquer comment chaque service utilisera les tables `openai_api_keys` et `openai_usage_logs`.                       |
| **6Ô∏è‚É£** | D√©finir les contraintes de validation, erreurs et s√©curit√© (RLS, triggers, fallback cl√© globale).                    |
| **7Ô∏è‚É£** | R√©diger un tableau de restitution clair (1 ligne par service, 1 ligne par contrainte, 1 ligne par appel hook/table). |

---

## üß© **R√®gles et contraintes √† respecter**

| √âl√©ment                | Directive                                                                                                                                                                                                                             |
| :--------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Conformit√©**         | Toutes les propositions doivent √™tre bas√©es sur des √©l√©ments r√©els (documents, tables, hooks existants) ‚Äî aucune extrapolation.                                                                                                       |
| **Coh√©rence**          | Respect total des conventions de nommage (`camelCase` dans React / `snake_case` dans Supabase).                                                                                                                                       |
| **Structure**          | Chaque service doit √™tre document√© dans un tableau unique indiquant :<br>- nom du service<br>- fonction utilis√©e<br>- hooks impliqu√©s<br>- tables li√©es<br>- r√®gles d‚Äôacc√®s (multi-tenant)<br>- stockage<br>- d√©pendances √©ventuelles |
| **Migration**          | Les tables `openai_api_keys` et `openai_usage_logs` font **partie int√©grante de la Section 4** et doivent √™tre trait√©es dans la m√™me phase pr√©paratoire (pas avant, pas apr√®s).                                                       |
| **Phase 1 uniquement** | Aucun stockage Supabase des r√©sultats IA pour l‚Äôinstant ; stockage uniquement localStorage (confirm√© par `n8_Etape1to5_ProcessEnvoiInfosOpenAI.md`).                                                                                  |
| **Audit futur**        | Les triggers et logs serviront √† alimenter le reporting IA en Phase 2 (pas √† impl√©menter maintenant).                                                                                                                                 |

---

## üßæ **Restitution finale attendue**

| √âl√©ment                 | Format attendu                                                                                                                  |
| :---------------------- | :------------------------------------------------------------------------------------------------------------------------------ |
| **Document √† produire** | `04.1.v1.SECTION 4 - SERVICES OPENAI.md` (document pr√©paratoire complet de la Section 4).                                       |
| **Format**              | Identique aux Sections 2 et 3 : sommaire, contexte, tableau de d√©finition des fonctions, contraintes, RLS, hooks et composants. |
| **Base de r√©f√©rence**   | Fichiers `04.1.v1.SECTION 4-1`, `04.1.v1.SECTION 4-2`, `04.1.v1.SECTION 4-3`.                                                   |
| **Livraison**           | Tableaux d√©taill√©s pour les 7 services + cahier des charges des tables IA associ√©es.                                            |

---
-
-
-
-
-
-
-
-
-
-
-
-
-
-
----
## NOUVELLE SECTION 4
üëâ √âtat actuel :
- Aucune fonction SQL, trigger, RLS, ni hook sp√©cifique aux agents IA d‚Äôannonces n‚Äôexiste encore dans Supabase.
- Nous devons les cr√©er de z√©ro √† partir des documents de migration
- Nous travaillons actuellement sur la section n¬∞ 4

üëâ Mission : 
- Pr√©parer le document pr√©paratoire au codage d√©finitif de la section n¬∞4
- G√©n√©rer des cahiers des charges de chaque √©l√©ment (fonctions, triggers, RLS, hooks, composants, etc) compatibles avec :
  - Les documents strat√©giques de LeadGenAI AdBuilder,
  - La table etapes_1to5 (structure, contraintes, camelCase/snake_case),
  - La bible des r√©f√©rences (process, champs, cl√©s localStorage, prompts, etc.),
  - Les documents d'audit pr√©paratoires
  - Les fichiers actuels de l'application
  - La strat√©gie multi-tenant Supabase 

- **Pour les structures** **R√©seaux**
| Type utilisateur | Acc√®s espace | Voit les projets de |
|------------------|--------------|---------------------|
| `reseau` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au r√©seau et √† sa direction) (Par respect confidentialit√© : Ne voit pas les projets des agences du r√©seau) |
| `reseau_direction` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au r√©seau et √† sa direction) (Par respect confidentialit√© : Ne voit pas les projets des agences du r√©seau)  |
| `reseau_agence` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_responsable` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |

- **Pour les structures** **Agences Ind√©pendantes**
| Type utilisateur | Acc√®s espace | Voit les projets de |
|------------------|--------------|---------------------|
| `agence_independante` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_responsable` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |


üëâ Objectif :
  - G√©n√©rer un cahier des charges complet, exhausitif sous forme de tableaux
  - de chaque √©l√©ment en v√©rifiant ligne par ligne, code par code, que chaque proposition de fonction,  SQL, trigger, hook etc :
  - est techniquement correcte,
  - respecte les conventions multi-tenant et camelCase,
  - respecte les process actuels de localstorage et des fonctions, champs, composants utilis√©s 
  - afin d'etre impl√©ment√©s sans risque dans la base.

üëâ Restitution :
- G√©n√©rer un fichier md dans le chat suivant
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.1.v1.SECTION 4 - SERVICES OPENAI.md
- dedans tu g√©n√©ras 
  - des tableaux clairs, exhaustifs, v√©rifi√©s, reposant sur des informations r√©√©lles et non des extrapolations
  - pour pr√©parer le codage d√©finitif de la section

- 

Rappel des ressources √† utiliser
- Tenir de compte de  : public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.0.DocumentPr√©paratoirePhase1.md -> Rappel des directives
- Analyser tous les fichiers actuels de l'application
- Relire et tenir compte des documens d'audit du dossier : public/4. ReadMe EtapesAnnonces/01.Etape1√†5 (9 documents √† analyser)
- Relire : public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/00.StrategiePhase1.md
- Relire et tenir compte de : 
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.0.Table_etapes1to5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.1.GestionStrategieMultiTenant.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.3.ExplicationdesChamps.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/02.0.BibleR√©f√©rences.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/03.0.D√©tailStrat√©giePhase1.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/03.1.TableauRecapElementsACr√©er.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.3.1.VALIDATION-SECTION 1.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.3.2.VALIDATION-SECTION 2.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.3.3.VALIDATION-SECTION 3.md
  
- Est ce clair
- As tu des questions?
--
 --
  ---
  ---
  ---
  ---
  --
  ---
  ---
  
# 8/ 
<mark># ATTENTION </mark> 
<mark># PROMPT LANCEMENT</mark> 

1/ Relis les documents strat√©giques
  - public/1. Documents Strat√©giques/01. Pr√©sentation LeadGenAi.md
  - public/1. Documents Strat√©giques/02. Pr√©sentation Structure LeadGenAi.md
  - public/1. Documents Strat√©giques/03. Logique Organisations.md
  - public/1. Documents Strat√©giques/04. Relations Business entre Tables.md
  - public/1. Documents Strat√©giques/05. Relations Users Utilisateurs.md
  - public/1. Documents Strat√©giques/06. R√©f√©rence des Hooks Strat√©giques.md
  - public/1. Documents Strat√©giques/07.1. FormCreationReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - public/1. Documents Strat√©giques/07.2. FormGestionReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - public/1. Documents Strat√©giques/08. Gestion du Menu Gauche.md
  - public/1. Documents Strat√©giques/09. Structure - Organisation | Client_id.md
  - public/1. Documents Strat√©giques/10. Structure des Tables de Connexion & R√®gles Collaborateurs.md

2/ Relis L'int√©gralit√© des fiohiers de l'application

3/ Relis les tables et contraintes actuelles dans Supabase (hooks, fonctions...)
  - src/services/openai.ts
  - src/services/openai/1.GenerateurAnnoncesOutilsSeo/0.APIAutresFonctionsLeadGenAI/

4/ Relis Les 7 prompts dans 7.PromptsOpenAi/

5/ Relis la strat√©gie de la phase 1 
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/00.StrategiePhase1.md

6/ Relis les audits des √©tapes
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/01.Etape1.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/02.Etape2.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/03.Etape3.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/04.Etape4.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/05.Etape5.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/06.Etape5animation.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/07.BilanEtape1aEtape5.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/08.ProcessEnvoiInfosOpenAI.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/09.ProcessPassageEtapeSuivante.md

7/ Relis la table pr√©patoire et ses notes de bas de page et le doc multitenant
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.0.Table_etapes1to5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.1.GestionStrategieMultiTenant.md

8/ Relis la bible des √©l√©ments de r√©f√©rence
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/02.0.BibleR√©f√©rences.md

9/ Relis le d√©tail de la strat√©gie et le tableau r√©capitulatif des √©l√©ments
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/03.0.D√©tailStrat√©giePhase1.md
  - public/4. ReadMe - EtapesAnnonces/03.PreparationMigration/01.Etape1to5/03.1.TableauRecapElementsACr√©er.md

10/ Relis les directives pr√©paratoires du document 
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/04.0.DocumentPr√©paratoirePhase1.md
  - et les Imp√©ratif d'Architecture : Convention du nommage camelCase

9/ Relis les √©l√©ments pr√©paratoires pr√©c√©dents



-> et donne moi le md dans le chat suivant

