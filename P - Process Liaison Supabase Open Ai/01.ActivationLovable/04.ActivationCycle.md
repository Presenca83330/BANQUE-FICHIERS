# Ok 
---
- Bonjour expert Ia, no code, intégration supabase
  - J'ai besoin de toi concernant mon projet actuel de migration de mon application Lovable en localstorage vers Supabase
  - Nous venons de terminer la phase 1 de la migration mais
  - Avant de te poser ma question, il est impératif que je te redonne toutes les infos et ressources pour avoir tout le contexte à ta disposition
  - Je vais te donner mes ressources et infos en 4 étapes :
    - ETAPE 1 -> ANALYSE DE MON APPLICATION EN MODE LOCALSTORAGE
    - ETAPE 2 -> COMPRENDRE MA STRATEGIE DE MIGRATION
    - ETAPE 3 -> POINT SUR LA MIGRATION
    - ETAPE 4 -> NOTRE MISSION DE CE JOUR
---
# **ETAPE 1 - ANALYSE DE MON APPLICATION EN MODE LOCALSTORAGE**
---
**DIRECTIVE 1/ Lis et Analyse les Docs Stratégiques**
  - Pour mener ta mission, tu dois avoir une vision complète de mon application commence par lire les documents suivants :
      - public/1. Documents Stratégiques/01. Présentation LeadGenAi.md
      - public/1. Documents Stratégiques/02. Présentation Structure LeadGenAi.md
      - public/1. Documents Stratégiques/03. Logique Organisations.md
      - public/1. Documents Stratégiques/04. Relations Business entre Tables.md
      - public/1. Documents Stratégiques/05. Relations Users Utilisateurs.md
      - public/1. Documents Stratégiques/06. Référence des Hooks Stratégiques.md
      - public/1. Documents Stratégiques/07.1. FormCreationReseau - Gestion Informations Partagées entre Réseau et Réseau Direction.md
      - public/1. Documents Stratégiques/07.2. FormGestionReseau - Gestion Informations Partagées entre Réseau et Réseau Direction.md
      - public/1. Documents Stratégiques/08. Gestion du Menu Gauche.md
      - public/1. Documents Stratégiques/09. Structure - Organisation | Client_id.md
      - public/1. Documents Stratégiques/10. Structure des Tables de Connexion & Règles Collaborateurs.md
---
**DIRECTIVE 2/ Analyse et mémorise tous les process qui existait en Localstorage**

- **PARTIE 1 : Lis et Analyse les process de récolte des informations dans les étapes 1 à 5 et envoi des données structurées à Open AI**
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/01.Etape1.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/02.Etape2.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/03.Etape3.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/04.Etape4.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/05.Etape5.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/06.Etape5animation.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/07.BilanEtape1aEtape5.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/08.ProcessEnvoiInfosOpenAI.md
    - public/4. ReadMe EtapesAnnonces/01.Etape1à5/09.ProcessPassageEtapeSuivante.md

- **PARTIE 2 : Lis et Analyse comment sont récupérées les données de OPen Ai et utilisée dans etape6communication**
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/00.ProcessRecuperationOpenAI.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/01.SiteInternetAnnonces.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/02.SiteInternetOutilsSeo.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/03.PortailsImmobiliers.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/04.CréerEmailingCampagneNewsletter.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/05.EnvoyerCampagneSMS.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/06.CréerLandingPage.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/07.DiffuserGoogleMB.md
    - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/08.DiffuserReseaux.md
---
# **FIN ETAPE 1 -> ANALYSE DE LA L'APPLICATION EN MODE LOCALSTORAGE**
  - Lis tous les liens que je t'ai donné, ils sont nécessaires pour connaitre mon application et l'ancien fonctionnement en local storage
  - Ce n'est pas la peine de me faire de résumer, j'ai juste besoin de savoir si ces informations sont bien acquises
  - J'ai d'autres informations à te donner dans le chat suivant
---
# **ETAPE 2** -> **COMPRENDRE MA STRATEGIE DE MIGRATION**
---
## **DIRECTIVE 3 : Comprendre mon projet de migration Supabase**
  - J ai travaillé avec toi sur un projet d application simple c'est pour ça que l'on a travaillé tout d'abord en localstorage.
  - Puis je me suis aperçu qu'elle etait géniale en localstorage tout fonctionnait à merveille mais il m'était pas possible de la commercialiser en l etat, il fallait que je passe en gestion Supabase
  - En fait, ce que je recherchais et recherche toujours, il faut que tu comprennes, et c'est essentiel,
      - MON OBJECTIF est simplement de Passer de localStorage à Supabase. SANS RIEN CHANGER D'AUTRE
      - Garder TOUS les champs (noms, types, structures),TOUS les processus, TOUTES les validations,TOUTE la logique métier, TOUTE l'UX/UI (même comportement utilisateur)
      - **C'est une migration technique pure, pas une refonte.**

### **Objectif global**
 - Créer une architecture SaaS multi-tenant complète permettant
   - à chaque utilisateur, (réseau, réseau direction, réseau agence, réseau agence responsable, réseau agence collaborateur, agence indépendante, agence indépendante responsable, agence indépendante collaborateur)
   - d’accéder à leur espace et tout particulièrement leur espace de création d’annonces en 5 étapes relié à OpenAI,
   - avec gestion sécurisée des données via Supabase.
    
### **Rappel du Flux utilisateur global**
  - Connexion / Authentification : Authentification via Supabase (email / mot de passe)
  - Accès à l’espace personnel avec Redirection automatique selon le rôle :
    - RESEAU-ESPACE
    - CLIENT-ESPACE
    - COLLABORATEUR-ESPACE
    - Chaque espace ouvre un accès aux données propres accessibles à l'utilisateur et au module accueil-leadgenai pour lancer le générateur d'annonces et d'outils seo
---
## **DIRECTIVE 4 : Appliquer une Structure multi-tenant dans Supabase avec des Règles de visibilité hiérarchique**
  - Donc, chaque entité dispose d’un espace de travail isolé et sécurisé, basé sur son organisation_id ou client_id.
  - La visibilité hiérarchique et les accès utilisateurs sont gérés exclusivement via les RLS policies SQL, appliquées sur les tables principales.
  - Les hooks front n’assurent que l’injection des identifiants organisationnels.
  - Nous suivons une structure multi tenant avec une structure de visibilité imposée.

**Pour les structures** **Réseaux**
| Type utilisateur | Accès espace | Voit les projets de |
|------------------|--------------|---------------------|
| `reseau` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au réseau et à sa direction) (Par respect confidentialité : Ne voit pas les projets des agences du réseau) |
| `reseau_direction` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au réseau et à sa direction) (Par respect confidentialité : Ne voit pas les projets des agences du réseau)  |
| `reseau_agence` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_responsable` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |

**Pour les structures** **Agences Indépendantes**
| Type utilisateur | Accès espace | Voit les projets de |
|------------------|--------------|---------------------|
| `agence_independante` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_responsable` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |
---
## **Directive 5 : Appliquer une architecture du NOMMAGE camelCase non négociable**
  - Tous les hooks, fonctions, et interactions Supabase créés lors de la migration **DOIVENT impérativement** :
      - Conserver la structure camelCase existante pour les champs métier (agencyName, propertyType, saleType, price, rentAmount, rentPeriodicity, keyElements, propertyDescription, financials, details, exclusivite, location, reference).
      - Utiliser snake_case uniquement pour les champs système Supabase (organisation_id, user_id, created_at, updated_at, project_id, etc.).
      - Contrairement à une idée reçue, PostgreSQL/Supabase accepte parfaitement les noms de colonnes en camelCase, ils sont simplement encadrés par des guillemets doubles dans les requêtes si nécessaire.
      - **Règles concernant le nommage des camelCase** :
      - **Règle SQL - Création de table** : Champs métier : `"camelCase"` (avec guillemets doubles) // Champs système : `snake_case` (sans guillemets)
      - **Règle TypeScript - Hooks & Services** : Utilisation directe du `camelCase` pour champs métier // Utilisation directe du `snake_case` pour champs système // AUCUNE fonction de conversion n'est nécessaire
      - **Règle Triggers** : Utiliser : `NEW."camelCase"` ou `NEW.snake_case` // Préférer les fonctions génériques réutilisables
---
##  **DIRECTIVE 6 : Stratégie de migration en 2 phases**
- Nous utilisons une stratégie de migration en 2 phases 
  - **Phase 1** : **Migrer l'ancien process Localstorage de récupération des infos au cours de 5 étapes et d'envoi vers -> Supabase**
    - Avec Récupération des données saisies par Utilisateur lors des étapes 1 à 5
    - Jusqu'à l'envoi des prompts vers OpenAI
    - Gérer Etape5animation avec process d'animation et de gestion du statut pendant la phase d'attente des données provenant de open ai
    
 - **Phase 2** : **Migrer l'ancien process Localstorage de récupération des données envoyée par Open ai et injection dans etape6communication vers -> Supabase**
   - Avec Récupération des données renvoyées par OpenAi
   - Avec injection dans la page etape6communication
   - Jusqu'à leur utilisation par les différents canaux
---
## Nous avons terminé la migration phase 1**
---
# **FIN ETAPE 2 -> COMPRENDRE MA STRATEGIE DE MIGRATION**
  - Lis tous les liens que je t'ai donné, ils sont nécessaires pour connaitre ma stratégie 
  - Ce n'est pas la peine de me faire de résumer, j'ai juste besoin de savoir si ces informations sont bien acquises
  - J'ai d'autres informations à te donner dans le chat suivant
---
# **ETAPE 3 : POINT SUR LA MIGRATION**
- Voici les fichiers en place actuellement dans mon application
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/..v1.00.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/..v1.01.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/..v1.02.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/..v1.03.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/..v1.04.CodesPhase1.md

- Analyse également les tables associées à la migration phase 1 et actuellement dans Supabase
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/1.etapes_1to5.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/2.openai_api_keys.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/3.openai_usage_logs.md
---
- Lis ces documents et je te poserai ma question elle concerne un point de détail
---
# **ETAPE 4 : PASSONS A L'ACTION**
Parfait 
- Tout fonctionne parfaitement, j'avais simplement laissé de côté un doit de détail
  - **Le menu Gauche**
  - Pour bien comprendre
    - Lis ces ressources
    - Le 1er fichier est une ressource stratégique qui explique le fonctionnement de ce menu dans son ensemble
      - public/1. Documents Stratégiques/08. Gestion du Menu Gauche.md
    - Le 2eme fichier avait ete rédigé au moment des audits préparatoires, fais attention il fait allusion à des composants qui ont évolué notamment useStep mais il te donnera de précieuses informations
      - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/02--1.MenuGaucheNavLinks.md
    - Enfin je te donne les liens vers les emplacements des fichiers liés à ce menu
      - src/components/navigation-site-leadgenaiadbuilder/NavLinks.tsx
      - src/components/navigation-site-leadgenaiadbuilder/2.Hook-Autorisations/1.Aut.Acces.Dashboard.tsx
      - src/components/navigation-site-leadgenaiadbuilder/Layout.tsx
      - src/components/HOOKS-STRATEGIQUE/2.HOOK-useCurrentUser/useCurrentUser.ts
    - Mon objectif aujourd'hui est de réfléchir à la stratégie pour faire fonctionner ce menu avec mon process phase 1 qui n est plus en localstorage mais en supabase et le nouveau composant useStep
    - A ce stade je ne veux pas de code je veux réfléchir stratégie
---
---
