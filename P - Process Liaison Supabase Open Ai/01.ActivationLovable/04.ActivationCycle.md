# PRESENTATION

- Tu es un expert en Ia no code et intégration supabese.
  - Je suis en train de migrer mon process de recupération des données de mon générateur, d'envoi vers openai, de récupération et d'utilisation qui est en localstorage vers supabase en 2 phases
  - POur l'instant, nous avons terminé la phase 1 (récupération des données aux étapes 1 à 5 et envoi à open ai)
  - Mais avant pour bien travailler ensemble, tu dois absolument te remémorer la structure de mon application
  - Je vais te transmettre des données cruciales et des liens vers des fichiers que tu devras lire pour bien travailler ensemble
  - Ok?
---
```typescript
# ETAPE 1 - LIS ET ANALYSE MES DOCS STRATEGIQUES
---
  - Pour mener ta mission, tu dois avoir une vision complète de mon application commence par lire les documents suivants :
    - public/1. Documents Stratégiques/01. Présentation LeadGenAi.md
    - public/1. Documents Stratégiques/02. Présentation Structure LeadGenAi.md
    - public/1. Documents Stratégiques/03. Logique Organisations.md
    - public/1. Documents Stratégiques/04. Relations Business entre Tables.md
    - public/1. Documents Stratégiques/05. Relations Users Utilisateurs.md
    - public/1. Documents Stratégiques/06. Référence des Hooks Stratégiques.md
    - public/1. Documents Stratégiques/07.1. Stratégie - Gestion des informations partagées entre Réseau et Réseau Direction.md
    - public/1. Documents Stratégiques/08. Gestion du Menu Gauche.md
    - public/1. Documents Stratégiques/09. Structure - Organisation | Client_id.md
    - public/1. Documents Stratégiques/10. Structure des Tables de Connexion & Règles Collaborateurs.md
---
Lis et analyse ces documents, je te donnerai d'autres informations dans le chat suivant
---
```
```typescript
# ETAPE 2 - COMPRENDRE MON PROJET
---
- Au départ, j ai travaillé avec toi sur un projet d'application simple de génération d'annonces c'est pour ça que nous avons travaillé tout d'abord en localstorage.
  - Puis je me suis aperçu qu'elle etait géniale en localstorage tout fonctionnait à merveille.
  - J'ai rajouté progressivement d'autres fonctions : génération de campagnes newsletters, sms, etc
    - Mais, il m'était pas possible de la commercialiser mon application en l'état, il fallait que je passe en gestion Supabase
  - En fait, MON OBJECTIF est simplement de Passer de localStorage à Supabase. SANS RIEN CHANGER D'AUTRE
    - Garder TOUS les champs (noms, types, structures),TOUS les processus, TOUTES les validations,TOUTE la logique métier, TOUTE l'UX/UI (même comportement utilisateur)
    - **C'est une migration technique pure, pas une refonte.**
---
- Pour bien comprendre tu dois te rappeler comment fonctionnait mon application en localstorage
  - PARTIE 1 : Lis et Analyse les process de récolte des informations dans les étapes 1 à 5 et envoi des données structurées à Open AI
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/01.Etape1.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/02.Etape2.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/03.Etape3.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/04.Etape4.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/05.Etape5.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/06.Etape5animation.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/07.BilanEtape1aEtape5.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/08.ProcessEnvoiInfosOpenAI.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/09.ProcessPassageEtapeSuivante.md
  - PARTIE 2 : Lis et Analyse comment sont récupérées les données de OPen Ai et utilisée dans etape6communication
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/00.ProcessRecuperationOpenAI.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/01.SiteInternetAnnonces.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/02.SiteInternetOutilsSeo.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/03.PortailsImmobiliers.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/04.CréerEmailingCampagneNewsletter.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/05.EnvoyerCampagneSMS.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/06.CréerLandingPage.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/07.DiffuserGoogleMB.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/08.DiffuserReseaux.md
---
Lis et analyse ces documents, je te donnerai d'autres informations dans le chat suivant
---
```
```typescript
# ETAPE 3 - MON OBJECTIF
---
- Je veux créer une architecture SaaS multi-tenant complète permettant
  - à chaque utilisateur, (réseau, réseau direction, réseau agence, réseau agence responsable, réseau agence collaborateur, agence indépendante, agence indépendante responsable, agence indépendante collaborateur)
  - d’accéder à leur espace et tout particulièrement leur espace de création d’annonces en 5 étapes relié à OpenAI,
  - avec gestion sécurisée des données via Supabase.
---
## **Rappel du Flux utilisateur global**
  - Connexion / Authentification : Authentification via Supabase (email / mot de passe)
  - Accès à l’espace personnel avec Redirection automatique selon le rôle :
    - RESEAU-ESPACE
    - CLIENT-ESPACE
    - COLLABORATEUR-ESPACE
    - Chaque espace ouvre un accès aux données propres accessibles à l'utilisateur et au module accueil-leadgenai pour lancer le générateur d'annonces et d'outils seo
---
## **Nous appliquons une Structure multi-tenant dans Supabase avec des Règles de visibilité hiérarchique**
  - Donc, chaque entité dispose d’un espace de travail isolé et sécurisé, basé sur son organisation_id ou client_id.
    - La visibilité hiérarchique et les accès utilisateurs sont gérés exclusivement via les RLS policies SQL, appliquées sur les tables principales.
    - Les hooks front n’assurent que l’injection des identifiants organisationnels.
    - Nous suivons une structure multi tenant avec une structure de visibilité imposée.

**Pour les structures** **Réseaux**
| Type utilisateur | Accès espace | Voit les projets de |
|------------------|--------------|---------------------|
| `reseau` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au réseau et à sa direction) (Par respect confidentialité : Ne voit pas les projets des agences du réseau) |
| `reseau_direction` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au réseau et à sa direction) (Par respect confidentialité : Ne voit pas les projets des agences du réseau)  |
| `reseau_agence` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_responsable` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |

**Pour les structures** **Agences Indépendantes**
| Type utilisateur | Accès espace | Voit les projets de |
|------------------|--------------|---------------------|
| `agence_independante` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_responsable` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |
---
## **Nous appliquons une architecture du NOMMAGE camelCase**
  - Tous les hooks, fonctions, et interactions Supabase créés lors de la migration **DOIVENT impérativement** :
      - Conserver la structure camelCase existante pour les champs métier (agencyName, propertyType, saleType, price, rentAmount, rentPeriodicity, keyElements, propertyDescription, financials, details, exclusivite, location, reference).
      - Utiliser snake_case uniquement pour les champs système Supabase (organisation_id, user_id, created_at, updated_at, project_id, etc.).
      - Contrairement à une idée reçue, PostgreSQL/Supabase accepte parfaitement les noms de colonnes en camelCase, ils sont simplement encadrés par des guillemets doubles dans les requêtes si nécessaire.
      - **Règles concernant le nommage des camelCase** :
      - **Règle SQL - Création de table** : Champs métier : `"camelCase"` (avec guillemets doubles) // Champs système : `snake_case` (sans guillemets)
      - **Règle TypeScript - Hooks & Services** : Utilisation directe du `camelCase` pour champs métier // Utilisation directe du `snake_case` pour champs système // AUCUNE fonction de conversion n'est nécessaire
      - **Règle Triggers** : Utiliser : `NEW."camelCase"` ou `NEW.snake_case` // Préférer les fonctions génériques réutilisables
---
##  **Nous appliquons une Stratégie de migration en 2 phases**
  - **Phase 1** : **Migrer l'ancien process Localstorage de récupération des infos au cours de 5 étapes et d'envoi vers -> Supabase**
    - Avec Récupération des données saisies par Utilisateur lors des étapes 1 à 5
    - Jusqu'à l'envoi des prompts vers OpenAI
    - Gérer Etape5animation avec process d'animation et de gestion du statut pendant la phase d'attente des données provenant de open ai
    
 - **Phase 2** : **Migrer l'ancien process Localstorage de récupération des données envoyée par Open ai et injection dans etape6communication vers -> Supabase**
   - Avec Récupération des données renvoyées par OpenAi
   - Avec injection dans la page etape6communication
   - Jusqu'à leur utilisation par les différents canaux
---
## **Nous avons terminé la migration phase 1**
---
As-tu bien compris ces éléments, je vais te donner d'autres infos dans le chat suivant
---
```
```typescript
# **ETAPE 4 - NOUS AVONS TERMINE LA PHASE 1**
- Nous avons terminé la phase 1 et le process de récupération des informations et d'envoi vers OpenAi fonctionne
- Le process de récupération dans la page etape6communication fonctionne également
- Lis ces documentations pour mieux te rappeler du process phase 1 :
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/01.--Objectifs.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/02.--CyclesdeVieProjets.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/03.--ArchitectureOpenAI.md

- Tu peux avoir une vision d'ensemble de tous les fichiers utilisés actuellement dans la phase 1 de mon application
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.00.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.01.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.02.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.03.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.04.CodesPhase1.md

- Tu peux également analyser les tables associées à la migration phase 1 et actuellement dans Supabase
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/04.--TablesPhase1.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/1.etapes_1to5.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/2.openai_api_keys.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/3.openai_usage_logs.md
 
- Tu peux si tu le souhaites analyser tous les process en analysant
    - src
---
Lis ces documents et As-tu bien compris ces éléments, je vais te donner d'autres infos dans le chat suivant
---
---
```
```typescript
# **ETAPE 5 : COMMENCER LA  PHASE 2**
---
- Nous travaillons maintenant sur la mise en place progressive de la phase 2
  - Je te rappelle qu'elle consiste à récupérer les données générées par OpenAi et les injecter dans les différents canaux de etape6communication

- Tu auras une vue d'ensemble en étudiant ce documents qui rappelle le process localstorage que nous voulons migrer vers supabase :
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/01--1.AuditPhase2.md
  - Ce document est lié aux 9 fichiers que tu as étudiés dans le dossier : public/4. ReadMe EtapesAnnonces/02.Etape6Communication

- Tu dois comprendre comment nous allons procéder pour migrer phase 2 vers Supabase
  - Nous allons travailler canal par canal, nous ne traiterons rien globalement
  - Nous avons pris la décision de partir de la table etapes_1to5 et d'ajouter des colonnes pour permettre de sauvegarder les corrections des utilisateurs dans chaque canal
    - Lis ce document pour bien comprendre notre direction
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/02--1.ReadMeMigrationPhase2.md

- Nous avons enfin programmé la création de 2 espaces "Mes anciens projets" et "Mes saisies"
  - Ces espaces seront créées graphiquement et techniquement à la fin de la migration des 8 canaux de etape6communication
  - Mais tu dois comprendre parfaitement son fonctionnement pour bien gérer les migrations par canal
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/.--2.ToDoListMesProjets.md

- Pour information complementaire nous utiliserons un nommage précis et des emplacements précis pour réaliser notre migration
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/03--1.Nomenclature.md

```
```typescript
# **ETAPE 6 : PROJET DE MIGRATION CANAL ANNONCE SITE INTERNET - CANAL 1**
---
- Comme je l'ai indiqué nous travaillons canal par canal
  - Nous allons commencer par le canal Annonces Site Internet cad canal "Copier Annonce Site Internet" dans l'application ou parfois nommé Canal 1

- Nous avons préparé un audit pour se rappeler des process localstorage actuel
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.03.0.Etape6Canal1/01--1.AuditCanal1.md

- Nous avons prévu une stratégie de migration et nous avons préparé les codes préparatoires
  - Je te demande d'analyser ces deux documents et me dire si à ton avis ils peuvent être suivis ou alors si tu identifies des risques de bugs
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.03.0.Etape6Canal1/03--StratégieMigrationCanal1.md


```
```typescript

```
