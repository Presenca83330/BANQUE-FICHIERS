# PRESENTATION
```typescript
- Bonjour
- Tu es un expert en Ia no code et intégration supabese.
  - Je suis en train de migrer mon process de recupération des données de mon générateur, d'envoi vers openai, de récupération et d'utilisation qui est en localstorage vers supabase en 2 phases
  - POur l'instant, nous avons terminé la phase 1 (récupération des données aux étapes 1 à 5 et envoi à open ai)
  - Nous travaillons sur la migration de la phase 2, nous avons déjà travaillé et migré les canaux 1/2/3/4/5 et l espace Newsletter Builder
  - Mais avant d'aller plus moi dans ma demande de ce jour et pour bien travailler ensemble, tu dois absolument te remémorer la structure de mon application et notre historique
  - Je vais te transmettre des données cruciales et des liens vers des fichiers que tu devras lire pour bien travailler ensemble
  - Ce ne sera pas la peine de me faire de résumer à chaque message, écris moi simplement en retour que tu as tout lu et que tu as bien compris
  - Je passerai alors à la transmission de la ressource suivante
  - Jusqu'à la dernière étape où je te poserai ma question du jour
  - Ok?
```
---
```typescript
# ETAPE 1 - LIS ET ANALYSE MES DOCS STRATEGIQUES
---
  - Pour mener ta mission, tu dois avoir une vision complète de mon application commence par lire les documents suivants :
    - public/1. Documents Stratégiques/01. Présentation LeadGenAi.md
    - public/1. Documents Stratégiques/02. Présentation Structure LeadGenAi.md
    - public/1. Documents Stratégiques/03. Logique Organisations.md
    - public/1. Documents Stratégiques/04. Relations Business entre Tables.md
    - public/1. Documents Stratégiques/05. Relations Users Utilisateurs.md
    - public/1. Documents Stratégiques/06. Référence des Hooks Stratégiques.md
    - public/1. Documents Stratégiques/07.1. Stratégie - Gestion des informations partagées entre Réseau et Réseau Direction.md
    - public/1. Documents Stratégiques/08. Gestion du Menu Gauche.md
    - public/1. Documents Stratégiques/09. Structure - Organisation | Client_id.md
    - public/1. Documents Stratégiques/10. Structure des Tables de Connexion & Règles Collaborateurs.md
    - public/1. Documents Stratégiques/12.ReadMe Espace Newsletter.md
---
Lis et analyse ces documents, je te donnerai d'autres informations dans le chat suivant
---
```
```typescript
# ETAPE 2 - COMPRENDRE MON PROJET
---
- Au départ, j ai travaillé avec toi sur un projet d'application simple de génération d'annonces c'est pour ça que nous avons travaillé tout d'abord en localstorage.
  - Puis je me suis aperçu qu'elle etait géniale en localstorage tout fonctionnait à merveille.
  - J'ai rajouté progressivement d'autres fonctions : génération de campagnes newsletters, sms, etc
    - Mais, il m'était pas possible de la commercialiser mon application en l'état, il fallait que je passe en gestion Supabase
  - En fait, MON OBJECTIF est simplement de Passer de localStorage à Supabase. SANS RIEN CHANGER D'AUTRE
    - Garder TOUS les champs (noms, types, structures),TOUS les processus, TOUTES les validations,TOUTE la logique métier, TOUTE l'UX/UI (même comportement utilisateur)
    - **C'est une migration technique pure, pas une refonte.**
---
- Pour bien comprendre tu dois te rappeler comment fonctionnait mon application en localstorage
  - PARTIE 1 : Lis et Analyse les process de récolte des informations dans les étapes 1 à 5 et envoi des données structurées à Open AI
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/01.Etape1.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/02.Etape2.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/03.Etape3.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/04.Etape4.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/05.Etape5.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/06.Etape5animation.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/07.BilanEtape1aEtape5.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/08.ProcessEnvoiInfosOpenAI.md
      - public/4. ReadMe EtapesAnnonces/01.Etape1à5/09.ProcessPassageEtapeSuivante.md
  - PARTIE 2 : Lis et Analyse comment sont récupérées les données de OPen Ai et utilisée dans etape6communication
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/00.ProcessRecuperationOpenAI.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/01.SiteInternetAnnonces.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/02.SiteInternetOutilsSeo.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/03.PortailsImmobiliers.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/04.CréerEmailingCampagneNewsletter.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/05.EnvoyerCampagneSMS.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/06.CréerLandingPage.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/07.DiffuserGoogleMB.md
      - public/4. ReadMe EtapesAnnonces/02.Etape6Communication/08.DiffuserReseaux.md
---
Lis et analyse ces documents, je te donnerai d'autres informations dans le chat suivant
---
```
```typescript
# ETAPE 3 - MON OBJECTIF
---
- Je veux créer une architecture SaaS multi-tenant complète permettant
  - à chaque utilisateur, (réseau, réseau direction, réseau agence, réseau agence responsable, réseau agence collaborateur, agence indépendante, agence indépendante responsable, agence indépendante collaborateur)
  - d’accéder à leur espace et tout particulièrement leur espace de création d’annonces en 5 étapes relié à OpenAI,
  - avec gestion sécurisée des données via Supabase.
---
## **Rappel du Flux utilisateur global**
  - Connexion / Authentification : Authentification via Supabase (email / mot de passe)
  - Accès à l’espace personnel avec Redirection automatique selon le rôle :
    - RESEAU-ESPACE
    - CLIENT-ESPACE
    - COLLABORATEUR-ESPACE
    - Chaque espace ouvre un accès aux données propres accessibles à l'utilisateur et au module accueil-leadgenai pour lancer le générateur d'annonces et d'outils seo
---
## **Nous appliquons une Structure multi-tenant dans Supabase avec des Règles de visibilité hiérarchique**
  - Donc, chaque entité dispose d’un espace de travail isolé et sécurisé, basé sur son organisation_id ou client_id.
    - La visibilité hiérarchique et les accès utilisateurs sont gérés exclusivement via les RLS policies SQL, appliquées sur les tables principales.
    - Les hooks front n’assurent que l’injection des identifiants organisationnels.
  - à chaque utilisateur, (réseau, réseau direction, réseau agence, réseau agence responsable, réseau agence collaborateur, agence indépendante, agence indépendante responsable, agence indépendante collaborateur)
    - d’accéder à leur espace et tout particulièrement leur espace de création d’annonces en 5 étapes relié à OpenAI,
    - avec gestion sécurisée des données via Supabase.
| Identifiant | Rôle |
|-------------|------|
| `organisation_id` | Isolation tenant |
| `user_id` | Créateur du projet |
| `utilisateur_type_compte` | Portée de visibilité |

---
## **Implémentation**
- **RLS Policies SQL** : Gèrent la visibilité hiérarchique
- **Hooks Frontend** : Injectent uniquement les identifiants organisationnels
- **Pas de logique métier côté client** pour la sécurité
---

    - Nous suivons une structure multi tenant avec une structure de visibilité imposée.

**Pour les structures** **Réseaux**
| Type utilisateur | Accès espace | Voit les projets de |
|------------------|--------------|---------------------|
| `reseau` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au réseau et à sa direction) (Par respect confidentialité : Ne voit pas les projets des agences du réseau) |
| `reseau_direction` | `/accueil-leadgenai` | reseau + reseau_direction (projets internes au réseau et à sa direction) (Par respect confidentialité : Ne voit pas les projets des agences du réseau)  |
| `reseau_agence` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_responsable` | `/accueil-leadgenai` | reseau_agence + reseau_agence_responsable + reseau_agence_collaborateur |
| `reseau_agence_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |

**Pour les structures** **Agences Indépendantes**
| Type utilisateur | Accès espace | Voit les projets de |
|------------------|--------------|---------------------|
| `agence_independante` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_responsable` | `/accueil-leadgenai` | agence_independante + agence_independante_responsable + agence_independante_collaborateur |
| `agence_independante_collaborateur` | `/accueil-leadgenai` | **Uniquement ses propres projets** |

### LES CLES OPENAI/Brevo/GetLate QU'UTILISENT LES UTILISATEURS S'ILS ONT LEURS PROPRES CLES
**Pour les structures** **Réseaux**
| Type utilisateur | Si elle est saisie -> Utilise la clé openai de :  |
|------------------|--------------|
| `reseau` | Clé Openai/Brevo/GetLate reseau  |
| `reseau_direction` | Clé OPenai/Brevo/GetLate reseau  |
| `reseau_agence` |  Clé OPenai/Brevo/GetLate reseau_agence  |
| `reseau_agence_responsable` | Clé OPenai/Brevo/GetLate reseau_agence  |
| `reseau_agence_collaborateur` | Clé OPenai/Brevo/GetLate reseau_agence  |
---
**Pour les structures** **Agences Indépendantes**
| Type utilisateur | Si elle est saisie -> Utilise la clé de :  |
|------------------|--------------|
| `agence_independante` | Clé OPenai/Brevo/GetLate agence_independante |
| `agence_independante_responsable` | Clé OPenai/Brevo/GetLate agence_independante |
| `agence_independante_collaborateur` | Clé OPenai/Brevo/GetLate agence_independante |
---
---

## **Nous appliquons une architecture du NOMMAGE camelCase**
  - Tous les hooks, fonctions, et interactions Supabase créés lors de la migration **DOIVENT impérativement** :
      - Conserver la structure camelCase existante pour les champs métier (agencyName, propertyType, saleType, price, rentAmount, rentPeriodicity, keyElements, propertyDescription, financials, details, exclusivite, location, reference).
      - Utiliser snake_case uniquement pour les champs système Supabase (organisation_id, user_id, created_at, updated_at, project_id, etc.).
      - Contrairement à une idée reçue, PostgreSQL/Supabase accepte parfaitement les noms de colonnes en camelCase, ils sont simplement encadrés par des guillemets doubles dans les requêtes si nécessaire.
      - **Règles concernant le nommage des camelCase** :
      - **Règle SQL - Création de table** : Champs métier : `"camelCase"` (avec guillemets doubles) // Champs système : `snake_case` (sans guillemets)
      - **Règle TypeScript - Hooks & Services** : Utilisation directe du `camelCase` pour champs métier // Utilisation directe du `snake_case` pour champs système // AUCUNE fonction de conversion n'est nécessaire
      - **Règle Triggers** : Utiliser : `NEW."camelCase"` ou `NEW.snake_case` // Préférer les fonctions génériques réutilisables
---
##  **Nous appliquons une Stratégie de migration en 2 phases**
  - **Phase 1** : **Migrer l'ancien process Localstorage de récupération des infos au cours de 5 étapes et d'envoi vers -> Supabase**
    - Avec Récupération des données saisies par Utilisateur lors des étapes 1 à 5
    - Jusqu'à l'envoi des prompts vers OpenAI
    - Gérer Etape5animation avec process d'animation et de gestion du statut pendant la phase d'attente des données provenant de open ai
    
 - **Phase 2** : **Migrer l'ancien process Localstorage de récupération des données envoyée par Open ai et injection dans etape6communication vers -> Supabase**
   - Avec Récupération des données renvoyées par OpenAi
   - Avec injection dans la page etape6communication
   - Jusqu'à leur utilisation par les différents canaux
---
## **Nous avons terminé la migration phase 1**
---
As-tu bien compris ces éléments, je vais te donner d'autres infos dans le chat suivant
---
```
```typescript
# **ETAPE 4 - NOUS AVONS TERMINE LA PHASE 1**
- Nous avons terminé la phase 1 et le process de récupération des informations et d'envoi vers OpenAi fonctionne
- Le process de récupération dans la page etape6communication fonctionne également
- Lis ces documentations pour mieux te rappeler du process phase 1 :
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/01.--Objectifs.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/02.--CyclesdeVieProjets.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/03.--ArchitectureOpenAI.md

- Tu peux avoir une vision d'ensemble de tous les fichiers utilisés actuellement dans la phase 1 de mon application
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.00.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.01.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.02.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.03.CodesPhase1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/v1.04.CodesPhase1.md

- Tu peux également analyser les tables associées à la migration phase 1 et actuellement dans Supabase
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/04.--TablesPhase1.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/1.etapes_1to5.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/2.openai_api_keys.md
    - public/2. Etats des Tables /5.Tables.Migration.Phase1/3.openai_usage_logs.md

- Nous avons identifier une erreur que nous corrigerons plus tard mais qui doit etre prise en compte pour les prochaines migrations
- Bon 95% des utilisateurs utiliserons notre clé présenca
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.01-ProcessPhase1/05.--IdentifiicationErreurOpenai.md
 
- Tu peux si tu le souhaites analyser tous les process en analysant
    - src

Lis ces documents et As-tu bien compris ces éléments, je vais te donner d'autres infos dans le chat suivant
---

```
```typescript
# **ETAPE 5 : COMMENCER LA  PHASE 2**
---
- Nous travaillons maintenant sur la mise en place progressive de la phase 2
  - Je te rappelle qu'elle consiste à récupérer les données générées par OpenAi et les injecter dans les différents canaux de etape6communication
- Lis ces fichiers pour bien comprendre :
    - La situation localstorage actuelle
    - Des explications pour mener les migrations
    - Des Alertes

- Fichiers à lire : Consignes générales de conception et de migration
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/01--1.AuditPhase2.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/02--1.ReadMeMigrationPhase2.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/03--1.Nomenclature.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/04--1.GuideMigrationCanaux.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/05--1.FonctionModifierSauvegarder.md

- Fichiers d'alerte avec consignes pour éviter des erreurs
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/..--1.AlerteWYSIWYG.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/..--2.AlerteEtape5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/..--3.AlerteBugGenerer.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/..--4ToDoListRetry.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/..--5AlerteBrevoIp.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/..--6AlerteStaleClosure.md

- Fichiers de ToDo lists
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/.--2.ToDoListMesProjets.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/.--5.ToDoListOpenaiConnexion.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/.--6.ToDoListOptionsPayantes.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/.--7.ToDoListFaqCanal5.md

- Lis ces documents, je te donnerai des informations sur les migrations effectuées 
```
```typescript
# **ETAPE 6 : MIGRATION CANAL 1/2/3/4/5**
---
- Comme je l'ai indiqué nous travaillons canal par canal
    - Canal 1 : Copier / Publier sur mon Site Internet
    - Canal 2 : Copier / Intéger sur mon Site Internet
    - Canal 3 : Copier / Publier sur mes Portails Immobiliers
    - Canal 4 : Créer un Emailing Annonce ou une Campagne Newsletter
    - Canal 5 : Copier / Envoyer une Campagne SMS
    - Canal 6 : Copier / Diffuser sur ma Fiche Google Business Profile
    - Canal 7 : Copier / Diffuser sur mes Réseaux Sociaux
    - Canal 8 : Créer une Landing Page Annonce Dédiée
- Nous avons migré les canaux 1/2/3/4/5/

- Pour chaque canal, nous travaillons en 3 étapes 
    - 1 audit
    - un document de stratégie préparatoire
    - un doc préparatoire avec tous les codes

- Analyse les informations qui nous ont permis de migrer sans défaut ces canauls
MIGRATION CANAL 1
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.03.0.Etape6Canal1/01--1.AuditCanal1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.03.0.Etape6Canal1/02--StratégieMigrationCanal1.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.03.0.Etape6Canal1/03--CodesCanal1.md

MIGRATION CANAL 2
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.04.0.Etape6Canal2/01--1.AuditCanal2.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.04.0.Etape6Canal2/02--StratégieMigrationCanal2.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.04.0.Etape6Canal2/03--CodesCanal2.md

MIGRATION CANAL 3
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.05.0.Etape6Canal3/01--1.AuditCanal3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.05.0.Etape6Canal3/02--StrategieMigrationCanal3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.05.0.Etape6Canal3/03--CodesCanal3.md

MIGRATION CANAL 4
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/01--1.AuditCanal4.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/01--2.AuditNewsletterBuilder.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/02--StrategieMigrationCanal4.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/03--CodesCanal4.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/04--PrepTableNewsletterBuilder.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/05--SqlCreationTableNB.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/07--Tablenewsletter_builder.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/08--InjectionAgenceTemplate.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/09--EnrichissementTableNewsletterBuilder.md

MIGRATION CANAL 5
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/.--1.ToDoListFaq.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/01--1.AuditCanal5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/01--1.AuditPrécisionsTable.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/02--1.APIBrevoSynthese.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/02--2.APIRéponses.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/03--1.StratégiePhaseACanal5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/03--2.CodesPrepPhaseA.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/03--3.RécapPhaseACanal5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/04--1_StrategiePhaseBCanal5-CORRIGE-V3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/04--2_CodesPhaseBCanal5-CORRIGE-V3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/04--3_RécapPhaseBCanal5-CORRIGE-V3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/05--1.ToDoListOptionPayante.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/06--1.ArchiMultitenantApi.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/07--1.GestionClésApiUtilisateurs.md

- Merci de lire ces documents
- Je te poserai mas question dans le prochain chat

```
---

```typescript

# **ETAPE 7 : CANAL 6 - GOOGLE PROFILE **
- Nous allons travailler sur la migration du canal 6 | Votre Annonce Google Business Profile À Copier ou À Envoyer
- Avant de préparer cette migration, j'ai besoin d'un audit très complet de l'existant localstorage qu il va falloir migrer
- A ce stade, je ne veux pas de codes, mais je veux tout savoir de l'existant, des hooks, fonctions, des EditeurWYSIWYG, des boutons corriger, des fonctions copier, les processus de récupération des données de open ai
- tout, tout.
- J'ai besoin de tout avoir en détail pour bien preparer la stratégie et ensuite les codes
- je veux que tu me prépares un md compler avec sommaire cliquable et un maxi de tableaux comme nous avons fait pour : public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.06.0.Etape6Canal4/01--1.AuditCanal4.md
- les données sont dans  : src/components/1-Sources-Restitution-Utilisateur/6.EtapeDiffuserGoogleAnnonce
---
```
---
---
---
---
---
---
---
---
---

```typescript
```

```
# **ETAPE 7 : NEWSLETTER BUILDER **
- Lors de la migration du canal 4 : Créer un Emailing Annonce ou une Campagne Newsletter
- Nous avons également commencer à paramétrer une table newsletter_builder
  - Je vais te rappeler l'objectif de ce canal
    - ici l'utilisateur récupére la propositon d'annonce newsletter générée par openai
    - Il peut la conserver, la modifier, la copier pour ses propres besoin
    - Mais, il peut aussi la sauvegarder pour pouvoir l'utiliser dans notre espace Newsletter Builder qui lui permettra de générer et d'envoyer une newsletter avec Brevo
    - Pour permettre cette sauvegarde nous avons créer une table : newsletter_builder
    - tu peux l 'analyser ici : public/2. Etats des Tables /6.Tables.NewsletterBuilder/1.newsletter_builder.md

- Pour bien comprendre le fonctionnement et la migration future de l'espace Newsletter Builder nous avons travaillé sur certains documents
    - tu peux analyser le dossier actuel : src/components/NEWSLETTER-BUILDER

- Mais lis aussi mes ressources
- Lis les audits préparatoires
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.0-AuditsNewsBuilder/00.PresentationGénéraleNBuilder.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.0-AuditsNewsBuilder/01.AuditSauvegarde.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.0-AuditsNewsBuilder/02.AuditOnglet1ElementsNewsletter.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.0-AuditsNewsBuilder/03.AuditOnglet2Configuration.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.0-AuditsNewsBuilder/04.AuditOnglet3TestEtEnvoi.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.0-AuditsNewsBuilder/05.AuditBibledeReferences.md

- Lis ces analyses préparatoires de l'api Brevo
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--1.APIBrevoSynthese.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--2.APIBrevoGuide.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--3.APIBrevoTemplateNewsletter.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--4.APIBrevoExplCreaTemplate.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--5.APIBrevoCodeTemplate.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--6.APIBrevoSupabaseStorage.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--7.APIBrevoConfigurationObjet.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--8.APIBrevoParameOnglet2.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--9.APIBrevoTest.md

- Lis ces informations et je te poserai ma question dans le chat suivant

```
---
```typescript
# **ETAPE 8 : MIGRATION ESPACE NEWSLETTER BUILDER**
- J'ai commerncé avec Claude à migrer l'espace 
- Nous travaillons en etapes, migrations :
-1/ Espace sauvegarde
-2/ Onglets 1
-3/ Onglet 2
-4/ Onglet 3

Etape 1 - Nous avons réussi la migration de l'espace Sauvegarde ménu gauche 
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.01-MigSauvegarde/00.StrategieSauvegarde.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.01-MigSauvegarde/01.CodesMigrationSauvegarde.md
  -> Analyse les codes dans : src/components/NEWSLETTER-BUILDER
  -> src/components/NEWSLETTER-BUILDER/HOOKS-SUPABASE-SAUVEGARDE

Etape 2 - Nous avons réussi la migration de l'onglet 1 avec la création d'une nouvelle table
Analyse ces fichiers, il y a notre stratégie, les codes utilisés, des conseils 
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.02-MigOnglet1Elements/.--01.ToDoList.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.02-MigOnglet1Elements/...01.AnalyseLovable.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.02-MigOnglet1Elements/00.StrategieOnglet1.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.02-MigOnglet1Elements/01.TablePrepNewsGenerationBrevo.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.02-MigOnglet1Elements/03.AdaptationTablesBrevoClients.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.02-MigOnglet1Elements/04.CodesMigOnglet1.md
  -> Analyse les codes dans : src/components/NEWSLETTER-BUILDER
  -> src/components/NEWSLETTER-BUILDER/HOOKS-SUPABASE-ONGLET1-ELTS

Etape 3 - Nous avons réussi la migraiton de l'onglet 2 
  - Analyse ces fichiers, il y a notre stratégie, les codes utilisés, des conseils
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.03-MigOnglet2Configuration/...01.AuditLovable.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.03-MigOnglet2Configuration/...02.AuditLovable.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.03-MigOnglet2Configuration/...04.StrategieOnglet2.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.03-MigOnglet2Configuration/...05.CodesPrepOnglet2.md
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.03-MigOnglet2Configuration/...06.AlerteStatePartagé.md

Etape 4 - Nous avons réussi la migration de l'onglet 3
  - Analyse ces fichiers, il y a notre stratégie, les codes utilisés, des conseils
- public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...01.AuditLovable.md
- public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...02.AuditLovable.md
- public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...03.StrategieOnglet3.md
- public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...04.CodesOnglet3.md
- public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...05.StrategiePostEnvoi.md

Tu peux analyser les tables dans supabase et ici
  - public/2. Etats des Tables /7.Tables.Migration.Phase2/2.newsletter_generation_brevo.md
  - public/2. Etats des Tables /7.Tables.Migration.Phase2/1.brevo_sms_logs.md
  - public/2. Etats des Tables /6.Tables.NewsletterBuilder/1.newsletter_builder.md
  - public/2. Etats des Tables /2.Tables.Clients/1.reseau.md
  - public/2. Etats des Tables /2.Tables.Clients/3.reseau_agence.md
  - public/2. Etats des Tables /2.Tables.Clients/6.agence_independante.md
  - public/2. Etats des Tables /3.Tables.Connexion/1.brevo_connexion.md

- Analyse ces fichiers et je te poserai ma question dans le chat suivant
```
---
```typescript
# **ETAPE 9  : NOUS TRAVAILLONS SUR L'ONGLET 3 **

- Nous avons fait un travail d'audit
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...01.AuditLovable.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...02.AuditLovable.md

- Nous avons défini une stratégie de migration en respectant les directives de migration et les contraintes des api brevo
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...03.StrategieOnglet3.md
- Ainsi que les codes préparatoires à la migration
  - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...04.CodesOnglet3.md

Question -> Je te demande d'analyser ces deux documents et me dire si à ton avis ils peuvent être suivis ou alors si tu identifies des risques de bugs

Attention pour bien faire cette analyse 
## -> Relis les directives Générales de migration meme si elles ne concernent pas directement cet espace newsletter builder, mais elles intégrent la notion de pont des anciens hooks
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/02--1.ReadMeMigrationPhase2.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/03--1.Nomenclature.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/04--1.GuideMigrationCanaux.md
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.02.0.Etape6Global/05--1.FonctionModifierSauvegarder.md

## -> Relis les directives concernant les api brevo
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--1.APIBrevoSynthese.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--2.APIBrevoGuide.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--3.APIBrevoTemplateNewsletter.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--4.APIBrevoExplCreaTemplate.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--5.APIBrevoCodeTemplate.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--6.APIBrevoSupabaseStorage.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--7.APIBrevoConfigurationObjet.md
    - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.00-APIBrevoNotes/.--8.APIBrevoParameOnglet2.md

## -> Relis les codes utilisés lors des migrations des canaux 5 sms qui utilise Brevo  
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/.--1.ToDoListFaq.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/01--1.AuditCanal5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/01--1.AuditPrécisionsTable.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/02--1.APIBrevoSynthese.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/02--2.APIRéponses.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/03--1.StratégiePhaseACanal5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/03--2.CodesPrepPhaseA.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/03--3.RécapPhaseACanal5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/04--1_StrategiePhaseBCanal5-CORRIGE-V3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/04--2_CodesPhaseBCanal5-CORRIGE-V3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/04--3_RécapPhaseBCanal5-CORRIGE-V3.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/05--1.ToDoListOptionPayante.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/06--1.ArchiMultitenantApi.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.07.0.Etape6Canal5/07--1.GestionClésApiUtilisateurs.md

## -> Relis les tables utilisées dans supabase et ici
  - public/2. Etats des Tables /7.Tables.Migration.Phase2/2.newsletter_generation_brevo.md
  - public/2. Etats des Tables /7.Tables.Migration.Phase2/1.brevo_sms_logs.md
  - public/2. Etats des Tables /6.Tables.NewsletterBuilder/1.newsletter_builder.md
  - public/2. Etats des Tables /2.Tables.Clients/1.reseau.md
  - public/2. Etats des Tables /2.Tables.Clients/3.reseau_agence.md
  - public/2. Etats des Tables /2.Tables.Clients/6.agence_independante.md
  - public/2. Etats des Tables /3.Tables.Connexion/1.brevo_connexion.md

## -> Relis les audits de onglets 3
   - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...01.AuditLovable.md
   - public/4. ReadMe EtapesAnnonces/04.NewsletterBuilder/.04-MigOnglet3TestEnvoi/...02.AuditLovable.md

- Et dis-moi ce que tu penses de ces deux fichiers
 
```
---
---


```typescript
```

```typescript
# **ETAPE 7 : PROJET DE MIGRATION CANAL Créer un Emailing Annonce ou une Campagne Newsletter - CANAL 4**
---
- J'aurais besoin que tu me prépare un audit hyper complet comme nous avons fait pour canal 1 
    - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.03.0.Etape6Canal1/01--1.AuditCanal1.md
    - Mais attention je veux le meme menu cliquable adapté au canal 4

    # 02. SOMMAIRE CLIQUABLE 

1. [Mission du Document](#mission)
2. [Sommaire Cliquable](#sommaire)
3. [Architecture Globale - Canal "Copier Annonce Site Internet"](#architecture)
   - 3.1. Vue d'ensemble du canal
   - 3.2. Position dans Étape 6 Communication
   - 3.3. Schéma Mermaid complet (flux de données)
4. [Liste Exhaustive des Fichiers Utilisés](#fichiers)
   - 4.1. Fichiers de composition (9 fichiers)
   - 4.2. Hooks de récupération (2 fichiers)
   - 4.3. Hooks d'aperçu (2 fichiers)
   - 4.4. Hooks de copie (2 fichiers)
   - 4.5. Composants graphiques (2 fichiers)
   - 4.6. Arborescence complète avec descriptions
5. [Système d'Onglets (3 Onglets)](#onglets)
   - 5.1. MenuOngletCopierSiteInternet (orchestrateur)
   - 5.2. Onglet 1 : Annonce Site Internet (File1)
   - 5.3. Onglet 2 : Annonce Fiche de Synthèse (File2)
   - 5.4. Onglet 3 : Copier les Annonces (File3)
   - 5.5. Logique de navigation et état
6. [Processus de Récupération des Données OpenAI](#recuperation)
   - 6.1. Sources de données (2 clés localStorage)
   - 6.2. Logique de priorité (modifs > originales)
   - 6.3. Hooks de récupération détaillés
   - 6.4. Mapping des champs OpenAI → Interface
7. [Structure des Données localStorage](#localStorage)
   - 7.1. Clés LUES (2 clés generation_*)
   - 7.2. Clés ÉCRITES (2 clés key-modifs-*)
   - 7.3. Interfaces TypeScript complètes
   - 7.4. Tableaux récapitulatifs
8. [Processus Complet Étape par Étape](#processus)
   - 8.1. Chargement initial (useEffect)
   - 8.2. Affichage en mode lecture seule
   - 8.3. Activation du mode édition
   - 8.4. Modification des champs
   - 8.5. Sauvegarde automatique
   - 8.6. Copie au format Texte/HTML
9. [Système d'Édition - Bouton "Modifier"](#edition)
   - 9.1. Localisation (MenuOngletCopierSiteInternet)
   - 9.2. Comportement toggle (Modifier ↔ Sauvegarder)
   - 9.3. Propagation de l'état editMode
   - 9.4. Affichage conditionnel (ReadOnlyField vs EditableField)
   - 9.5. Nettoyage HTML automatique
   - 9.6. Éditeur WYSIWYG (EditeurWYSIWYG.tsx)
10. [Options de Copie (6 Fonctions)](#copie)
    - 10.1. FORMAT TEXTE (3 fonctions)
    - 10.2. FORMAT HTML (3 fonctions)
    - 10.3. Logique de formatage détaillée
11. [Système d'Aperçu (2 Hooks)](#apercu)
    - 11.1. Hook Aperçu Annonce Site Internet
    - 11.2. Hook Aperçu Annonce Fiche de Synthèse
    - 11.3. Fonction stripHtmlTags() détaillée
    - 11.4. Fonction addTitlesToSections()
12. [Contraintes et Validation](#contraintes)
    - 12.1. Validation des champs (nettoyage HTML)
    - 12.2. Gestion des erreurs (loading, error)
    - 12.3. Toasts de notification
    - 12.4. Sécurité (dangerouslySetInnerHTML)
13. [Composants Graphiques Réutilisables](#composants)
    - 13.1. LabelField
    - 13.2. ReadOnlyField
    - 13.3. EditableField (+ useWysiwyg)
    - 13.4. CopyOption3
    - 13.5. CopyOptionsContainer
    - 13.6. AnnoncePreview
14. [Tableaux Récapitulatifs](#tableaux)
    - 14.1. Tableau des champs (Annonce Site Internet - 4 champs)
    - 14.2. Tableau des champs (Fiche de Synthèse - 5 champs)
    - 14.3. Tableau des hooks (8 hooks au total)
    - 14.4. Tableau des fonctions de copie (6 fonctions)
    - 14.5. Matrice Onglets × Actions × Fichiers
15. [Données à Prendre en Considération](#donnees)
    - 15.1. Choix stratégiques LeadGenAI
    - 15.2. Dépendances critiques (react-quill)
    - 15.3. Fonctions clés à préserver
    - 15.4. Mapping OpenAI → Interface (cta vs appelAction)

- je veux que tu vérifies tous les codes localstorage un par un en temps réel pour avoir toutes les infos pour préparer mon étude
- je ne veux pas d'hypothèse pour la migration, je veux tout savoir du localstorage
- je veux que tu analyses bien l onglet : "Utiliser l'Annonce" et ses fonctions actuelles 

- Merci de me transférer l'audit du canal 4 dans le chat suivant
- en respectant à la lettre le modèle public/4. ReadMe EtapesAnnonces/03.PreparationMigration/.03.0.Etape6Canal1/01--1.AuditCanal1.md
- son sommaire détaillé cliquable avec les rubriques
- utilise un maximum de tableaux pour faciliter l'étude


```
