# Documentation Table: abonnement_stripe

**Date de g√©n√©ration:** 03/09/2025  
**Statut:** actif  
**Type:** connexion

---

## 1. D√âFINITION SQL

```sql
/* SQL Definition generated from catalogs */
/* Owner: postgres | Tablespace: pg_default | RLS: enabled */

CREATE TABLE public.abonnement_stripe (
  abonnement_id uuid NOT NULL DEFAULT gen_random_uuid(),
  organisation_id uuid NOT NULL,
  abonnement_appli_client_id uuid NOT NULL,
  abonnement_appli_souscripteur text NOT NULL,
  abonnement_stripe_payeur_id uuid NOT NULL,
  abonnement_stripe_payeur_type text NOT NULL,
  abonnement_stripe_numero_client_id text NOT NULL,
  abonnement_stripe_numero_abonnement_id text NOT NULL,
  abonnement_stripe_plan text NOT NULL,
  abonnement_stripe_debut timestamp with time zone NOT NULL,
  abonnement_stripe_terme_prevu timestamp with time zone,
  abonnement_stripe_date_resiliation timestamp with time zone,
  abonnement_stripe_statut_appli text NOT NULL DEFAULT 'en_cours'::text,
  abonnement_stripe_statut_paiement text,
  abonnement_stripe_statut_essai boolean NOT NULL DEFAULT false,
  abonnement_stripe_fin_essai timestamp with time zone,
  abonnement_stripe_montant_ht numeric NOT NULL,
  abonnement_stripe_devise text NOT NULL DEFAULT 'eur'::text,
  abonnement_stripe_fractionnement text NOT NULL DEFAULT 'mois'::text,
  abonnement_stripe_quantite numeric NOT NULL DEFAULT 1,
  abonnement_stripe_tva boolean NOT NULL DEFAULT true,
  abonnement_stripe_taux_tva numeric DEFAULT 20.0,
  abonnement_stripe_pays text NOT NULL DEFAULT 'FR'::text,
  abonnement_stripe_raison_sociale text,
  abonnement_stripe_siret text,
  abonnement_stripe_mode text,
  abonnement_stripe_next_echeance timestamp with time zone,
  abonnement_stripe_retard boolean NOT NULL DEFAULT false,
  abonnement_stripe_paiement_date timestamp with time zone,
  abonnement_stripe_paiement_montant numeric,
  abonnement_stripe_paiement_reussi numeric DEFAULT 0,
  abonnement_stripe_paiement_refus numeric DEFAULT 0,
  abonnement_stripe_paiement_total numeric DEFAULT 0,
  abonnement_stripe_facture_suspens numeric DEFAULT 0,
  abonnement_stripe_last_facture timestamp with time zone,
  abonnement_stripe_last_synchro timestamp with time zone DEFAULT now(),
  abonnement_stripe_commentaire_presenca text,
  abonnement_created_at timestamp with time zone NOT NULL DEFAULT now(),
  abonnement_created_by uuid,
  abonnement_updated_at timestamp with time zone NOT NULL DEFAULT now(),
  abonnement_updated_by uuid,
  CONSTRAINT abonnement_stripe_pkey PRIMARY KEY (abonnement_id)
);
```

---

## 2. STRUCTURE DE LA TABLE

| Colonne | Type | Nullable | D√©faut | Description |
|---------|------|----------|--------|-------------|
| abonnement_id | uuid | Non | gen_random_uuid() | - |
| organisation_id | uuid | Non | Aucun | - |
| abonnement_appli_client_id | uuid | Non | Aucun | - |
| abonnement_appli_souscripteur | text | Non | Aucun | - |
| abonnement_stripe_payeur_id | uuid | Non | Aucun | - |
| abonnement_stripe_payeur_type | text | Non | Aucun | - |
| abonnement_stripe_numero_client_id | text | Non | Aucun | - |
| abonnement_stripe_numero_abonnement_id | text | Non | Aucun | - |
| abonnement_stripe_plan | text | Non | Aucun | - |
| abonnement_stripe_debut | timestamp with time zone | Non | Aucun | - |
| abonnement_stripe_terme_prevu | timestamp with time zone | Oui | Aucun | - |
| abonnement_stripe_date_resiliation | timestamp with time zone | Oui | Aucun | - |
| abonnement_stripe_statut_appli | text | Non | 'en_cours'::text | - |
| abonnement_stripe_statut_paiement | text | Oui | Aucun | - |
| abonnement_stripe_statut_essai | boolean | Non | false | - |
| abonnement_stripe_fin_essai | timestamp with time zone | Oui | Aucun | - |
| abonnement_stripe_montant_ht | numeric | Non | Aucun | - |
| abonnement_stripe_devise | text | Non | 'eur'::text | - |
| abonnement_stripe_fractionnement | text | Non | 'mois'::text | - |
| abonnement_stripe_quantite | numeric | Non | 1 | - |
| abonnement_stripe_tva | boolean | Non | true | - |
| abonnement_stripe_taux_tva | numeric | Oui | 20.0 | - |
| abonnement_stripe_pays | text | Non | 'FR'::text | - |
| abonnement_stripe_raison_sociale | text | Oui | Aucun | - |
| abonnement_stripe_siret | text | Oui | Aucun | - |
| abonnement_stripe_mode | text | Oui | Aucun | - |
| abonnement_stripe_next_echeance | timestamp with time zone | Oui | Aucun | - |
| abonnement_stripe_retard | boolean | Non | false | - |
| abonnement_stripe_paiement_date | timestamp with time zone | Oui | Aucun | - |
| abonnement_stripe_paiement_montant | numeric | Oui | Aucun | - |
| abonnement_stripe_paiement_reussi | numeric | Oui | 0 | - |
| abonnement_stripe_paiement_refus | numeric | Oui | 0 | - |
| abonnement_stripe_paiement_total | numeric | Oui | 0 | - |
| abonnement_stripe_facture_suspens | numeric | Oui | 0 | - |
| abonnement_stripe_last_facture | timestamp with time zone | Oui | Aucun | - |
| abonnement_stripe_last_synchro | timestamp with time zone | Oui | now() | - |
| abonnement_stripe_commentaire_presenca | text | Oui | Aucun | - |
| abonnement_created_at | timestamp with time zone | Non | now() | - |
| abonnement_created_by | uuid | Oui | Aucun | - |
| abonnement_updated_at | timestamp with time zone | Non | now() | - |
| abonnement_updated_by | uuid | Oui | Aucun | - |

---

## 3. CONTRAINTES

- **PRIMARY KEY**: abonnement_stripe_pkey

---

## 4. INDEX

- abonnement_stripe_pkey: CREATE UNIQUE INDEX abonnement_stripe_pkey ON public.abonnement_stripe USING btree (abonnement_id)

---

## 5. TRIGGERS

- **set_created_audit_fields_abonnement_stripe** (BEFORE INSERT): EXECUTE FUNCTION set_created_audit_fields_abonnement_stripe()
- **update_audit_fields_abonnement_stripe** (BEFORE UPDATE): EXECUTE FUNCTION update_audit_fields_abonnement_stripe()

---

## 6. RELATIONS ENTRE TABLES (FK)

Aucune relation FK trouv√©e

---

## 7. S√âCURIT√â RLS

### admin_presenca_full_access_abonnement_stripe
- **Commande:** ALL
- **R√¥les:** Tous
- **Expression USING:** `is_admin_presenca(auth.uid())`
- **Expression WITH CHECK:** `is_admin_presenca(auth.uid())`

### organisation_only_access_abonnement_stripe
- **Commande:** ALL
- **R√¥les:** Tous
- **Expression USING:** `(organisation_id = get_user_organisation_id(auth.uid()))`
- **Expression WITH CHECK:** `(organisation_id = get_user_organisation_id(auth.uid()))`

---

## üîß FONCTIONS LI√âES

**Fonctions utilisant cette table**

- **set_created_audit_fields_abonnement_stripe()**: Fonction sp√©cifique √† la table
- **update_audit_fields_abonnement_stripe()**: Fonction sp√©cifique √† la table

---

## 9. NOTES TECHNIQUES
- **Derni√®re mise √† jour:** 03/09/2025
- **Source:** Supabase Database (temps r√©el)
- **G√©n√©rateur:** Lovable AI Documentation Tool (enrichi)
- **Fichier:** generate-table.js