---

const generalData = {  reseau_nom,  reseau_identite_commerciale,  reseau_adresse,  reseau_code_postal,  reseau_ville,  reseau_siret,  // BLOQUÉS (ReseauDirection):  reseau_telephone, // → Affichage seul avec message  reseau_email      // → Affichage seul avec message}```**ONGLET INTÉGRATIONS (tables: brevo_connexion, zoho_connexion, openai_connexion)** :```javascriptconst integrationsData = {  brevo: {    brevo_api_key,    brevo_email_compte,    brevo_nom_compte  },  zoho: {    zoho_api_key,    zoho_email_compte,    zoho_nom_compte  },  openai: {    openai_api_key,    openai_email_compte  }}```**ONGLET FICHIERS (table: reseau)** :```javascriptconst filesData = {  reseau_logo,        // → URL du logo  reseau_ressources   // → Array des URLs documents}```#### ⚙️ Hook de gestion des données**Nom** : `useReseauFormData`**Responsabilités** :- Chargement des données complètes du réseau sélectionné- Gestion des états d'édition par section- Sauvegarde des modifications- Reset en cas d'annulation**Interface** :```typescriptinterface UseReseauFormDataReturn {  // Données  reseauData: ReseauCompleteData | null;  isLoading: boolean;    // Actions  loadReseauData: (reseauId: string) => Promise<void>;  updateField: (section: string, field: string, value: any) => void;    // États d'édition  editingStates: {    general: boolean;    integrations: boolean;    files: boolean;  };  toggleEditMode: (section: string) => void;    // Sauvegarde  saveSection: (section: string) => Promise<void>;  cancelEdit: (section: string) => void;}```#### 🎮 Intégration GraphBoutonModifier**Composant existant** : `GraphBoutonModifier.tsx` (déjà fonctionnel)**Usage dans chaque section** :```tsx// ONGLET GÉNÉRAL<GraphBoutonModifier  onEditingChange={(isEditing) => toggleEditMode('general')}  onSave={() => saveSection('general')}  onCancel={() => cancelEdit('general')}  isLoading={isLoadingSave}/>// ONGLET INTÉGRATIONS<GraphBoutonModifier  onEditingChange={(isEditing) => toggleEditMode('integrations')}  onSave={() => saveSection('integrations')}  onCancel={() => cancelEdit('integrations')}  isLoading={isLoadingSave}/>// ONGLET FICHIERS<GraphBoutonModifier  onEditingChange={(isEditing) => toggleEditMode('files')}  onSave={() => saveSection('files')}  onCancel={() => cancelEdit('files')}  isLoading={isLoadingSave}/>```**Contrôle des champs** :```tsx// Exemple pour onglet Général<Input  value={reseauData?.reseau_nom || ''}  onChange={(e) => updateField('general', 'reseau_nom', e.target.value)}  disabled={!editingStates.general}/>```#### 🔄 Requête de chargement complète**Query Supabase obligatoire** :```javascriptconst loadCompleteReseauData = async (reseauId) => {  const { data, error } = await supabase    .from('reseau')    .select(`      *,      organisations(*),      brevo_connexion(*),      zoho_connexion(*),      openai_connexion(*)    `)    .eq('reseau_id', reseauId)    .single();      return data;};```#### 📱 UX Messages**Champs bloqués (telephone/email)** :```tsx<div className="relative">  <Input value={reseauData?.reseau_telephone} disabled />  <p className="text-sm text-muted-foreground mt-1">    Ce champ correspond aux informations du ReseauDirection.    À modifier dans le formulaire RÉSEAU Direction  </p></div>```**États de chargement** :- Spinner pendant `loadReseauData`- Skeleton des champs pendant chargement- Toast de confirmation après sauvegarde### 🎯 Ordre d'implémentation recommandé1. **Hook useReseauFormData** → Gestion état/données2. **Composant DropdownReseauSelector** → Sélection réseau  3. **Integration onglet Général** → Premier cas d'usage4. **Integration onglets Intégrations + Fichiers** → Completion5. **Tests et ajustements UX** → Finalisation🔄 Workflow complet défini (inchangé)---## 📊 ANALYSE ARCHITECTURE COMPLÈTE - FormReseauGestion**Date d'analyse** : Phase d'étude architecture**Objectif** : Estimation précise des fichiers, hooks et composants nécessaires### 🎯 SYNTHÈSE QUANTITATIVE**En plus du fichier principal** `FormReseauGestion.tsx` (qui sera modifié), voici l'architecture complète :#### 📁 **HOOKS STRATÉGIQUES** → 6 nouveaux fichiers```src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/├── useReseauFormData.ts           → Hook orchestrateur principal├── useReseauSelector.ts           → Dropdown sélection + recherche  ├── useReseauValidation.ts         → Validation champs par section├── useReseauFiles.ts              → Upload fichiers + storage├── useReseauIntegrations.ts       → Gestion Brevo/Zoho/OpenAI└── types.ts                       → Interfaces TypeScript (modifié)```#### 🧩 **COMPOSANTS UI** → 7 nouveaux composants```src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau/Components/├── DropdownReseauSelector.tsx     → Dropdown avec recherche intégrée├── FormOngletGeneral.tsx          → Section Général isolée├── FormOngletIntegrations.tsx     → Section Intégrations isolée  ├── FormOngletFichiers.tsx         → Section Fichiers isolée├── IntegrationBrevo.tsx           → Sous-composant Brevo├── IntegrationZoho.tsx            → Sous-composant Zoho└── IntegrationOpenAI.tsx          → Sous-composant OpenAI```#### 🗄️ **BASE DE DONNÉES** → 1 migration SQL```supabase/migrations/└── [timestamp]_create_storage_bucket_reseau.sql  → Bucket + RLS policies```#### ⚡ **EDGE FUNCTIONS** → 3 nouvelles fonctions```supabase/functions/├── update-reseau-general/         → MAJ onglet Général├── update-reseau-integrations/    → MAJ onglet Intégrations  └── update-reseau-files/           → MAJ onglet Fichiers + Storage```#### 📋 **TYPES TYPESCRIPT** → 7 nouvelles interfaces principales```typescriptReseauCompleteData                 → Données réseau avec jointuresReseauSelectorOption               → Option dropdown sélectionReseauEditingStates                → États d'édition par sectionReseauValidationErrors             → Erreurs validationReseauIntegrationsData             → Données intégrationsReseauFilesData                    → Données fichiers/storageReseauFormSections                 → Sections du formulaire```### 🔧 **DÉTAIL FONCTIONNEL PAR HOOK**#### **1. useReseauFormData** (Hook principal - Complexité: 🔴 Élevée)**Rôle** : Orchestrateur central - gestion état global**Responsabilités** :- Chargement données complètes réseau avec jointures- Gestion états d'édition par section (général/intégrations/fichiers)- Coordination sauvegarde multi-tables- Interface avec tous les autres hooks**Fonctions exposées** :```typescriptloadReseauData, updateField, saveSection, cancelEdit, toggleEditMode, resetSection```#### **2. useReseauSelector** (Complexité: 🟡 Moyenne)**Rôle** : Dropdown de sélection avec recherche intelligente**Responsabilités** :- Recherche temps réel sur reseau_nom, organisation_nom, reseau_ville- Requête avec jointure organisations- Debouncing 300ms optimisation- Formatting affichage items#### **3. useReseauValidation** (Complexité: 🟡 Moyenne)  **Rôle** : Validation métier par section**Responsabilités** :- Validation champs obligatoires Général- Validation format API keys Intégrations  - Validation types fichiers (images/PDF)- Messages d'erreur contextuels#### **4. useReseauFiles** (Complexité: 🔴 Élevée)**Rôle** : Gestion storage multi-fichiers**Responsabilités** :- Upload vers bucket storage avec paths calculés- Gestion logo unique + documents multiples- Preview fichiers uploadés- Suppression fichiers + nettoyage storage#### **5. useReseauIntegrations** (Complexité: 🟡 Moyenne)**Rôle** : Gestion connexions externes**Responsabilités** :- Sauvegarde multi-tables (brevo_connexion, zoho_connexion, openai_connexion)- Gestion relations FK depuis table reseau- Test validation connexions API (futur)### 🎯 **COMPLEXITÉ PAR COMPOSANT**#### **COMPOSANTS SIMPLES** (🟢 Faible complexité)- `IntegrationBrevo.tsx` → Formulaire 3 champs- `IntegrationZoho.tsx` → Formulaire 3 champs  - `IntegrationOpenAI.tsx` → Formulaire 2 champs#### **COMPOSANTS MOYENS** (🟡 Moyenne complexité)- `DropdownReseauSelector.tsx` → Search + formatting- `FormOngletGeneral.tsx` → 6 champs + champs bloqués- `FormOngletIntegrations.tsx` → 3 sous-composants#### **COMPOSANTS COMPLEXES** (🔴 Haute complexité)- `FormOngletFichiers.tsx` → Upload + preview + storage- `FormReseauGestion.tsx` → Orchestration complète### 🗄️ **MIGRATION SQL DÉTAILLÉE****Contenu obligatoire** :```sql-- Création bucket storageINSERT INTO storage.buckets (id, name, public) VALUES ('bucket-table-reseau', 'bucket-table-reseau', false);-- RLS policies isolation par organisationCREATE POLICY "Organisation access files" ON storage.objectsFOR ALL USING (  bucket_id = 'bucket-table-reseau'   AND name LIKE 'reseau-' || get_user_organisation_id(auth.uid())::text || '/%');-- Admin PRESENCA full access  CREATE POLICY "Admin PRESENCA full access storage" ON storage.objectsFOR ALL USING (is_admin_presenca(auth.uid()));```### ⚡ **EDGE FUNCTIONS STRATÉGIQUES**#### **update-reseau-general**- MAJ table `reseau` champs général- Validation SIRET, codes postaux- Audit log changements#### **update-reseau-integrations**  - MAJ tables `brevo_connexion`, `zoho_connexion`, `openai_connexion`- Gestion relations FK- Test validation API keys#### **update-reseau-files**- Gestion upload storage- MAJ champs `reseau_logo`, `reseau_ressources`- Nettoyage fichiers supprimés### 📈 **ESTIMATION DÉVELOPPEMENT****Projet substantiel mais bien structuré** :- **6 hooks stratégiques** pour architecture modulaire- **7 composants UI** spécialisés et réutilisables  - **1 migration storage** avec sécurité RLS complète- **3 edge functions** pour logique backend- **7 interfaces TypeScript** pour typage fort**Architecture évolutive** permettant extensions futures (nouvelles intégrations, nouveaux types fichiers, etc.)---## 🚀 APPROCHE PROGRESSIVE ET MÉTHODIQUE - 4 PHASES**Méthodologie validée** : Développement séquentiel avec fondations solides### PHASE 1 - INTERFACE FIRST (Création des formulaires)**Objectif** : Créer et valider les interfaces utilisateur de tous les onglets1. **FormOngletGeneral** → Création des champs généraux (6 champs éditables + 2 bloqués)2. **FormOngletIntegrations** → Création des 3 sections Brevo/Zoho/OpenAI3. **FormOngletFichiers** → Création upload logo + documents multiples4. **Validation visuelle** → Vérification UX et cohérence design**Livrables Phase 1** :- 3 composants de formulaires complets et fonctionnels visuellement- Tous les champs avec placeholders et labels appropriés- Design cohérent avec le design system- Validation de l'ergonomie avant logique métier### PHASE 2 - CORE INFRASTRUCTURE (Hooks de base)  **Objectif** : Créer l'infrastructure de données et de gestion d'état1. **useReseauSelector** → Hook de sélection/recherche des réseaux2. **useReseauFormData** → Hook central de gestion des données3. **useReseauValidation** → Hook de validation métier4. **Types/interfaces** → Définition des contrats TypeScript**Livrables Phase 2** :- Hooks fonctionnels et testés indépendamment- Sélection de réseau avec recherche opérationnelle- Structure de données typée et cohérente- Validation des champs en temps réel### PHASE 3 - PERSISTENCE BY TAB (Sauvegarde par onglet)**Objectif** : Connecter chaque onglet à la persistance en base1. **Onglet Général** → Connexion hook + sauvegarde table `reseau`2. **Onglet Intégrations** → Connexion hooks + sauvegarde tables connexions3. **Onglet Fichiers** → Création bucket storage + upload sécurisé4. **Edge functions** → APIs de sauvegarde spécialisées par onglet**Livrables Phase 3** :- Chaque onglet entièrement fonctionnel avec persistance- Bucket storage configuré avec RLS policies- Edge functions optimisées par cas d'usage- Tests de bout en bout par section### PHASE 4 - FINALISATION & INTÉGRATION COMPLÈTE**Objectif** : Assemblage final et optimisations1. **FormReseauGestion final** → Intégration complète des 3 onglets2. **GraphBoutonModifier** → Intégration du système d'édition3. **Tests complets** → Validation de tous les workflows4. **Optimisations UX** → Messages, toasts, loading states**Livrables Phase 4** :- Application complète et testée- Tous les workflows utilisateur fonctionnels- UX polie avec feedbacks appropriés- Documentation technique finalisée### 🎯 Avantages de cette approche "Interface First"- **Visuel et testable** : Validation immédiate des interfaces- **Évite l'over-engineering** : Hooks créés selon besoins réels- **Itératif** : Feedback utilisateur dès la Phase 1- **Modulaire** : Chaque phase est indépendante et testable- **Pragmatique** : Logique métier adaptée aux vraies contraintes UI(inchangé, corrections appliquées seulement sur stockage, intégrations et sélection réseau)
0 commit commentsComments0 (0)Lock conversationCommentSubscribeYou're not receiving notifications from this thread.
