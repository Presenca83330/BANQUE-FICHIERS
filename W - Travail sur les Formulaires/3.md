---

const generalData = {  reseau_nom,  reseau_identite_commerciale,  reseau_adresse,  reseau_code_postal,  reseau_ville,  reseau_siret,  // BLOQUÃ‰S (ReseauDirection):  reseau_telephone, // â†’ Affichage seul avec message  reseau_email      // â†’ Affichage seul avec message}```**ONGLET INTÃ‰GRATIONS (tables: brevo_connexion, zoho_connexion, openai_connexion)** :```javascriptconst integrationsData = {  brevo: {    brevo_api_key,    brevo_email_compte,    brevo_nom_compte  },  zoho: {    zoho_api_key,    zoho_email_compte,    zoho_nom_compte  },  openai: {    openai_api_key,    openai_email_compte  }}```**ONGLET FICHIERS (table: reseau)** :```javascriptconst filesData = {  reseau_logo,        // â†’ URL du logo  reseau_ressources   // â†’ Array des URLs documents}```#### âš™ï¸ Hook de gestion des donnÃ©es**Nom** : `useReseauFormData`**ResponsabilitÃ©s** :- Chargement des donnÃ©es complÃ¨tes du rÃ©seau sÃ©lectionnÃ©- Gestion des Ã©tats d'Ã©dition par section- Sauvegarde des modifications- Reset en cas d'annulation**Interface** :```typescriptinterface UseReseauFormDataReturn {  // DonnÃ©es  reseauData: ReseauCompleteData | null;  isLoading: boolean;    // Actions  loadReseauData: (reseauId: string) => Promise<void>;  updateField: (section: string, field: string, value: any) => void;    // Ã‰tats d'Ã©dition  editingStates: {    general: boolean;    integrations: boolean;    files: boolean;  };  toggleEditMode: (section: string) => void;    // Sauvegarde  saveSection: (section: string) => Promise<void>;  cancelEdit: (section: string) => void;}```#### ğŸ® IntÃ©gration GraphBoutonModifier**Composant existant** : `GraphBoutonModifier.tsx` (dÃ©jÃ  fonctionnel)**Usage dans chaque section** :```tsx// ONGLET GÃ‰NÃ‰RAL<GraphBoutonModifier  onEditingChange={(isEditing) => toggleEditMode('general')}  onSave={() => saveSection('general')}  onCancel={() => cancelEdit('general')}  isLoading={isLoadingSave}/>// ONGLET INTÃ‰GRATIONS<GraphBoutonModifier  onEditingChange={(isEditing) => toggleEditMode('integrations')}  onSave={() => saveSection('integrations')}  onCancel={() => cancelEdit('integrations')}  isLoading={isLoadingSave}/>// ONGLET FICHIERS<GraphBoutonModifier  onEditingChange={(isEditing) => toggleEditMode('files')}  onSave={() => saveSection('files')}  onCancel={() => cancelEdit('files')}  isLoading={isLoadingSave}/>```**ContrÃ´le des champs** :```tsx// Exemple pour onglet GÃ©nÃ©ral<Input  value={reseauData?.reseau_nom || ''}  onChange={(e) => updateField('general', 'reseau_nom', e.target.value)}  disabled={!editingStates.general}/>```#### ğŸ”„ RequÃªte de chargement complÃ¨te**Query Supabase obligatoire** :```javascriptconst loadCompleteReseauData = async (reseauId) => {  const { data, error } = await supabase    .from('reseau')    .select(`      *,      organisations(*),      brevo_connexion(*),      zoho_connexion(*),      openai_connexion(*)    `)    .eq('reseau_id', reseauId)    .single();      return data;};```#### ğŸ“± UX Messages**Champs bloquÃ©s (telephone/email)** :```tsx<div className="relative">  <Input value={reseauData?.reseau_telephone} disabled />  <p className="text-sm text-muted-foreground mt-1">    Ce champ correspond aux informations du ReseauDirection.    Ã€ modifier dans le formulaire RÃ‰SEAU Direction  </p></div>```**Ã‰tats de chargement** :- Spinner pendant `loadReseauData`- Skeleton des champs pendant chargement- Toast de confirmation aprÃ¨s sauvegarde### ğŸ¯ Ordre d'implÃ©mentation recommandÃ©1. **Hook useReseauFormData** â†’ Gestion Ã©tat/donnÃ©es2. **Composant DropdownReseauSelector** â†’ SÃ©lection rÃ©seau  3. **Integration onglet GÃ©nÃ©ral** â†’ Premier cas d'usage4. **Integration onglets IntÃ©grations + Fichiers** â†’ Completion5. **Tests et ajustements UX** â†’ FinalisationğŸ”„ Workflow complet dÃ©fini (inchangÃ©)---## ğŸ“Š ANALYSE ARCHITECTURE COMPLÃˆTE - FormReseauGestion**Date d'analyse** : Phase d'Ã©tude architecture**Objectif** : Estimation prÃ©cise des fichiers, hooks et composants nÃ©cessaires### ğŸ¯ SYNTHÃˆSE QUANTITATIVE**En plus du fichier principal** `FormReseauGestion.tsx` (qui sera modifiÃ©), voici l'architecture complÃ¨te :#### ğŸ“ **HOOKS STRATÃ‰GIQUES** â†’ 6 nouveaux fichiers```src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/â”œâ”€â”€ useReseauFormData.ts           â†’ Hook orchestrateur principalâ”œâ”€â”€ useReseauSelector.ts           â†’ Dropdown sÃ©lection + recherche  â”œâ”€â”€ useReseauValidation.ts         â†’ Validation champs par sectionâ”œâ”€â”€ useReseauFiles.ts              â†’ Upload fichiers + storageâ”œâ”€â”€ useReseauIntegrations.ts       â†’ Gestion Brevo/Zoho/OpenAIâ””â”€â”€ types.ts                       â†’ Interfaces TypeScript (modifiÃ©)```#### ğŸ§© **COMPOSANTS UI** â†’ 7 nouveaux composants```src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau/Components/â”œâ”€â”€ DropdownReseauSelector.tsx     â†’ Dropdown avec recherche intÃ©grÃ©eâ”œâ”€â”€ FormOngletGeneral.tsx          â†’ Section GÃ©nÃ©ral isolÃ©eâ”œâ”€â”€ FormOngletIntegrations.tsx     â†’ Section IntÃ©grations isolÃ©e  â”œâ”€â”€ FormOngletFichiers.tsx         â†’ Section Fichiers isolÃ©eâ”œâ”€â”€ IntegrationBrevo.tsx           â†’ Sous-composant Brevoâ”œâ”€â”€ IntegrationZoho.tsx            â†’ Sous-composant Zohoâ””â”€â”€ IntegrationOpenAI.tsx          â†’ Sous-composant OpenAI```#### ğŸ—„ï¸ **BASE DE DONNÃ‰ES** â†’ 1 migration SQL```supabase/migrations/â””â”€â”€ [timestamp]_create_storage_bucket_reseau.sql  â†’ Bucket + RLS policies```#### âš¡ **EDGE FUNCTIONS** â†’ 3 nouvelles fonctions```supabase/functions/â”œâ”€â”€ update-reseau-general/         â†’ MAJ onglet GÃ©nÃ©ralâ”œâ”€â”€ update-reseau-integrations/    â†’ MAJ onglet IntÃ©grations  â””â”€â”€ update-reseau-files/           â†’ MAJ onglet Fichiers + Storage```#### ğŸ“‹ **TYPES TYPESCRIPT** â†’ 7 nouvelles interfaces principales```typescriptReseauCompleteData                 â†’ DonnÃ©es rÃ©seau avec jointuresReseauSelectorOption               â†’ Option dropdown sÃ©lectionReseauEditingStates                â†’ Ã‰tats d'Ã©dition par sectionReseauValidationErrors             â†’ Erreurs validationReseauIntegrationsData             â†’ DonnÃ©es intÃ©grationsReseauFilesData                    â†’ DonnÃ©es fichiers/storageReseauFormSections                 â†’ Sections du formulaire```### ğŸ”§ **DÃ‰TAIL FONCTIONNEL PAR HOOK**#### **1. useReseauFormData** (Hook principal - ComplexitÃ©: ğŸ”´ Ã‰levÃ©e)**RÃ´le** : Orchestrateur central - gestion Ã©tat global**ResponsabilitÃ©s** :- Chargement donnÃ©es complÃ¨tes rÃ©seau avec jointures- Gestion Ã©tats d'Ã©dition par section (gÃ©nÃ©ral/intÃ©grations/fichiers)- Coordination sauvegarde multi-tables- Interface avec tous les autres hooks**Fonctions exposÃ©es** :```typescriptloadReseauData, updateField, saveSection, cancelEdit, toggleEditMode, resetSection```#### **2. useReseauSelector** (ComplexitÃ©: ğŸŸ¡ Moyenne)**RÃ´le** : Dropdown de sÃ©lection avec recherche intelligente**ResponsabilitÃ©s** :- Recherche temps rÃ©el sur reseau_nom, organisation_nom, reseau_ville- RequÃªte avec jointure organisations- Debouncing 300ms optimisation- Formatting affichage items#### **3. useReseauValidation** (ComplexitÃ©: ğŸŸ¡ Moyenne)  **RÃ´le** : Validation mÃ©tier par section**ResponsabilitÃ©s** :- Validation champs obligatoires GÃ©nÃ©ral- Validation format API keys IntÃ©grations  - Validation types fichiers (images/PDF)- Messages d'erreur contextuels#### **4. useReseauFiles** (ComplexitÃ©: ğŸ”´ Ã‰levÃ©e)**RÃ´le** : Gestion storage multi-fichiers**ResponsabilitÃ©s** :- Upload vers bucket storage avec paths calculÃ©s- Gestion logo unique + documents multiples- Preview fichiers uploadÃ©s- Suppression fichiers + nettoyage storage#### **5. useReseauIntegrations** (ComplexitÃ©: ğŸŸ¡ Moyenne)**RÃ´le** : Gestion connexions externes**ResponsabilitÃ©s** :- Sauvegarde multi-tables (brevo_connexion, zoho_connexion, openai_connexion)- Gestion relations FK depuis table reseau- Test validation connexions API (futur)### ğŸ¯ **COMPLEXITÃ‰ PAR COMPOSANT**#### **COMPOSANTS SIMPLES** (ğŸŸ¢ Faible complexitÃ©)- `IntegrationBrevo.tsx` â†’ Formulaire 3 champs- `IntegrationZoho.tsx` â†’ Formulaire 3 champs  - `IntegrationOpenAI.tsx` â†’ Formulaire 2 champs#### **COMPOSANTS MOYENS** (ğŸŸ¡ Moyenne complexitÃ©)- `DropdownReseauSelector.tsx` â†’ Search + formatting- `FormOngletGeneral.tsx` â†’ 6 champs + champs bloquÃ©s- `FormOngletIntegrations.tsx` â†’ 3 sous-composants#### **COMPOSANTS COMPLEXES** (ğŸ”´ Haute complexitÃ©)- `FormOngletFichiers.tsx` â†’ Upload + preview + storage- `FormReseauGestion.tsx` â†’ Orchestration complÃ¨te### ğŸ—„ï¸ **MIGRATION SQL DÃ‰TAILLÃ‰E****Contenu obligatoire** :```sql-- CrÃ©ation bucket storageINSERT INTO storage.buckets (id, name, public) VALUES ('bucket-table-reseau', 'bucket-table-reseau', false);-- RLS policies isolation par organisationCREATE POLICY "Organisation access files" ON storage.objectsFOR ALL USING (  bucket_id = 'bucket-table-reseau'   AND name LIKE 'reseau-' || get_user_organisation_id(auth.uid())::text || '/%');-- Admin PRESENCA full access  CREATE POLICY "Admin PRESENCA full access storage" ON storage.objectsFOR ALL USING (is_admin_presenca(auth.uid()));```### âš¡ **EDGE FUNCTIONS STRATÃ‰GIQUES**#### **update-reseau-general**- MAJ table `reseau` champs gÃ©nÃ©ral- Validation SIRET, codes postaux- Audit log changements#### **update-reseau-integrations**  - MAJ tables `brevo_connexion`, `zoho_connexion`, `openai_connexion`- Gestion relations FK- Test validation API keys#### **update-reseau-files**- Gestion upload storage- MAJ champs `reseau_logo`, `reseau_ressources`- Nettoyage fichiers supprimÃ©s### ğŸ“ˆ **ESTIMATION DÃ‰VELOPPEMENT****Projet substantiel mais bien structurÃ©** :- **6 hooks stratÃ©giques** pour architecture modulaire- **7 composants UI** spÃ©cialisÃ©s et rÃ©utilisables  - **1 migration storage** avec sÃ©curitÃ© RLS complÃ¨te- **3 edge functions** pour logique backend- **7 interfaces TypeScript** pour typage fort**Architecture Ã©volutive** permettant extensions futures (nouvelles intÃ©grations, nouveaux types fichiers, etc.)---## ğŸš€ APPROCHE PROGRESSIVE ET MÃ‰THODIQUE - 4 PHASES**MÃ©thodologie validÃ©e** : DÃ©veloppement sÃ©quentiel avec fondations solides### PHASE 1 - INTERFACE FIRST (CrÃ©ation des formulaires)**Objectif** : CrÃ©er et valider les interfaces utilisateur de tous les onglets1. **FormOngletGeneral** â†’ CrÃ©ation des champs gÃ©nÃ©raux (6 champs Ã©ditables + 2 bloquÃ©s)2. **FormOngletIntegrations** â†’ CrÃ©ation des 3 sections Brevo/Zoho/OpenAI3. **FormOngletFichiers** â†’ CrÃ©ation upload logo + documents multiples4. **Validation visuelle** â†’ VÃ©rification UX et cohÃ©rence design**Livrables Phase 1** :- 3 composants de formulaires complets et fonctionnels visuellement- Tous les champs avec placeholders et labels appropriÃ©s- Design cohÃ©rent avec le design system- Validation de l'ergonomie avant logique mÃ©tier### PHASE 2 - CORE INFRASTRUCTURE (Hooks de base)  **Objectif** : CrÃ©er l'infrastructure de donnÃ©es et de gestion d'Ã©tat1. **useReseauSelector** â†’ Hook de sÃ©lection/recherche des rÃ©seaux2. **useReseauFormData** â†’ Hook central de gestion des donnÃ©es3. **useReseauValidation** â†’ Hook de validation mÃ©tier4. **Types/interfaces** â†’ DÃ©finition des contrats TypeScript**Livrables Phase 2** :- Hooks fonctionnels et testÃ©s indÃ©pendamment- SÃ©lection de rÃ©seau avec recherche opÃ©rationnelle- Structure de donnÃ©es typÃ©e et cohÃ©rente- Validation des champs en temps rÃ©el### PHASE 3 - PERSISTENCE BY TAB (Sauvegarde par onglet)**Objectif** : Connecter chaque onglet Ã  la persistance en base1. **Onglet GÃ©nÃ©ral** â†’ Connexion hook + sauvegarde table `reseau`2. **Onglet IntÃ©grations** â†’ Connexion hooks + sauvegarde tables connexions3. **Onglet Fichiers** â†’ CrÃ©ation bucket storage + upload sÃ©curisÃ©4. **Edge functions** â†’ APIs de sauvegarde spÃ©cialisÃ©es par onglet**Livrables Phase 3** :- Chaque onglet entiÃ¨rement fonctionnel avec persistance- Bucket storage configurÃ© avec RLS policies- Edge functions optimisÃ©es par cas d'usage- Tests de bout en bout par section### PHASE 4 - FINALISATION & INTÃ‰GRATION COMPLÃˆTE**Objectif** : Assemblage final et optimisations1. **FormReseauGestion final** â†’ IntÃ©gration complÃ¨te des 3 onglets2. **GraphBoutonModifier** â†’ IntÃ©gration du systÃ¨me d'Ã©dition3. **Tests complets** â†’ Validation de tous les workflows4. **Optimisations UX** â†’ Messages, toasts, loading states**Livrables Phase 4** :- Application complÃ¨te et testÃ©e- Tous les workflows utilisateur fonctionnels- UX polie avec feedbacks appropriÃ©s- Documentation technique finalisÃ©e### ğŸ¯ Avantages de cette approche "Interface First"- **Visuel et testable** : Validation immÃ©diate des interfaces- **Ã‰vite l'over-engineering** : Hooks crÃ©Ã©s selon besoins rÃ©els- **ItÃ©ratif** : Feedback utilisateur dÃ¨s la Phase 1- **Modulaire** : Chaque phase est indÃ©pendante et testable- **Pragmatique** : Logique mÃ©tier adaptÃ©e aux vraies contraintes UI(inchangÃ©, corrections appliquÃ©es seulement sur stockage, intÃ©grations et sÃ©lection rÃ©seau)
0 commit commentsComments0Â (0)Lock conversationCommentSubscribeYou're not receiving notifications from this thread.
