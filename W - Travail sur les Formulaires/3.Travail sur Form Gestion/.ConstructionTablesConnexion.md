1. Construction gÃ©nÃ©rale des tables de connexion (Brevo, Zoho, OpenAI, etc.)

Ces tables servent Ã  stocker les identifiants API et informations de connexion propres Ã  chaque client (rÃ©seau ou agence).
Elles ont Ã©tÃ© construites selon la logique suivante :

Champs techniques obligatoires :
id (UUID, PK)
organisation_id â†’ relie la connexion Ã  lâ€™organisation multi-tenant (rÃ©seau, agence, etc.)
client_type (ENUM : reseau, reseau_agence, agence_independante)
client_id (UUID â†’ FK vers la table mÃ©tier correspondante, selon client_type)

Champs API :
Ex. pour Brevo â†’ brevo_api_key, brevo_email_compte, brevo_nom_compte
Ex. pour Zoho â†’ zoho_api_key, zoho_email_compte, zoho_nom_compt
Ex. pour OpenAI â†’ openai_api_key, openai_email_compte
Ces champs Ã©taient parfois dÃ©finis en NOT NULL pour garantir que la clÃ© API existe au moment de lâ€™utilisation, mais en rÃ©alitÃ© ils devraient Ãªtre facultatifs car toutes les agences nâ€™utilisent pas forcÃ©ment toutes les intÃ©grations.

Contraintes et sÃ©curitÃ© :
RLS activÃ©e : chaque organisation ne peut lire/Ã©crire que ses propres connexions.
FK dynamiques : client_id doit exister dans la table correspondant au client_type.
Objectif : Ã©viter quâ€™une agence se connecte avec la clÃ© API dâ€™une autre.

2. Cas particulier : table reseau
Prenons un exemple avec reseau :
Table reseau (simplifiÃ©) :
reseau_id (UUID, PK)
organisation_id (FK vers organisations)
reseau_nom â€¦
Lien avec Brevo connexion :
Dans brevo_connexion, si client_type = 'reseau', alors client_id = reseau.reseau_id.
Cela permet de savoir quelle instance Brevo appartient Ã  quel rÃ©seau.
MÃªme logique pour Zoho, OpenAI, etc.
Exemple dâ€™utilisation :

Le directeur du rÃ©seau configure Brevo dans son espace â†’ une ligne est crÃ©Ã©e dans brevo_connexion avec :
client_type = 'reseau'
client_id = <reseau_id>
brevo_api_key = 'xxxx'
Ensuite, toutes les agences du rÃ©seau peuvent utiliser cette connexion si la politique du rÃ©seau lâ€™autorise.

2. Cas particulier : table reseau
Table mÃ©tier reseau (simplifiÃ©)
reseau_id (UUID, PK)
organisation_id (FK vers organisations)
reseau_nom
Exemple de lien avec brevo_connexion
Dans brevo_connexion :
client_type = 'reseau'
client_id = reseau.reseau_id
organisation_id = reseau.organisation_id
champs API (brevo_api_key, brevo_email_compteâ€¦)

ğŸ‘‰ Cela veut dire :
Une connexion Brevo appartient au rÃ©seau X.
Toutes les agences de ce rÃ©seau peuvent, selon les rÃ¨gles, utiliser cette connexion pour envoyer emails/newsletters.
MÃªme logique avec Zoho et OpenAI
zoho_connexion.client_id = reseau_id
openai_connexion.client_id = reseau_id
etc.
