# ğŸ“‹ **DOCUMENTATION EXHAUSTIVE - Ã‰TAPE 1 : Ã‰LÃ‰MENTS CLÃ‰S**

## **ğŸ¯ MISSION DU DOCUMENT**
- Cette documentation constitue la Bible complÃ¨te de l'**Ã‰tape 1** du processus de gÃ©nÃ©ration d'annonces en mode **localStorage**.
- Elle recense **TOUS** les fichiers, fonctions, composants, champs de formulaire, validations, contraintes, interactions, et flux de donnÃ©es utilisÃ©s dans cette Ã©tape.
- Objectif : fournir une base d'audit exhaustive avant la migration vers Supabase.

---
## **ğŸ“‘ SOMMAIRE CLIQUABLE - Ã‰TAPE 1**

### **Structure du document**
- [ğŸ¯ MISSION DU DOCUMENT](#-mission-du-document)
- [ğŸ“‚ I. ARCHITECTURE GLOBALE DE L'Ã‰TAPE 1](#-i-architecture-globale-de-ltape-1)
- [ğŸ“ II. FICHIERS UTILISÃ‰S (Liste exhaustive)](#-ii-fichiers-utilisÃ©s-liste-exhaustive)
- [III. STRUCTURE DES DONNÃ‰ES DANS `localStorage`](#iii-structure-des-donnÃ©es-dans-localstorage)
- [IV. LOGIQUE DE VALIDATION DES CHAMPS](#iv-logique-de-validation-des-champs)
- [V. CONTRAINTES ET RÃˆGLES MÃ‰TIER](#v-contraintes-et-rÃ¨gles-mÃ©tier)
- [VI. NAVIGATION ET RETOUR EN ARRIÃˆRE](#vi-navigation-et-retour-en-arriÃ¨re)
- [VII. UTILISATION DES DONNÃ‰ES PAR OPENAI](#vii-utilisation-des-donnÃ©es-par-openai)
- [VIII. PROCESSUS COMPLET Ã‰TAPE PAR Ã‰TAPE](#viii-processus-complet-Ã©tape-par-Ã©tape)
- [IX. Ã‰LÃ‰MENTS CACHÃ‰S / CONDITIONNELS](#ix-Ã©lÃ©ments-cachÃ©s--conditionnels)
- [X. TIMER DE SESSION (DÃ‰SACTIVÃ‰ MAIS PRÃ‰SENT)](#x-timer-de-session-dÃ©sactivÃ©-mais-prÃ©sent)
- [XI. RÃ‰CAPITULATIF DES CLÃ‰S `localStorage`](#xi-rÃ©capitulatif-des-clÃ©s-localstorage)
- [XII. DONNEES DE L'ETAPE 1 Ã€ PRENDRE EN CONSIDÃ‰RATION](#xii-donnees-de-letape-1-Ã -prendre-en-considÃ©ration)

---

---
## **ğŸ“‚ I. ARCHITECTURE GLOBALE DE L'Ã‰TAPE 1**

### **Vue d'ensemble**
- L'Ã‰tape 1 (route `/etape1`) permet Ã  l'utilisateur de saisir les **Ã©lÃ©ments clÃ©s** d'un bien immobilier commercial.
- Ces donnÃ©es sont **stockÃ©es dans le localStorage** sous la clÃ© `"propertyData"` au format JSON. E
- lles servent de base pour les Ã©tapes suivantes (2, 3, 4) et pour la gÃ©nÃ©ration d'annonces par OpenAI Ã  l'Ã‰tape 5.

### **Flux de donnÃ©es simplifiÃ©**
```
Utilisateur saisit le formulaire
         â†“
EnsembleFormulairesEtape1Form (gestion state local)
         â†“
handleValidation() - Validation des champs
         â†“
updatePropertyData() - Stockage dans localStorage clÃ© "propertyData"
         â†“
completeStep(1) - DÃ©verrouillage Ã‰tape 2 dans localStorage clÃ© "stepProgress"
         â†“
navigate("/etape2") - Navigation vers Ã‰tape 2
```
---
```mermaid
graph TD
    A[Chargement Etape1.tsx] --> B[useStepProgress: initialisation Ã©tape 1]
    B --> C[Affichage EnsembleFormulairesEtape1Form]
    C --> D[useEffect: RÃ©cupÃ©ration propertyData]
    D --> E[getPropertyDataFromStorage depuis localStorage]
    E --> F{propertyData existe?}
    F -->|Oui| G[PrÃ©-remplissage des champs du formulaire]
    F -->|Non| H[Affichage formulaire vide]
    G --> I[Affichage de tous les champs]
    H --> I
    I --> J[Utilisateur saisit les informations]
    J --> K{Type de transaction?}
    K -->|Ã€ vendre| L[Affichage champ Prix FAI]
    K -->|Ã€ louer| M[Affichage champs Loyer + PÃ©riodicitÃ©]
    L --> N[Modifications dans les champs]
    M --> N
    N --> O[Clic sur BoutonValiderInformations]
    O --> P{Validation des champs obligatoires}
    P -->|agencyName vide| Q1[Toast erreur: Nom agence requis]
    P -->|reference vide| Q2[Toast erreur: RÃ©fÃ©rence requise]
    P -->|location vide| Q3[Toast erreur: Emplacement requis]
    P -->|propertyType vide| Q4[Toast erreur: Type de bien requis]
    P -->|price vide et vente| Q5[Toast erreur: Prix requis]
    P -->|rentAmount vide et location| Q6[Toast erreur: Loyer requis]
    P -->|keyElements vide| Q7[Toast erreur: Arguments commerciaux requis]
    Q1 --> R[Retour au formulaire]
    Q2 --> R
    Q3 --> R
    Q4 --> R
    Q5 --> R
    Q6 --> R
    Q7 --> R
    P -->|Tous les champs valides| S[Construction objet etape1Data]
    S --> T[updatePropertyData: sauvegarde dans localStorage.propertyData]
    T --> U[completeStep: ajout Ã©tape 2 Ã  stepProgress]
    U --> V[Toast succÃ¨s: Informations validÃ©es]
    V --> W[Navigation vers /etape2]
```
---

## ğŸ“ DÃ©tails du flux

### ğŸ”„ Phases principales

1. **Initialisation** (Aâ†’C)
   - Chargement de `Etape1.tsx`
   - Initialisation `useStepProgress(1)`
   - Affichage du composant formulaire

2. **Chargement des donnÃ©es** (Dâ†’I)
   - `useEffect` rÃ©cupÃ¨re `propertyData` via `getPropertyDataFromStorage()`
   - Si donnÃ©es existantes â†’ prÃ©-remplissage
   - Si aucune donnÃ©e â†’ formulaire vide

3. **Saisie utilisateur** (Jâ†’N)
   - Affichage conditionnel selon `saleType`
   - Vente: champ "Prix FAI"
   - Location: champs "Loyer HT/HC" + "PÃ©riodicitÃ©"

4. **Validation** (Oâ†’R)
   - **7 validations** obligatoires
   - Toasts d'erreur spÃ©cifiques pour chaque champ manquant
   - Retour au formulaire si erreur

5. **Sauvegarde et navigation** (Sâ†’W)
   - Construction de l'objet `etape1Data`
   - `updatePropertyData()` â†’ sauvegarde dans `localStorage.propertyData`
   - `completeStep(1)` â†’ ajout Ã©tape 2 dans `stepProgress`
   - Toast de succÃ¨s
   - Navigation vers `/etape2`

---

## **ğŸ“ II. FICHIERS UTILISÃ‰S (Liste exhaustive)**

### **1. Fichiers de page principale**

#### **`src/1.etapes-generation-annonces/etape1/Etape1.tsx`**
**RÃ´le** : Composant page principale de l'Ã‰tape 1.
- **ResponsabilitÃ©s** :
  - Affiche le layout global avec `LayoutV2GenAnn`
  - Affiche le hero header avec `StructureHeroPetit`
  - IntÃ¨gre le formulaire via `EnsembleFormulairesEtape1Form` (avec rÃ©fÃ©rence `ref`)
  - Affiche la colonne latÃ©rale avec `DirectivesMenuOnglet` et `EtapeFAQ`
  - GÃ¨re la visibilitÃ© pour forcer le rechargement des donnÃ©es

- **Imports clÃ©s** :
  ```typescript
  import LayoutV2GenAnn from "@/components/atemplate.v2.generation-annonces/Layout.V2.GenAnn";
  import StructureHeroPetit from "@/0.structure-type-page/structure5HeroPetit/StructureHeroPetit";
  import DirectivesMenuOnglet from "@/components/atemplate.v2.generation-annonces/DirectivesMenuOnglet";
  import { EtapeFAQ } from "@/components/1-Sources-Generation-Annonces/help/EtapeFAQ";
  import { useStepProgress } from "@/components/1-Sources-Generation-Annonces/utils/useStepProgress";
  import EnsembleFormulairesEtape1Form from "@/components/1-Sources-Generation-Annonces/form-etape1/EnsembleFormulairesEtape1Form";
  ```

- **Hooks utilisÃ©s** :
  - `useStepProgress(1)` : GÃ¨re la progression et le dÃ©blocage des Ã©tapes
  - `useRef` : RÃ©fÃ©rence au formulaire pour appel de `handleValidation()`

- **DonnÃ©es configurÃ©es** :
  - `headerTitle` : "Bienvenue sur votre GÃ©nÃ©rateur d'Annonces et d'Outils SEO"
  - `headerSubtitle` : "Notre gÃ©nÃ©rateur a Ã©tÃ© conÃ§u pour vous permettre de structurer et optimiser vos annonces en toute simplicitÃ©."
  - `headerText` : Contient instructions HTML (avec ``)
  - `card1CentreTitre` : "Ã‰lÃ©ments ClÃ©s"

- **Fonction de validation** :
  ```typescript
  const handleValidation = () => {
    if (formulaireRef.current) {
      const isValid = formulaireRef.current.handleValidation();
      if (isValid) {
        completeStep(1);
        navigate("/etape2");
      }
    }
  };
  ```

---

### **2. Composant formulaire principal**

#### **`src/components/1-Sources-Generation-Annonces/form-etape1/EnsembleFormulairesEtape1Form.tsx`**
**RÃ´le** : Composant formulaire contenant TOUS les champs de saisie de l'Ã‰tape 1.

- **Structure** :
  - `forwardRef` pour exposer la mÃ©thode `handleValidation()` au parent via `useImperativeHandle`
  - GÃ¨re **10 states locaux** (un par champ de formulaire)
  - Charge les donnÃ©es depuis `localStorage` au montage (`useEffect`)
  - Valide et sauvegarde les donnÃ©es via `updatePropertyData()`

- **Ã‰tats locaux (States)** :
  ```typescript
  const [agencyName, setAgencyName] = useState("");           // Nom de l'Agence
  const [reference, setReference] = useState("");             // RÃ©fÃ©rence du bien
  const [exclusivite, setExclusivite] = useState("Non");      // ExclusivitÃ© (Oui/Non)
  const [location, setLocation] = useState("");               // Emplacement
  const [propertyType, setPropertyType] = useState("");       // Type de bien
  const [saleType, setSaleType] = useState("Ã  vendre");       // Type de transaction (Ã  vendre/Ã  louer)
  const [price, setPrice] = useState("");                     // Prix FAI
  const [rentAmount, setRentAmount] = useState("");           // Loyer HT/HC
  const [rentPeriodicity, setRentPeriodicity] = useState("Mensuel"); // PÃ©riodicitÃ© loyer
  const [keyElements, setKeyElements] = useState("");         // Arguments commerciaux
  ```

- **Options de sÃ©lection** :
  ```typescript
  const exclusiviteOptions = [
    { id: "Oui", label: "Oui" },
    { id: "Non", label: "Non" }
  ];

  const saleTypeOptions = [
    { id: "Ã  vendre", label: "Ã€ vendre" },
    { id: "Ã  louer", label: "Ã€ louer" }
  ];

  const rentPeriodicityOptions = [
    { id: "Mensuel", label: "Mensuel" },
    { id: "Trimestriel", label: "Trimestriel" },
    { id: "Annuel", label: "Annuel" }
  ];
  ```

- **Chargement des donnÃ©es (`useEffect`)** :
  ```typescript
  useEffect(() => {
    const loadData = () => {
      const propertyData = getPropertyDataFromStorage(); // Lecture localStorage
      if (Object.keys(propertyData).length > 0) {
        setAgencyName(propertyData.agencyName || "");
        setReference(propertyData.reference || "");
        setExclusivite(propertyData.exclusivite || "Non");
        setLocation(propertyData.location || "");
        setPropertyType(propertyData.propertyType || "");
        setSaleType(propertyData.saleType || "Ã  vendre");
        setPrice(propertyData.price || "");
        setRentAmount(propertyData.rentAmount || "");
        setRentPeriodicity(propertyData.rentPeriodicity || "Mensuel");
        setKeyElements(propertyData.keyElements || "");
      }
    };
    loadData();

    // Rechargement au retour focus
    window.addEventListener('focus', loadData);
    return () => window.removeEventListener('focus', loadData);
  }, []);
  ```

- **Validation des champs (`handleValidation`)** :
  ```typescript
  const handleValidation = () => {
    // 1. VÃ©rification champ obligatoire "agencyName"
    if (!agencyName.trim()) {
      toast({
        title: "Erreur de validation",
        description: "Veuillez saisir le nom de votre agence.",
        variant: "destructive"
      });
      return false;
    }

    // 2. VÃ©rification "reference"
    if (!reference.trim()) {
      toast({ description: "Veuillez saisir une rÃ©fÃ©rence pour le bien." });
      return false;
    }

    // 3. VÃ©rification "location"
    if (!location.trim()) {
      toast({ description: "Veuillez saisir l'emplacement du bien." });
      return false;
    }

    // 4. VÃ©rification "propertyType"
    if (!propertyType.trim()) {
      toast({ description: "Veuillez saisir le type de bien." });
      return false;
    }

    // 5. VÃ©rification conditionnelle "price" (si vente)
    if (saleType === "Ã  vendre" && !price.trim()) {
      toast({ description: "Veuillez saisir le prix du bien." });
      return false;
    }

    // 6. VÃ©rification conditionnelle "rentAmount" (si location)
    if (saleType === "Ã  louer" && !rentAmount.trim()) {
      toast({ description: "Veuillez saisir le montant du loyer." });
      return false;
    }

    // 7. VÃ©rification "keyElements"
    if (!keyElements.trim()) {
      toast({ description: "Veuillez saisir au moins un argument commercial." });
      return false;
    }

    // 8. Sauvegarde dans localStorage
    const etape1Data = {
      agencyName, reference, exclusivite, location, propertyType,
      saleType, price, rentAmount, rentPeriodicity, keyElements
    };
    updatePropertyData(etape1Data); // Stockage clÃ© "propertyData"

    toast({
      title: "Informations validÃ©es",
      description: "Vos informations ont Ã©tÃ© enregistrÃ©es avec succÃ¨s.",
    });

    return true;
  };
  ```

- **Soumission formulaire** :
  ```typescript
  const handleFormSubmit = () => {
    if (handleValidation()) {
      completeStep(1); // DÃ©bloque Ã©tape 2 (localStorage "stepProgress")
      navigate("/etape2");
    }
  };
  ```

- **Contenu d'aide (SgaHelpBox)** :
  - Titre : "Arguments commerciaux"
  - Contenu : Instructions dÃ©taillÃ©es sur les arguments commerciaux (points forts, conditions locatives, raretÃ©...)

---

### **3. Composants de champs de formulaire**

#### **`src/components/1-Sources-Generation-Annonces/form-components/TextFieldForm.tsx`**
**RÃ´le** : Champ texte simple avec capitalisation automatique de la premiÃ¨re lettre.

- **Props** :
  ```typescript
  interface TextFieldFormProps {
    id: string;
    title: string;
    placeholder?: string;
    value: string;
    onChange: (e: React.ChangeEvent) => void;
    className?: string;
    required?: boolean;
  }
  ```

- **Logique de capitalisation** :
  ```typescript
  const handleInputChange = (e: React.ChangeEvent) => {
    const newText = e.target.value;
    if (newText.length > 0) {
      e.target.value = newText.charAt(0).toUpperCase() + newText.slice(1);
    }
    onChange(e);
  };
  ```

- **Styles** :
  - Label : `text-[14px] text-black font-bold`
  - Input : `h-[42px] rounded-md bg-[#ffffff] border border-[#B8C8DC] text-[14px]`
  - Focus : `focus:ring-2 focus:ring-[#5E50A6]`

- **Champs utilisant TextFieldForm** :
  1. `agencyName` (id: "agencyName", titre: "Nom de l'Agence", placeholder: "Votre agence immobiliÃ¨re", required: true)
  2. `reference` (id: "reference", titre: "RÃ©fÃ©rence", placeholder: "RÃ©fÃ©rence du bien", required: true)
  3. `location` (id: "location", titre: "Emplacement", placeholder: "Ville, Arrondissement, DÃ©partement...", required: true)
  4. `propertyType` (id: "propertyType", titre: "Type de bien", placeholder: "Restaurant, Commerce, Local Commercial...", required: true)

---

#### **`src/components/1-Sources-Generation-Annonces/form-components/MonetaryFieldForm.tsx`**
**RÃ´le** : Champ monÃ©taire avec formatage automatique (espaces milliers + symbole â‚¬).

- **Props** :
  ```typescript
  interface MonetaryFieldFormProps {
    id: string;
    title: string;
    placeholder?: string;
    value: string;
    onChange: (e: React.ChangeEvent) => void;
    currency?: string; // Par dÃ©faut "â‚¬"
    className?: string;
    required?: boolean;
  }
  ```

- **Logique de formatage** :
  ```typescript
  const handleChange = (e: React.ChangeEvent) => {
    const inputValue = e.target.value;
    const valueWithoutCurrency = inputValue.replace(/â‚¬/g, '');

    // Autoriser valeur vide
    if (valueWithoutCurrency.trim() === '') {
      onChange({ ...e, target: { ...e.target, value: '' } });
      return;
    }

    // Supprimer caractÃ¨res non-numÃ©riques
    const cleanValue = valueWithoutCurrency.replace(/[^\d\s]/g, '');
    const numericOnly = cleanValue.replace(/\s/g, '');

    // Formatage avec espaces (milliers)
    const formattedValue = numericOnly.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
    const finalValue = formattedValue ? `${formattedValue}â‚¬` : "";

    onChange({ ...e, target: { ...e.target, value: finalValue } });
  };
  ```

- **Comportement au focus** :
  ```typescript
  const handleFocus = (e: React.FocusEvent) => {
    e.target.select(); // SÃ©lection totale au focus
  };
  ```

- **Champs utilisant MonetaryFieldForm** :
  1. `price` (id: "price", titre: "Prix FAI", placeholder: "450 000â‚¬", currency: "â‚¬", required: true, **visible uniquement si** `saleType === "Ã  vendre"`)
  2. `rentAmount` (id: "rentAmount", titre: "Loyer HT/HC", placeholder: "1 200â‚¬", currency: "â‚¬", required: true, **visible uniquement si** `saleType === "Ã  louer"`)

---

#### **`src/components/1-Sources-Generation-Annonces/form-components/SelectionButtonRond.tsx`**
**RÃ´le** : Boutons radio stylisÃ©s (points ronds).

- **Props** :
  ```typescript
  interface SelectionButtonRondProps {
    id: string;
    options: { id: string; label: string }[];
    selectedOption: string;
    onChange: (option: string) => void;
    className?: string;
    label?: string;
    required?: boolean;
  }
  ```

- **Rendu** :
  - Conteneur : `inline-flex bg-[#ffff] rounded-md border border-[#B8C8DC]`
  - Chaque option : Cercle externe (`border-2 border-[#5E50A6]`) + Cercle interne plein si sÃ©lectionnÃ© (`bg-[#5E50A6]`)

- **Champs utilisant SelectionButtonRond** :
  1. `exclusivite` (id: "exclusivite", label: "ExclusivitÃ©", options: ["Oui", "Non"], selectedOption: "Non" par dÃ©faut, required: true)
  2. `saleType` (id: "saleType", label: "Type de transaction", options: ["Ã  vendre", "Ã  louer"], selectedOption: "Ã  vendre" par dÃ©faut, required: true)
  3. `rentPeriodicity` (id: "rentPeriodicity", label: "PÃ©riodicitÃ© du loyer", options: ["Mensuel", "Trimestriel", "Annuel"], selectedOption: "Mensuel" par dÃ©faut, required: true, **visible uniquement si** `saleType === "Ã  louer"`)

---

#### **`src/components/1-Sources-Generation-Annonces/form-components/FormulaireSaisie.tsx`**
**RÃ´le** : Zone de texte multiligne (textarea) avec formatage automatique :
- Ajout automatique de puces (`â€¢ `) en dÃ©but de ligne
- Capitalisation de la premiÃ¨re lettre aprÃ¨s la puce
- Ajustement dynamique de la hauteur

- **Props** :
  ```typescript
  interface FormulaireSaisieProps {
    id: string;
    title: string;
    value: string;
    onChange: (e: React.ChangeEvent) => void;
    placeholder?: string;
    className?: string;
    minRows?: number; // Nombre min de lignes
    readOnly?: boolean;
    required?: boolean;
  }
  ```

- **Logique de formatage** :
  ```typescript
  const handleInputChange = (e: React.ChangeEvent) => {
    let text = e.target.value;
    const lines = text.split('\n');

    const formattedLines = lines.map((line, index) => {
      // Ignorer ligne vide
      if (!line.trim()) return line;

      // Ajouter puce si absente
      if (!line.startsWith('â€¢ ')) {
        line = 'â€¢ ' + line.replace(/^[â€¢\s]+/, '');
      }

      // Capitaliser aprÃ¨s la puce
      if (line.length > 2) {
        line = 'â€¢ ' + line.charAt(2).toUpperCase() + line.slice(3);
      }

      return line;
    });

    const formattedText = formattedLines.join('\n');
    e.target.value = formattedText;
    onChange(e);
    adjustHeight(e.target);
  };
  ```

- **Champs utilisant FormulaireSaisie** :
  1. `keyElements` (id: "keyElements", titre: "Arguments commerciaux", placeholder: "Listez 5 arguments commerciaux forts en votre possession...", minRows: 8, required: true)

---

#### **`src/components/1-Sources-Generation-Annonces/form-components/BoutonValiderInformations.tsx`**
**RÃ´le** : Bouton de validation du formulaire.

- **Props** :
  ```typescript
  interface BoutonValiderInformationsProps {
    onClick?: () => void;
    disabled?: boolean;
    width?: string; // DÃ©faut: "auto"
    height?: string; // DÃ©faut: "70px"
    className?: string;
  }
  ```

- **Apparence** :
  - Texte : "Valider mes informations"
  - IcÃ´ne : `` (Lucide)
  - Gradient : `from-[#4C1D96] to-[#6C28D8]`
  - Hover : `from-[#244BD8] to-[#7B24CF]` + `scale-105`

---

### **4. Composants d'aide et support**

#### **`src/components/1-Sources-Generation-Annonces/help/SgaHelpBox.tsx`**
**RÃ´le** : BoÃ®te d'aide avec icÃ´ne, titre et contenu.

- **Props** :
  ```typescript
  interface SgaHelpBoxProps {
    title: string;
    content: React.ReactNode;
    icon?: React.ReactNode; // DÃ©faut: 
    className?: string;
  }
  ```

- **Utilisation dans Ã‰tape 1** :
  - AffichÃ©e **sous le bouton "Valider mes informations"**
  - Titre : "Arguments commerciaux"
  - IcÃ´ne : ``
  - Contenu : Instructions dÃ©taillÃ©es (voir ligne 206-220 de `EnsembleFormulairesEtape1Form.tsx`)

---

#### **`src/components/1-Sources-Generation-Annonces/help/EtapeFAQ.tsx`**
**RÃ´le** : FAQ spÃ©cifique Ã  chaque Ã©tape.

- **Props** :
  ```typescript
  interface EtapeFAQProps {
    etape: "etape1" | "etape2" | "etape3" | "etape4";
  }
  ```

- **Contenu pour `etape="etape1"`** :
  - Titre : "Quelles informations intÃ©grer ?"
  - IcÃ´ne : ``
  - Contenu :
    - Type de bien, Emplacement (SEO), Prix FAI, Loyer
    - Message : "Plus vous fournissez d'informations prÃ©cises, plus l'IA pourra gÃ©nÃ©rer une annonce originale..."

---

### **5. Utilitaires de gestion d'Ã©tat et stockage**

#### **`src/services/openai.ts`**
**RÃ´le** : Service centralisÃ© pour :
1. GÃ©rer le stockage/rÃ©cupÃ©ration des donnÃ©es de formulaire (localStorage)
2. Communiquer avec OpenAI API (utilisÃ© en Ã‰tape 5)

- **Interface des donnÃ©es** :
  ```typescript
  export interface PropertyData {
    // Ã‰tape 1
    agencyName?: string;
    reference?: string;
    exclusivite?: string;
    location?: string;
    propertyType?: string;
    saleType?: string;
    price?: string;
    rentAmount?: string;
    rentPeriodicity?: string;
    keyElements?: string;

    // Ã‰tape 2
    propertyDescription?: string;

    // Ã‰tape 3
    financials?: string;

    // Ã‰tape 4
    details?: string;
    hasNoDetails?: boolean;
  }
  ```

- **Fonction `getPropertyDataFromStorage()`** :
  ```typescript
  export const getPropertyDataFromStorage = (): PropertyData => {
    try {
      const data = localStorage.getItem("propertyData");
      return data ? JSON.parse(data) : {};
    } catch (error) {
      console.error("Error parsing property data from storage:", error);
      return {};
    }
  };
  ```
  - **ClÃ© localStorage** : `"propertyData"`
  - **Format** : JSON stringifiÃ©

- **Fonction `updatePropertyData()`** :
  ```typescript
  export const updatePropertyData = (newData: Partial): PropertyData => {
    try {
      const existingData = getPropertyDataFromStorage();
      const updatedData = { ...existingData, ...newData }; // Merge
      localStorage.setItem("propertyData", JSON.stringify(updatedData));
      return updatedData;
    } catch (error) {
      console.error("Error updating property data in storage:", error);
      return newData as PropertyData;
    }
  };
  ```
  - **Comportement** : Merge avec donnÃ©es existantes (ne remplace pas tout)

- **Fonction `clearPropertyData()`** :
  ```typescript
  export const clearPropertyData = (): void => {
    localStorage.removeItem("propertyData");
  };
  ```

---

#### **`src/components/1-Sources-Generation-Annonces/utils/useStepProgress.ts`**
**RÃ´le** : Hook pour gÃ©rer la progression des Ã©tapes (dÃ©blocage sÃ©quentiel).

- **ClÃ© localStorage** : `"stepProgress"`
- **Format** : Tableau JSON d'entiers (ex: `[1, 2, 3]` = Ã‰tapes 1, 2, 3 disponibles)

- **Ã‰tat** :
  ```typescript
  const [availableSteps, setAvailableSteps] = useState([1]);
  const [hasCompletedStep4, setHasCompletedStep4] = useState(false);
  ```

- **Chargement au montage** :
  ```typescript
  useEffect(() => {
    const savedProgress = localStorage.getItem('stepProgress');
    if (savedProgress) {
      const progress = JSON.parse(savedProgress);
      setAvailableSteps(progress);
      if (progress.includes(5)) setHasCompletedStep4(true);
    }
  }, []);
  ```

- **Fonction `completeStep(step: number)`** :
  ```typescript
  const completeStep = (step: number) => {
    const nextStep = step + 1;
    const newAvailableSteps = [...new Set([...availableSteps, nextStep])];
    setAvailableSteps(newAvailableSteps);
    localStorage.setItem('stepProgress', JSON.stringify(newAvailableSteps));

    if (step === 4) setHasCompletedStep4(true);
  };
  ```
  - **Exemple** : `completeStep(1)` â†’ Ajoute `2` dans `stepProgress`

- **Fonction `getDisabledSteps()`** :
  ```typescript
  const getDisabledSteps = () => {
    const allSteps = [1, 2, 3, 4, 5];
    return allSteps.filter(step => !availableSteps.includes(step));
  };
  ```

- **Fonction `handleConfirmNewProject()`** :
  ```typescript
  const handleConfirmNewProject = () => {
    localStorage.clear(); // Supprime TOUT
    toast({ title: "Projet rÃ©initialisÃ©" });
    navigate('/etape1');
    window.location.reload(); // Force rechargement
  };
  ```

---

#### **`src/components/1-Sources-Generation-Annonces/utils/useBoutonGenerationNewProjet.tsx`**
**RÃ´le** : Hook pour gÃ©rer le bouton "GÃ©nÃ©rer un nouveau projet".

- **Fonction exposÃ©e** :
  ```typescript
  const handleConfirmNewProject = () => {
    localStorage.clear(); // Supprime propertyData, stepProgress, etc.
    toast({ title: "Projet rÃ©initialisÃ©", description: "Toutes les donnÃ©es ont Ã©tÃ© effacÃ©es." });
    navigate('/etape1');
    window.location.reload();
  };
  ```

- **Utilisation** :
  - Dans `DirectivesMenuOnglet.tsx` (colonne latÃ©rale)
  - Affiche une `AlertDialog` de confirmation avant d'exÃ©cuter `handleConfirmNewProject()`

---

### **6. Composants de navigation et layout**

#### **`src/components/atemplate.v2.generation-annonces/DirectivesMenuOnglet.tsx`**
**RÃ´le** : Menu latÃ©ral avec navigation entre Ã©tapes + boutons d'action.

- **Props** :
  ```typescript
  interface DirectivesMenuOngletProps {
    activeStep?: number; // Ã‰tape actuelle
    disabledSteps?: number[]; // Ã‰tapes dÃ©sactivÃ©es
  }
  ```

- **Hooks utilisÃ©s** :
  ```typescript
  const { hasCompletedStep4, goToEtape5, isStepAvailable } = useStepProgress(activeStep);
  const { handleConfirmNewProject } = useBoutonGenerationNewProjet();
  ```

- **Structure visuelle** :
  1. **Grille 2x2 de cartes colorÃ©es** (navigation vers Ã©tapes 1-4) :
     - Carte verte (Ã‰tape 1) : IcÃ´ne ``, Texte "Ã‰lÃ©ments ClÃ©s"
     - Carte bleue (Ã‰tape 2) : IcÃ´ne ``, Texte "Infos de Description"
     - Carte violette (Ã‰tape 3) : IcÃ´ne ``, Texte "Infos FinanciÃ¨res"
     - Carte orange (Ã‰tape 4) : IcÃ´ne ``, Texte "Autres DÃ©tails"
     - **OpacitÃ© rÃ©duite si Ã©tape dÃ©sactivÃ©e** : `opacity-50 cursor-not-allowed`

  2. **Bouton "Valider mon projet"** (composant `BoutonValiderProjet`) :
     - **Visible uniquement si** `hasCompletedStep4 === true` ET `activeStep !== 5`
     - Action : `goToEtape5()` â†’ Navigation vers `/etape5`

  3. **Bouton "GÃ©nÃ©rer un nouveau projet"** (composant `BoutonNouveauProjet`) :
     - IcÃ´ne ``
     - Affiche `AlertDialog` de confirmation
     - Action confirmÃ©e : `handleConfirmNewProject()` (supprime tout localStorage)

---

#### **`src/components/atemplate.v2.generation-annonces/Layout.V2.GenAnn.tsx`**
**RÃ´le** : Layout global de l'application (sidebar gauche + contenu principal).

- **Structure** :
  - Sidebar gauche :
    - Logo (image)
    - Menu de navigation (gÃ©nÃ©rÃ© par `useNavLinks()`)
    - Menu Dashboard (gÃ©nÃ©rÃ© par `useDashboardLinks()`)
  - Contenu principal : `{children}` (le contenu de la page Ã‰tape 1)

- **Props** :
  ```typescript
  interface LayoutV2GenAnnProps {
    children: React.ReactNode;
    logoSrc?: string;
    navTitle?: string;
    navLinks?: NavLink[];
  }
  ```

---

#### **`src/0.structure-type-page/structure5HeroPetit/StructureHeroPetit.tsx`**
**RÃ´le** : Section hero en haut de page (titre, sous-titre, description, image).

- **Props** :
  ```typescript
  interface StructureHeroPetitProps {
    title: string;
    subtitle: string;
    description: string;
    imageSrc?: string;
    className?: string;
    buttonText?: string;
    buttonLink?: string;
    onButtonClick?: () => void;
    allowHTML?: boolean; // Permet d'insÃ©rer du HTML (ex: )
  }
  ```

- **Apparence** :
  - Fond : `bg-realestate-purple-dark`
  - Titre H1 : `text-[32px] font-bold text-[#ffffff]`
  - Sous-titre H2 : `text-[20px] text-[#F1940F] font-bold`
  - Description : `text-white text-[15px]`
  - Image : AffichÃ©e Ã  droite (cachÃ©e sur mobile)

---

### **7. Composants de boutons d'action**

#### **`src/components/1-Sources-Restitution-Utilisateur/0.Etape6Communication/BoutonNouveauProjet.tsx`**
**RÃ´le** : Bouton "GÃ©nÃ©rer un nouveau projet".

- **Apparence** :
  - Gradient : `from-[#470135] to-[#860265]`
  - Texte : `text-[#FD62F7]` - "GÃ©nÃ©rer un nouveau projet" (3 lignes)
  - IcÃ´ne : `` (en bas Ã  droite)
  - Hover : `scale-105`

---

#### **`src/components/1-Sources-Generation-Annonces/form-components/BoutonValiderProjet.tsx`**
**RÃ´le** : Bouton "Revenir Ã  l'Ã‰tape GÃ©nÃ©ration des Annonces" (vers Ã‰tape 5).

- **Apparence** :
  - Gradient : `from-[#0B2B6C] to-[#0E3A96]`
  - Texte : "Revenir Ã  l'Etape GÃ©nÃ©ration des Annonces" (3 lignes)
  - IcÃ´ne : `` (en bas Ã  droite)

---

## **III. STRUCTURE DES DONNÃ‰ES DANS `localStorage`**

### **ClÃ© `"propertyData"` (donnÃ©es du formulaire)**

#### **Format JSON** :
```json
{
  "agencyName": "Presenca Immobilier",
  "reference": "REF-12345",
  "exclusivite": "Oui",
  "location": "Paris 15e",
  "propertyType": "Restaurant",
  "saleType": "Ã  vendre",
  "price": "450 000â‚¬",
  "rentAmount": "",
  "rentPeriodicity": "Mensuel",
  "keyElements": "â€¢ Emplacement premium\nâ€¢ Fort potentiel\nâ€¢ ClientÃ¨le fidÃ¨le"
}
```

#### **Champs Ã‰tape 1** :
| **Nom du champ** | **Type** | **Valeur par dÃ©faut** | **Obligatoire** | **Condition d'affichage** |
|---|---|---|---|---|
| `agencyName` | `string` | `""` | âœ… Oui | Toujours |
| `reference` | `string` | `""` | âœ… Oui | Toujours |
| `exclusivite` | `string` | `"Non"` | âœ… Oui | Toujours |
| `location` | `string` | `""` | âœ… Oui | Toujours |
| `propertyType` | `string` | `""` | âœ… Oui | Toujours |
| `saleType` | `string` | `"Ã  vendre"` | âœ… Oui | Toujours |
| `price` | `string` | `""` | âš ï¸ Oui (si vente) | Visible si `saleType === "Ã  vendre"` |
| `rentAmount` | `string` | `""` | âš ï¸ Oui (si location) | Visible si `saleType === "Ã  louer"` |
| `rentPeriodicity` | `string` | `"Mensuel"` | âœ… Oui | Visible si `saleType === "Ã  louer"` |
| `keyElements` | `string` | `""` | âœ… Oui | Toujours |

---

### **ClÃ© `"stepProgress"` (progression des Ã©tapes)**

#### **Format JSON** :
```json
[1, 2, 3]
```
- **Signification** : Ã‰tapes 1, 2, 3 sont disponibles
- **Mis Ã  jour par** : `completeStep(stepNumber)` dans `useStepProgress`
- **Exemple** :
  - Initial : `[1]` (seule Ã‰tape 1 accessible)
  - AprÃ¨s validation Ã‰tape 1 : `[1, 2]`
  - AprÃ¨s validation Ã‰tape 2 : `[1, 2, 3]`
  - AprÃ¨s validation Ã‰tape 4 : `[1, 2, 3, 4, 5]`

---

## **IV. LOGIQUE DE VALIDATION DES CHAMPS**

### **RÃ¨gles de validation (Ã‰tape 1)**

#### **1. Champs obligatoires TOUJOURS** :
| **Champ** | **RÃ¨gle** | **Message d'erreur** |
|---|---|---|
| `agencyName` | Non vide aprÃ¨s trim | "Veuillez saisir le nom de votre agence." |
| `reference` | Non vide aprÃ¨s trim | "Veuillez saisir une rÃ©fÃ©rence pour le bien." |
| `location` | Non vide aprÃ¨s trim | "Veuillez saisir l'emplacement du bien." |
| `propertyType` | Non vide aprÃ¨s trim | "Veuillez saisir le type de bien." |
| `keyElements` | Non vide aprÃ¨s trim | "Veuillez saisir au moins un argument commercial." |

#### **2. Champs obligatoires CONDITIONNELS** :
| **Champ** | **Condition** | **RÃ¨gle** | **Message d'erreur** |
|---|---|---|---|
| `price` | `saleType === "Ã  vendre"` | Non vide aprÃ¨s trim | "Veuillez saisir le prix du bien." |
| `rentAmount` | `saleType === "Ã  louer"` | Non vide aprÃ¨s trim | "Veuillez saisir le montant du loyer." |

#### **3. Champs NON obligatoires** :
| **Champ** | **Remarque** |
|---|---|
| `exclusivite` | Valeur par dÃ©faut `"Non"` |
| `rentPeriodicity` | Valeur par dÃ©faut `"Mensuel"` (utilisÃ© uniquement si location) |

---

### **Ordre de validation** (sÃ©quentiel) :
```
1. agencyName â†’ Erreur si vide
2. reference â†’ Erreur si vide
3. location â†’ Erreur si vide
4. propertyType â†’ Erreur si vide
5. SI saleType === "Ã  vendre" â†’ price â†’ Erreur si vide
6. SI saleType === "Ã  louer" â†’ rentAmount â†’ Erreur si vide
7. keyElements â†’ Erreur si vide
8. SI toutes validations OK â†’ Sauvegarde dans localStorage + Success toast
```

---

## **V. CONTRAINTES ET RÃˆGLES MÃ‰TIER**

### **Contraintes des champs**

#### **1. `agencyName` (Nom de l'Agence)** :
- Type : Texte libre
- Capitalisation automatique de la premiÃ¨re lettre
- UtilisÃ© par OpenAI dans le prompt `[nom de l'agence immobiliÃ¨re]`
- **Exemple** : "Presenca Immobilier"

#### **2. `reference` (RÃ©fÃ©rence du bien)** :
- Type : Texte libre
- Capitalisation automatique de la premiÃ¨re lettre
- UtilisÃ© par OpenAI dans le prompt `[rÃ©fÃ©rence du bien]`
- **Exemple** : "REF-12345", "LOC-456"

#### **3. `exclusivite` (ExclusivitÃ©)** :
- Type : Boutons radio (`"Oui"` ou `"Non"`)
- Valeur par dÃ©faut : `"Non"`
- UtilisÃ© par OpenAI :
  - Si `"Oui"` â†’ Mention "ExclusivitÃ©" dans titre et accroche
  - Si `"Non"` â†’ Pas de mention
- Placeholder OpenAI : `[Oui]` (remplacÃ© par `"Oui"` ou `"Non"`)

#### **4. `location` (Emplacement)** :
- Type : Texte libre
- Capitalisation automatique de la premiÃ¨re lettre
- **RÃ´le SEO** : Repris dans balise titre, mÃ©ta-description, URL
- UtilisÃ© par OpenAI dans le prompt `[localisation du bien]`
- **Exemples** : "Paris 15e", "Lyon 3e Arrondissement", "Bordeaux Centre"

#### **5. `propertyType` (Type de bien)** :
- Type : Texte libre
- Capitalisation automatique de la premiÃ¨re lettre
- UtilisÃ© par OpenAI dans le prompt `[type de bien commercial: restaurant, bar, boutique, etc.]`
- **Exemples** : "Restaurant", "Bar", "Boutique", "Local commercial", "Bureau"

#### **6. `saleType` (Type de transaction)** :
- Type : Boutons radio (`"Ã  vendre"` ou `"Ã  louer"`)
- Valeur par dÃ©faut : `"Ã  vendre"`
- **Impact visuel** :
  - Si `"Ã  vendre"` â†’ Affiche champ `price`
  - Si `"Ã  louer"` â†’ Affiche champs `rentAmount` + `rentPeriodicity`
- UtilisÃ© par OpenAI dans le prompt `[Ã  vendre ou Ã  louer]`

#### **7. `price` (Prix FAI)** :
- Type : Champ monÃ©taire
- Formatage automatique : Espaces milliers + symbole `â‚¬`
- **Exemples** : `"450 000â‚¬"`, `"1 200 000â‚¬"`
- UtilisÃ© par OpenAI dans le prompt `[montant]` (si vente)
- **Contrainte** : Obligatoire UNIQUEMENT si `saleType === "Ã  vendre"`

#### **8. `rentAmount` (Loyer HT/HC)** :
- Type : Champ monÃ©taire
- Formatage automatique : Espaces milliers + symbole `â‚¬`
- **Exemples** : `"1 200â‚¬"`, `"5 000â‚¬"`
- UtilisÃ© par OpenAI dans le prompt `[montant]` (si location)
- **Contrainte** : Obligatoire UNIQUEMENT si `saleType === "Ã  louer"`

#### **9. `rentPeriodicity` (PÃ©riodicitÃ© du loyer)** :
- Type : Boutons radio (`"Mensuel"`, `"Trimestriel"`, `"Annuel"`)
- Valeur par dÃ©faut : `"Mensuel"`
- UtilisÃ© par OpenAI dans le prompt `[mensuel, trimestriel, ou annuel]`
- **Contrainte** : Visible UNIQUEMENT si `saleType === "Ã  louer"`

#### **10. `keyElements` (Arguments commerciaux)** :
- Type : Textarea multiligne avec formatage automatique
- **Formatage** :
  - Ajout automatique de puces `â€¢ ` en dÃ©but de ligne
  - Capitalisation automatique aprÃ¨s la puce
- UtilisÃ© par OpenAI dans le prompt `[points forts et arguments commerciaux]`
- **RÃ´le stratÃ©gique** : Alimente les titres, accroches, CTA, et outils SEO
- **Exemples** :
  ```
  â€¢ Emplacement premium en centre-ville
  â€¢ Fort potentiel de dÃ©veloppement
  â€¢ ClientÃ¨le fidÃ¨le et dynamique
  â€¢ Conditions locatives attractives
  â€¢ Ã‰quipements professionnels haut de gamme
  ```

---

### **Contraintes du bouton "GÃ©nÃ©rer un nouveau projet"**

#### **Comportement** :
1. Affiche une `AlertDialog` de confirmation :
   - Titre : "ÃŠtes-vous sÃ»r de vouloir gÃ©nÃ©rer un nouveau projet ?"
   - Description : "Attention. Cette action supprimera toutes les donnÃ©es saisies du projet en cours. Cette action est irrÃ©versible."
   - Boutons : "Annuler" | "GÃ©nÃ©rer un nouveau projet"

2. Si confirmation :
   - ExÃ©cute `localStorage.clear()` â†’ **Supprime TOUTES les clÃ©s** :
     - `"propertyData"` (toutes les donnÃ©es Ã‰tapes 1-4)
     - `"stepProgress"` (progression)
     - `"session_start_time"` (timer dÃ©sactivÃ© mais prÃ©sent)
     - Toutes les clÃ©s de gÃ©nÃ©ration OpenAI (ex: `"generation_website_ad"`, `"generation_summary_sheet"`, etc.)
   - Affiche un toast de succÃ¨s
   - Redirige vers `/etape1`
   - ExÃ©cute `window.location.reload()` pour forcer le rechargement complet

#### **Emplacements du bouton** :
1. Dans `DirectivesMenuOnglet.tsx` (colonne latÃ©rale, visible sur toutes les Ã©tapes 1-5)
2. Dans `Etape6Communication` (page de diffusion)

---

## **VI. NAVIGATION ET RETOUR EN ARRIÃˆRE**

### **Navigation sÃ©quentielle**

#### **DÃ©blocage des Ã©tapes** :
- **Initial** : Seule Ã‰tape 1 accessible (`stepProgress = [1]`)
- **AprÃ¨s validation Ã‰tape 1** : Ã‰tapes 1 et 2 accessibles (`stepProgress = [1, 2]`)
- **AprÃ¨s validation Ã‰tape 2** : Ã‰tapes 1, 2, 3 accessibles (`stepProgress = [1, 2, 3]`)
- **Etc.**

#### **Fonction `isStepAvailable(step: number)`** (dans `useStepProgress`) :
```typescript
isStepAvailable: (step: number) => {
  // Ã‰tape 1 toujours accessible
  if (step === 1) return true;

  // Ã‰tape prÃ©cÃ©dente accessible si dans availableSteps
  if (step < currentStep) return availableSteps.includes(step);

  // Ã‰tape actuelle ou disponible
  return step === currentStep || availableSteps.includes(step);
}
```

---

### **Retour en arriÃ¨re (correction)**

#### **MÃ©thode 1 : Navigation via DirectivesMenuOnglet** :
- Cliquer sur une carte colorÃ©e (Ã‰tape 1-4) **si elle est disponible**
- Fonction `allerVersEtape(etape: number)` :
  ```typescript
  const allerVersEtape = (etape: number) => {
    if (!isStepAvailable(etape)) return;
    navigate(`/etape${etape}`);
  };
  ```

#### **MÃ©thode 2 : Navigation via menu gauche** (sidebar) :
- Cliquer sur un lien du menu de navigation gÃ©nÃ©rÃ© par `useNavLinks()`

#### **MÃ©thode 3 : Retour arriÃ¨re navigateur** :
- Le hook `useEffect` dans `EnsembleFormulairesEtape1Form` recharge les donnÃ©es au retour focus :
  ```typescript
  window.addEventListener('focus', loadData);
  ```

---

### **Chargement des donnÃ©es au retour** :
- **DÃ©clenchement** :
  1. Montage du composant (`useEffect([])`)
  2. Retour focus sur la fenÃªtre (`window.addEventListener('focus', loadData)`)
  3. Retour visibilitÃ© page (`document.visibilityState === 'visible'`)

- **Fonction `loadData()`** :
  ```typescript
  const loadData = () => {
    const propertyData = getPropertyDataFromStorage();
    if (Object.keys(propertyData).length > 0) {
      // Remplissage de tous les states avec les valeurs stockÃ©es
      setAgencyName(propertyData.agencyName || "");
      setReference(propertyData.reference || "");
      // ...
    }
  };
  ```

---

## **VII. UTILISATION DES DONNÃ‰ES PAR OPENAI**

### **Prompts OpenAI (Ã‰tape 5)**

#### **Fichier de prompt : `src/services/openai/1.GenerateurAnnoncesOutilsSeo/7.PromptsOpenAi/1.PromptAnnonceSiteInternet.ts`**

**Placeholders remplacÃ©s** :
| **Placeholder dans le prompt** | **Valeur de remplacement** | **Source** |
|---|---|---|
| `[nom de l'agence immobiliÃ¨re]` | `data.agencyName` | `propertyData.agencyName` |
| `[type de bien commercial: restaurant, bar, boutique, etc.]` | `data.propertyType` | `propertyData.propertyType` |
| `[Ã  vendre ou Ã  louer]` | `data.saleType` | `propertyData.saleType` |
| `[localisation du bien]` | `data.location` | `propertyData.location` |
| `[points forts et arguments commerciaux]` | `data.keyElements` | `propertyData.keyElements` |
| `[montant]` | `data.price OU data.rentAmount` | `propertyData.price` ou `propertyData.rentAmount` |
| `[mensuel, trimestriel, ou annuel]` | `data.rentPeriodicity` | `propertyData.rentPeriodicity` |
| `[Oui]` | `"Oui"` OU `"Non"` | `propertyData.exclusivite === "Oui" ? "Oui" : "Non"` |
| `[rÃ©fÃ©rence du bien]` | `data.reference` | `propertyData.reference` |
| `[description dÃ©taillÃ©e du bien]` | `data.propertyDescription` | `propertyData.propertyDescription` (Ã‰tape 2) |
| `[dÃ©tails financiers du bien]` | `data.financials` | `propertyData.financials` (Ã‰tape 3) |
| `[informations complÃ©mentaires]` | `data.details` | `propertyData.details` (Ã‰tape 4) |

---

### **GÃ©nÃ©ration OpenAI (mÃ©thode `generateWebsiteAd`)**

**Code dans `src/services/openai.ts` (lignes 160-203)** :
```typescript
async generateWebsiteAd(data: PropertyData, model: string = "gpt-4o"): Promise<{
  titre: string;
  accroche: string;
  descriptif: string;
  cta: string;
}> {
  const userPrompt = promptAnnonceSiteInternet
    .replace(/\[nom de l'agence immobiliÃ¨re\]/g, data.agencyName || "")
    .replace(/\[type de bien commercial: restaurant, bar, boutique, etc.\]/g, data.propertyType || "")
    .replace(/\[Ã  vendre ou Ã  louer\]/g, data.saleType || "")
    .replace(/\[localisation du bien\]/g, data.location || "")
    .replace(/\[points forts et arguments commerciaux\]/g, data.keyElements || "")
    .replace(/\[montant\]/g, data.price || data.rentAmount || "")
    .replace(/\[mensuel, trimestriel, ou annuel\]/g, data.rentPeriodicity || "")
    .replace(/\[Oui\]/g, data.exclusivite === "Oui" ? "Oui" : "Non")
    .replace(/\[rÃ©fÃ©rence du bien\]/g, data.reference || "")
    .replace(/\[description dÃ©taillÃ©e du bien\]/g, data.propertyDescription || "")
    .replace(/\[dÃ©tails financiers du bien\]/g, data.financials || "")
    .replace(/\[informations complÃ©mentaires\]/g, data.details || "");

  const response = await this.generateResponse(userPrompt, model);

  return JSON.parse(response); // Retour attendu : { titre, accroche, descriptif, cta }
}
```

---

### **Structure attendue du titre gÃ©nÃ©rÃ©** (selon prompt) :

**Si vente** :
```
[Type de bien] Ã  Vendre | [Emplacement] | [Atout 1] | [Atout 2] | [Atout 3] | [Prix FAI]
```
**Exemple** :
```
Restaurant Ã  Vendre | Paris 15e | Emplacement Premium | ClientÃ¨le FidÃ¨le | Fort Potentiel | 450.000â‚¬
```

**Si location** :
```
[Type de bien] Ã  Louer | [Emplacement] | [Atout 1] | [Atout 2] | [Atout 3] | [Loyer HT/HC + PÃ©riodicitÃ©]
```
**Exemple** :
```
Bar Ã  Louer | Lyon 3e | Terrasse Spacieuse | Licence IV | Ã‰quipement Complet | 1.500â‚¬HT/HC par mois
```

---

## **VIII. PROCESSUS COMPLET Ã‰TAPE PAR Ã‰TAPE**

### **ScÃ©nario nominal : Validation Ã‰tape 1**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. UTILISATEUR ACCÃˆDE Ã€ /etape1                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. MONTAGE DU COMPOSANT Etape1.tsx                              â”‚
â”‚    - CrÃ©ation rÃ©fÃ©rence formulaire (useRef)                     â”‚
â”‚    - Appel useStepProgress(1) â†’ Chargement stepProgress         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. MONTAGE DU COMPOSANT EnsembleFormulairesEtape1Form           â”‚
â”‚    - Initialisation 10 states (vides ou valeurs par dÃ©faut)     â”‚
â”‚    - useEffect: loadData()                                      â”‚
â”‚      â†’ getPropertyDataFromStorage() lit localStorage            â”‚
â”‚      â†’ Si donnÃ©es existantes, remplissage des states            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. AFFICHAGE DU FORMULAIRE                                      â”‚
â”‚    - Champs TextFieldForm (4 champs)                            â”‚
â”‚    - Champs MonetaryFieldForm (1 ou 2 selon saleType)           â”‚
â”‚    - Champs SelectionButtonRond (2 ou 3 selon saleType)         â”‚
â”‚    - Champ FormulaireSaisie (keyElements)                       â”‚
â”‚    - Bouton BoutonValiderInformations                           â”‚
â”‚    - SgaHelpBox "Arguments commerciaux"                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. UTILISATEUR SAISIT LES CHAMPS                                â”‚
â”‚    - Capitalisation automatique (TextFieldForm)                 â”‚
â”‚    - Formatage monÃ©taire (MonetaryFieldForm)                    â”‚
â”‚    - Formatage puces (FormulaireSaisie)                         â”‚
â”‚    - Changement saleType â†’ Affichage conditionnel prix/loyer    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. UTILISATEUR CLIQUE SUR "Valider mes informations"           â”‚
â”‚    - DÃ©clenchement handleFormSubmit()                           â”‚
â”‚      â†’ Appel handleValidation()                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. VALIDATION SÃ‰QUENTIELLE (handleValidation)                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ âœ“ agencyName vide ? â†’ Toast erreur â†’ STOP              â”‚ â”‚
â”‚    â”‚ âœ“ reference vide ? â†’ Toast erreur â†’ STOP               â”‚ â”‚
â”‚    â”‚ âœ“ location vide ? â†’ Toast erreur â†’ STOP                â”‚ â”‚
â”‚    â”‚ âœ“ propertyType vide ? â†’ Toast erreur â†’ STOP            â”‚ â”‚
â”‚    â”‚ âœ“ SI saleType === "Ã  vendre" â†’ price vide ? â†’ STOP     â”‚ â”‚
â”‚    â”‚ âœ“ SI saleType === "Ã  louer" â†’ rentAmount vide ? â†’ STOP â”‚ â”‚
â”‚    â”‚ âœ“ keyElements vide ? â†’ Toast erreur â†’ STOP             â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    Si TOUTES les validations OK â†’ Suite                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. SAUVEGARDE DANS localStorage                                 â”‚
â”‚    - CrÃ©ation objet etape1Data { agencyName, reference, ... }  â”‚
â”‚    - Appel updatePropertyData(etape1Data)                       â”‚
â”‚      â†’ getPropertyDataFromStorage() (lecture existant)          â”‚
â”‚      â†’ Merge { ...existingData, ...etape1Data }                 â”‚
â”‚      â†’ localStorage.setItem("propertyData", JSON.stringify)     â”‚
â”‚    - Toast succÃ¨s "Informations validÃ©es"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. DÃ‰BLOCAGE Ã‰TAPE 2                                            â”‚
â”‚    - Appel completeStep(1) (useStepProgress)                    â”‚
â”‚      â†’ Ajout de 2 dans availableSteps                           â”‚
â”‚      â†’ localStorage.setItem("stepProgress", [1, 2])             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. NAVIGATION VERS Ã‰TAPE 2                                     â”‚
â”‚     - navigate("/etape2")                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **ScÃ©nario alternatif : Retour arriÃ¨re pour correction**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. UTILISATEUR SUR Ã‰TAPE 3 (ou autre)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. UTILISATEUR CLIQUE SUR CARTE VERTE (Ã‰tape 1)                 â”‚
â”‚    - DirectivesMenuOnglet â†’ allerVersEtape(1)                   â”‚
â”‚    - VÃ©rification isStepAvailable(1) â†’ true                     â”‚
â”‚    - navigate("/etape1")                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. MONTAGE EnsembleFormulairesEtape1Form                        â”‚
â”‚    - useEffect: loadData()                                      â”‚
â”‚    - Chargement donnÃ©es depuis localStorage "propertyData"      â”‚
â”‚    - PrÃ©-remplissage de TOUS les champs avec valeurs existantesâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. UTILISATEUR MODIFIE UN CHAMP (ex: agencyName)                â”‚
â”‚    - onChange dÃ©clenchÃ© â†’ setAgencyName(newValue)               â”‚
â”‚    - Ã‰tat local mis Ã  jour (MAIS PAS ENCORE localStorage)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. UTILISATEUR CLIQUE "Valider mes informations"               â”‚
â”‚    - handleValidation() â†’ Validation OK                         â”‚
â”‚    - updatePropertyData({ ...nouvelles valeurs })               â”‚
â”‚      â†’ MERGE avec existant â†’ Ã‰crase anciennes valeurs           â”‚
â”‚    - completeStep(1) â†’ Pas de changement (dÃ©jÃ  dans [1,2,3...]) â”‚
â”‚    - navigate("/etape2")                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **ScÃ©nario : Nouveau projet (suppression de tout)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. UTILISATEUR CLIQUE SUR "GÃ©nÃ©rer un nouveau projet"          â”‚
â”‚    - DirectivesMenuOnglet â†’ handleTrashButtonClick()            â”‚
â”‚    - Ouverture AlertDialog                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. UTILISATEUR CONFIRME                                         â”‚
â”‚    - handleConfirmNewProject() (useBoutonGenerationNewProjet)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SUPPRESSION TOTALE localStorage                              â”‚
â”‚    - localStorage.clear()                                       â”‚
â”‚      â†’ Suppression "propertyData"                               â”‚
â”‚      â†’ Suppression "stepProgress"                               â”‚
â”‚      â†’ Suppression "session_start_time"                         â”‚
â”‚      â†’ Suppression toutes clÃ©s de gÃ©nÃ©ration OpenAI             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. AFFICHAGE TOAST                                              â”‚
â”‚    - Toast { title: "Projet rÃ©initialisÃ©", description: ... }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. NAVIGATION + RECHARGEMENT                                    â”‚
â”‚    - navigate('/etape1')                                        â”‚
â”‚    - window.location.reload() â†’ Force rechargement complet      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. PAGE Ã‰TAPE 1 VIERGE                                          â”‚
â”‚    - Tous les champs vides                                      â”‚
â”‚    - stepProgress = [1] (seule Ã‰tape 1 accessible)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **IX. Ã‰LÃ‰MENTS CACHÃ‰S / CONDITIONNELS**

### **Champs affichÃ©s conditionnellement**

#### **1. Champ `price` (Prix FAI)** :
- **Condition d'affichage** : `saleType === "Ã  vendre"`
- **Code** :
  ```tsx
  {saleType === "Ã  vendre" && (
     setPrice(e.target.value)}
      required={true}
    />
  )}
  ```

#### **2. Champs `rentAmount` + `rentPeriodicity`** :
- **Condition d'affichage** : `saleType === "Ã  louer"`
- **Code** :
  ```tsx
  {saleType === "Ã  louer" && (
    <>
       setRentAmount(e.target.value)}
        required={true}
      />

  )}
  ```

---

### **Bouton "Valider mon projet" (DirectivesMenuOnglet)**

- **Condition d'affichage** : `hasCompletedStep4 === true` ET `activeStep !== 5`
- **Code** :
  ```tsx
  {hasCompletedStep4 && activeStep !== 5 && (

  )}
  ```
- **Explication** :
  - Visible UNIQUEMENT si l'utilisateur a complÃ©tÃ© l'Ã‰tape 4
  - CachÃ© sur l'Ã‰tape 5 (car dÃ©jÃ  sur la page de gÃ©nÃ©ration)

---

## **X. TIMER DE SESSION (DÃ‰SACTIVÃ‰ MAIS PRÃ‰SENT)**

### **Code dans `src/components/1-Sources-Generation-Annonces/utils/useSgaForm.ts`**

#### **Ã‰tat actuel** :
- Le code de timer est **commentÃ©** (lignes 14-53)
- Mais la **clÃ© localStorage** `"session_start_time"` est **toujours crÃ©Ã©e** (lignes 7-12)

#### **Fonctionnement (si rÃ©activÃ©)** :
1. Au premier accÃ¨s, crÃ©e `session_start_time` dans localStorage
2. VÃ©rifie toutes les 30 secondes le temps Ã©coulÃ©
3. Ã€ 9 minutes : Toast d'avertissement
4. Ã€ 10 minutes :
   - Supprime toutes les donnÃ©es (localStorage.clear)
   - Toast "Session expirÃ©e"
   - Redirige vers `/etape1`

#### **ClÃ© localStorage** :
- Nom : `"session_start_time"`
- Format : Timestamp en millisecondes (ex: `1704067200000`)

---

## **XI. RÃ‰CAPITULATIF DES CLÃ‰S `localStorage`**

| **ClÃ©** | **Format** | **CrÃ©Ã©e par** | **Contenu** | **UtilisÃ©e par** |
|---|---|---|---|---|
| `"propertyData"` | JSON Object | `updatePropertyData()` | DonnÃ©es formulaire Ã‰tapes 1-4 | Tous composants de saisie + OpenAI |
| `"stepProgress"` | JSON Array | `completeStep()` | Liste des Ã©tapes disponibles | `useStepProgress`, `DirectivesMenuOnglet` |
| `"session_start_time"` | String (timestamp) | `useSgaForm` | Heure dÃ©but session | Timer (dÃ©sactivÃ©) |
| `"generation_website_ad"` | JSON Object | Ã‰tape 5 (OpenAI) | Annonce site internet gÃ©nÃ©rÃ©e | Ã‰tape 6 Communication |
| `"generation_summary_sheet"` | JSON Object | Ã‰tape 5 (OpenAI) | Fiche de synthÃ¨se gÃ©nÃ©rÃ©e | Ã‰tape 6 Communication |
| `"generation_newsletter"` | JSON Object | Ã‰tape 5 (OpenAI) | Newsletter gÃ©nÃ©rÃ©e | Ã‰tape 6 Communication |
| `"generation_seo_tools"` | JSON Object | Ã‰tape 5 (OpenAI) | Outils SEO gÃ©nÃ©rÃ©s | Ã‰tape 6 Communication |
| `"generation_sms_ad"` | JSON Object | Ã‰tape 5 (OpenAI) | Annonce SMS gÃ©nÃ©rÃ©e | Ã‰tape 6 Communication |
| `"generation_google_business_ad"` | JSON Object | Ã‰tape 5 (OpenAI) | Annonce Google Business gÃ©nÃ©rÃ©e | Ã‰tape 6 Communication |
| `"generation_social_media_ad"` | JSON Object | Ã‰tape 5 (OpenAI) | Annonce rÃ©seaux sociaux gÃ©nÃ©rÃ©e | Ã‰tape 6 Communication |
| `"key-modifs-creer-landing-page-annonce"` | JSON Object | Ã‰tape 6 (modifications utilisateur) | Modifications annonce landing page | Hook de rÃ©cupÃ©ration Ã‰tape 6 |
| `"key-modifs-creer-landing-page-synthese"` | JSON Object | Ã‰tape 6 (modifications utilisateur) | Modifications fiche synthÃ¨se | Hook de rÃ©cupÃ©ration Ã‰tape 6 |

---

## **XII. DONNEES DE L'ETAPE 1 Ã€ PRENDRE EN CONSIDÃ‰RATION**

#### **1. Champs `propertyData` :
| **Champs localStorage** | **** | **** |
|---|---|---|
| `agencyName` | |  |
| `reference` | |  |
| `exclusivite` | |  |
| `location` | |  |
| `propertyType`| |  |
| `saleType` | |  |
| `price` | |  |
| `rentAmount` | |  |
| `rentPeriodicity`| |  |
| `keyElements`| |  |
| `propertyDescription` | |  |
| `financials` | |  |
| `details` | |  |
| `hasNoDetails` | |  |

---

#### **2. ClÃ©s `generation_*`
| **ClÃ©s localStorage** | **** | **** |
|---|---|---|
| `generation_website_ad` |  |  |
| `generation_summary_sheet` |  |  |
| `generation_newsletter` |  |  |
| `generation_seo_tools` |  |  |
| `generation_sms_ad` |  |  |
| `generation_google_business_ad` |  |  |
| `generation_social_media_ad` |  |  |

---

#### **3. Fonctions**

| **Fonctions** | **** | **** |
|---|---|---|
| `getPropertyDataFromStorage()` |  |  |
| `updatePropertyData()` |  |  |
| `completeStep()` |  |  |
| `GÃ©nÃ©ration OpenAI` |  |  |

---


