# üìã DOCUMENTATION COMPL√àTE - **√âTAPE 3 : INFORMATIONS FINANCI√àRES**

---

## üéØ MISSION DU DOCUMENT

Ce document d√©crit l'int√©gralit√© du fonctionnement de l'**√âtape 3** de l'application **LeadGenAI Ad Builder**, √©tape d√©di√©e √† la **saisie des informations financi√®res du bien immobilier commercial**.

Il d√©taille :
- Les fichiers utilis√©s (composants, hooks, services)
- La structure des donn√©es stock√©es dans `localStorage`
- La logique de validation
- Les contraintes m√©tier
- Le flux de navigation
- L'utilisation des donn√©es saisies par les fonctions OpenAI

---

## üìö SOMMAIRE CLIQUABLE

1. [I. ARCHITECTURE GLOBALE - √âTAPE 3](#i-architecture-globale---√©tape-3)
2. [II. FICHIERS UTILIS√âS (Liste exhaustive)](#ii-fichiers-utilis√©s-liste-exhaustive)
3. [III. STRUCTURE DES DONN√âES DANS localStorage](#iii-structure-des-donn√©es-dans-localstorage)
4. [IV. LOGIQUE DE VALIDATION DES CHAMPS](#iv-logique-de-validation-des-champs)
5. [V. CONTRAINTES ET R√àGLES M√âTIER](#v-contraintes-et-r√®gles-m√©tier)
6. [VI. NAVIGATION ET RETOUR EN ARRI√àRE](#vi-navigation-et-retour-en-arri√®re)
7. [VII. UTILISATION DES DONN√âES PAR OPENAI](#vii-utilisation-des-donn√©es-par-openai)
8. [VIII. PROCESSUS COMPLET √âTAPE PAR √âTAPE](#viii-processus-complet-√©tape-par-√©tape)
9. [IX. √âL√âMENTS CACH√âS / CONDITIONNELS](#ix-√©l√©ments-cach√©s--conditionnels)
10. [X. TIMER DE SESSION (D√âSACTIV√â MAIS PR√âSENT)](#x-timer-de-session-d√©sactiv√©-mais-pr√©sent)
11. [XI. R√âCAPITULATIF DES CL√âS localStorage](#xi-r√©capitulatif-des-cl√©s-localstorage)
12. [XII. DONN√âES DE L'√âTAPE 3 √Ä PRENDRE EN CONSID√âRATION](#xii-donn√©es-de-l√©tape-3-√†-prendre-en-consid√©ration)

---

## I. ARCHITECTURE GLOBALE - √âTAPE 3

### Vue d'ensemble

L'**√âtape 3** permet √† l'utilisateur de **saisir les informations financi√®res** du bien immobilier commercial (conditions locatives, donn√©es financi√®res, potentiel de d√©veloppement). Ces informations compl√®tent celles saisies aux √âtapes 1 et 2.

**Composants principaux :**
- **Page :** `Etape3.tsx` (structure de la page avec header, contenu central, et sidebar)
- **Formulaire de saisie :** `SaisieFinancialForm.tsx` (gestion du champ `financials`, validation, sauvegarde)
- **Composant d'entr√©e :** `FormulaireSaisie.tsx` (textarea avec formatage automatique et hauteur dynamique)
- **Hook de progression :** `useStepProgress.ts` (contr√¥le d'acc√®s, sauvegarde progression)
- **Service OpenAI :** `openai.ts` et services annexes (utilisation de `financials` dans tous les prompts)

### Flux de donn√©es simplifi√©

```
Utilisateur arrive sur /etape3
  ‚Üì
useStepProgress v√©rifie l'acc√®s (√©tapes 1 et 2 compl√©t√©es)
  ‚Üì (Si non autoris√© ‚Üí redirection /etape1)
  ‚Üì (Si autoris√©)
SaisieFinancialForm charge les donn√©es existantes depuis localStorage.propertyData
  ‚Üì
Affichage du formulaire (pr√©-rempli si `financials` existe d√©j√†)
  ‚Üì
Utilisateur modifie le champ "Informations financi√®res"
  ‚Üì
Validation au clic sur "Valider mes informations"
  ‚Üì
Sauvegarde dans localStorage.propertyData.financials
  ‚Üì
Mise √† jour de localStorage.stepProgress (ajout √©tape 4)
  ‚Üì
Navigation vers /etape4
```

### Sch√©ma complet Mermaid

```mermaid
graph TD
    A[Chargement Etape3.tsx] --> B[useStepProgress v√©rifie acc√®s √©tape 3]
    B -->|√âtape 3 non disponible| C[Redirection /etape1]
    B -->|√âtape 3 disponible| D[Affichage SaisieFinancialForm]
    D --> E[useEffect: R√©cup√©ration propertyData]
    E --> F[Chargement financials depuis localStorage]
    F --> G[Affichage FormulaireSaisie pr√©-rempli]
    G --> H[Utilisateur modifie informations financi√®res]
    H --> I[handleFinancialsChange: mise √† jour state]
    I --> J[Clic sur BoutonValiderInformations]
    J --> K{Validation: financials non vide?}
    K -->|Non| L[Toast erreur: Saisie obligatoire]
    K -->|Oui| M[updatePropertyData avec financials]
    M --> N[Sauvegarde dans localStorage.propertyData]
    N --> O[completeStep: ajout √©tape 4 √† stepProgress]
    O --> P[Toast succ√®s]
    P --> Q[Navigation vers /etape4]

    R[Modification depuis √âtape 5] --> S[Clic sur bouton Modifier √âtape 3]
    S --> T[Chargement Etape3.tsx avec donn√©es existantes]
    T --> U[Utilisateur modifie financials]
    U --> V[handleBackToEtape5: sauvegarde + navigation /etape5]
```

### D√©tail du flux

1. **Chargement initial :**
   - `Etape3.tsx` se monte
   - `useStepProgress(3)` v√©rifie si l'√©tape 3 est disponible (√©tapes 1 et 2 compl√©t√©es)
   - Si non disponible ‚Üí redirection automatique vers `/etape1`
   - Si disponible ‚Üí affichage du composant `SaisieFinancialForm`

2. **R√©cup√©ration des donn√©es :**
   - `useEffect` dans `SaisieFinancialForm` appelle `getPropertyDataFromStorage()`
   - Si `propertyData.financials` existe ‚Üí pr√©-rempli dans le state `financials`
   - Sinon ‚Üí champ vide

3. **Saisie utilisateur :**
   - L'utilisateur tape dans le `FormulaireSaisie`
   - Formatage automatique : ajout de `‚Ä¢ ` en d√©but de ligne, capitalisation premi√®re lettre
   - Hauteur du textarea s'ajuste dynamiquement selon le contenu
   - `handleFinancialsChange` met √† jour le state `financials`

4. **Validation :**
   - Clic sur `BoutonValiderInformations`
   - `handleValidation()` v√©rifie que `financials.trim()` n'est pas vide
   - Si vide ‚Üí Toast erreur "Veuillez saisir des informations financi√®res avant de continuer"
   - Si valide ‚Üí `updatePropertyData({ financials })` sauvegarde dans `localStorage.propertyData`
   - `completeStep(3)` ajoute l'√©tape 4 aux √©tapes disponibles dans `localStorage.stepProgress`
   - Toast succ√®s "Vos informations financi√®res ont √©t√© enregistr√©es avec succ√®s"
   - `navigate("/etape4")` ‚Üí redirection vers √âtape 4

5. **Modification depuis √âtape 5 :**
   - Si l'utilisateur clique sur "Modifier √âtape 3" depuis l'√âtape 5
   - `handleBackToEtape5()` sauvegarde les modifications via `updatePropertyData({ financials })`
   - Toast "Modifications sauvegard√©es"
   - `goToEtape5()` ‚Üí retour √† l'√âtape 5

---

## II. FICHIERS UTILIS√âS (Liste exhaustive)

### 1. **`src/1.etapes-generation-annonces/etape3/Etape3.tsx`**
**R√¥le :** Page principale de l'√âtape 3  
**Responsabilit√©s :**
- Structure de la page (header, contenu principal, sidebar)
- Int√©gration de `SaisieFinancialForm` dans la zone centrale
- Affichage du menu de navigation `DirectivesMenuOnglet`
- Affichage de la FAQ `EtapeFAQ` et de la carte d'aide
- V√©rification de l'acc√®s √† l'√©tape 3 via `useStepProgress`

**√âl√©ments cl√©s :**
```tsx
const { disabledSteps, completeStep, isStepAvailable } = useStepProgress(3);

React.useEffect(() => {
  if (!isStepAvailable(3)) {
    navigate("/etape1");
  }
}, [isStepAvailable, navigate]);
```

---

### 2. **`src/components/1-Sources-Generation-Annonces/form-etape3/SaisieFinancialForm.tsx`**
**R√¥le :** Composant formulaire de saisie des informations financi√®res  
**Responsabilit√©s :**
- Gestion du state `financials` (informations financi√®res)
- Chargement des donn√©es existantes depuis `localStorage.propertyData`
- Validation : v√©rification que `financials` n'est pas vide
- Sauvegarde via `updatePropertyData({ financials })`
- Navigation vers `/etape4` apr√®s validation
- Gestion du retour vers `/etape5` (modification)

**√âl√©ments cl√©s :**
```tsx
const [financials, setFinancials] = useState("");
const { completeStep, hasCompletedStep4, goToEtape5 } = useStepProgress(3);

const handleValidation = () => {
  if (!financials.trim()) {
    toast({ title: "Erreur de validation", description: "Veuillez saisir des informations financi√®res avant de continuer.", variant: "destructive" });
    return;
  }
  updatePropertyData({ financials });
  toast({ title: "Informations valid√©es", description: "Vos informations financi√®res ont √©t√© enregistr√©es avec succ√®s." });
  completeStep(3);
  navigate("/etape4");
};

useEffect(() => {
  const propertyData = getPropertyDataFromStorage();
  if (propertyData.financials) {
    setFinancials(propertyData.financials);
  }
}, []);
```

**Contenu d'aide (`helpContent`) :**
- Explique l'objectif de l'√©tape : lister les informations financi√®res (conditions locatives, performances financi√®res, potentiel de d√©veloppement)
- Rappelle que les donn√©es seront structur√©es et r√©dig√©es dans l'Annonce Site Internet, list√©es dans la Fiche de Synth√®se, et pr√©sent√©es en points forts dans la Newsletter
- Liste les informations essentielles : loyer, bail, chiffre d'affaires, b√©n√©fices, indicateurs de rentabilit√©, potentiel de d√©veloppement, etc.

---

### 3. **`src/components/1-Sources-Generation-Annonces/forms/SgaFinancialsForm.tsx`**
**R√¥le :** Wrapper de compatibilit√©  
**Responsabilit√©s :**
- Simple wrapper autour de `SaisieFinancialForm`
- Maintient la compatibilit√© avec le code existant qui pourrait importer `SgaFinancialsForm`

**Contenu :**
```tsx
export const SgaFinancialsForm: React.FC = () => {
  return ;
};
```

---

### 4. **`src/components/1-Sources-Generation-Annonces/form-components/FormulaireSaisie.tsx`**
**R√¥le :** Composant textarea g√©n√©rique avec formatage automatique  
**Responsabilit√©s :**
- Affichage d'un champ textarea avec label
- **Formatage automatique :** ajout de `‚Ä¢ ` en d√©but de ligne si elle ne commence pas d√©j√† par un caract√®re sp√©cial (‚Ä¢, ‚ñ†, ‚ñ™, ‚ñ´, ., -)
- **Capitalisation :** met en majuscule la premi√®re lettre apr√®s `‚Ä¢ `
- **Hauteur dynamique :** ajuste la hauteur du textarea selon le contenu (minimum : `minRows` lignes)
- Pr√©servation des espaces en d√©but de ligne

**√âl√©ments cl√©s :**
```tsx
const handleInputChange = (e: React.ChangeEvent) => {
  const newText = e.target.value;
  const formattedText = newText.split('\n').map(line => {
    if (line === '') return '';
    let formattedLine = line;
    if (!formattedLine.trimStart().startsWith('‚Ä¢') && /* autres caract√®res */) {
      const leadingSpaces = formattedLine.length - formattedLine.trimStart().length;
      const spacesPrefix = formattedLine.substring(0, leadingSpaces);
      formattedLine = spacesPrefix + '‚Ä¢ ' + formattedLine.trimStart();
    }
    // Capitalisation premi√®re lettre apr√®s '‚Ä¢ '
    // ...
    return formattedLine;
  }).join('\n');
  onChange({ ...e, target: { ...e.target, value: formattedText } });
};

const adjustHeight = () => {
  const textarea = textareaRef.current;
  if (textarea) {
    textarea.style.height = "auto";
    const lineHeight = parseInt(getComputedStyle(textarea).lineHeight) || 20;
    const minHeight = lineHeight * minRows;
    const newHeight = Math.max(textarea.scrollHeight, minHeight);
    textarea.style.height = `${newHeight}px`;
  }
};
```

---

### 5. **`src/components/1-Sources-Generation-Annonces/form-components/BoutonValiderInformations.tsx`**
**R√¥le :** Bouton de validation avec design gradient  
**Responsabilit√©s :**
- Affichage d'un bouton "Valider mes informations" avec ic√¥ne `ArrowRight`
- Gestion du clic via prop `onClick`
- Design : gradient violet `from-[#4C1D96] to-[#6C28D8]`, effet hover, animation scale

---

### 6. **`src/components/1-Sources-Generation-Annonces/help/SgaHelpBox.tsx`**
**R√¥le :** Composant d'affichage d'aide contextuelle  
**Responsabilit√©s :**
- Affiche une carte d'aide avec titre, contenu, et ic√¥ne
- Utilis√© dans `SaisieFinancialForm` pour afficher les conseils de saisie
- Design : fond `bg-[#F7F5FA]`, bordure grise, ic√¥ne `Calculator` (ambre)

---

### 7. **`src/components/1-Sources-Generation-Annonces/help/EtapeFAQ.tsx`**
**R√¥le :** FAQ sp√©cifique √† chaque √©tape  
**Responsabilit√©s :**
- Affiche une carte FAQ selon l'√©tape (prop `etape`)
- Pour `etape="etape3"` :
  - **Titre :** "Quelles informations int√©grer ?"
  - **Ic√¥ne :** `Calculator` (ambre)
  - **Contenu :** Liste des informations √† int√©grer (conditions locatives, donn√©es financi√®res, potentiel de d√©veloppement)

---

### 8. **`src/components/atemplate.v2.generation-annonces/DirectivesMenuOnglet.tsx`**
**R√¥le :** Menu de navigation entre les √©tapes (cartes color√©es)  
**Responsabilit√©s :**
- Affichage de 4 cartes cliquables : √âtape 1 (vert), √âtape 2 (bleu), √âtape 3 (violet), √âtape 4 (orange)
- **Carte √âtape 3 :**
  - Ic√¥ne : `Calculator`
  - Titre : "Infos Financi√®res"
  - Couleur : `template-v2-generation-annonces-purple`
  - Cliquable si `isStepAvailable(3)` retourne `true`
  - `onClick={() => allerVersEtape(3)}` ‚Üí navigation vers `/etape3`
- Affichage conditionnel du bouton "Valider mon projet" si `hasCompletedStep4`
- Bouton "G√©n√©rer un nouveau projet" avec dialogue de confirmation

---

### 9. **`src/components/1-Sources-Generation-Annonces/utils/useStepProgress.ts`**
**R√¥le :** Hook de gestion de la progression entre les √©tapes  
**Responsabilit√©s :**
- Chargement de `localStorage.stepProgress` au montage
- Fonction `completeStep(step)` : ajoute l'√©tape suivante aux √©tapes disponibles
- Fonction `isStepAvailable(step)` : v√©rifie si une √©tape est accessible
- Fonction `goToEtape5()` : navigation vers `/etape5`
- Fonction `handleConfirmNewProject()` : r√©initialise tout le `localStorage` et redirige vers `/etape1`
- Persistance dans `localStorage.stepProgress` (JSON stringifi√©)

**√âl√©ments cl√©s :**
```tsx
const completeStep = (step: number) => {
  const newAvailableSteps = [...availableSteps];
  if (!newAvailableSteps.includes(step + 1)) {
    newAvailableSteps.push(step + 1);
  }
  setAvailableSteps(newAvailableSteps);
  localStorage.setItem("stepProgress", JSON.stringify(newAvailableSteps));
  if (step === 4) {
    setHasCompletedStep4(true);
  }
};
```

---

### 10. **`src/services/openai.ts`**
**R√¥le :** Service principal de communication avec l'API OpenAI  
**Responsabilit√©s :**
- D√©finit l'interface `PropertyData` avec le champ `financials?: string`
- M√©thodes de g√©n√©ration :
  - `generateWebsiteAd()` : Annonce Site Internet
  - `generateSummarySheetAd()` : Fiche de Synth√®se
  - `generateNewsletterAd()` : Annonce Newsletter
  - `generateSEOTools()` : Outils SEO
- Remplacement des placeholders dans les prompts OpenAI :
  - `[d√©tails financiers du bien]` ‚Üí remplac√© par `data.financials || ""`
- Fonctions utilitaires :
  - `getPropertyDataFromStorage()` : r√©cup√®re `propertyData` depuis `localStorage`
  - `updatePropertyData(newData)` : met √† jour `propertyData` dans `localStorage`
  - `clearPropertyData()` : supprime `propertyData` du `localStorage`

**√âl√©ments cl√©s :**
```tsx
export interface PropertyData {
  // √âtape 1 - √âl√©ments cl√©s
  agencyName?: string;
  reference?: string;
  exclusivite?: string;
  location?: string;
  propertyType?: string;
  saleType?: string;
  price?: string;
  rentAmount?: string;
  rentPeriodicity?: string;
  keyElements?: string;

  // √âtape 2 - Description
  propertyDescription?: string;

  // √âtape 3 - Financials
  financials?: string;

  // √âtape 4 - Autres d√©tails
  details?: string;
  hasNoDetails?: boolean;
}

// Exemple d'utilisation dans generateWebsiteAd
const userPrompt = promptAnnonceSiteInternet
  .replace(/\[d√©tails financiers du bien\]/g, data.financials || "")
  // ... autres remplacements
```

---

### 11. **Services OpenAI annexes (SMS, Google, R√©seaux Sociaux)**

**Fichiers :**
- `src/services/openai/1.GenerateurAnnoncesOutilsSeo/0.APIAutresFonctionsLeadGenAI/1.API-AnnonceSMS.ts`
- `src/services/openai/1.GenerateurAnnoncesOutilsSeo/0.APIAutresFonctionsLeadGenAI/2.API-AnnonceGoogleBusinessProfile.ts`
- `src/services/openai/1.GenerateurAnnoncesOutilsSeo/0.APIAutresFonctionsLeadGenAI/3.API-AnnonceReseauxSociaux.ts`

**R√¥le :** Services de g√©n√©ration d'annonces SMS, Google Business Profile, et R√©seaux Sociaux  
**Responsabilit√©s :**
- D√©finissent leur propre interface `PropertyData` incluant `financials?: string`
- M√©thodes de g√©n√©ration similaires au service principal (`generateSMSAd()`, `generateGoogleProfileAd()`, `generateReseauxSociauxAd()`)
- Remplacement du placeholder `[d√©tails financiers du bien]` par `data.financials || ""`

**Exemple (API-AnnonceSMS.ts) :**
```tsx
const userPrompt = promptAnnonceSMS
  .replace(/\[d√©tails financiers du bien\]/g, data.financials || "")
  // ... autres remplacements
```

---

### 12. **`src/components/navigation-site-leadgenaiadbuilder/NavLinks.tsx`**
**R√¥le :** Configuration des liens de navigation globale  
**Responsabilit√©s :**
- Exporte `navLinks` et `navTitle` utilis√©s dans `LayoutV2GenAnn`
- D√©finit les liens de navigation du site (non sp√©cifique √† l'√âtape 3)

---

## III. STRUCTURE DES DONN√âES DANS localStorage

### 1. **`localStorage.propertyData`** (JSON stringifi√©)

**Structure compl√®te :**
```json
{
  "agencyName": "Nom de l'agence",
  "reference": "REF-12345",
  "exclusivite": "Oui",
  "location": "Paris 11√®me",
  "propertyType": "Restaurant",
  "saleType": "√† vendre",
  "price": "350000",
  "rentAmount": "",
  "rentPeriodicity": "",
  "keyElements": "‚Ä¢ Emplacement strat√©gique\n‚Ä¢ Terrasse 50 places\n‚Ä¢ Cuisine √©quip√©e",
  "propertyDescription": "‚Ä¢ Restaurant situ√© dans un quartier vivant\n‚Ä¢ Surface totale de 120 m¬≤\n‚Ä¢ Terrasse ext√©rieure de 50 places\n...",
  "financials": "‚Ä¢ Loyer mensuel : 3500‚Ç¨ HT/HC\n‚Ä¢ Bail 3-6-9 renouvelable\n‚Ä¢ Chiffre d'affaires annuel : 450 000‚Ç¨\n‚Ä¢ EBE : 120 000‚Ç¨\n...",
  "details": "‚Ä¢ Ouvert du lundi au samedi\n‚Ä¢ Fermeture annuelle en ao√ªt\n...",
  "hasNoDetails": false
}
```

**Champ sp√©cifique √† l'√âtape 3 :**
- **`financials`** (string) : Informations financi√®res du bien (conditions locatives, donn√©es financi√®res, potentiel de d√©veloppement)
  - Exemple : `"‚Ä¢ Loyer mensuel : 3500‚Ç¨ HT/HC\n‚Ä¢ Bail 3-6-9 renouvelable\n‚Ä¢ CA annuel : 450 000‚Ç¨\n‚Ä¢ EBE : 120 000‚Ç¨\n‚Ä¢ Potentiel d'extension : +30 m¬≤ au 1er √©tage"`

**Champs des √©tapes pr√©c√©dentes utilis√©s :**
- **√âtape 1 :** `agencyName`, `reference`, `exclusivite`, `location`, `propertyType`, `saleType`, `price`, `rentAmount`, `rentPeriodicity`, `keyElements`
- **√âtape 2 :** `propertyDescription`

---

### 2. **`localStorage.stepProgress`** (JSON stringifi√©)

**Structure :**
```json
[1, 2, 3, 4]
```

**R√¥le :**
- Tableau des num√©ros d'√©tapes disponibles pour l'utilisateur
- Au chargement de l'√âtape 3, ce tableau contient au minimum `[1, 2, 3]`
- Apr√®s validation de l'√âtape 3 ‚Üí `completeStep(3)` ajoute `4` : `[1, 2, 3, 4]`

---

### 3. **`localStorage.generation_*`** (cl√©s de stockage des annonces g√©n√©r√©es)

**Cl√©s concern√©es :**
- `generation_website_ad` : Annonce Site Internet (utilise `financials`)
- `generation_summary_sheet` : Fiche de Synth√®se (utilise `financials`)
- `generation_newsletter` : Annonce Newsletter (utilise `financials`)
- `generation_seo_tools` : Outils SEO (utilise `financials`)
- `generation_sms_ad` : Annonce SMS (utilise `financials`)
- `generation_googleprofile_ad` : Annonce Google Business Profile (utilise `financials`)
- `generation_reseauxsociaux_ad` : Annonce R√©seaux Sociaux (utilise `financials`)

**R√¥le :**
- Ces cl√©s sont cr√©√©es √† l'**√âtape 5** lors de la g√©n√©ration des annonces par OpenAI
- Toutes utilisent le champ `financials` saisi √† l'√âtape 3 pour enrichir le contenu g√©n√©r√©

---

### 4. **`localStorage.session_start_time`** (timestamp)

**Structure :**
```
"1704067200000"
```

**R√¥le :**
- Stocke la date de d√©but de session (timestamp en millisecondes)
- **Actuellement d√©sactiv√©** : aucun timer de session n'est actif dans l'√âtape 3
- Historiquement utilis√© pour g√©rer une expiration de session (fonctionnalit√© non impl√©ment√©e)

---

## IV. LOGIQUE DE VALIDATION DES CHAMPS

### Validation unique : Champ `financials` obligatoire

**R√®gle :**
- Le champ `financials` **ne peut pas √™tre vide** lors de la validation

**Impl√©mentation (`SaisieFinancialForm.tsx`) :**
```tsx
const handleValidation = () => {
  if (!financials.trim()) {
    toast({
      title: "Erreur de validation",
      description: "Veuillez saisir des informations financi√®res avant de continuer.",
      duration: 3000,
      variant: "destructive"
    });
    return;
  }

  updatePropertyData({ financials });
  toast({
    title: "Informations valid√©es",
    description: "Vos informations financi√®res ont √©t√© enregistr√©es avec succ√®s.",
    duration: 3000,
  });
  completeStep(3);
  navigate("/etape4");
};
```

**Messages d'erreur :**
| Condition | Message |
|-----------|---------|
| `financials` vide ou contient uniquement des espaces | "Veuillez saisir des informations financi√®res avant de continuer." |

**Message de succ√®s :**
| Condition | Message |
|-----------|---------|
| `financials` valide | "Vos informations financi√®res ont √©t√© enregistr√©es avec succ√®s." |

---

## V. CONTRAINTES ET R√àGLES M√âTIER

### 1. **Contraintes d'acc√®s**
- L'utilisateur **ne peut acc√©der √† l'√âtape 3** que si les √âtapes 1 et 2 ont √©t√© compl√©t√©es
- V√©rification via `isStepAvailable(3)` dans `useStepProgress`
- Si acc√®s non autoris√© ‚Üí redirection automatique vers `/etape1`

### 2. **Contraintes de saisie**
- **Formatage automatique :**
  - Chaque ligne non vide re√ßoit automatiquement `‚Ä¢ ` en d√©but (sauf si elle commence d√©j√† par `‚Ä¢`, `‚ñ†`, `‚ñ™`, `‚ñ´`, `.`, `-`)
  - La premi√®re lettre apr√®s `‚Ä¢ ` est automatiquement capitalis√©e
  - Les espaces en d√©but de ligne sont pr√©serv√©s
- **Hauteur du textarea :**
  - Minimum : 8 lignes (`minRows={8}`)
  - Maximum : ajustement dynamique selon le contenu (scrollHeight)

### 3. **Contraintes de navigation**
- **Apr√®s validation :**
  - Sauvegarde de `financials` dans `localStorage.propertyData`
  - Ajout de l'√âtape 4 √† `localStorage.stepProgress`
  - Navigation obligatoire vers `/etape4`
- **Modification depuis √âtape 5 :**
  - `handleBackToEtape5()` sauvegarde les modifications et retourne √† `/etape5`
  - Toast "Modifications sauvegard√©es"

### 4. **Contraintes de persistance**
- Toutes les donn√©es saisies sont **imm√©diatement sauvegard√©es** dans `localStorage` via `updatePropertyData()`
- Les donn√©es persistent **entre les sessions** (pas d'expiration automatique)
- Les donn√©es sont **effac√©es uniquement** si :
  - L'utilisateur clique sur "G√©n√©rer un nouveau projet" (confirmation requise)
  - L'utilisateur efface manuellement le `localStorage` via les outils de d√©veloppement

### 5. **Contraintes OpenAI**
- Le champ `financials` est utilis√© dans **7 prompts OpenAI diff√©rents** :
  - Annonce Site Internet
  - Fiche de Synth√®se
  - Annonce Newsletter
  - Outils SEO
  - Annonce SMS
  - Annonce Google Business Profile
  - Annonce R√©seaux Sociaux
- Le placeholder `[d√©tails financiers du bien]` est remplac√© par `data.financials || ""`
- Si `financials` est vide ou non saisi, le placeholder est remplac√© par une cha√Æne vide

---

## VI. NAVIGATION ET RETOUR EN ARRI√àRE

### 1. **Arriv√©e sur l'√âtape 3**

**Sc√©nario 1 : Navigation classique depuis l'√âtape 2**
- L'utilisateur termine l'√âtape 2 (saisie de `propertyDescription`)
- Validation ‚Üí `navigate("/etape3")`
- `useStepProgress(3)` v√©rifie l'acc√®s
- Si autoris√© ‚Üí affichage du formulaire
- Chargement de `financials` depuis `localStorage` (si d√©j√† saisi)

**Sc√©nario 2 : Navigation directe depuis le menu `DirectivesMenuOnglet`**
- L'utilisateur clique sur la carte "Infos Financi√®res" (violet, ic√¥ne `Calculator`)
- `allerVersEtape(3)` v√©rifie `isStepAvailable(3)`
- Si disponible ‚Üí `navigate("/etape3")`
- Chargement de `financials` depuis `localStorage`

**Sc√©nario 3 : Modification depuis l'√âtape 5**
- L'utilisateur clique sur le bouton "Modifier" de l'√âtape 3 (dans l'interface de l'√âtape 5)
- `navigate("/etape3")`
- Chargement de `financials` depuis `localStorage`
- Apr√®s modification ‚Üí `handleBackToEtape5()` ‚Üí retour √† `/etape5`

---

### 2. **D√©part de l'√âtape 3**

**Sc√©nario 1 : Validation normale**
- Utilisateur clique sur "Valider mes informations"
- `handleValidation()` v√©rifie `financials.trim()` non vide
- Si valide :
  - `updatePropertyData({ financials })` ‚Üí sauvegarde dans `localStorage.propertyData`
  - `completeStep(3)` ‚Üí ajout de l'√âtape 4 √† `stepProgress`
  - Toast succ√®s
  - `navigate("/etape4")` ‚Üí redirection vers √âtape 4

**Sc√©nario 2 : Modification depuis √âtape 5 (bouton "Modifier")**
- L'utilisateur a modifi√© `financials`
- Clic sur le bouton de retour ou lien vers √âtape 5
- `handleBackToEtape5()` :
  - Si `financials.trim()` non vide ‚Üí `updatePropertyData({ financials })`
  - Toast "Modifications sauvegard√©es"
  - `goToEtape5()` ‚Üí `navigate("/etape5")`

**Sc√©nario 3 : Navigation via menu `DirectivesMenuOnglet`**
- L'utilisateur clique sur une autre carte du menu (√âtape 1, 2, ou 4)
- V√©rification `isStepAvailable(etape)`
- Si disponible ‚Üí `navigate("/etape{etape}")`
- **‚ö†Ô∏è Attention :** Les donn√©es saisies non valid√©es (modification en cours) ne sont **pas automatiquement sauvegard√©es** dans ce sc√©nario
- **Recommandation :** Valider avant de naviguer ou impl√©menter une sauvegarde automatique

---

### 3. **Comportement en cas de donn√©es manquantes**

**Cas 1 : `financials` vide lors de la validation**
- Toast erreur : "Veuillez saisir des informations financi√®res avant de continuer."
- Pas de navigation
- Pas de sauvegarde
- L'utilisateur reste sur l'√âtape 3

**Cas 2 : `propertyData` inexistant dans `localStorage`**
- `getPropertyDataFromStorage()` retourne `{}`
- Le champ `financials` reste vide
- L'utilisateur peut saisir de nouvelles informations

---

## VII. UTILISATION DES DONN√âES PAR OPENAI

### Champ utilis√© par OpenAI : `financials`

**Description :**
- Contient les informations financi√®res du bien immobilier commercial
- Exemples : conditions locatives (loyer, bail), donn√©es financi√®res (CA, EBE), potentiel de d√©veloppement

**Prompts OpenAI utilisant `financials` :**

| Service | M√©thode | Placeholder | Remplacement |
|---------|---------|-------------|--------------|
| `openai.ts` | `generateWebsiteAd()` | `[d√©tails financiers du bien]` | `data.financials \|\| ""` |
| `openai.ts` | `generateSummarySheetAd()` | `[d√©tails financiers du bien]` | `data.financials \|\| ""` |
| `openai.ts` | `generateNewsletterAd()` | `[d√©tails financiers du bien]` | `data.financials \|\| ""` |
| `openai.ts` | `generateSEOTools()` | `[d√©tails financiers du bien]` | `data.financials \|\| ""` |
| `1.API-AnnonceSMS.ts` | `generateSMSAd()` | `[d√©tails financiers du bien]` | `data.financials \|\| ""` |
| `2.API-AnnonceGoogleBusinessProfile.ts` | `generateGoogleProfileAd()` | `[d√©tails financiers du bien]` | `data.financials \|\| ""` |
| `3.API-AnnonceReseauxSociaux.ts` | `generateReseauxSociauxAd()` | `[d√©tails financiers du bien]` | `data.financials \|\| ""` |

**Total : 7 prompts OpenAI utilisent `financials`**

---

### Exemple d'utilisation dans `generateWebsiteAd()` :

```tsx
async generateWebsiteAd(data: PropertyData, model: string = "gpt-4o"): Promise<{...}> {
  const userPrompt = promptAnnonceSiteInternet
    .replace(/\[nom de l'agence immobili√®re\]/g, data.agencyName || "")
    .replace(/\[type de bien commercial: restaurant, bar, boutique, etc.\]/g, data.propertyType || "")
    .replace(/\[√† vendre ou √† louer\]/g, data.saleType || "")
    .replace(/\[localisation du bien\]/g, data.location || "")
    .replace(/\[points forts et arguments commerciaux\]/g, data.keyElements || "")
    .replace(/\[montant\]/g, data.price || data.rentAmount || "")
    .replace(/\[mensuel, trimestriel, ou annuel\]/g, data.rentPeriodicity || "")
    .replace(/\[Oui\]/g, data.exclusivite === "Oui" ? "Oui" : "Non")
    .replace(/\[r√©f√©rence du bien\]/g, data.reference || "")
    .replace(/\[description d√©taill√©e du bien\]/g, data.propertyDescription || "")
    .replace(/\[d√©tails financiers du bien\]/g, data.financials || "") // ‚Üê Utilisation de financials
    .replace(/\[informations compl√©mentaires\]/g, data.details || "");

  const response = await this.generateResponse(userPrompt, model);
  return JSON.parse(response);
}
```

---

### Importance de la saisie compl√®te

**Impact si `financials` est vide :**
- Le placeholder `[d√©tails financiers du bien]` est remplac√© par `""`
- OpenAI ne dispose **d'aucune information financi√®re** pour enrichir l'annonce
- Les sections "Donn√©es financi√®res" de la Fiche de Synth√®se seront **vides ou g√©n√©riques**
- Les points forts de la Newsletter ne pourront **pas valoriser les aspects financiers**
- Les outils SEO ne pourront **pas optimiser sur des mots-cl√©s financiers**

**Recommandation :**
- Saisir le **maximum d'informations financi√®res** disponibles (loyer, bail, CA, EBE, potentiel, etc.)
- Plus la saisie est compl√®te, plus les annonces g√©n√©r√©es seront **pr√©cises et percutantes**

---

## VIII. PROCESSUS COMPLET √âTAPE PAR √âTAPE

### 1. **Arriv√©e sur l'√âtape 3**

**√âtape 1.1 : V√©rification d'acc√®s**
- Composant `Etape3.tsx` se monte
- `useStepProgress(3)` initialise et charge `localStorage.stepProgress`
- `useEffect` appelle `isStepAvailable(3)`
- Si `false` (√âtapes 1 ou 2 non compl√©t√©es) ‚Üí `navigate("/etape1")`
- Si `true` ‚Üí affichage du composant `SaisieFinancialForm`

**√âtape 1.2 : Chargement des donn√©es**
- `SaisieFinancialForm` se monte
- `useEffect` appelle `getPropertyDataFromStorage()`
- Si `propertyData.financials` existe ‚Üí `setFinancials(propertyData.financials)` (pr√©-remplissage)
- Sinon ‚Üí `financials` reste vide (`""`)

**√âtape 1.3 : Affichage du formulaire**
- `FormulaireSaisie` affiche le textarea avec :
  - **Label :** "Informations financi√®res"
  - **Placeholder :** "Listez le maximum d'informations financi√®res de votre bien en votre possession..."
  - **Valeur :** `financials` (vide ou pr√©-rempli)
  - **Hauteur :** Minimum 8 lignes, ajustement dynamique
- `BoutonValiderInformations` affich√© en dessous
- `SgaHelpBox` affich√© avec conseils de saisie (ic√¥ne `Calculator`)

---

### 2. **Saisie utilisateur**

**√âtape 2.1 : Modification du champ**
- Utilisateur tape dans le textarea
- `FormulaireSaisie` applique le formatage automatique via `handleInputChange` :
  - Ajout de `‚Ä¢ ` en d√©but de ligne (sauf si ligne vide ou commence par `‚Ä¢`, `‚ñ†`, etc.)
  - Capitalisation premi√®re lettre apr√®s `‚Ä¢ `
  - Pr√©servation des espaces en d√©but de ligne
- `onChange` appel√© ‚Üí `handleFinancialsChange` ‚Üí `setFinancials(formattedText)`

**√âtape 2.2 : Ajustement hauteur**
- `onInput` d√©clenche `adjustHeight()`
- Calcul de la nouvelle hauteur selon `scrollHeight`
- Hauteur minimale : `minRows * lineHeight` (8 * 20px = 160px)
- Hauteur maximale : `scrollHeight` du textarea
- Application via `textarea.style.height = "${newHeight}px"`

---

### 3. **Validation**

**√âtape 3.1 : Clic sur "Valider mes informations"**
- `onClick` du `BoutonValiderInformations` appelle `handleValidation()`

**√âtape 3.2 : V√©rification des donn√©es**
- `if (!financials.trim())` ‚Üí champ vide ou uniquement espaces
  - Toast erreur : "Veuillez saisir des informations financi√®res avant de continuer." (variant `destructive`)
  - `return` ‚Üí arr√™t du processus, pas de navigation

**√âtape 3.3 : Sauvegarde**
- `updatePropertyData({ financials })` :
  - R√©cup√®re `propertyData` existant depuis `localStorage`
  - Fusionne avec `{ financials }`
  - Sauvegarde dans `localStorage.propertyData` (JSON stringifi√©)
  - Retourne `updatedData`

**√âtape 3.4 : Mise √† jour de la progression**
- `completeStep(3)` :
  - Charge `stepProgress` actuel (ex: `[1, 2, 3]`)
  - Ajoute l'√âtape 4 si non pr√©sente : `[1, 2, 3, 4]`
  - Sauvegarde dans `localStorage.stepProgress`
  - Si √©tape 4 compl√©t√©e ‚Üí `setHasCompletedStep4(true)` (non applicable ici)

**√âtape 3.5 : Feedback utilisateur**
- Toast succ√®s : "Vos informations financi√®res ont √©t√© enregistr√©es avec succ√®s." (dur√©e 3000ms)
- `console.log("Informations financi√®res valid√©es et centralis√©es")`

**√âtape 3.6 : Navigation**
- `navigate("/etape4")` ‚Üí redirection vers √âtape 4

---

### 4. **Modification depuis √âtape 5**

**√âtape 4.1 : Acc√®s depuis √âtape 5**
- Utilisateur clique sur "Modifier √âtape 3" (bouton dans l'interface de l'√âtape 5)
- `navigate("/etape3")`
- `SaisieFinancialForm` se monte avec les donn√©es existantes (pr√©-remplissage)

**√âtape 4.2 : Modification**
- Utilisateur modifie le champ `financials`
- Formatage automatique appliqu√© (m√™me logique qu'en saisie classique)
- `handleFinancialsChange` met √† jour `financials` dans le state

**√âtape 4.3 : Retour √† l'√âtape 5**
- Utilisateur clique sur un bouton de retour ou lien "Retour √† l'√âtape 5"
- `handleBackToEtape5()` :
  - `if (financials.trim())` ‚Üí sauvegarde via `updatePropertyData({ financials })`
  - Toast : "Modifications sauvegard√©es" (dur√©e 3000ms)
  - `goToEtape5()` ‚Üí `navigate("/etape5")`

---

### 5. **G√©n√©ration des annonces (√âtape 5)**

**√âtape 5.1 : R√©cup√©ration des donn√©es**
- L'√âtape 5 charge `propertyData` depuis `localStorage`
- Toutes les donn√©es saisies (√âtapes 1 √† 4) sont disponibles :
  - `agencyName`, `reference`, `exclusivite`, `location`, `propertyType`, `saleType`, `price`, `rentAmount`, `rentPeriodicity`, `keyElements`
  - `propertyDescription`
  - `financials` ‚Üê **Donn√©es de l'√âtape 3**
  - `details`, `hasNoDetails`

**√âtape 5.2 : Appel des services OpenAI**
- Pour chaque annonce √† g√©n√©rer :
  - Cr√©ation d'une instance `OpenAIService` (avec cl√© API)
  - Appel de la m√©thode correspondante (ex: `generateWebsiteAd(propertyData)`)
  - Remplacement des placeholders dans le prompt (dont `[d√©tails financiers du bien]` ‚Üí `propertyData.financials`)
  - Envoi du prompt √† OpenAI (ChatCompletion)
  - Parsing de la r√©ponse JSON
  - Sauvegarde dans `localStorage.generation_*`

**√âtape 5.3 : Affichage des r√©sultats**
- Les annonces g√©n√©r√©es sont affich√©es dans l'interface de l'√âtape 5
- Utilisateur peut consulter, modifier, ou t√©l√©charger les annonces

---

## IX. √âL√âMENTS CACH√âS / CONDITIONNELS

### 1. **Pas d'√©l√©ments conditionnels dans le formulaire**

**Contrairement √† l'√âtape 1 :**
- L'√âtape 1 affiche conditionnellement "Prix FAI" (si `saleType === "√† vendre"`) ou "Loyer" (si `saleType === "√† louer"`)
- L'√âtape 3 **n'a aucun champ conditionnel**
- Le champ `financials` est **toujours affich√©**, quel que soit le `saleType` ou d'autres donn√©es saisies

**Raison :**
- Les informations financi√®res sont pertinentes **autant pour une vente que pour une location**
- Vente : valoriser le prix, le potentiel de rentabilit√©, les b√©n√©fices
- Location : valoriser le loyer, le bail, les conditions locatives

---

### 2. **Bouton "Valider mon projet" (dans `DirectivesMenuOnglet`)**

**Affichage conditionnel :**
```tsx
{hasCompletedStep4 && activeStep !== 5 && (

)}
```

**Conditions :**
- `hasCompletedStep4 === true` : l'utilisateur a termin√© l'√âtape 4
- `activeStep !== 5` : l'utilisateur n'est **pas** sur l'√âtape 5
- Si les deux conditions sont remplies ‚Üí affichage du bouton "Valider mon projet"
- Clic ‚Üí `goToEtape5()` ‚Üí navigation vers `/etape5`

**Pour l'√âtape 3 :**
- Si l'utilisateur a compl√©t√© l'√âtape 4 **avant** de revenir √† l'√âtape 3 (modification)
- Le bouton "Valider mon projet" s'affiche dans le menu `DirectivesMenuOnglet`
- Permet de retourner directement √† l'√âtape 5 sans passer par l'√âtape 4

---

### 3. **Cartes du menu `DirectivesMenuOnglet` (disponibilit√©)**

**Affichage conditionnel de l'opacit√© et du curseur :**
```tsx
 allerVersEtape(3)}
>
```

**Conditions :**
- Si `isStepAvailable(3) === true` :
  - Classe : `cursor-pointer`
  - Opacit√© : 100% (normale)
  - Clic autoris√© ‚Üí navigation vers `/etape3`
- Si `isStepAvailable(3) === false` :
  - Classe : `opacity-50 cursor-not-allowed`
  - Opacit√© : 50% (gris√©e)
  - Clic interdit ‚Üí `allerVersEtape(3)` retourne sans action

**Pour l'√âtape 3 :**
- La carte "Infos Financi√®res" (violet, ic√¥ne `Calculator`) est **disponible** si :
  - `stepProgress` contient au minimum `[1, 2, 3]`
  - C'est-√†-dire si les √âtapes 1 et 2 ont √©t√© compl√©t√©es

---

## X. TIMER DE SESSION (D√âSACTIV√â MAIS PR√âSENT)

### 1. **Cl√© `localStorage.session_start_time`**

**Valeur :**
- Timestamp en millisecondes (ex: `"1704067200000"`)
- Repr√©sente la date de d√©but de session

**Origine :**
- D√©fini dans les anciennes versions de l'application (logique de timer de session)
- **Actuellement d√©sactiv√©** : aucun code actif ne v√©rifie ou utilise cette cl√© dans l'√âtape 3

---

### 2. **Incoh√©rence avec la fonction `clearPropertyData()`**

**Fonction `clearPropertyData()` dans `openai.ts` :**
```tsx
export const clearPropertyData = (): void => {
  localStorage.removeItem("propertyData");
};
```

**Probl√®me :**
- Cette fonction **supprime uniquement** `propertyData`
- Elle **ne supprime pas** :
  - `stepProgress`
  - `generation_*`
  - `session_start_time`
  - Autres cl√©s √©ventuelles

**Comportement attendu (reset complet) :**
- La fonction `handleConfirmNewProject()` dans `useStepProgress.ts` effectue un reset complet :
```tsx
const handleConfirmNewProject = () => {
  localStorage.clear(); // ‚Üê Supprime TOUTES les cl√©s
  toast({ title: "Projet r√©initialis√©", description: "Toutes les donn√©es ont √©t√© effac√©es. Vous pouvez commencer un nouveau projet." });
  navigate('/etape1');
  window.location.reload();
};
```

**Recommandation :**
- Si un timer de session est r√©activ√© √† l'avenir, synchroniser la suppression de `session_start_time` avec `clearPropertyData()`
- Ou utiliser `localStorage.clear()` pour tous les resets

---

### 3. **Impact sur l'√âtape 3**

**Actuellement :**
- L'√âtape 3 **n'est pas affect√©e** par `session_start_time`
- Aucune v√©rification d'expiration de session
- Les donn√©es persistent **ind√©finiment** dans `localStorage` (sauf suppression manuelle ou reset complet)

**Si timer r√©activ√© √† l'avenir :**
- V√©rifier la validit√© de la session au chargement de l'√âtape 3
- Si session expir√©e ‚Üí redirection vers `/etape1` + suppression des donn√©es
- Synchroniser la gestion de `session_start_time` avec `propertyData` et `stepProgress`

---

## XI. R√âCAPITULATIF DES CL√âS localStorage

### Cl√©s utilis√©es par l'√âtape 3 :

| Cl√© localStorage | Type | Cr√©√©e par | Utilis√©e par | Description |
|------------------|------|-----------|--------------|-------------|
| `propertyData` | JSON Object | √âtape 1 | Toutes les √©tapes | Contient toutes les donn√©es saisies (dont `financials`) |
| `stepProgress` | JSON Array | √âtape 1 | Toutes les √©tapes | Tableau des √©tapes disponibles (ex: `[1, 2, 3, 4]`) |
| `session_start_time` | String (timestamp) | Historique | Aucune (d√©sactiv√©) | Timestamp de d√©but de session (non utilis√©) |
| `generation_website_ad` | JSON Object | √âtape 5 | √âtape 5 | Annonce Site Internet g√©n√©r√©e (utilise `financials`) |
| `generation_summary_sheet` | JSON Object | √âtape 5 | √âtape 5 | Fiche de Synth√®se g√©n√©r√©e (utilise `financials`) |
| `generation_newsletter` | JSON Object | √âtape 5 | √âtape 5 | Annonce Newsletter g√©n√©r√©e (utilise `financials`) |
| `generation_seo_tools` | JSON Object | √âtape 5 | √âtape 5 | Outils SEO g√©n√©r√©s (utilise `financials`) |
| `generation_sms_ad` | JSON Object | √âtape 5 | √âtape 5 | Annonce SMS g√©n√©r√©e (utilise `financials`) |
| `generation_googleprofile_ad` | JSON Object | √âtape 5 | √âtape 5 | Annonce Google Business Profile g√©n√©r√©e (utilise `financials`) |
| `generation_reseauxsociaux_ad` | JSON Object | √âtape 5 | √âtape 5 | Annonce R√©seaux Sociaux g√©n√©r√©e (utilise `financials`) |

---

### Cl√©s modifi√©es par l'√âtape 3 :

| Cl√© | Action | Moment | Valeur ajout√©e/modifi√©e |
|-----|--------|--------|-------------------------|
| `propertyData` | Mise √† jour | Validation (clic "Valider mes informations") | Ajout/modification de `{ financials: "..." }` |
| `stepProgress` | Mise √† jour | Validation (ajout √âtape 4) | Ajout de `4` dans le tableau (ex: `[1, 2, 3]` ‚Üí `[1, 2, 3, 4]`) |

---

## XII. DONN√âES DE L'√âTAPE 3 √Ä PRENDRE EN CONSID√âRATION

### 1. **Champs `propertyData`**

| Champs localStorage | Cr√©√©/Modifi√© par √âtape 3 | Utilis√© par OpenAI | Description |
|---------------------|--------------------------|--------------------| ------------|
| `agencyName` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | Nom de l'agence immobili√®re |
| `reference` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | R√©f√©rence du bien |
| `exclusivite` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | Exclusivit√© ("Oui" ou "Non") |
| `location` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | Emplacement du bien |
| `propertyType` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | Type de bien (restaurant, bar, boutique, etc.) |
| `saleType` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | "√† vendre" ou "√† louer" |
| `price` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | Prix FAI (si vente) |
| `rentAmount` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | Loyer HT/HC (si location) |
| `rentPeriodicity` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | P√©riodicit√© du loyer (mensuel, trimestriel, annuel) |
| `keyElements` | ‚ùå Non (√âtape 1) | ‚úÖ Oui (7 prompts) | Points forts et arguments commerciaux |
| `propertyDescription` | ‚ùå Non (√âtape 2) | ‚úÖ Oui (7 prompts) | Description d√©taill√©e du bien |
| **`financials`** | **‚úÖ Oui (√âtape 3)** | **‚úÖ Oui (7 prompts)** | **Informations financi√®res du bien** |
| `details` | ‚ùå Non (√âtape 4) | ‚úÖ Oui (4 prompts) | Autres d√©tails (horaires, fermetures, etc.) |
| `hasNoDetails` | ‚ùå Non (√âtape 4) | ‚ùå Non | Bool√©en indiquant l'absence de d√©tails |

**Champ sp√©cifique de l'√âtape 3 :**
- **`financials`** : Informations financi√®res du bien (conditions locatives, donn√©es financi√®res, potentiel de d√©veloppement)

---

### 2. **Cl√©s `generation_*`**

| Cl√©s localStorage | Utilise `financials` | Cr√©√©e √† l'√âtape | Description |
|-------------------|----------------------|-----------------|-------------|
| `generation_website_ad` | ‚úÖ Oui | √âtape 5 | Annonce Site Internet (titre, accroche, descriptif, CTA) |
| `generation_summary_sheet` | ‚úÖ Oui | √âtape 5 | Fiche de Synth√®se (titre, r√©f√©rence et prix, d√©tails cl√©s, donn√©es financi√®res, infos compl√©mentaires) |
| `generation_newsletter` | ‚úÖ Oui | √âtape 5 | Annonce Newsletter (titre, accroche, points forts, CTA, prix et r√©f√©rence) |
| `generation_seo_tools` | ‚úÖ Oui | √âtape 5 | Outils SEO (balise titre, meta description, URL longue tra√Æne) |
| `generation_sms_ad` | ‚úÖ Oui | √âtape 5 | Annonce SMS (titre, accroche, points forts, CTA) |
| `generation_googleprofile_ad` | ‚úÖ Oui | √âtape 5 | Annonce Google Business Profile (titre, accroche, points forts, CTA) |
| `generation_reseauxsociaux_ad` | ‚úÖ Oui | √âtape 5 | Annonce R√©seaux Sociaux (titre, accroche, points forts, CTA) |

**Total : 7 annonces g√©n√©r√©es utilisent `financials`**

---

### 3. **Fonctions**

| Fonctions | Fichier | Description | Utilise/Modifie `financials` |
|-----------|---------|-------------|------------------------------|
| `getPropertyDataFromStorage()` | `openai.ts` | R√©cup√®re `propertyData` depuis `localStorage` | ‚úÖ R√©cup√®re `financials` |
| `updatePropertyData(newData)` | `openai.ts` | Met √† jour `propertyData` dans `localStorage` | ‚úÖ Modifie `financials` |
| `clearPropertyData()` | `openai.ts` | Supprime `propertyData` du `localStorage` | ‚úÖ Supprime `financials` |
| `completeStep(step)` | `useStepProgress.ts` | Ajoute l'√©tape suivante √† `stepProgress` | ‚ùå Non (g√®re la progression) |
| `handleValidation()` | `SaisieFinancialForm.tsx` | Valide et sauvegarde `financials`, navigation vers √âtape 4 | ‚úÖ Valide et sauvegarde `financials` |
| `handleFinancialsChange(e)` | `SaisieFinancialForm.tsx` | Met √† jour le state `financials` lors de la saisie | ‚úÖ Met √† jour state `financials` |
| `handleBackToEtape5()` | `SaisieFinancialForm.tsx` | Sauvegarde `financials` et retourne √† l'√âtape 5 | ‚úÖ Sauvegarde `financials` |
| `handleInputChange(e)` | `FormulaireSaisie.tsx` | Formatage automatique (ajout `‚Ä¢ `, capitalisation) | ‚úÖ Formate `financials` |
| `adjustHeight()` | `FormulaireSaisie.tsx` | Ajuste la hauteur du textarea selon le contenu | ‚ùå Non (g√®re l'UI) |
| `generateWebsiteAd(data)` | `openai.ts` | G√©n√®re l'annonce Site Internet via OpenAI | ‚úÖ Utilise `data.financials` |
| `generateSummarySheetAd(data)` | `openai.ts` | G√©n√®re la Fiche de Synth√®se via OpenAI | ‚úÖ Utilise `data.financials` |
| `generateNewsletterAd(data)` | `openai.ts` | G√©n√®re l'annonce Newsletter via OpenAI | ‚úÖ Utilise `data.financials` |
| `generateSEOTools(data)` | `openai.ts` | G√©n√®re les Outils SEO via OpenAI | ‚úÖ Utilise `data.financials` |
| `generateSMSAd(data)` | `1.API-AnnonceSMS.ts` | G√©n√®re l'annonce SMS via OpenAI | ‚úÖ Utilise `data.financials` |
| `generateGoogleProfileAd(data)` | `2.API-AnnonceGoogleBusinessProfile.ts` | G√©n√®re l'annonce Google Business Profile via OpenAI | ‚úÖ Utilise `data.financials` |
| `generateReseauxSociauxAd(data)` | `3.API-AnnonceReseauxSociaux.ts` | G√©n√®re l'annonce R√©seaux Sociaux via OpenAI | ‚úÖ Utilise `data.financials` |

---

### 4. **Rappel des d√©pendances entre les √©tapes**

| √âtape | Champ(s) principal(aux) | D√©pend de l'√©tape | Utilis√© par l'√©tape | Utilis√© par OpenAI |
|-------|-------------------------|-------------------|---------------------|-------------------|
| **√âtape 1** | `agencyName`, `reference`, `exclusivite`, `location`, `propertyType`, `saleType`, `price`, `rentAmount`, `rentPeriodicity`, `keyElements` | Aucune (premi√®re √©tape) | √âtapes 2, 3, 4, 5 | ‚úÖ Oui (7 prompts) |
| **√âtape 2** | `propertyDescription` | √âtape 1 | √âtapes 3, 4, 5 | ‚úÖ Oui (7 prompts) |
| **√âtape 3** | **`financials`** | **√âtapes 1, 2** | **√âtapes 4, 5** | **‚úÖ Oui (7 prompts)** |
| **√âtape 4** | `details`, `hasNoDetails` | √âtapes 1, 2, 3 | √âtape 5 | ‚úÖ Oui (4 prompts : Site Internet, Fiche de Synth√®se, Newsletter, SMS) |
| **√âtape 5** | G√©n√©ration des annonces | √âtapes 1, 2, 3, 4 | Aucune (derni√®re √©tape) | ‚úÖ Oui (utilise tous les champs) |

---

**Flux de d√©pendance simplifi√© :**
```
√âtape 1 (√âl√©ments cl√©s)
  ‚Üì
√âtape 2 (Description)
  ‚Üì
√âtape 3 (Informations financi√®res) ‚Üê VOUS √äTES ICI
  ‚Üì
√âtape 4 (Autres d√©tails)
  ‚Üì
√âtape 5 (G√©n√©ration des annonces OpenAI)
```

---



Voil√† ! Vous avez maintenant le **contenu complet** de la documentation pour l'**√âtape 3 : Informations Financi√®res**, suivant exactement la m√™me structure et m√©thodologie que les √âtapes 1 et 2. 

Vous pouvez **copier ce contenu directement** dans votre fichier `public/4. ReadMe EtapesAnnonces/01.Etape1√†5/03.Etape3.md` üìã
