# üéØ DOCUMENT PREPARATOIRE AU CODAGE FINAL DE LA MIGRATION - PHASE 1 : MIGRATION √âTAPES 1 √Ä 5

## **Principe G√©n√©ral de la Migration Phase 1 -> Etape 1 √† Etape 5**
**Objectif** : 
- Migrer le process Localstorage -> Supabase
  - Pour les √©tapes 1 √† 5
  - Jusqu'√† l"envoi des prompts vers OpenAI
    - Migrer les **14 champs `propertyData`** des √©tapes 1-4 vers Supabase
    - Pr√©parer et envoyer les donn√©es √† OpenAI (INPUT)
    - Utiliser les **7 prompts sp√©cifiques** (d√©finis dans `src/services/openai/1.GenerateurAnnoncesOutilsSeo/7.PromptsOpenAi/`)

**Ce qui reste en localStorage dans cette phase 1** : 
- Les **7 g√©n√©rations OpenAI** restent en l'√©tat, on les laisse temporairement dans `localStorage`
- Le **statut de g√©n√©ration** (`generation_status`) reste √©galement dans `localStorage`
- Afin de laisser la compatibilit√© temporaire avec **√âtape 6 Communication** qui reste en `localStorage`
- Afin de **limiter les risques** et identifier plus facilement de potentiels bugs
---
## **Imp√©ratif d'Architecture : Convention du nommage `camelCase`**
**Interdiction formelle de transformation  `snake_case`**
- Il est **STRICTEMENT INTERDIT** de transformer ces champs `camelCase` en `snake_case` (ex: `agency_name`, `property_type`) lors de la migration vers Supabase, sous peine de :

**Imp√©ratif absolu pour la migration**
- **Tous les hooks, fonctions, et interactions Supabase cr√©√©s lors de la migration DOIVENT imp√©rativement :**
    - **Conserver la structure `camelCase` existante** pour les champs m√©tier (`agencyName`, `propertyType`, `saleType`, `price`, `rentAmount`, `rentPeriodicity`, `keyElements`, `propertyDescription`, `financials`, `details`, `exclusivite`, `location`, `reference`).
    - **Utiliser `snake_case` uniquement** pour les champs syst√®me Supabase (`organisation_id`, `user_id`, `created_at`, `updated_at`, `project_id`, etc.).
**Cette convention `camelCase` est un imp√©ratif absolu :  elle garantit une migration sans rupture et √©vite tout bug de transformation.**
---
## Ressources imp√©ratives √† consulter pour pr√©parer les r√®gles de cr√©ations des √©l√©ments
**Avant tout codage d'√©l√©ments. Imp√©ratif absolu de consulter**

- **L'int√©gralit√© des fiohiers de l'application**
- **Les tables et contraintes actuelles dans Supabase** (hooks, fonctions...)
- **Relire les documets strat√©giques**
  - public/1. Documents Strat√©giques/01. Pr√©sentation LeadGenAi.md
  - public/1. Documents Strat√©giques/02. Pr√©sentation Structure LeadGenAi.md
  - public/1. Documents Strat√©giques/03. Logique Organisations.md
  - public/1. Documents Strat√©giques/04. Relations Business entre Tables.md
  - public/1. Documents Strat√©giques/05. Relations Users Utilisateurs.md
  - public/1. Documents Strat√©giques/06. R√©f√©rence des Hooks Strat√©giques.md
  - public/1. Documents Strat√©giques/07.1. FormCreationReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - public/1. Documents Strat√©giques/07.2. FormGestionReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - public/1. Documents Strat√©giques/08. Gestion du Menu Gauche.md
  - public/1. Documents Strat√©giques/09. Structure - Organisation | Client_id.md
  - public/1. Documents Strat√©giques/10. Structure des Tables de Connexion & R√®gles Collaborateurs.md
- **Relire la strat√©gie de la phase 1**
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/00.StrategiePhase1.md
- **Relire les audits des √©tapes**
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/01.Etape1.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/02.Etape2.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/03.Etape3.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/04.Etape4.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/05.Etape5.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/06.Etape5animation.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/07.BilanEtape1aEtape5.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/08.ProcessEnvoiInfosOpenAI.md
  - public/4. ReadMe EtapesAnnonces/01.Etape1√†5/09.ProcessPassageEtapeSuivante.md
- **Relire la table pr√©patoire et ses notes de bas de page et le doc multitenant**
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/01.Table_etapes1to5.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/02.1.GestionStrategieMultiTenant.md
- **Relire la bible des elements de r√©f√©rence**
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/02.BibleR√©f√©rences.md
- **Relire le d√©tail de la strat√©gie et le tableau r√©capitulatif des √©l√©ments**
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/03.D√©tailStrat√©giePhase1.md
  - public/4. ReadMe EtapesAnnonces/03.PreparationMigration/01.Etape1to5/03.1.TableauRecapElementsACr√©er.md

---
## Directives de r√©daction des √©l√©ments
- **Introduire le document par un sommaire cliquable**
- **Privl√©gier la pr√©sentation sous forme de tableau**
- **Etre exhausitif pour laisser le moins de zones d'ombres possibles lors de l'√©tape de codage**
- **Eviter les commentaires inutiles**
- **Nommer l'int√©gralit√© des √©l√©ments champs formulaires, fonctions, √©lements pr√©cis de la table qui seront utilis√©s lors du codage**
- **Eviter au maximum de longues s√©ries de codes. Le codage sera effectu√© √† l"√©tape suivante**
- **Structure de pr√©sentation de chaque √©l√©ment**
  - Nom de l'√©l√©ment (ex. Hook √âtape 1)
  - Nom pr√©vu dans la migration (ex.HookEtape-1.ts)
  - Emplacement pr√©vu (ex.src/components/HOOKS-ANNONCES/01.HOOKS-ETAPE1TO5/01.Hooks/HookEtape-1.ts)
  - Fonctions principales (liste des fonctions expos√©es)
  - tableau
    - Contraintes de namming √† respecter
    - Contraintes techniques √† respecter
    - Autres informations conditionn√©es par la nature de l'√©l√©ment
    - Autres informations indispensables pour la cr√©ation d'un bon code
- **Emplacement**
  - Les emplacements des fichiers suivent des r√©gles imp√©ratives
  - Privl√©gier les noms explicites et en fran√ßais
  - Les Hooks seront imp√©rativement cr√©√©s dans le dossier
    - **src/components/HOOKS-ANNONCES/01.HOOKS-ETAPE1TO5/01.Hooks**
  - Les composants, helper, seront imp√©rativement situ√©s dans le dossier
    - **src/components/HOOKS-ANNONCES/01.HOOKS-ETAPE1TO5/02.COMPONENTS**
  - Les fonctions devront imp√©rativement suivre ce naming
    - **01-etapes1to5-etape1/index.ts**
- **R√®gles concernant les sql**
    - Les sql devront √™tre nomm√©es et d√©compos√©es en √©tape de migration pour eviter des migrations trop lourdes pour Supabase
- **R√®gles concernant le nommage des camelCase**
    - **R√®gle SQL - Cr√©ation de table**
      - Champs m√©tier : `"camelCase"` (avec guillemets doubles)
      - Champs syst√®me : `snake_case` (sans guillemets)
    - **R√®gle TypeScript - Hooks & Services**
      - Utilisation directe du `camelCase` pour champs m√©tier
      - Utilisation directe du `snake_case` pour champs syst√®me
      - **AUCUNE fonction de conversion n'est n√©cessaire**
    - **R√®gle Triggers**
      - Utiliser : `NEW."camelCase"` ou `NEW.snake_case`
      - Pr√©f√©rer les fonctions g√©n√©riques r√©utilisables
---
---
## **PLAN PROPOS√â (5 sections principales)**
#### **SECTION 1 - FONDATIONS SQL (11 √©l√©ments)**
1. **Table `etapes_1to5`** (1 √©l√©ment)
2. **Fonctions SQL Helper** (4 √©l√©ments)
3. **Triggers SQL** (4 √©l√©ments)
4. **Politiques RLS** (2 √©l√©ments)
---
#### **SECTION 2 - UTILITAIRES (12 √©l√©ments)**
5. **Utilitaires Formatage** (4 √©l√©ments)
6. **Utilitaires Validation** (5 √©l√©ments)
7. **Utilitaires Conversion/Mapping** (3 √©l√©ments)
---
#### **SECTION 3 - HOOKS REACT (7 √©l√©ments)**
8. **Hook Technique** (1 √©l√©ment √† adapter)
9. **Hook Progression** (1 √©l√©ment)
10. **Hooks M√©tier** (5 √©l√©ments)
---
#### **SECTION 4 - SERVICES OPENAI (7 √©l√©ments)**
11. **Services de G√©n√©ration** (7 √©l√©ments)
---
#### **SECTION 5 - COMPOSANTS & CONTEXTES (12 √©l√©ments √† adapter)**
12. **Composants React** (8 √©l√©ments √† adapter)
13. **Contexte React** (1 √©l√©ment √† adapter)
14. **Script de Migration** (1 √©l√©ment)
---
---
