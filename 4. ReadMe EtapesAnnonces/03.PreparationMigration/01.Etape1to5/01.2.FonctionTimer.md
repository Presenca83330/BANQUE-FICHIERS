# üìã M√âMO - DIRECTIVE ABSOLUE : TIMER `session_start_time`

## üö´ **DIRECTIVE ABSOLUE**
- **‚ùå INTERDICTION FORMELLE DE SUPPRIMER LE CODE DU TIMER `session_start_time`**
- **‚ùå INTERDICTION DE L'INTEGRER DANS LA MIGRATION PHASE 1 ET PHASE 2 **
- **LE COMPOSANT DOIT RESTER EN L'ETAT -> D√âSACTIV√â**
- **AUCUNE INTERVENTION SUR CE CODE JUSQU'√Ä NOUVEL ORDRE**

**Cette directive s'applique √† :**
- Toute intervention future sur le code
- Toute migration (Phase 1, Phase 2, etc.)
- Toute refactorisation
- Toute suggestion d'optimisation

---

## üìç **Localisation du code**
**Fichier** : `src/components/1-Sources-Generation-Annonces/utils/useSgaForm.ts`

**Lignes concern√©es** :
- **Lignes 11-20** : Cr√©ation initiale du `session_start_time` dans `localStorage` (ACTIF)
- **Lignes 22-73** : Logique compl√®te du timer de 10 minutes (D√âSACTIV√âE - comment√©e)
- **Lignes 82-85** : Fonction `resetSessionTimer()` pour nettoyer le timer (ACTIVE)

---

## üéØ **√Ä quoi sert ce timer ?**

### **Objectif initial (MVP sans Supabase Auth)**
Dans la version MVP de l'application, **avant l'impl√©mentation de Supabase Authentication**, ce timer servait √† :

1. **Limiter la dur√©e de session √† 10 minutes**
   - √âviter que les donn√©es restent ind√©finiment dans `localStorage`
   - Forcer l'utilisateur √† g√©n√©rer son annonce rapidement

2. **Alerter l'utilisateur √† 9 minutes**
   - Toast d'avertissement 1 minute avant expiration
   - Message : *"Vos donn√©es vont expirer dans 1 minute"*

3. **Nettoyer automatiquement √† 10 minutes**
   - Suppression de toutes les cl√©s `localStorage` :
     - `session_start_time`
     - `propertyDescription`
     - `financials`
     - `propertyData`
     - `stepProgress`
     - `etape1Data`
     - `details`
   - Redirection automatique vers `/etape1`
   - Toast d'expiration : *"Votre session a expir√©"*

4. **Exclusions**
   - Le timer ne s'activait **PAS** sur les pages `/animation` et `/etape6`
   - V√©rification toutes les 30 secondes via `setInterval`

### **Fonctionnement technique**
```typescript
// 1. Cr√©ation du timestamp au premier acc√®s (ACTIF)
useEffect(() => {
  const sessionStart = localStorage.getItem("session_start_time");
  if (!sessionStart) {
    const startTime = new Date().getTime();
    localStorage.setItem("session_start_time", startTime.toString());
  }
}, []);

// 2. Logique du timer (D√âSACTIV√âE - comment√©e)
// - V√©rification toutes les 30s
// - Alert √† 9min
// - Nettoyage √† 10min

// 3. Fonction de reset (ACTIVE - appel√©e lors g√©n√©ration)
const resetSessionTimer = () => {
  localStorage.removeItem("session_start_time");
};
```

---

## ‚ö†Ô∏è **√âtat actuel : D√âSACTIV√â**

### **Ce qui est ACTIF**
‚úÖ **Lignes 11-20** : Cr√©ation du timestamp `session_start_time` au premier acc√®s  
‚úÖ **Lignes 82-85** : Fonction `resetSessionTimer()` export√©e dans le hook

### **Ce qui est D√âSACTIV√â**
‚ùå **Lignes 22-73** : Toute la logique de v√©rification/alerte/nettoyage (comment√©e)  
‚ùå **Aucun `setInterval`** actif  
‚ùå **Aucun toast d'avertissement**  
‚ùå **Aucun nettoyage automatique**  
‚ùå **Aucune redirection automatique**

### **Cons√©quence actuelle**
- Le timer cr√©e une cl√© `session_start_time` dans `localStorage`
- Cette cl√© **n'est jamais lue** (code de lecture comment√©)
- Cette cl√© **n'est jamais nettoy√©e** (sauf si `resetSessionTimer()` est appel√©e manuellement)
- **Impact** : Pollution mineure de `localStorage` (1 cl√© orpheline)

---

## üîê **Pourquoi c'est d√©sactiv√© ?**

Depuis l'impl√©mentation de **Supabase Authentication**, ce timer est devenu redondant car :
- Supabase g√®re automatiquement les sessions avec JWT tokens
- Les tokens ont leur propre expiration (configurable dans Supabase)
- Supabase Auth auto-refresh les tokens avant expiration
- Les donn√©es migr√©es vers Supabase (`etapes_1to5`) persistent au-del√† de 10 minutes

**Conclusion** : Le timer 10 minutes n'a plus de raison d'√™tre dans le contexte actuel.

---

## üõ°Ô∏è **DIRECTIVE : Ne PAS supprimer**

### **Raisons de conservation**
- **1/** : **S√©curit√©** : √âvite tout risque de casse accidentelle
- **2/** : **Possibilit√© future** : Pourrait √™tre r√©activ√© si besoin (ex: mode d√©mo sans auth)

### **Ce qu'on fait avec ce code**
‚úÖ **On le GARDE tel quel**  
‚úÖ **On l'OUBLIE pour l'instant**  
‚úÖ **On NE LE SUPPRIME PAS**  
‚úÖ **On ne le mentionne PAS dans les plans de migration Phase 1/2**

---

## üìù **Action pour les futures interventions**

Lorsque l'IA ou un d√©veloppeur travaille sur :
- Migration Phase 1 (`etapes_1to5`)
- Migration Phase 2 (`property_generations`)
- Refactorisation de `useSgaForm.ts`
- Nettoyage de `localStorage`

**‚ö†Ô∏è CONSIGNE ABSOLUE** :
> **"Ignorer compl√®tement le code du timer `session_start_time`. Ne pas le modifier, ne pas le supprimer, ne pas le mentionner. C'est une zone intouchable jusqu'√† nouvel ordre."**

---

**Date de cr√©ation** : 2025-10-29  
**Statut** : üî¥ **DIRECTIVE ABSOLUE EN VIGUEUR**  
**Validit√©** : Jusqu'√† instruction contraire explicite

---
---

