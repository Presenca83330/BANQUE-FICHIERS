# ğŸ“„ **NavLinks.tsx MIGRÃ‰ - VERSION SIMPLE (sans loader)**

```typescript
import React, { useEffect, useState } from "react";
import { useLocation } from "react-router-dom";
import { useAutorisationDashboard } from "./2.Hook-Autorisations/1.Aut.Acces.Dashboard";
import { useStepProgress } from "@/components/HOOKS-ANNONCES/01.HOOKS-ETAPE1TO5/01.Hooks/00.Technique/useStepProgress";

// DÃ©finition du type pour les sous-liens de navigation
export interface SubNavLink {
  to: string;
  label: string;
  isActive: boolean;
}

// DÃ©finition du type pour les liens de navigation
export interface NavLink {
  to: string;
  label: string;
  isActive: boolean;
  subLinks?: SubNavLink[];
  expanded?: boolean;
}

// DÃ©finition du titre de navigation en dur
export const navTitle = "Vos Assistants IA";

// DÃ©finition des liens de navigation avec sous-liens
export const navLinks: NavLink[] = [
  { to: "/accueil-leadgenai", label: "Accueil", isActive: false },
  { 
    to: "/etape1", 
    label: "Bien Ã  vendre ou Ã  louer", 
    isActive: false,
    expanded: false,
    subLinks: [
      { to: "/etape1", label: "Ã‰lÃ©ments clÃ©s", isActive: false },
      { to: "/etape2", label: "Infos de description", isActive: false },
      { to: "/etape3", label: "Infos FinanciÃ¨res", isActive: false },
      { to: "/etape4", label: "Autres dÃ©tails", isActive: false },
      { to: "/etape6communication", label: "Annonces et Outils Marketing", isActive: false },
    ]
  },
  { to: "/zone-chalandise", label: "Zone de Chalandise Ã  analyser", isActive: false },
  { to: "/newsletter-builder", label: "Newsletter Ã  lancer", isActive: false },
  { to: "#", label: "Landing Page Ã  crÃ©er", isActive: false },
  { to: "#", label: "Bases de donnÃ©es Ã  constituer", isActive: false },
  { to: "#", label: "Prospects Ã  relancer", isActive: false },
  { to: "#", label: "Contenus Ã  rÃ©diger", isActive: false },
  { to: "#", label: "PublicitÃ©s Ã  diffuser", isActive: false },
];

// Titre de rubrique Dashboard
export const dashboardTitle = "Dashboard";

// Liens du menu Dashboard
export const dashboardLinks: NavLink[] = [
  { to: "/espace-client", label: "Mon Espace Client", isActive: false },
];

// Fonction pour obtenir les liens de navigation avec l'Ã©tat actif mis Ã  jour
export const useNavLinks = (): [NavLink[], (index: number) => void] => {
  const location = useLocation();
  
  // âœ… MIGRATION : Utiliser useStepProgress au lieu de localStorage
  const { completedSteps } = useStepProgress(1);
  
  const [links, setLinks] = useState<NavLink[]>([]);

  // âœ… MIGRATION : Fonction pour vÃ©rifier si une Ã©tape est dÃ©bloquÃ©e (Supabase)
  const isStepUnlocked = (path: string): boolean => {
    // Si pas de progression, seule l'Ã©tape 1 est accessible
    if (!completedSteps || completedSteps.length === 0) {
      return path === "/etape1";
    }
    
    // Extraire le numÃ©ro d'Ã©tape du chemin
    const stepMatch = path.match(/\/etape(\d+)/);
    if (stepMatch) {
      const stepNumber = parseInt(stepMatch[1]);
      return completedSteps.includes(stepNumber);
    }
    
    // Pour les chemins spÃ©ciaux comme /etape6communication
    if (path === "/etape6communication") {
      return completedSteps.includes(5); // Accessible si Ã©tape 5 est dÃ©bloquÃ©e
    }
    
    return true; // Pour les autres chemins, les laisser visibles
  };

  // âœ… MIGRATION : Mettre Ã  jour les liens quand completedSteps change (event-driven)
  useEffect(() => {
    const updatedLinks = navLinks.map(link => {
      // VÃ©rifie si le lien principal est actif
      const isMainActive = location.pathname === link.to || 
                         (link.to === "/accueil-leadgenai" && location.pathname === "/accueil-leadgenai") ||
                         (link.to === "/etape1" && (location.pathname.includes("/etape") || location.pathname === "/safe")) ||
                         (link.to === "/zone-chalandise" && location.pathname.includes("/zone-chalandise")) ||
                         (link.to === "/etape1" && location.pathname.includes("/analyse-photos"));
      
      // Traitement des sous-liens s'ils existent
      const updatedSubLinks = link.subLinks?.map(subLink => ({
        ...subLink,
        isActive: location.pathname === subLink.to || 
                 (subLink.to === "/etape1" && location.pathname.includes("/etape1")) ||
                 (subLink.to === "/etape2" && location.pathname.includes("/etape2")) ||
                 (subLink.to === "/etape3" && location.pathname.includes("/etape3")) ||
                 (subLink.to === "/etape4" && location.pathname.includes("/etape4")) ||
                 (subLink.to === "/etape6communication" && location.pathname.includes("/etape6communication")) ||
                 (subLink.to === "/safe" && location.pathname === "/safe") ||
                 (subLink.to === "/analyse-photos" && location.pathname.includes("/analyse-photos"))
      }))?.filter(subLink => isStepUnlocked(subLink.to)); // âœ… Filtrer les sous-liens non dÃ©bloquÃ©s
      
      return {
        ...link,
        isActive: isMainActive,
        subLinks: updatedSubLinks,
        expanded: isMainActive
      };
    });

    setLinks(updatedLinks);
  }, [location.pathname, completedSteps]);

  // Fonction pour basculer l'Ã©tat d'expansion d'un menu
  const toggleExpand = (index: number) => {
    setLinks(prevLinks => 
      prevLinks.map((link, i) => 
        i === index 
          ? { ...link, expanded: !link.expanded } 
          : link
      )
    );
  };
  
  return [links, toggleExpand];
};

// Hook pour les liens du dashboard avec autorisation dynamique
export const useDashboardLinks = (): NavLink[] => {
  const location = useLocation();
  const { espacesAutorises, labelsEspaces, isAutorised } = useAutorisationDashboard();
  
  // Si pas d'autorisation, retourner un tableau vide
  if (!isAutorised || espacesAutorises.length === 0) {
    return [];
  }

  // CrÃ©er les liens dynamiques basÃ©s sur TOUS les espaces autorisÃ©s
  const dynamicDashboardLinks: NavLink[] = labelsEspaces.map(({ espace, label }) => {
    let routePath = "/espace-client"; // dÃ©faut
    
    // Adapter la route selon l'espace
    switch (espace) {
      case "ADMIN-PRESENCA":
        routePath = "/admin-presenca";
        break;
      case "RESEAU-ESPACE":
        routePath = "/espace-reseau";
        break;
      case "CLIENT-ESPACE":
        routePath = "/espace-client";
        break;
      case "COLLABORATEUR-ESPACE":
        routePath = "/espace-collaborateur";
        break;
    }

    return {
      to: routePath,
      label: label,
      isActive: location.pathname === routePath
    };
  });

  return dynamicDashboardLinks;
};

// Composant qui retourne les liens et le titre
const NavLinks: React.FC = () => {
  return null;
};

export default NavLinks;
```

---

## âœ… **CHANGEMENTS EFFECTUÃ‰S**

| Ligne | Avant (localStorage) | AprÃ¨s (Supabase) |
|-------|---------------------|------------------|
| **5** | âŒ Pas d'import | âœ… `import { useStepProgress }` |
| **58** | âŒ `localStorage.getItem('stepProgress')` | âœ… `const { completedSteps } = useStepProgress(1)` |
| **68** | âŒ `JSON.parse(savedProgress)` | âœ… `completedSteps` (direct) |
| **76** | âŒ `progress.includes(stepNumber)` | âœ… `completedSteps.includes(stepNumber)` |
| **108** | âŒ Pas de dÃ©pendance `completedSteps` | âœ… `[location.pathname, completedSteps]` |

---

## ğŸ¯ **CE QUI SE PASSE MAINTENANT**

### **Comportement :**

1. **User arrive sur la page** â†’ Menu vide pendant 80-300ms
2. **Supabase rÃ©pond** â†’ `completedSteps` mis Ã  jour
3. **useEffect triggered** â†’ Menu filtrÃ© automatiquement
4. **User valide Ã‰tape 1** â†’ `completeStep(1)` appelÃ©
5. **Supabase mis Ã  jour** â†’ `completedSteps` change
6. **useEffect re-triggered** â†’ Ã‰tape 2 apparaÃ®t automatiquement ! âœ¨

### **Event-driven :**
```typescript
useEffect(() => {
  // Se dÃ©clenche automatiquement quand completedSteps change
  const updatedLinks = navLinks.map(link => {
    // Filtrage dynamique basÃ© sur Supabase
  });
  setLinks(updatedLinks);
}, [location.pathname, completedSteps]); // â† completedSteps dans les dÃ©pendances
```

---

## ğŸš€ **PRÃŠT Ã€ REMPLACER**

**Fichier Ã  remplacer :**
```
src/components/navigation-site-leadgenaiadbuilder/NavLinks.tsx
```

**C'est tout ! Plus de localStorage, tout est Supabase maintenant !** âœ…
