# üìã CAHIER DES CHARGES SECTION 5 ‚Äî CORRIG√â ET VALID√â

## üéØ OBJECTIFS DE LA SECTION 5

### Mission Principale
**Adapter l'interface React existante (√âtapes 1-5) pour utiliser Supabase au lieu de localStorage, SANS modifier l'UI actuelle qui fonctionne parfaitement.**

### P√©rim√®tre Phase 1 STRICT
- ‚úÖ Adapter les 5 pages existantes (`Etape1.tsx` ‚Üí `Etape5.tsx`)
- ‚úÖ Adapter les 4 formulaires existants
- ‚úÖ Remplacer appels `localStorage` par hooks Supabase (Section 3)
- ‚úÖ Int√©grer les services OpenAI (Section 4) dans Etape5.tsx
- ‚úÖ Cr√©er le contexte `AnnonceContext` pour g√©rer le `project_id`
- ‚úÖ **R√©sultats OpenAI restent dans `localStorage` (Phase 1)**
- ‚ùå **PAS de page Animation** (Phase 2)
- ‚ùå **PAS d'√âtape 6 Communication** (Phase 2)
- ‚ùå **PAS de script migration** (app pas en prod)

---

## ‚ùå ERREURS DE L'ANCIEN CAHIER DES CHARGES

### üö® Erreur 1 : Cr√©ation de Nouvelles Pages
**Ancien document proposait :**
```
src/components/GENERATION-ANNONCES/
‚îú‚îÄ‚îÄ 1.Etape1FormulaireBienCommercial.tsx  ‚ùå NOUVEAU FICHIER
‚îú‚îÄ‚îÄ 2.Etape2ChoixTypeAnnonce.tsx           ‚ùå NOUVEAU FICHIER
‚îú‚îÄ‚îÄ 3.Etape3ValidationRecap.tsx            ‚ùå NOUVEAU FICHIER
‚îú‚îÄ‚îÄ 4.Etape4ReglagesParametrages.tsx       ‚ùå NOUVEAU FICHIER
‚îî‚îÄ‚îÄ 5.Etape5GenerationAnnonce.tsx          ‚ùå NOUVEAU FICHIER
```

**‚ùå PROBL√àME :** L'application actuelle fonctionne parfaitement avec des pages existantes !

**‚úÖ CORRECTION :** On adapte les pages existantes
```
src/1.etapes-generation-annonces/
‚îú‚îÄ‚îÄ etape1/Etape1.tsx        ‚úÖ ADAPTER EXISTANT
‚îú‚îÄ‚îÄ etape2/Etape2.tsx        ‚úÖ ADAPTER EXISTANT
‚îú‚îÄ‚îÄ etape3/Etape3.tsx        ‚úÖ ADAPTER EXISTANT
‚îú‚îÄ‚îÄ etape4/Etape4.tsx        ‚úÖ ADAPTER EXISTANT
‚îî‚îÄ‚îÄ etape5/Etape5.tsx        ‚úÖ ADAPTER EXISTANT
```

---

### üö® Erreur 2 : Page Animation dans Phase 1
**Ancien document incluait :**
- Animation de progression pendant g√©n√©ration OpenAI
- Redirection vers `/etape6communication`

**‚ùå PROBL√àME :** Phase 1 s'arr√™te √† l'ENVOI vers OpenAI, pas apr√®s !

**‚úÖ CORRECTION :**
- Page Animation = **Phase 2** (apr√®s g√©n√©ration)
- Phase 1 = Collecte donn√©es + Envoi OpenAI
- R√©sultats OpenAI restent dans `localStorage`

---

### üö® Erreur 3 : Script Migration
**Ancien document proposait :**
```
src/utils/migration/migrateLocalStorageToSupabase.ts
```

**‚ùå PROBL√àME :** L'application n'est PAS en production, il n'y a RIEN √† migrer !

**‚úÖ CORRECTION :**
- Pas de script migration n√©cessaire
- Les donn√©es iront directement dans Supabase

---

### üö® Erreur 4 : Nouveaux Composants Navigation/Progress/Layout
**Ancien document proposait :**
- `NavigationEtapes.tsx` (nouveau)
- `ProgressIndicator.tsx` (nouveau)
- `LayoutGenerationAnnonce.tsx` (nouveau)

**‚ùå PROBL√àME :** Ces composants existent d√©j√† et fonctionnent !

**‚úÖ CORRECTION :**
- `DirectivesMenuOnglet` existe d√©j√† (navigation)
- `useStepProgress` existe d√©j√† (progression)
- `LayoutV2GenAnn` existe d√©j√† (layout)
- **On adapte, on ne recr√©e pas !**

---

## ‚úÖ STRAT√âGIE CORRIG√âE

### Principe Fondamental
**"On ne touche PAS √† ce qui fonctionne, on adapte juste localStorage ‚Üí Supabase"**

### Architecture Conserv√©e
```
Pages actuelles (Etape1.tsx ‚Üí Etape5.tsx)
    ‚Üì
Formulaires actuels (EnsembleFormulairesEtape1Form.tsx, etc.)
    ‚Üì
Petits composants actuels (TextFieldForm, MonetaryFieldForm, etc.)
    ‚Üì
‚ùå AVANT: localStorage.propertyData
‚úÖ APR√àS: Supabase via hooks Section 3
```

---

## üìã FICHIERS √Ä CR√âER/MODIFIER

### 1Ô∏è‚É£ FICHIER NOUVEAU : AnnonceContext

| Fichier | Action | R√¥le |
|---------|--------|------|
| `src/contexts/AnnonceContext.tsx` | **CR√âER** | G√©rer `currentProjectId` et √©tat global |

**√âtats du contexte :**
```typescript
interface AnnonceContextType {
  currentProjectId: string | null;
  projectData: ProjectData | null;
  isLoading: boolean;
  error: string | null;
  loadProject: (projectId: string) => Promise<void>;
  updateProject: (data: Partial<ProjectData>) => Promise<void>;
}
```

---

### 2Ô∏è‚É£ FICHIERS √Ä ADAPTER : 5 Pages Existantes

| Fichier Actuel | Action | Modifications Principales |
|----------------|--------|--------------------------|
| `src/1.etapes-generation-annonces/etape1/Etape1.tsx` | **ADAPTER** | Utiliser `AnnonceContext` et `useEtape1` |
| `src/1.etapes-generation-annonces/etape2/Etape2.tsx` | **ADAPTER** | Utiliser `AnnonceContext` et `useEtape2` |
| `src/1.etapes-generation-annonces/etape3/Etape3.tsx` | **ADAPTER** | Utiliser `AnnonceContext` et `useEtape3` |
| `src/1.etapes-generation-annonces/etape4/Etape4.tsx` | **ADAPTER** | Utiliser `AnnonceContext` et `useEtape4` |
| `src/1.etapes-generation-annonces/etape5/Etape5.tsx` | **ADAPTER** | Int√©grer services OpenAI (Section 4) |

**Exemple de modification (Etape1.tsx) :**

```typescript
// ‚ùå AVANT (localStorage)
const handleValidation = () => {
  const propertyData = getPropertyDataFromStorage();
  updatePropertyData(etape1Data);
  completeStep(1);
  navigate('/etape2');
};

// ‚úÖ APR√àS (Supabase)
const { projectData, updateProject } = useAnnonceContext();
const { saveEtape1, completeStep } = useEtape1(currentProjectId);

const handleValidation = async () => {
  await saveEtape1(etape1Data);
  await completeStep(1);
  navigate('/etape2');
};
```

---

### 3Ô∏è‚É£ FICHIERS √Ä ADAPTER : 4 Formulaires Existants

| Fichier Actuel | Action | Modifications |
|----------------|--------|--------------|
| `src/components/1-Sources-Generation-Annonces/form-etape1/EnsembleFormulairesEtape1Form.tsx` | **ADAPTER** | Recevoir `projectId` et hooks en props |
| `src/components/1-Sources-Generation-Annonces/form-etape2/SaisieDescriptionForm.tsx` | **ADAPTER** | Recevoir `projectId` et hooks en props |
| `src/components/1-Sources-Generation-Annonces/form-etape3/SaisieFinancialForm.tsx` | **ADAPTER** | Recevoir `projectId` et hooks en props |
| `src/components/1-Sources-Generation-Annonces/form-etape4/SaisieDetailsForm.tsx` | **ADAPTER** | Recevoir `projectId` et hooks en props |

**Exemple de modification (EnsembleFormulairesEtape1Form.tsx) :**

```typescript
// ‚ùå AVANT (localStorage)
interface Props {
  onValidationSuccess: () => void;
}

const EnsembleFormulairesEtape1Form = ({ onValidationSuccess }: Props) => {
  useEffect(() => {
    const data = getPropertyDataFromStorage();
    // Pr√©-remplissage
  }, []);

// ‚úÖ APR√àS (Supabase)
interface Props {
  projectId: string;
  projectData: ProjectData | null;
  saveEtape1: (data: Etape1Data) => Promise<void>;
  onValidationSuccess: () => void;
}

const EnsembleFormulairesEtape1Form = ({ 
  projectId, 
  projectData, 
  saveEtape1,
  onValidationSuccess 
}: Props) => {
  useEffect(() => {
    // Pr√©-remplissage depuis projectData (d√©j√† charg√©)
  }, [projectData]);
```

---

### 4Ô∏è‚É£ FICHIER √Ä ADAPTER : Hook Progression

| Fichier Actuel | Action | Modifications |
|----------------|--------|--------------|
| `src/components/1-Sources-Generation-Annonces/utils/useStepProgress.ts` | **ADAPTER** | Utiliser `useStepProgress` de Section 3 |

**Modifications :**

```typescript
// ‚ùå AVANT (localStorage)
const completeStep = (stepNumber: number) => {
  const progress = JSON.parse(localStorage.getItem('stepProgress') || '{}');
  progress.availableSteps.push(stepNumber + 1);
  localStorage.setItem('stepProgress', JSON.stringify(progress));
};

// ‚úÖ APR√àS (Supabase)
import { useStepProgress as useStepProgressSupabase } from '@/components/HOOKS-ANNONCES/01.HOOKS-ETAPE1TO5/01.Hooks/00.Technique/useStepProgress';

const { completeStep } = useStepProgressSupabase(currentProjectId);
// completeStep appelle maintenant Supabase
```

---

### 5Ô∏è‚É£ PETITS COMPOSANTS : NE PAS TOUCHER ‚ùå

| Composant | Action |
|-----------|--------|
| `TextFieldForm.tsx` | ‚úÖ **NE PAS MODIFIER** |
| `MonetaryFieldForm.tsx` | ‚úÖ **NE PAS MODIFIER** |
| `SelectionButtonRond.tsx` | ‚úÖ **NE PAS MODIFIER** |
| `FormulaireSaisie.tsx` | ‚úÖ **NE PAS MODIFIER** |
| `BoutonValiderInformations.tsx` | ‚úÖ **NE PAS MODIFIER** |
| `SgaHelpBox.tsx` | ‚úÖ **NE PAS MODIFIER** |
| `EtapeFAQ.tsx` | ‚úÖ **NE PAS MODIFIER** |

---

## üìä TABLEAU DE CORRESPONDANCE localStorage ‚Üí Supabase

### √âtape 1 : √âl√©ments Cl√©s

| Champ localStorage | Champ Supabase | Type | Hook Section 3 |
|-------------------|----------------|------|----------------|
| `propertyData.agencyName` | `etapes_1to5.agencyName` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.reference` | `etapes_1to5.reference` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.exclusivite` | `etapes_1to5.exclusivite` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.location` | `etapes_1to5.location` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.propertyType` | `etapes_1to5.propertyType` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.saleType` | `etapes_1to5.saleType` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.price` | `etapes_1to5.price` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.rentAmount` | `etapes_1to5.rentAmount` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.rentPeriodicity` | `etapes_1to5.rentPeriodicity` | TEXT | `useEtape1.saveEtape1()` |
| `propertyData.keyElements` | `etapes_1to5.keyElements` | TEXT | `useEtape1.saveEtape1()` |

### √âtape 2 : Description

| Champ localStorage | Champ Supabase | Type | Hook Section 3 |
|-------------------|----------------|------|----------------|
| `propertyData.propertyDescription` | `etapes_1to5.propertyDescription` | TEXT | `useEtape2.saveEtape2()` |

### √âtape 3 : Finances

| Champ localStorage | Champ Supabase | Type | Hook Section 3 |
|-------------------|----------------|------|----------------|
| `propertyData.financials` | `etapes_1to5.financials` | TEXT | `useEtape3.saveEtape3()` |

### √âtape 4 : D√©tails

| Champ localStorage | Champ Supabase | Type | Hook Section 3 |
|-------------------|----------------|------|----------------|
| `propertyData.details` | `etapes_1to5.details` | TEXT | `useEtape4.saveEtape4()` |
| `propertyData.hasNoDetails` | `etapes_1to5.hasNoDetails` | BOOLEAN | `useEtape4.saveEtape4()` |

### Progression

| Cl√© localStorage | Champ Supabase | Type | Hook Section 3 |
|-----------------|----------------|------|----------------|
| `stepProgress.availableSteps` | `etapes_1to5.step_progress` | INTEGER[] | `useStepProgress.completeStep()` |

---

## üîß INT√âGRATION SERVICES OPENAI (√âTAPE 5)

### √âtape 5 : G√©n√©ration OpenAI

**Fichier √† modifier :** `src/1.etapes-generation-annonces/etape5/Etape5.tsx`

### Modifications Principales

```typescript
// ‚úÖ IMPORTS Section 4
import { createAnnonceSiteInternetService } from '@/services/openai/01.SupabaseEtape1to5/0.Helpers/openaiConfig';
import { getActiveOpenAIKey } from '@/services/openai/01.SupabaseEtape1to5/0.Helpers/getActiveOpenAIKey';
import { getProjectDataFromSupabase } from '@/services/openai/01.SupabaseEtape1to5/0.Helpers/getProjectDataFromSupabase';

// ‚úÖ INTERFACE GenerationStatus (pour compatibility avec page Animation)
interface GenerationStatus {
  startTime: number;
  websiteAd: boolean;
  summarySheet: boolean;
  newsletter: boolean;
  seoTools: boolean;
  smsAd: boolean;
  googleBusinessProfile: boolean;
  reseauxSociaux: boolean;
  completed: boolean;
  progress: number;
}

// ‚úÖ FONCTION HELPER : updateGenerationStatus
// CRITIQUE : Cette fonction met √† jour le statut pour la page Animation
const updateGenerationStatus = (updates: Partial<GenerationStatus>) => {
  const current = JSON.parse(localStorage.getItem('generation_status') || '{}');
  const updated = { ...current, ...updates };
  localStorage.setItem('generation_status', JSON.stringify(updated));
};

// ‚úÖ S√âQUENCE D'APPELS
const handleGenerateAds = async () => {
  // 1. Initialiser generation_status
  const initialStatus: GenerationStatus = {
    startTime: Date.now(),
    websiteAd: false,
    summarySheet: false,
    newsletter: false,
    seoTools: false,
    smsAd: false,
    googleBusinessProfile: false,
    reseauxSociaux: false,
    completed: false,
    progress: 0
  };
  localStorage.setItem('generation_status', JSON.stringify(initialStatus));

  try {
    // 2. R√©cup√©rer la cl√© OpenAI active
    const apiKey = await getActiveOpenAIKey();
    
    // 3. R√©cup√©rer les donn√©es du projet
    const projectData = await getProjectDataFromSupabase(projectId);
    
    // 4. Appeler les 7 services s√©quentiellement
    
    // Service 1 - Site Internet
    const service1 = createAnnonceSiteInternetService(apiKey);
    const result1 = await service1.generateAnnonceSiteInternet(projectData);
    localStorage.setItem('generation_website_ad', JSON.stringify(result1));
    updateGenerationStatus({ websiteAd: true, progress: 14 });
    
    // Service 2 - Fiche Synth√®se
    const service2 = createAnnonceFichedeSyntheseService(apiKey);
    const result2 = await service2.generateAnnonceFichedeSynthese(projectData);
    localStorage.setItem('generation_summary_sheet', JSON.stringify(result2));
    updateGenerationStatus({ summarySheet: true, progress: 28 });
    
    // Service 3 - Newsletter
    const service3 = createAnnonceNewsletterService(apiKey);
    const result3 = await service3.generateAnnonceNewsletter(projectData);
    localStorage.setItem('generation_newsletter', JSON.stringify(result3));
    updateGenerationStatus({ newsletter: true, progress: 42 });
    
    // Service 4 - Outils SEO
    const service4 = createOutilsSEOService(apiKey);
    const result4 = await service4.generateOutilsSEO(projectData);
    localStorage.setItem('generation_seo_tools', JSON.stringify(result4));
    updateGenerationStatus({ seoTools: true, progress: 57 });
    
    // Service 5 - SMS
    const service5 = createSMSAnnonceService(apiKey);
    const result5 = await service5.generateSMSAnnonce(projectData);
    localStorage.setItem('generation_sms_ad', JSON.stringify(result5));
    updateGenerationStatus({ smsAd: true, progress: 71 });
    
    // Service 6 - Google Business Profile
    const service6 = createGoogleBusinessProfileService(apiKey);
    const result6 = await service6.generateGoogleBusinessProfileAnnonce(projectData);
    localStorage.setItem('generation_googleprofile_ad', JSON.stringify(result6));
    updateGenerationStatus({ googleBusinessProfile: true, progress: 85 });
    
    // Service 7 - R√©seaux Sociaux
    const service7 = createReseauxSociauxService(apiKey);
    const result7 = await service7.generateReseauxSociauxAnnonce(projectData);
    localStorage.setItem('generation_reseauxsociaux_ad', JSON.stringify(result7));
    updateGenerationStatus({ reseauxSociaux: true, progress: 100, completed: true });
    
    // 5. Redirection vers page Animation
    navigate('/etape5/animation');
    
  } catch (error) {
    console.error('Erreur g√©n√©ration:', error);
    toast.error("Erreur lors de la g√©n√©ration");
  }
};
```

### Cl√©s localStorage des R√©sultats OpenAI (Phase 1)

| Service | Cl√© localStorage | Format |
|---------|------------------|--------|
| Site Internet | `generation_website_ad` | JSON |
| Fiche Synth√®se | `generation_summary_sheet` | JSON |
| Newsletter | `generation_newsletter` | JSON |
| Outils SEO | `generation_seo_tools` | JSON |
| SMS | `generation_sms_ad` | JSON |
| Google Business | `generation_googleprofile_ad` | JSON |
| R√©seaux Sociaux | `generation_reseauxsociaux_ad` | JSON |

### üö® FONCTION CRITIQUE : updateGenerationStatus

**CETTE FONCTION EST OBLIGATOIRE POUR LA COMPATIBILIT√â AVEC LA PAGE ANIMATION (PHASE 2)**

**R√¥le :**
- Mettre √† jour `generation_status` dans localStorage apr√®s chaque service
- Permet √† la page Animation d'afficher la progression en temps r√©el
- DOIT √™tre appel√©e 7 fois (une fois par service)

**Signature :**
```typescript
const updateGenerationStatus = (updates: Partial<GenerationStatus>) => {
  const current = JSON.parse(localStorage.getItem('generation_status') || '{}');
  const updated = { ...current, ...updates };
  localStorage.setItem('generation_status', JSON.stringify(updated));
};
```

**Appels obligatoires :**
```typescript
// Apr√®s CHAQUE service (7 fois au total)
updateGenerationStatus({ websiteAd: true, progress: 14 });        // Service 1
updateGenerationStatus({ summarySheet: true, progress: 28 });     // Service 2
updateGenerationStatus({ newsletter: true, progress: 42 });       // Service 3
updateGenerationStatus({ seoTools: true, progress: 57 });         // Service 4
updateGenerationStatus({ smsAd: true, progress: 71 });            // Service 5
updateGenerationStatus({ googleBusinessProfile: true, progress: 85 }); // Service 6
updateGenerationStatus({ reseauxSociaux: true, progress: 100, completed: true }); // Service 7
```

**‚ö†Ô∏è ATTENTION :** Oublier cette fonction = page Animation ne fonctionnera pas !

---

## üéØ GESTION DU project_id

### Via AnnonceContext

**Le contexte g√®re :**
1. Stockage du `currentProjectId`
2. Chargement des donn√©es via `useSupabaseOperations.getProjectData()`
3. Mise √† jour via `useSupabaseOperations.updateEtapeData()`
4. Navigation entre √©tapes

### Flux de Donn√©es

```
URL/Navigation ‚Üí project_id
    ‚Üì
AnnonceContext.loadProject(project_id)
    ‚Üì
useSupabaseOperations.getProjectData(project_id)
    ‚Üì
RLS Supabase (filtrage organisation_id automatique)
    ‚Üì
projectData disponible dans le contexte
    ‚Üì
Pages/Formulaires utilisent projectData
```

---

## ‚úÖ CHECKLIST DE LIVRAISON SECTION 5

### Fichiers √† Cr√©er (1)
- [ ] `src/contexts/AnnonceContext.tsx`

### Fichiers √† Adapter (9)
- [ ] `src/1.etapes-generation-annonces/etape1/Etape1.tsx`
- [ ] `src/1.etapes-generation-annonces/etape2/Etape2.tsx`
- [ ] `src/1.etapes-generation-annonces/etape3/Etape3.tsx`
- [ ] `src/1.etapes-generation-annonces/etape4/Etape4.tsx`
- [ ] `src/1.etapes-generation-annonces/etape5/Etape5.tsx`
- [ ] `src/components/1-Sources-Generation-Annonces/form-etape1/EnsembleFormulairesEtape1Form.tsx`
- [ ] `src/components/1-Sources-Generation-Annonces/form-etape2/SaisieDescriptionForm.tsx`
- [ ] `src/components/1-Sources-Generation-Annonces/form-etape3/SaisieFinancialForm.tsx`
- [ ] `src/components/1-Sources-Generation-Annonces/form-etape4/SaisieDetailsForm.tsx`

### V√©rifications Techniques
- [ ] Tous les appels `localStorage.getItem('propertyData')` remplac√©s
- [ ] Tous les appels `updatePropertyData()` remplac√©s
- [ ] Tous les appels `getPropertyDataFromStorage()` remplac√©s
- [ ] Hook `useStepProgress` utilise Supabase
- [ ] Services OpenAI int√©gr√©s dans Etape5.tsx
- [ ] **Fonction `updateGenerationStatus` cr√©√©e dans Etape5.tsx** ‚úÖ CRITIQUE
- [ ] **Interface `GenerationStatus` d√©finie dans Etape5.tsx** ‚úÖ CRITIQUE
- [ ] **`generation_status` initialis√© au d√©but de la g√©n√©ration** ‚úÖ CRITIQUE
- [ ] **`generation_status` mis √† jour apr√®s CHAQUE service (7 fois)** ‚úÖ CRITIQUE
- [ ] **`completed: true` d√©fini apr√®s le 7√®me service** ‚úÖ CRITIQUE
- [ ] R√©sultats OpenAI stock√©s dans localStorage (Phase 1)
- [ ] Contexte AnnonceContext g√®re le project_id
- [ ] RLS respect√© via hooks Section 3
- [ ] Aucun nouveau composant cr√©√© (r√©utilisation existant)

### Tests Fonctionnels
- [ ] √âtape 1 : Saisie et sauvegarde dans Supabase
- [ ] √âtape 2 : Saisie et sauvegarde dans Supabase
- [ ] √âtape 3 : Saisie et sauvegarde dans Supabase
- [ ] √âtape 4 : Saisie et sauvegarde dans Supabase
- [ ] √âtape 5 : G√©n√©ration OpenAI fonctionne
- [ ] Navigation entre √©tapes pr√©serv√©e
- [ ] Validation des champs pr√©serv√©e
- [ ] Pr√©-remplissage des formulaires fonctionne
- [ ] Multi-tenant respect√© (RLS)

---

## üö® INTERDICTIONS STRICTES

| Interdiction | Raison |
|--------------|--------|
| ‚ùå Cr√©er de nouvelles pages | Les pages actuelles fonctionnent |
| ‚ùå Cr√©er de nouveaux composants formulaires | Les formulaires actuels fonctionnent |
| ‚ùå Modifier les petits composants (TextFieldForm, etc.) | Ils fonctionnent parfaitement |
| ‚ùå Modifier l'UI/UX | L'interface actuelle est valid√©e |
| ‚ùå Coder la page Animation | C'est Phase 2 |
| ‚ùå Coder l'√âtape 6 Communication | C'est Phase 2 |
| ‚ùå Stocker r√©sultats OpenAI en BDD | Phase 1 = localStorage |
| ‚ùå Cr√©er un script migration | App pas en production |
| ‚ùå Modifier les noms de champs | Respect strict camelCase/snake_case |
| ‚ùå Modifier les validations | Les r√®gles actuelles sont bonnes |

---

## üìö R√âF√âRENCES SECTIONS PR√âC√âDENTES

### Section 1 : SQL
- Table `etapes_1to5` avec 30 champs (9 syst√®me + 7 analytiques + 14 m√©tier)
- RLS multi-tenant
- Triggers et functions

### Section 2 : Utilitaires
- `validateEtape1()` ‚Üí `validateEtape4()`
- Fonctions de formatage
- Mapping Supabase ‚Üî UI

### Section 3 : Hooks React
- `useEtape1()` ‚Üí `useEtape5()` (5 hooks m√©tier)
- `useStepProgress()` (progression)
- `useSupabaseOperations()` (CRUD technique)

### Section 4 : Services OpenAI
- 7 services de g√©n√©ration
- Helpers : `getActiveOpenAIKey()`, `getProjectDataFromSupabase()`
- Mod√®le : `gpt-5-mini-2025-08-07`
- R√©sultats ‚Üí localStorage (Phase 1)

---

## üéØ R√âSUM√â FINAL

**CE QU'ON FAIT :**
1. ‚úÖ Cr√©er `AnnonceContext` pour g√©rer project_id
2. ‚úÖ Adapter 5 pages existantes (remplacer localStorage ‚Üí Supabase)
3. ‚úÖ Adapter 4 formulaires existants (props depuis parent)
4. ‚úÖ Adapter hook progression (Supabase au lieu de localStorage)
5. ‚úÖ Int√©grer services OpenAI dans Etape5.tsx

**CE QU'ON NE FAIT PAS :**
1. ‚ùå Cr√©er de nouvelles pages/composants
2. ‚ùå Modifier l'UI existante
3. ‚ùå Coder page Animation (Phase 2)
4. ‚ùå Coder √âtape 6 (Phase 2)
5. ‚ùå Script migration (pas n√©cessaire)

---

**FIN DU CAHIER DES CHARGES SECTION 5 CORRIG√â**
