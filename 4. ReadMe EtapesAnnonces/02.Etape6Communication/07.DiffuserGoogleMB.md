# üìã AUDIT TECHNIQUE EXHAUSTIF
## Canal : Copier / Diffuser sur ma Fiche Google Business Profile

---

## I. MISSION DU DOCUMENT

Ce document constitue l'**audit technique complet** du canal **"Copier / Diffuser sur ma Fiche Google Business Profile"** de l'√âtape 6 Communication. Il documente **exhaustivement** :
- L'architecture technique et le flux de donn√©es
- Les fichiers, hooks, composants et interactions
- Le syst√®me de g√©n√©ration OpenAI, de r√©cup√©ration, de modification et de copie
- Les contraintes de r√©daction Google Business Profile
- Les recommandations de migration vers Supabase

**Public cible** : D√©veloppeurs, architectes techniques, √©quipe produit.  
**Objectif** : Fournir une compr√©hension compl√®te du canal pour maintenance, √©volution et migration.

---

## II. SOMMAIRE CLIQUABLE

1. [MISSION DU DOCUMENT](#i-mission-du-document)
2. [SOMMAIRE CLIQUABLE](#ii-sommaire-cliquable)
3. [ARCHITECTURE GLOBALE - CANAL](#iii-architecture-globale---canal)
   - [3.1. Vue d'ensemble du canal](#31-vue-densemble-du-canal)
   - [3.2. Position dans √âtape 6 Communication](#32-position-dans-√©tape-6-communication)
   - [3.3. Sch√©ma Mermaid complet](#33-sch√©ma-mermaid-complet-flux-de-donn√©es)
4. [LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS](#iv-liste-exhaustive-des-fichiers-utilis√©s)
5. [SYST√àME D'ONGLETS](#v-syst√®me-donglets)
6. [PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI](#vi-processus-de-r√©cup√©ration-des-donn√©es-openai)
7. [STRUCTURE DES DONN√âES localStorage](#vii-structure-des-donn√©es-localstorage)
8. [PROCESSUS COMPLET √âTAPE PAR √âTAPE](#viii-processus-complet-√©tape-par-√©tape)
9. [SYST√àME D'√âDITION - BOUTON "MODIFIER"](#ix-syst√®me-d√©dition---bouton-modifier)
10. [OPTIONS DE COPIE](#x-options-de-copie)
11. [SYST√àME D'APER√áU](#xi-syst√®me-daper√ßu)
12. [CONTRAINTES ET VALIDATION](#xii-contraintes-et-validation)
13. [COMPOSANTS GRAPHIQUES R√âUTILISABLES](#xiii-composants-graphiques-r√©utilisables)
14. [TABLEAUX R√âCAPITULATIFS](#xiv-tableaux-r√©capitulatifs)
15. [DONN√âES √Ä PRENDRE EN CONSID√âRATION](#xv-donn√©es-√†-prendre-en-consid√©ration)

---

## III. ARCHITECTURE GLOBALE - CANAL

### 3.1. Vue d'ensemble du canal

**Nom** : Copier / Diffuser sur ma Fiche Google Business Profile  
**Objectif** : Permettre √† l'utilisateur de visualiser, √©diter et copier une **Annonce Google Business Profile** g√©n√©r√©e par OpenAI, personnaliser l'URL et la photo de couverture, puis (inactivement) envoyer le post vers Zoho Social.

**Fonctionnalit√©s principales** :
1. **Onglet 1** : Affichage et √©dition de l'annonce Google (4 champs : titre, accroche, points forts, appel √† l'action)
2. **Onglet 2** : Personnalisation de l'URL et upload de la photo de couverture (redimensionn√©e 720x540)
3. **Onglet 3** : Copie au format texte + Envoi via Zoho Social (inactif)

### 3.2. Position dans √âtape 6 Communication

**Chemin de navigation** :  
`/etape6communication` ‚Üí S√©lection de `"diffuser-google-business"` ‚Üí Rendu de ``

**Fichier parent** : `src/1.etapes-restitution-utilisateur/0.Etape6Communication/Etape6Communication.tsx` (lignes 16, 112-116)

```typescript
// Ligne 16
import AccueilDiffuserGoogleAnnonce from "@/components/1-Sources-Restitution-Utilisateur/6.EtapeDiffuserGoogleAnnonce/AccueilDiffuserGoogleAnnonce";

// Lignes 112-116
{selectedOption === "diffuser-google-business" && (

)}
```

### 3.3. Sch√©ma Mermaid complet (flux de donn√©es)

```mermaid
graph TD
    A[√âtape 6 Communication] -->|selectedOption = diffuser-google-business| B[AccueilDiffuserGoogleAnnonce]

    B --> C[MenuOngletDiffuserGoogle]
    C --> D[Onglet 1: AnnonceGoogle]
    C --> E[Onglet 2: PersonnaliserGoogle]
    C --> F[Onglet 3: ActionUtilisateurGoogle]

    %% Onglet 1
    D --> G[Hook-1-RecuperationDataGoogle]
    G --> H{localStorage}
    H -->|1. Priorit√©| I[key-modifs-diffuser-google-annonce]
    H -->|2. Fallback| J[generation_googleprofile_ad]
    G --> K[cleanOpenAIContent: \\n\\n ‚Üí sauts ligne]

    %% Onglet 2
    E --> L[Hook-2-PersonnaliserUrl]
    E --> M[Hook-2-PersonnaliserPhoto]
    L --> N[key-modifs-url-annonce-google]
    M --> O[Canvas resize 720x540]
    O --> P[key-modifs-photo-annonce-google]
    M --> Q[GraphismeUploadPhoto]

    %% Onglet 3
    F --> R[Hook-3-UtiliserCopierTexte]
    F --> S[Hook-3-UtiliserZohoFonctionEnvoi INACTIF]
    F --> T[Hook-3-UtiliserApercuGoogle]

    R --> U[Copier Annonce + URL format Texte]
    T --> V[Aper√ßu temps r√©el: Annonce, URL, Photo]
    V --> W[window.addEventListener storage + setInterval]

    %% OpenAI
    X[OpenAI API] --> Y[2.API-AnnonceGoogleBusinessProfile.ts]
    Y --> Z[6.PromptGoogleBusinessProfileAnnonce.ts]
    Z --> AA[Directives: Titre, Accroche, Points Forts, CTA]
    AA --> AB{R√©ponse JSON}
    AB --> AC[TitreAnnonceGoogle]
    AB --> AD[AccrocheDescriptiveAnnonceGoogle]
    AB --> AE[PointsFortsAnnonceGoogle]
    AB --> AF[CtaAnnonceGoogle]
    AC --> J
    AD --> J
    AE --> J
    AF --> J

    %% √âdition
    D --> AG[EditeurWYSIWYG toolbar=false]
    AG --> AH[Sauvegarde automatique ‚Üí localStorage]
    AH --> I

    %% Composants graphiques
    D --> AI[GraphismeInterieurDiffuserGoogle]
    AI --> AJ[LabelGoogleAnnonce]
    AI --> AK[ReadOnlyGoogleAnnonce]
    AI --> AL[EditableGoogleAnnonce]
    AI --> AM[CopyGoogleOption]
    AI --> AN[GoogleAnnoncePreview]

    style J fill:#e1f5ff
    style I fill:#ffe1e1
    style X fill:#fff4e1
    style S fill:#f0f0f0,stroke-dasharray: 5 5
```

---

## IV. LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS

### 4.1. Fichiers de composition

| Fichier | R√¥le | Lignes cl√©s |
|---------|------|-------------|
| `AccueilDiffuserGoogleAnnonce.tsx` | **Conteneur principal** du canal, g√®re l'√©tat global `editMode` et transmet les onglets au `MenuOnglet` | 1-68 |
| `MenuOngletDiffuserGoogle.tsx` | **Syst√®me d'onglets** avec bouton Modifier/Sauvegarder sur onglets 1 et 2 | 31-178 |
| `File1.AnnonceGoogle.tsx` | **Onglet 1** : Affichage et √©dition de l'annonce Google (4 champs) | R√©sum√© fourni |
| `File2.PersonnaliserGoogle.tsx` | **Onglet 2** : Personnalisation URL + Upload photo de couverture (720x540) | 1-176 |
| `File3.ActionUtilisateurGoogle.tsx` | **Onglet 3** : Options de copie et envoi (Zoho inactif) | 1-30 |

### 4.2. Hooks de r√©cup√©ration

| Hook | Fonction | Fichier | Lignes cl√©s |
|------|----------|---------|-------------|
| `useRecuperationDataGoogle` | R√©cup√®re annonce Google depuis localStorage (`key-modifs` > `generation_googleprofile_ad`), nettoie `\\n\\n` ‚Üí `\n\n` | `Hook-1-RecuperationDataGoogle.ts` | 18-73 |
| `usePersonnaliserUrl` | G√®re l'URL de l'annonce (`key-modifs-url-annonce-google`) | `Hook-2-PersonnaliserUrl.tsx` | 8-44 |
| `usePersonnaliserPhoto` | Traite et stocke la photo (resize 720x540, base64, `key-modifs-photo-annonce-google`) | `Hook-2-PersonnaliserPhoto.tsx` (r√©sum√©) | - |

### 4.3. Hooks d'aper√ßu

| Hook | Fonction | Fichier | Lignes cl√©s |
|------|----------|---------|-------------|
| `HookUtiliserApercuGoogle` | Affiche aper√ßus temps r√©el (Annonce, URL, Photo) avec `window.addEventListener('storage')` + `setInterval` | `Hook-3-UtiliserApercuGoogle.tsx` (r√©sum√©) | - |

### 4.4. Hooks de copie et envoi

| Hook | Fonction | Fichier | Lignes cl√©s |
|------|----------|---------|-------------|
| `HookUtiliserCopierTexte` | **Copie format texte** : Annonce + URL (double saut de ligne entre les deux) | `Hook-3-UtiliserCopierTexte.tsx` | 12-90 |
| `HookUtiliserZohoFonctionEnvoi` | **Envoi Zoho Social** (INACTIF, toast "Fonction en pr√©paration") | `Hook-3-UtiliserZohoFonctionEnvoi.tsx` | 6-27 |
| `HookUtiliserZoho` | **Alias Zoho** (INACTIF, toast "En pr√©paration") | `Hook-3-UtiliserZoho.tsx` | 6-27 |

### 4.5. Composants graphiques

| Composant | Fonction | Fichier | Lignes |
|-----------|----------|---------|--------|
| `GraphismeInterieurDiffuserGoogle.tsx` | **Biblioth√®que UI** : Labels, champs R/O et √©ditables, aper√ßus, options de copie | `GraphismeInterieurDiffuserGoogle.tsx` | 1-337 |
| `EditeurWYSIWYG.tsx` | **√âditeur de texte** avec emojis, **toolbar d√©sactiv√©** | `EditeurWYSIWYG.tsx` | 1-194 |
| `GraphismeUploadPhoto.tsx` | **Upload photo** avec drag & drop et info format Google (720x540) | `GraphismeUploadPhoto.tsx` | 1-97 |

### 4.6. Arborescence compl√®te avec descriptions

```
src/components/1-Sources-Restitution-Utilisateur/6.EtapeDiffuserGoogleAnnonce/
‚îú‚îÄ‚îÄ AccueilDiffuserGoogleAnnonce.tsx         # Conteneur principal, gestion editMode global
‚îú‚îÄ‚îÄ MenuOngletDiffuserGoogle.tsx              # Syst√®me d'onglets + bouton Modifier/Sauvegarder
‚îú‚îÄ‚îÄ File1.AnnonceGoogle.tsx                   # Onglet 1 : Annonce Google (4 champs)
‚îú‚îÄ‚îÄ File2.PersonnaliserGoogle.tsx             # Onglet 2 : URL + Photo de couverture
‚îú‚îÄ‚îÄ File3.ActionUtilisateurGoogle.tsx         # Onglet 3 : Copie Texte + Envoi Zoho (inactif)
‚îú‚îÄ‚îÄ Hook-1-RecuperationDataGoogle.ts          # R√©cup√©ration annonce depuis localStorage
‚îú‚îÄ‚îÄ Hook-2-PersonnaliserUrl.tsx               # Gestion URL annonce
‚îú‚îÄ‚îÄ Hook-2-PersonnaliserPhoto.tsx             # Traitement photo (resize 720x540)
‚îú‚îÄ‚îÄ Hook-3-UtiliserCopierTexte.tsx            # Copie format texte (Annonce + URL)
‚îú‚îÄ‚îÄ Hook-3-UtiliserZoho.tsx                   # Envoi Zoho (inactif)
‚îú‚îÄ‚îÄ Hook-3-UtiliserZohoFonctionEnvoi.tsx      # Envoi Zoho (inactif, doublon)
‚îú‚îÄ‚îÄ Hook-3-UtiliserApercuGoogle.tsx           # Aper√ßus temps r√©el (Annonce, URL, Photo)
‚îú‚îÄ‚îÄ GraphismeInterieurDiffuserGoogle.tsx      # Composants UI r√©utilisables
‚îú‚îÄ‚îÄ EditeurWYSIWYG.tsx                        # √âditeur texte + emojis (toolbar off)
‚îî‚îÄ‚îÄ GraphismeUploadPhoto.tsx                  # Upload photo drag & drop
```

**Services OpenAI** :
```
src/services/openai/1.GenerateurAnnoncesOutilsSeo/
‚îú‚îÄ‚îÄ 0.APIAutresFonctionsLeadGenAI/
‚îÇ   ‚îî‚îÄ‚îÄ 2.API-AnnonceGoogleBusinessProfile.ts   # Service OpenAI Google Business Profile
‚îî‚îÄ‚îÄ 7.PromptsOpenAi/
    ‚îî‚îÄ‚îÄ 6.PromptGoogleBusinessProfileAnnonce.ts  # Prompt Google (533 lignes, directives strictes)
```

---

## V. SYST√àME D'ONGLETS

### 5.1. MenuOnglet

**Fichier** : `MenuOngletDiffuserGoogle.tsx`

**Titres des onglets** (ligne 32) :
```typescript
["Annonce Google Profile", "Personnaliser l'Annonce", "Utiliser l'Annonce"]
```

**Logique bouton Modifier** (lignes 77-79) :
```typescript
const shouldShowEditButton = (tabValue: string) => {
  return tabValue === "tab1" || tabValue === "tab2";
};
```
‚ûú Le bouton **Modifier/Sauvegarder** appara√Æt **uniquement** sur les onglets 1 et 2.

**Comportement changement d'onglet** (lignes 47-56) :
```typescript
const handleTabChange = (value: string) => {
  setActiveTab(value);
  if (editMode) {
    toggleEditMode(); // D√©sactive automatiquement le mode √©dition
  }
  if (onTabChange) onTabChange(value);
};
```

**Toast de sauvegarde** (lignes 59-74) :
```typescript
const toggleEditMode = () => {
  const newEditMode = !editMode;
  setEditMode(newEditMode);

  if (!newEditMode) {
    toast({
      title: "Modifications sauvegard√©es",
      description: "Les changements ont √©t√© enregistr√©s avec succ√®s."
    });
  }

  if (onEditModeChange) {
    onEditModeChange(newEditMode);
  }
};
```

### 5.2. Onglet 1 : Annonce Google Profile

**Fichier** : `File1.AnnonceGoogle.tsx`

**Champs affich√©s** :
1. **Titre de l'Annonce Google** (`titre`) ‚Äî 1 ligne
2. **Accroche Descriptive de l'Annonce Google** (`accroche`) ‚Äî 3 lignes, **WYSIWYG**
3. **Rappel des Points Forts de l'Annonce Google** (`pointsForts`) ‚Äî 7 lignes, **WYSIWYG**
4. **Call to Action de l'Annonce Google** (`appelAction`) ‚Äî 2 lignes

**Hook utilis√©** : `useRecuperationDataGoogle()`

**√âdition** :
- Mode lecture seule : `ReadOnlyGoogleAnnonce`
- Mode √©dition : `EditableGoogleAnnonce` (sauf `accroche` et `pointsForts` qui utilisent `EditeurWYSIWYG`)
- Sauvegarde : **Automatique et imm√©diate** dans `localStorage` via `updateAnnonceGoogle()`

### 5.3. Onglet 2 : Personnaliser l'Annonce

**Fichier** : `File2.PersonnaliserGoogle.tsx`

**Champs affich√©s** :
1. **URL de l'annonce** (`urlAnnonce`)  
   - Hook : `usePersonnaliserUrl()`  
   - Stockage : `key-modifs-url-annonce-google`  
   - Format : Texte brut (1 ligne)

2. **Photo de couverture du post** (`photoUrl`)  
   - Hook : `usePersonnaliserPhoto()`  
   - Stockage : `key-modifs-photo-annonce-google` (base64)  
   - Format : **Redimensionn√©e automatiquement √† 720x540 pixels** (Canvas)  
   - Upload : `GraphismeUploadPhoto` (drag & drop ou parcourir)  
   - Actions : Changer d'image / Supprimer

**Particularit√©s photo** (lignes 86-99, 95-99, 156-161) :
- **Message UX sauvegarde** : "‚ö†Ô∏è N'oubliez pas de cliquer sur le bouton 'Sauvegarder' pour enregistrer votre image"
- **Info format** : "Image optimis√©e au format recommand√© par Google (720x540)"
- **Aspect ratio** : `4:3`, `objectFit: cover`

### 5.4. Onglet 3 : Utiliser l'Annonce

**Fichier** : `File3.ActionUtilisateurGoogle.tsx`

**Structure** (lignes 8-30) :
```typescript

  {/* Titre principal */}
  Options

  {/* Deux cadres c√¥te √† c√¥te */}

  {/* Les aper√ßus et rappels */}

```

**Options disponibles** :
1. **Copier au Format Texte** (`HookUtiliserCopierTexte`)  
   - Copie l'annonce Google + URL au format texte  
   - Ic√¥ne : `FileText`  
   - Toast : "Votre Annonce Google Business Profile a √©t√© copi√©e dans le presse-papier"

2. **Envoyer via Zoho Social** (`HookUtiliserZohoFonctionEnvoi`)  
   - **INACTIF** (toast "Fonction en pr√©paration")  
   - Ic√¥ne : `Send`

3. **Aper√ßus** (`HookUtiliserApercuGoogle`)  
   - Aper√ßu de l'Annonce Google  
   - Aper√ßu de l'URL  
   - Aper√ßu de la Photo de Couverture

### 5.5. Logique de navigation et √©tat

**√âtat global** (`AccueilDiffuserGoogleAnnonce.tsx`, lignes 15-17) :
```typescript
const [editMode, setEditMode] = useState(false);
const [annonceGoogleData, setAnnonceGoogleData] = useState({});
const [personnaliserGoogleData, setPersonnaliserGoogleData] = useState({});
```

**Propagation de l'√©tat** :
1. `AccueilDiffuserGoogleAnnonce` ‚Üí `MenuOngletDiffuserGoogle` via prop `onEditModeChange`
2. `MenuOngletDiffuserGoogle` ‚Üí `File1.AnnonceGoogle` et `File2.PersonnaliserGoogle` via prop `editMode`

**Callbacks de changement de donn√©es** (lignes 20-30) :
```typescript
const handleAnnonceGoogleDataChange = (data: any) => {
  setAnnonceGoogleData(data);
};

const handlePersonnaliserGoogleDataChange = (data: any) => {
  setPersonnaliserGoogleData(data);
};
```

---

## VI. PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI

### 6.1. Sources de donn√©es (cl√©s localStorage)

#### Donn√©es LUES

| Cl√© localStorage | Contenu | G√©n√©r√© par | Champs |
|------------------|---------|------------|--------|
| `generation_googleprofile_ad` | **Annonce Google originale OpenAI** | Service OpenAI (`2.API-AnnonceGoogleBusinessProfile.ts`) | `TitreAnnonceGoogle`, `AccrocheDescriptiveAnnonceGoogle`, `PointsFortsAnnonceGoogle`, `CtaAnnonceGoogle` |
| `key-modifs-diffuser-google-annonce` | **Modifications utilisateur de l'annonce** | Hook `updateAnnonceGoogle()` | `titre`, `accroche`, `pointsForts`, `appelAction` |
| `key-modifs-url-annonce-google` | **URL personnalis√©e** | Hook `updateUrlAnnonce()` | Texte brut (URL) |
| `key-modifs-photo-annonce-google` | **Photo de couverture** (base64) | Hook `processAndStorePhoto()` | Base64 de l'image redimensionn√©e (720x540) |

### 6.2. Logique de priorit√© (modifs > originales)

**Fichier** : `Hook-1-RecuperationDataGoogle.ts` (lignes 18-73)

```typescript
useEffect(() => {
  try {
    setIsLoading(true);

    // 1. V√©rifier d'abord s'il y a des donn√©es modifi√©es par l'utilisateur
    const donneesModifiees = localStorage.getItem('key-modifs-diffuser-google-annonce');

    if (donneesModifiees) {
      // Utiliser les donn√©es modifi√©es si elles existent (d√©j√† nettoy√©es, ne pas re-transformer)
      const dataModifiees = JSON.parse(donneesModifiees);
      setAnnonceGoogle({
        titre: dataModifiees.titre || '',
        accroche: dataModifiees.accroche || '',
        pointsForts: dataModifiees.pointsForts || '',
        appelAction: dataModifiees.appelAction || ''
      });
    } else {
      // 2. R√©cup√©rer et nettoyer les donn√©es originales d'OpenAI (seulement √† la premi√®re lecture)
      const donneesOriginales = localStorage.getItem('generation_googleprofile_ad');

      if (donneesOriginales) {
        const dataOriginales = JSON.parse(donneesOriginales);
        setAnnonceGoogle({
          titre: cleanOpenAIContent(dataOriginales.TitreAnnonceGoogle || ''),
          accroche: cleanOpenAIContent(dataOriginales.AccrocheDescriptiveAnnonceGoogle || ''),
          pointsForts: cleanOpenAIContent(dataOriginales.PointsFortsAnnonceGoogle || ''),
          appelAction: cleanOpenAIContent(dataOriginales.CtaAnnonceGoogle || '')
        });
      }
    }

    setIsLoading(false);
    setError(null);

  } catch (err) {
    console.error('Erreur lors de la r√©cup√©ration des donn√©es Google:', err);
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

**Ordre de priorit√©** :
1. **Priorit√© absolue** : `key-modifs-diffuser-google-annonce` (donn√©es utilisateur propres)
2. **Fallback** : `generation_googleprofile_ad` (donn√©es OpenAI nettoy√©es avec `cleanOpenAIContent`)
3. **D√©faut** : Cha√Ænes vides

### 6.3. Hooks de r√©cup√©ration d√©taill√©s

#### Hook `useRecuperationDataGoogle`

**Fonction `cleanOpenAIContent`** (lignes 6-12) :
```typescript
const cleanOpenAIContent = (text: string): string => {
  if (!text) return '';

  return text
    .replace(/\\n\\n/g, '\n\n')  // Convertir \\n\\n en doubles retours √† la ligne (saut de ligne)
    .replace(/\\n/g, '\n')       // Convertir \\n en simples retours √† la ligne
    .replace(/\\\\/g, '\\');     // Nettoyer les antislashs doubl√©s
};
```

**Fonction `updateAnnonceGoogle`** (lignes 75-90) :
```typescript
const updateAnnonceGoogle = (nouvellesDonnees: Partial) => {
  try {
    const donneesActuelles = { ...annonceGoogle, ...nouvellesDonnees };

    // Sauvegarder dans le localStorage avec la cl√© de modifications
    // Les donn√©es sont sauvegard√©es telles quelles (d√©j√† propres)
    localStorage.setItem('key-modifs-diffuser-google-annonce', JSON.stringify(donneesActuelles));

    // Mettre √† jour l'√©tat local
    setAnnonceGoogle(donneesActuelles);

  } catch (err) {
    console.error('Erreur lors de la sauvegarde des modifications:', err);
    setError('Erreur lors de la sauvegarde');
  }
};
```

#### Hook `usePersonnaliserUrl`

**Fichier** : `Hook-2-PersonnaliserUrl.tsx`

**Fonctions** :
- `updateUrlAnnonce(value: string)` ‚Äî Sauvegarde imm√©diate dans `key-modifs-url-annonce-google`
- `getUrlAnnonce(): string` ‚Äî R√©cup√®re l'URL depuis localStorage
- `getAllData(): PersonnaliserGoogleData` ‚Äî R√©cup√®re toutes les donn√©es

#### Hook `usePersonnaliserPhoto`

**R√©sum√©** (d'apr√®s `Hook-2-PersonnaliserPhoto.tsx`) :

**Fonctions** :
- `resizeImageWithCanvas(file: File): Promise` ‚Äî Redimensionne l'image √† **720x540 pixels** (Canvas) et retourne une string base64
- `processAndStorePhoto(file: File)` ‚Äî Traite l'image et la sauvegarde dans `key-modifs-photo-annonce-google`
- `removePhoto()` ‚Äî Supprime la photo du localStorage
- `getPhotoUrl(): string` ‚Äî R√©cup√®re l'URL de la photo
- `getAllData(): PersonnaliserPhotoData` ‚Äî R√©cup√®re toutes les donn√©es photo

**Format de stockage** : Base64 (pas de requ√™te serveur)

### 6.4. Mapping des champs OpenAI ‚Üí Interface

| Champ OpenAI (localStorage) | Champ Interface (TypeScript) | Transformation | Fichier |
|-----------------------------|------------------------------|----------------|---------|
| `TitreAnnonceGoogle` | `titre` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts:44` |
| `AccrocheDescriptiveAnnonceGoogle` | `accroche` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts:45` |
| `PointsFortsAnnonceGoogle` | `pointsForts` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts:46` |
| `CtaAnnonceGoogle` | `appelAction` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts:47` |

**Point d'attention** :  
Le champ `CtaAnnonceGoogle` est mapp√© vers `appelAction` dans l'interface, coh√©rent avec les autres canaux (ex: Portails Immobiliers). Cependant, **ici, il n'y a pas de mapping manuel** contrairement aux autres canaux : le mapping se fait directement par lecture et renommage dans le hook.

---

## VII. STRUCTURE DES DONN√âES localStorage

### 7.1. Cl√©s LUES

| Cl√© | Origine | Format | Contenu |
|-----|---------|--------|---------|
| `generation_googleprofile_ad` | OpenAI (`2.API-AnnonceGoogleBusinessProfile.ts`) | JSON | `{ TitreAnnonceGoogle, AccrocheDescriptiveAnnonceGoogle, PointsFortsAnnonceGoogle, CtaAnnonceGoogle }` |
| `key-modifs-diffuser-google-annonce` | Modifications utilisateur | JSON | `{ titre, accroche, pointsForts, appelAction }` |
| `key-modifs-url-annonce-google` | Personnalisation URL | String | URL de l'annonce (texte brut) |
| `key-modifs-photo-annonce-google` | Upload photo | String | Base64 de l'image redimensionn√©e (720x540) |

### 7.2. Cl√©s √âCRITES

| Cl√© | Fonction d'√©criture | Trigger | Contenu √©crit |
|-----|---------------------|---------|---------------|
| `key-modifs-diffuser-google-annonce` | `updateAnnonceGoogle()` | Modification d'un champ dans `File1.AnnonceGoogle` | `{ titre, accroche, pointsForts, appelAction }` (JSON) |
| `key-modifs-url-annonce-google` | `updateUrlAnnonce()` | Modification URL dans `File2.PersonnaliserGoogle` | URL (string) |
| `key-modifs-photo-annonce-google` | `processAndStorePhoto()` | Upload/changement de photo dans `File2.PersonnaliserGoogle` | Base64 de l'image (string) |

### 7.3. Interfaces TypeScript compl√®tes

#### Interface `AnnonceGoogleData` (`Hook-1-RecuperationDataGoogle.ts`)

```typescript
interface AnnonceGoogleData {
  titre: string;
  accroche: string;
  pointsForts: string;
  appelAction: string;
}
```

#### Interface `PersonnaliserGoogleData` (`Hook-2-PersonnaliserUrl.tsx`)

```typescript
interface PersonnaliserGoogleData {
  urlAnnonce: string;
}
```

#### Interface `PersonnaliserPhotoData` (d'apr√®s r√©sum√© `Hook-2-PersonnaliserPhoto.tsx`)

```typescript
interface PersonnaliserPhotoData { 
  photoUrl: string; 
  isProcessing: boolean; 
}
```

### 7.4. Tableaux r√©capitulatifs

#### Tableau des champs de l'Annonce Google

| Nom du champ | Label affich√© | Lignes (rows) | √âditeur | Nettoyage HTML | Cl√© localStorage (modifs) | Cl√© OpenAI (original) |
|--------------|---------------|---------------|---------|----------------|---------------------------|----------------------|
| `titre` | Titre de l'Annonce Google | 1 | Textarea | Non | `key-modifs-diffuser-google-annonce.titre` | `TitreAnnonceGoogle` |
| `accroche` | Accroche Descriptive de l'Annonce Google | 3 | **WYSIWYG** | Non | `key-modifs-diffuser-google-annonce.accroche` | `AccrocheDescriptiveAnnonceGoogle` |
| `pointsForts` | Rappel des Points Forts de l'Annonce Google | 7 | **WYSIWYG** | Non | `key-modifs-diffuser-google-annonce.pointsForts` | `PointsFortsAnnonceGoogle` |
| `appelAction` | Call to Action de l'Annonce Google | 2 | Textarea | Non | `key-modifs-diffuser-google-annonce.appelAction` | `CtaAnnonceGoogle` |

#### Tableau des champs de Personnalisation

| Nom du champ | Label affich√© | Type | Contraintes | Cl√© localStorage |
|--------------|---------------|------|-------------|------------------|
| `urlAnnonce` | URL de l'annonce | Texte | Aucune | `key-modifs-url-annonce-google` |
| `photoUrl` | Photo de couverture du post | Image (Base64) | **720x540 pixels** (4:3), redimensionn√©e automatiquement | `key-modifs-photo-annonce-google` |

---

## VIII. PROCESSUS COMPLET √âTAPE PAR √âTAPE

### 8.1. Chargement initial

1. **Route activ√©e** : `/etape6communication` + `selectedOption = "diffuser-google-business"`
2. **Rendu** : ``
3. **√âtat initial** : `editMode = false`
4. **Hook `useRecuperationDataGoogle`** s'ex√©cute :
   - V√©rifie `key-modifs-diffuser-google-annonce` (donn√©es utilisateur)
   - Si absent, r√©cup√®re `generation_googleprofile_ad` (OpenAI) et applique `cleanOpenAIContent()`
   - D√©finit `annonceGoogle` dans l'√©tat local
5. **Hook `usePersonnaliserUrl`** s'ex√©cute :
   - R√©cup√®re `key-modifs-url-annonce-google`
6. **Hook `usePersonnaliserPhoto`** s'ex√©cute :
   - R√©cup√®re `key-modifs-photo-annonce-google`
7. **Affichage** : Onglet 1 en mode lecture seule

### 8.2. Affichage en mode lecture seule

- **Onglet 1** : Affiche `ReadOnlyGoogleAnnonce` pour les 4 champs
- **Onglet 2** : Affiche `ReadOnlyGoogleAnnonce` pour l'URL, image de la photo (si pr√©sente)
- **Onglet 3** : Affiche les options de copie et aper√ßus (toujours en lecture seule)

### 8.3. Activation du mode √©dition

1. **Utilisateur clique** sur le bouton **"Modifier"** (onglet 1 ou 2)
2. **`MenuOngletDiffuserGoogle`** appelle `toggleEditMode()`
3. **√âtat** : `editMode = true`
4. **Propagation** : Callback `onEditModeChange(true)` ‚Üí `AccueilDiffuserGoogleAnnonce` ‚Üí `File1.AnnonceGoogle` et `File2.PersonnaliserGoogle`
5. **Affichage** : Bouton devient **"Sauvegarder"**, champs deviennent √©ditables

### 8.4. Modification des champs

#### Onglet 1 : Annonce Google

1. **Utilisateur modifie** un champ (ex: `titre`)
2. **`handleChange`** dans `File1.AnnonceGoogle` est appel√©
3. **`updateAnnonceGoogle`** sauvegarde **imm√©diatement** dans `key-modifs-diffuser-google-annonce`
4. **√âtat local** est mis √† jour
5. **Callback** `onDataChange` notifie le parent (optionnel)

#### Onglet 2 : Personnalisation

1. **URL** :
   - Modification ‚Üí `updateUrlAnnonce()` ‚Üí Sauvegarde imm√©diate dans `key-modifs-url-annonce-google`

2. **Photo** :
   - Upload ‚Üí `handleFileSelect()` ‚Üí `processAndStorePhoto()`
   - Image redimensionn√©e (Canvas 720x540)
   - Sauvegarde imm√©diate en base64 dans `key-modifs-photo-annonce-google`

### 8.5. Sauvegarde automatique

**Toutes les modifications sont sauvegard√©es automatiquement et imm√©diatement dans `localStorage`.**

Le bouton **"Sauvegarder"** :
- **NE d√©clenche PAS de sauvegarde** (d√©j√† faite automatiquement)
- **D√©sactive le mode √©dition** (`editMode = false`)
- **Affiche un toast** : "Modifications sauvegard√©es - Les changements ont √©t√© enregistr√©s avec succ√®s."

### 8.6. Copie au format Texte

1. **Utilisateur** sur onglet 3 clique sur **"Copier l'Annonce Google Business Profile"**
2. **`HookUtiliserCopierTexte`** :
   - R√©cup√®re l'annonce compl√®te via `recupererAnnonceGoogle()` (depuis `useRecuperationDataGoogle`)
   - R√©cup√®re l'URL via `getUrlAnnonce()` (depuis `usePersonnaliserUrl`)
   - Construit le texte final : `Annonce + \n\n + URL`
   - Copie dans le presse-papier (`navigator.clipboard.writeText`)
   - Affiche un toast : "Votre Annonce Google Business Profile a √©t√© copi√©e dans le presse-papier"

---

## IX. SYST√àME D'√âDITION - BOUTON "MODIFIER"

### 9.1. Localisation

**Fichier** : `MenuOngletDiffuserGoogle.tsx`

**Position** : Affich√© dans les onglets 1 et 2 (lignes 109-130, 139-160)

### 9.2. Comportement toggle (Modifier ‚Üî Sauvegarder)

**Fonction** : `toggleEditMode()` (lignes 59-74)

```typescript
const toggleEditMode = () => {
  const newEditMode = !editMode;
  setEditMode(newEditMode);

  if (!newEditMode) {
    // Si on d√©sactive le mode √©dition, on affiche un toast
    toast({
      title: "Modifications sauvegard√©es",
      description: "Les changements ont √©t√© enregistr√©s avec succ√®s."
    });
  }

  if (onEditModeChange) {
    onEditModeChange(newEditMode);
  }
};
```

**√âtats** :
- `editMode = false` ‚Üí Bouton affiche **"Modifier"** (ic√¥ne `Edit`)
- `editMode = true` ‚Üí Bouton affiche **"Sauvegarder"** (ic√¥ne `Save`)

### 9.3. Propagation de l'√©tat

1. `MenuOngletDiffuserGoogle` ‚Üí `onEditModeChange(newEditMode)`
2. `AccueilDiffuserGoogleAnnonce` ‚Üí `setEditMode(newEditMode)`
3. `AccueilDiffuserGoogleAnnonce` ‚Üí Prop `editMode` vers `File1.AnnonceGoogle` et `File2.PersonnaliserGoogle`

### 9.4. Affichage conditionnel

**Onglet 1** (`File1.AnnonceGoogle.tsx`) :
```typescript
{editMode ? (
   handleChange('titre', value)}
    rows={1}
  />
) : (

)}
```

**Onglet 2** (`File2.PersonnaliserGoogle.tsx`, lignes 49-62) :
```typescript
{editMode ? (

) : (

)}
```

### 9.5. Nettoyage HTML

**Aucun nettoyage HTML appliqu√©** dans ce canal. Les donn√©es sont stock√©es **telles quelles** dans `localStorage`.

**Raison** : Les champs `accroche` et `pointsForts` utilisent `EditeurWYSIWYG`, mais le contenu HTML n'est **pas nettoy√©** (contrairement aux canaux Newsletter ou Portails Immobiliers).

### 9.6. √âditeur WYSIWYG (EditeurWYSIWYG.tsx)

**Utilis√© pour** : `accroche` (3 lignes) et `pointsForts` (7 lignes)

**Particularit√©** : **Toolbar d√©sactiv√©** (`toolbar: false` implicitement car le composant n'affiche pas de toolbar)

**Fichier** : `EditeurWYSIWYG.tsx` (lignes 1-194)

**Fonctionnalit√©s** :
- Textarea enrichie avec emojis (6 cat√©gories)
- Insertion d'emoji √† la position du curseur
- Pas de formatage HTML (texte brut + emojis)

**Appel** (dans `File1.AnnonceGoogle.tsx`) :
```typescript
 handleChange('accroche', value)}
  rows={3}
  useWysiwyg={true}
/>
```

---

## X. OPTIONS DE COPIE

### 10.1. FORMAT TEXTE

#### A. Fichier et fonction

**Fichier** : `Hook-3-UtiliserCopierTexte.tsx`

**Fonction principale** : `copierTexteGoogle()` (lignes 66-90)

#### B. Construction du texte

**√âtape 1** : R√©cup√©rer l'annonce Google compl√®te (lignes 19-29)
```typescript
const recupererAnnonceGoogle = (): string => {
  if (dataGoogle.titre || dataGoogle.accroche || dataGoogle.pointsForts || dataGoogle.appelAction) {
    const contenuComplet = [
      dataGoogle.titre,
      dataGoogle.accroche,
      dataGoogle.pointsForts,
      dataGoogle.appelAction
    ].filter(Boolean).join('\n\n');

    return contenuComplet;
  }
  return '';
};
```

**√âtape 2** : R√©cup√©rer l'URL (lignes 32-34)
```typescript
const recupererUrlAnnonce = (): string => {
  return getUrlAnnonce();
};
```

**√âtape 3** : Construire le texte final (lignes 37-56)
```typescript
const construireTexteGoogle = (): string => {
  const annonceGoogle = recupererAnnonceGoogle().trim();
  const urlAnnonce = recupererUrlAnnonce().trim();

  let texteFinal = '';

  // Ajouter l'annonce Google Business Profile avec ses sauts de ligne
  if (annonceGoogle) {
    texteFinal += annonceGoogle;
  }

  // Ajouter double saut de ligne puis l'URL
  if (urlAnnonce) {
    if (texteFinal) {
      texteFinal += '\n\n'; // Double saut de ligne
    }
    texteFinal += urlAnnonce;
  }

  return texteFinal;
};
```

**Format final** :
```
[Titre]

[Accroche]

[Points Forts]

[Appel √† l'Action]

[URL]
```

#### C. Copie dans le presse-papier

```typescript
const copierTexteGoogle = () => {
  const texteGoogle = construireTexteGoogle();

  if (texteGoogle) {
    navigator.clipboard.writeText(texteGoogle).then(() => {
      console.log('Annonce Google copi√©e avec succ√®s:', texteGoogle);
      toast({
        title: "Succ√®s",
        description: "Votre Annonce Google Business Profile a √©t√© copi√©e dans le presse-papier",
      });
    }).catch((error) => {
      console.error('Erreur lors de la copie:', error);
      toast({
        title: "Erreur",
        description: "Impossible de copier l'annonce Google Business Profile",
        variant: "destructive",
      });
    });
  } else {
    console.warn('Aucun contenu Google √† copier');
    toast({
      title: "Attention",
      description: "Aucun contenu Google Business Profile disponible √† copier",
      variant: "destructive",
    });
  }
};
```

### 10.2. ENVOI ZOHO SOCIAL (INACTIF)

#### A. Fichier et fonction

**Fichier 1** : `Hook-3-UtiliserZohoFonctionEnvoi.tsx` (lignes 6-27)  
**Fichier 2** : `Hook-3-UtiliserZoho.tsx` (lignes 6-27) ‚Äî **Doublon**

#### B. Fonction

```typescript
const envoyerCampagneZoho = () => {
  // TODO: Int√©grer la logique d'envoi Zoho Social compl√®te

  toast({
    title: "Fonction en pr√©paration",
    description: "L'envoi via Zoho Social sera bient√¥t disponible",
    variant: "default",
  });
};
```

#### C. Recommandation

√Ä l'avenir, cette fonction devra :
1. R√©cup√©rer l'annonce compl√®te + URL + Photo
2. Formater les donn√©es selon l'API Zoho Social
3. Envoyer la requ√™te POST vers Zoho Social
4. G√©rer les erreurs et afficher un toast de confirmation

---

## XI. SYST√àME D'APER√áU

### 11.1. Hook Aper√ßu Annonce Google

**Fichier** : `Hook-3-UtiliserApercuGoogle.tsx` (r√©sum√© fourni)

**Objectif** : Afficher des aper√ßus en temps r√©el de l'annonce Google, de l'URL et de la photo de couverture.

### 11.2. Fonctions d√©taill√©es

#### Logique d'√©coute (d'apr√®s r√©sum√©)

**M√©canisme 1** : `window.addEventListener('storage')` pour d√©tecter les changements dans `localStorage`

**M√©canisme 2** : `setInterval()` pour rafra√Æchir l'aper√ßu toutes les X secondes (polling)

#### Aper√ßus affich√©s

1. **Aper√ßu de l'Annonce Google** :
   - Affiche `titre + \n\n + accroche + \n\n + pointsForts + \n\n + appelAction`
   - Composant : `GoogleAnnoncePreview`

2. **Aper√ßu de l'URL** :
   - Affiche l'URL r√©cup√©r√©e depuis `key-modifs-url-annonce-google`
   - Composant : `GoogleAnnoncePreview`

3. **Aper√ßu de la Photo de Couverture** :
   - Affiche l'image base64 r√©cup√©r√©e depuis `key-modifs-photo-annonce-google`
   - Composant : `GoogleAnnoncePreview` avec `` en `4:3`, `objectFit: cover`

### 11.3. Placeholder

Si les donn√©es sont absentes, affiche un message d'invite :
- "Cliquez sur 'Modifier' pour personnaliser ce champ"

---

## XII. CONTRAINTES ET VALIDATION

### 12.1. Validation des champs (nettoyage HTML)

**Aucun nettoyage HTML appliqu√©** dans ce canal.

**Raison** : Les donn√©es sont destin√©es √† √™tre utilis√©es **telles quelles** dans Google Business Profile et Zoho Social, qui acceptent le HTML.

### 12.2. Gestion des erreurs (loading, error)

**Fichier** : `Hook-1-RecuperationDataGoogle.ts` (lignes 18-91)

**√âtats** :
- `isLoading`: Indique si les donn√©es sont en cours de chargement
- `error`: Contient le message d'erreur si le chargement √©choue

**Affichage** (dans `File1.AnnonceGoogle.tsx`) :
```typescript
if (isLoading) {
  return Chargement...;
}

if (error) {
  return {error};
}
```

### 12.3. Toasts de notification

**Fichier** : Utilise `useToast()` de `@/hooks/use-toast`

**Cas d'usage** :
1. **Sauvegarde** : "Modifications sauvegard√©es - Les changements ont √©t√© enregistr√©s avec succ√®s." (vert)
2. **Copie r√©ussie** : "Succ√®s - Votre Annonce Google Business Profile a √©t√© copi√©e dans le presse-papier" (vert)
3. **Copie √©chou√©e** : "Erreur - Impossible de copier l'annonce Google Business Profile" (rouge)
4. **Aucun contenu** : "Attention - Aucun contenu Google Business Profile disponible √† copier" (rouge)
5. **Envoi Zoho** : "Fonction en pr√©paration - L'envoi via Zoho Social sera bient√¥t disponible" (bleu)

### 12.4. S√©curit√©

**Risques identifi√©s** :

1. **localStorage non chiffr√©** :
   - Donn√©es sensibles (annonces) stock√©es en clair
   - Accessibles via `document.cookie` ou `localStorage` en JavaScript
   - **Recommandation** : Migrer vers Supabase avec RLS

2. **Pas de validation des entr√©es** :
   - Aucune limite de caract√®res
   - Aucune validation du format URL
   - **Recommandation** : Ajouter des validations (ex: max 1500 caract√®res pour l'annonce, format URL pour l'URL)

3. **Upload photo sans validation** :
   - Accepte tous les formats d'image (`accept="image/*"`)
   - Pas de limite de taille de fichier
   - **Recommandation** : Limiter la taille (ex: 5MB max) et valider le format (JPEG, PNG, WEBP)

4. **Pas de sanitisation HTML** :
   - Bien que `EditeurWYSIWYG` soit utilis√©, aucune sanitisation n'est appliqu√©e
   - **Recommandation** : Utiliser `DOMPurify` si les donn√©es HTML sont affich√©es dans d'autres contextes

---

## XIII. COMPOSANTS GRAPHIQUES R√âUTILISABLES

### 13.1. LabelGoogleAnnonce

**Fichier** : `GraphismeInterieurDiffuserGoogle.tsx` (lignes 107-116)

**Usage** : Libell√© des champs (ex: "Titre de l'Annonce Google")

### 13.2. ReadOnlyGoogleAnnonce

**Fichier** : `GraphismeInterieurDiffuserGoogle.tsx` (lignes 125-138)

**Usage** : Affichage en lecture seule, conserve les sauts de ligne (`whitespace-pre-line`)

**Particularit√©** : **Aucune transformation HTML** (contrairement √† d'autres canaux)

### 13.3. EditableGoogleAnnonce

**Fichier** : `GraphismeInterieurDiffuserGoogle.tsx` (lignes 150-181)

**Usage** : Champs √©ditables (textarea ou WYSIWYG selon `useWysiwyg`)

**Props** :
- `useWysiwyg={true}` ‚Üí Affiche `EditeurWYSIWYG`
- `useWysiwyg={false}` ou omis ‚Üí Affiche ``

### 13.4. CopyGoogleOption

**Fichier** : `GraphismeInterieurDiffuserGoogle.tsx` (lignes 229-255)

**Usage** : Cadre d'option de copie (ex: "Copier au Format Texte")

**Props** :
- `title` : Titre de l'option
- `description` : Description de l'option
- `icon` : Ic√¥ne (ex: `<FileText>`)
- `buttonText` : Texte du bouton
- `buttonIcon` : Ic√¥ne du bouton
- `onClick` : Fonction appel√©e au clic

### 13.5. GoogleAnnoncePreview

**Fichier** : `GraphismeInterieurDiffuserGoogle.tsx` (lignes 324-337)

**Usage** : Aper√ßu des annonces Google (onglet 3)

**Particularit√©** : **Hauteur automatique** (pas de `max-height` fixe)

---

## XIV. TABLEAUX R√âCAPITULATIFS

### 14.1. Tableau des champs de l'Annonce Google

| Champ | Label | Lignes | √âditeur | Nettoyage HTML | localStorage (modifs) | OpenAI (original) |
|-------|-------|--------|---------|----------------|-----------------------|-------------------|
| `titre` | Titre de l'Annonce Google | 1 | Textarea | Non | `titre` | `TitreAnnonceGoogle` |
| `accroche` | Accroche Descriptive | 3 | **WYSIWYG** | Non | `accroche` | `AccrocheDescriptiveAnnonceGoogle` |
| `pointsForts` | Rappel des Points Forts | 7 | **WYSIWYG** | Non | `pointsForts` | `PointsFortsAnnonceGoogle` |
| `appelAction` | Call to Action | 2 | Textarea | Non | `appelAction` | `CtaAnnonceGoogle` |

### 14.2. Tableau des champs de Personnalisation

| Champ | Label | Type | Contraintes | localStorage |
|-------|-------|------|-------------|--------------|
| `urlAnnonce` | URL de l'annonce | Texte | Aucune | `key-modifs-url-annonce-google` |
| `photoUrl` | Photo de couverture | Image (Base64) | **720x540 px** (4:3) | `key-modifs-photo-annonce-google` |

### 14.3. Tableau des hooks

| Hook | Fonction | Retour | Fichier |
|------|----------|--------|---------|
| `useRecuperationDataGoogle` | R√©cup√©ration annonce Google | `{ annonceGoogle, updateAnnonceGoogle, isLoading, error }` | `Hook-1-RecuperationDataGoogle.ts` |
| `usePersonnaliserUrl` | Gestion URL | `{ personnaliserData, updateUrlAnnonce, getUrlAnnonce, getAllData }` | `Hook-2-PersonnaliserUrl.tsx` |
| `usePersonnaliserPhoto` | Gestion photo (resize 720x540) | `{ photoData, processAndStorePhoto, removePhoto, getPhotoUrl, getAllData }` | `Hook-2-PersonnaliserPhoto.tsx` |

### 14.4. Tableau des fonctions de copie

| Fonction | Description | Fichier | Lignes |
|----------|-------------|---------|--------|
| `copierTexteGoogle()` | Copie Annonce + URL au format texte | `Hook-3-UtiliserCopierTexte.tsx` | 66-90 |
| `envoyerCampagneZoho()` | Envoi vers Zoho Social (INACTIF) | `Hook-3-UtiliserZohoFonctionEnvoi.tsx` | 10-18 |

### 14.5. Matrice Onglets √ó Actions √ó Fichiers

| Onglet | Action | Fichier(s) concern√©(s) | Hook(s) utilis√©(s) |
|--------|--------|------------------------|-------------------|
| **1. Annonce Google Profile** | Affichage en lecture seule | `File1.AnnonceGoogle.tsx` | `useRecuperationDataGoogle` |
| **1. Annonce Google Profile** | √âdition des 4 champs | `File1.AnnonceGoogle.tsx`, `EditeurWYSIWYG.tsx` | `useRecuperationDataGoogle`, `updateAnnonceGoogle` |
| **2. Personnaliser l'Annonce** | √âdition URL | `File2.PersonnaliserGoogle.tsx` | `usePersonnaliserUrl`, `updateUrlAnnonce` |
| **2. Personnaliser l'Annonce** | Upload photo (720x540) | `File2.PersonnaliserGoogle.tsx`, `GraphismeUploadPhoto.tsx` | `usePersonnaliserPhoto`, `processAndStorePhoto` |
| **3. Utiliser l'Annonce** | Copie format texte | `Hook-3-UtiliserCopierTexte.tsx` | `useRecuperationDataGoogle`, `usePersonnaliserUrl` |
| **3. Utiliser l'Annonce** | Envoi Zoho (inactif) | `Hook-3-UtiliserZohoFonctionEnvoi.tsx` | - |
| **3. Utiliser l'Annonce** | Aper√ßus temps r√©el | `Hook-3-UtiliserApercuGoogle.tsx` | `useRecuperationDataGoogle`, `usePersonnaliserUrl`, `usePersonnaliserPhoto` |

---

## XV. DONN√âES √Ä PRENDRE EN CONSID√âRATION

### 15.1. Points d'attention techniques

1. **Redimensionnement photo 720x540** :
   - Utilise Canvas pour redimensionner l'image
   - Format 4:3, `objectFit: cover`
   - Stockage en base64 (attention √† la taille dans `localStorage`)

2. **Double sauts de ligne** :
   - `cleanOpenAIContent()` transforme `\\n\\n` ‚Üí `\n\n`
   - Importante pour la lisibilit√© de l'annonce Google

3. **Pas de nettoyage HTML** :
   - Contrairement aux autres canaux, aucun `stripHtmlTags()` appliqu√©
   - Les donn√©es WYSIWYG sont conserv√©es telles quelles

4. **Aper√ßus temps r√©el** :
   - Utilise `window.addEventListener('storage')` + `setInterval()`
   - Permet de visualiser les changements sans recharger la page

5. **Envoi Zoho inactif** :
   - Fonctionnalit√© pr√©vue pour l'avenir
   - N√©cessitera l'int√©gration de l'API Zoho Social

### 15.2. D√©pendances critiques

1. **localStorage** :
   - Toutes les donn√©es sont stock√©es en `localStorage`
   - **Risque** : Perte de donn√©es si l'utilisateur vide le cache
   - **Recommandation** : Migrer vers Supabase

2. **OpenAI API** :
   - G√©n√©ration de l'annonce Google via `2.API-AnnonceGoogleBusinessProfile.ts`
   - Prompt de 533 lignes avec directives strictes (`6.PromptGoogleBusinessProfileAnnonce.ts`)

3. **Canvas API** :
   - Redimensionnement de la photo
   - **Limitation** : Peut ne pas fonctionner sur certains navigateurs anciens

4. **Clipboard API** :
   - `navigator.clipboard.writeText()`
   - **Limitation** : N√©cessite HTTPS ou localhost

### 15.3. Fonctions cl√©s √† pr√©server

1. **`cleanOpenAIContent()`** (lignes 6-12, `Hook-1-RecuperationDataGoogle.ts`) :
   - Transformation `\\n\\n` ‚Üí `\n\n` pour les sauts de ligne
   - **Critique** : Sans cette fonction, l'annonce Google serait illisible

2. **`processAndStorePhoto()`** (`Hook-2-PersonnaliserPhoto.tsx`) :
   - Redimensionnement 720x540 pixels
   - Stockage en base64
   - **Critique** : Format recommand√© par Google Business Profile

3. **`construireTexteGoogle()`** (lignes 37-56, `Hook-3-UtiliserCopierTexte.tsx`) :
   - Assemblage de l'annonce compl√®te + URL
   - Double saut de ligne entre les sections
   - **Critique** : Format attendu par Google Business Profile

### 15.4. Mapping OpenAI ‚Üí Interface

#### Tableau de mapping

| Champ OpenAI | Champ Interface | Transformation | Fichier | Ligne |
|--------------|-----------------|----------------|---------|-------|
| `TitreAnnonceGoogle` | `titre` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts` | 44 |
| `AccrocheDescriptiveAnnonceGoogle` | `accroche` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts` | 45 |
| `PointsFortsAnnonceGoogle` | `pointsForts` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts` | 46 |
| `CtaAnnonceGoogle` | `appelAction` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataGoogle.ts` | 47 |

#### Point d'attention critique

**Le champ `CtaAnnonceGoogle` est mapp√© vers `appelAction`** dans l'interface utilisateur. Ce mapping est coh√©rent avec les autres canaux (ex: Portails Immobiliers), mais il diff√®re du nom original OpenAI.

**Contrairement aux autres canaux**, ici **le mapping se fait directement dans le hook** `useRecuperationDataGoogle` lors de la lecture du `localStorage`, et non dans une fonction de transformation d√©di√©e.

**Code concern√©** (lignes 42-47) :
```typescript
const dataOriginales = JSON.parse(donneesOriginales);
setAnnonceGoogle({
  titre: cleanOpenAIContent(dataOriginales.TitreAnnonceGoogle || ''),
  accroche: cleanOpenAIContent(dataOriginales.AccrocheDescriptiveAnnonceGoogle || ''),
  pointsForts: cleanOpenAIContent(dataOriginales.PointsFortsAnnonceGoogle || ''),
  appelAction: cleanOpenAIContent(dataOriginales.CtaAnnonceGoogle || '')
});
```


