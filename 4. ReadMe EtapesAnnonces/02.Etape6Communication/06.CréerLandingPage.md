# üìã DOCUMENTATION TECHNIQUE EXHAUSTIVE
## CANAL : Cr√©er une Landing Page Annonce D√©di√©e

---

## I. MISSION DU DOCUMENT

Ce document d√©taille **l'architecture technique compl√®te** du canal **"Cr√©er une Landing Page Annonce D√©di√©e"** dans l'√©cosyst√®me **LeadGenAI FormPresenca**.

**Objectif du canal :**
- Permettre √† l'utilisateur de **visualiser**, **√©diter** et **sauvegarder** deux types d'annonces g√©n√©r√©es par OpenAI :
  1. **Annonce Landing Page** (4 champs : titre, accroche, descriptif, appel √† l'action)
  2. **Synth√®se Landing Page** (5 champs : titre, r√©f√©rence & prix, d√©tails cl√©s, donn√©es financi√®res, informations compl√©mentaires)
- Pr√©parer les donn√©es pour une **future g√©n√©ration de Landing Page via Brevo**

**Fonctionnalit√©s principales :**
- ‚úÖ **Affichage en lecture seule** des annonces g√©n√©r√©es par OpenAI
- ‚úÖ **Mode √©dition** avec √©diteur WYSIWYG (ReactQuill, toolbar d√©sactiv√©e)
- ‚úÖ **Sauvegarde automatique** dans `localStorage` lors des modifications
- ‚úÖ **Aper√ßus textuels** nettoy√©s (HTML stripp√©) pour pr√©visualisation
- ‚ö†Ô∏è **Fonction de sauvegarde inactive** (bouton "Sauvegarder l'Annonce" affiche un toast "En d√©veloppement")

**Future int√©gration (pas encore impl√©ment√©e) :**
- Enregistrement dans Supabase (tables `annonces_landing_page`, `syntheses_landing_page`)
- G√©n√©ration de Landing Page via Brevo (route `/newsletter-builder`)

---

## II. SOMMAIRE CLIQUABLE

1. [Mission du Document](#i-mission-du-document)
2. [Sommaire Cliquable](#ii-sommaire-cliquable)
3. [Architecture Globale - Canal](#iii-architecture-globale---canal)
   - [3.1. Vue d'ensemble du canal](#31-vue-densemble-du-canal)
   - [3.2. Position dans √âtape 6 Communication](#32-position-dans-√©tape-6-communication)
   - [3.3. Sch√©ma Mermaid complet (flux de donn√©es)](#33-sch√©ma-mermaid-complet-flux-de-donn√©es)
4. [Liste Exhaustive des Fichiers Utilis√©s](#iv-liste-exhaustive-des-fichiers-utilis√©s)
   - [4.1. Fichiers de composition](#41-fichiers-de-composition)
   - [4.2. Hooks de r√©cup√©ration](#42-hooks-de-r√©cup√©ration)
   - [4.3. Hooks d'aper√ßu](#43-hooks-daper√ßu)
   - [4.4. Hooks de sauvegarde](#44-hooks-de-sauvegarde)
   - [4.5. Composants graphiques](#45-composants-graphiques)
   - [4.6. Arborescence compl√®te avec descriptions](#46-arborescence-compl√®te-avec-descriptions)
5. [Syst√®me d'Onglets](#v-syst√®me-donglets)
   - [5.1. MenuOngletLandingPage](#51-menuongletlandingpage)
   - [5.2. Onglet 1 : Annonce du bien](#52-onglet-1--annonce-du-bien)
   - [5.3. Onglet 2 : Synth√®se du bien](#53-onglet-2--synth√®se-du-bien)
   - [5.4. Onglet 3 : Utiliser l'Annonce](#54-onglet-3--utiliser-lannonce)
   - [5.5. Logique de navigation et √©tat](#55-logique-de-navigation-et-√©tat)
6. [Processus de R√©cup√©ration des Donn√©es OpenAI](#vi-processus-de-r√©cup√©ration-des-donn√©es-openai)
   - [6.1. Sources de donn√©es (cl√©s localStorage)](#61-sources-de-donn√©es-cl√©s-localstorage)
   - [6.2. Logique de priorit√© (modifs > originales)](#62-logique-de-priorit√©-modifs--originales)
   - [6.3. Hooks de r√©cup√©ration d√©taill√©s](#63-hooks-de-r√©cup√©ration-d√©taill√©s)
   - [6.4. Mapping des champs OpenAI ‚Üí Interface](#64-mapping-des-champs-openai--interface)
7. [Structure des Donn√©es localStorage](#vii-structure-des-donn√©es-localstorage)
   - [7.1. Cl√©s LUES](#71-cl√©s-lues)
   - [7.2. Cl√©s √âCRITES](#72-cl√©s-√©crites)
   - [7.3. Interfaces TypeScript compl√®tes](#73-interfaces-typescript-compl√®tes)
   - [7.4. Tableaux r√©capitulatifs](#74-tableaux-r√©capitulatifs)
8. [Processus Complet √âtape par √âtape](#viii-processus-complet-√©tape-par-√©tape)
   - [8.1. Chargement initial](#81-chargement-initial)
   - [8.2. Affichage en mode lecture seule](#82-affichage-en-mode-lecture-seule)
   - [8.3. Activation du mode √©dition](#83-activation-du-mode-√©dition)
   - [8.4. Modification des champs](#84-modification-des-champs)
   - [8.5. Sauvegarde automatique](#85-sauvegarde-automatique)
   - [8.6. Sauvegarde finale (inactive)](#86-sauvegarde-finale-inactive)
9. [Syst√®me d'√âdition - Bouton "Modifier"](#ix-syst√®me-d√©dition---bouton-modifier)
   - [9.1. Localisation](#91-localisation)
   - [9.2. Comportement toggle (Modifier ‚Üî Sauvegarder)](#92-comportement-toggle-modifier--sauvegarder)
   - [9.3. Propagation de l'√©tat](#93-propagation-de-l√©tat)
   - [9.4. Affichage conditionnel](#94-affichage-conditionnel)
   - [9.5. Nettoyage HTML](#95-nettoyage-html)
   - [9.6. √âditeur WYSIWYG (EditeurWYSIWYG.tsx)](#96-√©diteur-wysiwyg-editeurwysiwg)
10. [Syst√®me d'Aper√ßu](#x-syst√®me-daper√ßu)
    - [10.1. Hook Aper√ßu Annonce Landing Page](#101-hook-aper√ßu-annonce-landing-page)
    - [10.2. Hook Aper√ßu Synth√®se Landing Page](#102-hook-aper√ßu-synth√®se-landing-page)
    - [10.3. Fonctions d√©taill√©es](#103-fonctions-d√©taill√©es)
11. [Fonction de Sauvegarde (Inactive)](#xi-fonction-de-sauvegarde-inactive)
    - [11.1. Hook `usePublierLandingPage`](#111-hook-usepublierlandingpage)
    - [11.2. Bouton "Sauvegarder l'Annonce"](#112-bouton-sauvegarder-lannonce)
    - [11.3. Simulation actuelle](#113-simulation-actuelle)
12. [Contraintes et Validation](#xii-contraintes-et-validation)
    - [12.1. Validation des champs (nettoyage HTML)](#121-validation-des-champs-nettoyage-html)
    - [12.2. Gestion des erreurs (loading, error)](#122-gestion-des-erreurs-loading-error)
    - [12.3. Toasts de notification](#123-toasts-de-notification)
    - [12.4. S√©curit√©](#124-s√©curit√©)
13. [Composants Graphiques R√©utilisables](#xiii-composants-graphiques-r√©utilisables)
    - [13.1. LabelField](#131-labelfield)
    - [13.2. ReadOnlyField](#132-readonlyfield)
    - [13.3. EditableField](#133-editablefield)
    - [13.4. CopyOption3](#134-copyoption3)
    - [13.5. AnnoncePreview](#135-annoncepreview)
14. [Tableaux R√©capitulatifs](#xiv-tableaux-r√©capitulatifs)
    - [14.1. Tableau des champs Annonce Landing Page](#141-tableau-des-champs-annonce-landing-page)
    - [14.2. Tableau des champs Synth√®se Landing Page](#142-tableau-des-champs-synth√®se-landing-page)
    - [14.3. Tableau des hooks](#143-tableau-des-hooks)
    - [14.4. Tableau des fonctions de sauvegarde](#144-tableau-des-fonctions-de-sauvegarde)
    - [14.5. Matrice Onglets √ó Actions √ó Fichiers](#145-matrice-onglets--actions--fichiers)
15. [Donn√©es √† Prendre en Consid√©ration](#xv-donn√©es-√†-prendre-en-consid√©ration)
    - [15.1. Points d'attention techniques](#151-points-dattention-techniques)
    - [15.2. D√©pendances critiques](#152-d√©pendances-critiques)
    - [15.3. Fonctions cl√©s √† pr√©server](#153-fonctions-cl√©s-√†-pr√©server)
    - [15.4. Mapping OpenAI ‚Üí Interface (cta vs appelAction)](#154-mapping-openai--interface-cta-vs-appelaction)

---

## III. ARCHITECTURE GLOBALE - CANAL

### 3.1. Vue d'ensemble du canal

**Nom du canal :** Cr√©er une Landing Page Annonce D√©di√©e  
**Route :** `/etape6communication`  
**Condition d'affichage :** `selectedOption === "creer-landing-page"`  
**Composant racine :** ``

**Fonctionnement global :**
1. L'utilisateur acc√®de au canal via le menu de l'√âtape 6 Communication
2. Le composant `AccueilCreerLandingPageAnnonce` charge 3 onglets via `MenuOngletLandingPage`
3. Les onglets 1 et 2 affichent les annonces en **mode lecture seule** par d√©faut
4. L'utilisateur peut activer le **mode √©dition** via le bouton "Modifier"
5. Les modifications sont **sauvegard√©es automatiquement** dans `localStorage`
6. L'onglet 3 affiche les **aper√ßus** et propose un bouton de sauvegarde (actuellement inactif)

### 3.2. Position dans √âtape 6 Communication

**Fichier :** `src/1.etapes-restitution-utilisateur/0.Etape6Communication/Etape6Communication.tsx`

**Ligne 18 :**
```typescript
import AccueilCreerLandingPageAnnonce from "@/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/AccueilCreerLandingPageAnnonce";
```

**Lignes 69-74 (menu) :**
```typescript
{
  id: "creer-landing-page",
  title: "Cr√©er une Landing Page Annonce D√©di√©e",
  description: "",
  icon: ,
  route: "/landing-page"
}
```

**Lignes 133-135 (rendu conditionnel) :**
```typescript
if (selectedOption === "creer-landing-page") {
  return ;
}
```

### 3.3. Sch√©ma Mermaid complet (flux de donn√©es)

```mermaid
graph TD
    A[√âtape 6 Communication] -->|selectedOption = creer-landing-page| B[AccueilCreerLandingPageAnnonce]

    B --> C[MenuOngletLandingPage]

    C --> D[Onglet 1: Annonce du bien]
    C --> E[Onglet 2: Synth√®se du bien]
    C --> F[Onglet 3: Utiliser l'Annonce]

    D --> D1[File1.AnnonceLandingPage]
    D1 --> D2[useRecuperationAnnonceVersLandingPage]
    D2 --> D3{Donn√©es modifi√©es ?}
    D3 -->|OUI| D4[key-modifs-creer-landing-page-annonce]
    D3 -->|NON| D5[generation_website_ad]
    D4 --> D6[Affichage 4 champs]
    D5 --> D7[Mapping cta ‚Üí appelAction]
    D7 --> D6

    E --> E1[File2.SyntheseLandingPage]
    E1 --> E2[useRecuperationFichedeSyntheseVersLandingPage]
    E2 --> E3{Donn√©es modifi√©es ?}
    E3 -->|OUI| E4[key-modifs-creer-landing-page-synthese]
    E3 -->|NON| E5[generation_summary_sheet]
    E4 --> E6[Affichage 5 champs]
    E5 --> E6

    F --> F1[File3.ActionSauvegardeCreerLandingPage]
    F1 --> F2[useApercuAnnonceLandingPage]
    F1 --> F3[useApercuSyntheseLandingPage]
    F2 --> F4[stripHtmlTags]
    F3 --> F5[stripHtmlTags + addTitlesToSections]
    F4 --> F6[Aper√ßu Annonce]
    F5 --> F7[Aper√ßu Synth√®se]
    F1 --> F8[usePublierLandingPage]
    F8 --> F9[Bouton Sauvegarder]
    F9 --> F10[Toast: Fonctionnalit√© en d√©veloppement]

    D6 --> G[Bouton Modifier activ√© ?]
    E6 --> G
    G -->|OUI| H[EditeurWYSIWYG]
    H --> I[Modification champs]
    I --> J[updateAnnonceLandingPage / updateFichedeSyntheseLandingPage]
    J --> K[Sauvegarde automatique localStorage]
    K --> D4
    K --> E4

    G -->|NON| L[ReadOnlyField]
    L --> M[dangerouslySetInnerHTML pour descriptif/d√©tails]

    style A fill:#e1f5ff
    style B fill:#fff4e6
    style C fill:#f0e6ff
    style D fill:#e6ffe6
    style E fill:#ffe6f0
    style F fill:#fff0cc
    style F10 fill:#ffcccc
    style K fill:#ccffcc
```

---

## IV. LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS

### 4.1. Fichiers de composition

| Fichier | R√¥le | Lignes | Localisation |
|---------|------|--------|--------------|
| `AccueilCreerLandingPageAnnonce.tsx` | Composant racine du canal, g√®re l'√©tat `editMode` et orchestre les 3 onglets | 76 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/` |
| `MenuOngletLandingPage.tsx` | Syst√®me d'onglets avec bouton Modifier/Sauvegarder int√©gr√© | 175 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/` |
| `File1.AnnonceLandingPage.tsx` | Affiche et √©dite les 4 champs de l'annonce Landing Page | ~135 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/` |
| `File2.SyntheseLandingPage.tsx` | Affiche et √©dite les 5 champs de la synth√®se Landing Page | ~152 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/` |
| `File3.ActionSauvegardeCreerLandingPage.tsx` | Affiche les aper√ßus et le bouton de sauvegarde (inactif) | ~61 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/` |

### 4.2. Hooks de r√©cup√©ration

| Hook | R√¥le | Lignes | Localisation |
|------|------|--------|--------------|
| `useRecuperationAnnonceVersLandingPage` | R√©cup√®re et met √† jour les donn√©es de l'annonce Landing Page depuis `localStorage` | ~81 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/HookRecuperationAnnonceVersLandingPage.ts` |
| `useRecuperationFichedeSyntheseVersLandingPage` | R√©cup√®re et met √† jour les donn√©es de la synth√®se Landing Page depuis `localStorage` | ~81 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/HookRecuperationFichedeSyntheseVersLandingPage.ts` |

### 4.3. Hooks d'aper√ßu

| Hook | R√¥le | Lignes | Localisation |
|------|------|--------|--------------|
| `useApercuAnnonceLandingPage` | G√©n√®re l'aper√ßu textuel de l'annonce Landing Page (HTML stripp√©) | ~82 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/HookCopierApercuAnnonceLandingPage.tsx` |
| `useApercuSyntheseLandingPage` | G√©n√®re l'aper√ßu textuel de la synth√®se Landing Page (HTML stripp√© + titres de sections ajout√©s) | ~101 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/HookCopierApercuSyntheseLandingPage.tsx` |

### 4.4. Hooks de sauvegarde

| Hook | R√¥le | Lignes | Localisation |
|------|------|--------|--------------|
| `usePublierLandingPage` | G√®re la sauvegarde de l'annonce Landing Page (actuellement inactive, simule un d√©lai et affiche un toast) | ~47 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/HookPublierLandingPage.tsx` |

### 4.5. Composants graphiques

| Composant | R√¥le | Lignes | Localisation |
|-----------|------|--------|--------------|
| `GraphismeInterieurLandingPage.tsx` | Biblioth√®que de composants UI r√©utilisables (LabelField, ReadOnlyField, EditableField, CopyOption3, AnnoncePreview) | 249 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/GraphismeInterieurLandingPage.tsx` |
| `EditeurWYSIWYG.tsx` | √âditeur WYSIWYG bas√© sur ReactQuill avec toolbar d√©sactiv√©e | 90 | `src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/EditeurWYSIWYG.tsx` |

### 4.6. Arborescence compl√®te avec descriptions

```
src/components/1-Sources-Restitution-Utilisateur/8.EtapeCreerLandingPageAnnonce/
‚îÇ
‚îú‚îÄ‚îÄ AccueilCreerLandingPageAnnonce.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Composant racine, g√®re l'√©tat editMode et les callbacks onDataChange
‚îÇ
‚îú‚îÄ‚îÄ MenuOngletLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Syst√®me d'onglets avec bouton Modifier/Sauvegarder, g√®re l'√©tat editMode local
‚îÇ
‚îú‚îÄ‚îÄ File1.AnnonceLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Affiche 4 champs (titre, accroche, descriptif, appelAction)
‚îÇ   ‚îî‚îÄ‚îÄ Utilise useRecuperationAnnonceVersLandingPage
‚îÇ   ‚îî‚îÄ‚îÄ Nettoie HTML pour titre, accroche, appelAction
‚îÇ   ‚îî‚îÄ‚îÄ Pr√©serve HTML pour descriptif (dangerouslySetInnerHTML)
‚îÇ
‚îú‚îÄ‚îÄ File2.SyntheseLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Affiche 5 champs (titre, referenceEtPrix, detailsCles, donneesFinancieres, informationsComplementaires)
‚îÇ   ‚îî‚îÄ‚îÄ Utilise useRecuperationFichedeSyntheseVersLandingPage
‚îÇ   ‚îî‚îÄ‚îÄ Nettoie HTML pour titre uniquement
‚îÇ   ‚îî‚îÄ‚îÄ Pr√©serve HTML pour les 4 autres champs (dangerouslySetInnerHTML)
‚îÇ
‚îú‚îÄ‚îÄ File3.ActionSauvegardeCreerLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Affiche 2 aper√ßus (Annonce + Synth√®se)
‚îÇ   ‚îî‚îÄ‚îÄ Bouton "Sauvegarder l'Annonce" (inactif)
‚îÇ   ‚îî‚îÄ‚îÄ Utilise useApercuAnnonceLandingPage, useApercuSyntheseLandingPage, usePublierLandingPage
‚îÇ
‚îú‚îÄ‚îÄ HookRecuperationAnnonceVersLandingPage.ts
‚îÇ   ‚îî‚îÄ‚îÄ Logique de priorit√© : key-modifs-creer-landing-page-annonce > generation_website_ad
‚îÇ   ‚îî‚îÄ‚îÄ Mapping cta ‚Üí appelAction (ligne ~59)
‚îÇ   ‚îî‚îÄ‚îÄ Fonction updateAnnonceLandingPage (sauvegarde automatique)
‚îÇ
‚îú‚îÄ‚îÄ HookRecuperationFichedeSyntheseVersLandingPage.ts
‚îÇ   ‚îî‚îÄ‚îÄ Logique de priorit√© : key-modifs-creer-landing-page-synthese > generation_summary_sheet
‚îÇ   ‚îî‚îÄ‚îÄ Pas de mapping n√©cessaire (champs identiques)
‚îÇ   ‚îî‚îÄ‚îÄ Fonction updateFichedeSyntheseLandingPage (sauvegarde automatique)
‚îÇ
‚îú‚îÄ‚îÄ HookCopierApercuAnnonceLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Fonction stripHtmlTags (lignes 11-27) : pr√©serve les transitions  ‚Üí \n\n
‚îÇ   ‚îî‚îÄ‚îÄ G√©n√®re l'aper√ßu textuel de l'annonce
‚îÇ
‚îú‚îÄ‚îÄ HookCopierApercuSyntheseLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Fonction stripHtmlTags (lignes 13-23) : pr√©serve les transitions  ‚Üí \n\n
‚îÇ   ‚îî‚îÄ‚îÄ Fonction addTitlesToSections (lignes 26-43) : ajoute les titres de sections
‚îÇ   ‚îî‚îÄ‚îÄ G√©n√®re l'aper√ßu textuel de la synth√®se
‚îÇ
‚îú‚îÄ‚îÄ HookPublierLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Fonction publierAnnonceLandingPage (lignes 16-38) : simulation de sauvegarde
‚îÇ   ‚îî‚îÄ‚îÄ Retourne isPublishing, annonceLandingPage, syntheseLandingPage
‚îÇ
‚îú‚îÄ‚îÄ GraphismeInterieurLandingPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ LabelField (lignes 14-23)
‚îÇ   ‚îî‚îÄ‚îÄ ReadOnlyField (lignes 33-51)
‚îÇ   ‚îî‚îÄ‚îÄ EditableField (lignes 63-95) : int√®gre EditeurWYSIWYG ou textarea
‚îÇ   ‚îî‚îÄ‚îÄ CopyOption3 (lignes 181-213) : bouton de sauvegarde
‚îÇ   ‚îî‚îÄ‚îÄ AnnoncePreview (lignes 236-249) : conteneur d'aper√ßu
‚îÇ
‚îî‚îÄ‚îÄ EditeurWYSIWYG.tsx
    ‚îî‚îÄ‚îÄ ReactQuill avec toolbar: false (ligne 16)
    ‚îî‚îÄ‚îÄ Formats permis mais non accessibles visuellement
    ‚îî‚îÄ‚îÄ Hauteur calcul√©e selon le nombre de lignes (ligne 48)
```

---

## V. SYST√àME D'ONGLETS

### 5.1. MenuOngletLandingPage

**Fichier :** `MenuOngletLandingPage.tsx`

**Props :**
```typescript
interface MenuOngletLandingPageProps {
  tabTitles?: string[];
  tabContent1?: ReactNode;
  tabContent2?: ReactNode;
  tabContent3?: ReactNode;
  enableEditMode?: boolean;
  onTabChange?: (tabValue: string) => void;
  onEditModeChange?: (isEditMode: boolean) => void;
  className?: string;
}
```

**Valeurs par d√©faut :**
```typescript
// Ligne 32
tabTitles = ["Annonce du bien", "Synth√®se du bien", "Utiliser l'Annonce"]
```

**√âtat local :**
```typescript
// Lignes 41-42
const [activeTab, setActiveTab] = useState("tab1");
const [editMode, setEditMode] = useState(false);
```

**Bouton Modifier/Sauvegarder :**
- **Localisation :** Lignes 94-129
- **Condition d'affichage :** `enableEditMode === true` ET `activeTab === "tab1"` ou `"tab2"`
- **Ic√¥nes :** `` (mode lecture) ou `` (mode √©dition)
- **Callback :** `toggleEditMode()` (ligne 63)

**Logique du toggle :**
```typescript
// Lignes 63-85
const toggleEditMode = () => {
  if (editMode) {
    // Sortie du mode √©dition
    toast({
      title: "Modifications sauvegard√©es",
      description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s.",
    });
  }
  setEditMode(!editMode);

  // Notifier le parent
  if (onEditModeChange) {
    onEditModeChange(!editMode);
  }
};
```

### 5.2. Onglet 1 : Annonce du bien

**Composant :** `File1.AnnonceLandingPage.tsx`

**Hook utilis√© :** `useRecuperationAnnonceVersLandingPage`

**Champs affich√©s :**
1. **Titre** (ligne 56-71)
2. **Accroche** (ligne 73-88)
3. **Descriptif** (ligne 90-106)
4. **Appel √† l'action** (ligne 108-123)

**Logique de nettoyage HTML :**
```typescript
// Lignes 22-40
const handleChange = (name: string, value: string) => {
  let cleanedValue = value;
  if (name === "titre") {
    // Supprime les balises HTML pour le titre
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }
  if (name === "accroche") {
    // Supprime les balises HTML pour l'accroche
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }
  if (name === "appelAction") {
    // Supprime les balises HTML pour l'appel √† l'action
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  updateAnnonceLandingPage({ [name]: cleanedValue });

  if (onDataChange) {
    onDataChange({ ...annonceLandingPage, [name]: cleanedValue });
  }
};
```

**Affichage conditionnel :**
```typescript
// Exemple pour le champ "Titre" (lignes 62-70)
{editMode ? (
   handleChange("titre", value)}
    rows={1}
  />
) : (

)}
```

**Particularit√© :** Le champ "Descriptif" utilise `dangerouslySetInnerHTML` en mode lecture seule (ligne 102)

### 5.3. Onglet 2 : Synth√®se du bien

**Composant :** `File2.SyntheseLandingPage.tsx`

**Hook utilis√© :** `useRecuperationFichedeSyntheseVersLandingPage`

**Champs affich√©s :**
1. **Titre** (ligne 57-72)
2. **R√©f√©rence & Prix** (ligne 74-90)
3. **D√©tails cl√©s** (ligne 92-109)
4. **Donn√©es Financi√®res** (ligne 111-128)
5. **Informations Compl√©mentaires** (ligne 130-147)

**Logique de nettoyage HTML :**
```typescript
// Lignes 22-36
const handleChange = (name: string, value: string) => {
  let cleanedValue = value;
  if (name === "titre") {
    // Supprime les balises HTML uniquement pour le titre
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  updateFichedeSyntheseLandingPage({ [name]: cleanedValue });

  if (onDataChange) {
    onDataChange({ ...fichedeSyntheseLandingPage, [name]: cleanedValue });
  }
};
```

**Particularit√© :** Les champs R√©f√©rence & Prix, D√©tails cl√©s, Donn√©es Financi√®res, Informations Compl√©mentaires utilisent `dangerouslySetInnerHTML` en mode lecture seule (pr√©servent le HTML)

### 5.4. Onglet 3 : Utiliser l'Annonce

**Composant :** `File3.ActionSauvegardeCreerLandingPage.tsx`

**Hooks utilis√©s :**
- `useApercuAnnonceLandingPage()` : G√©n√®re l'aper√ßu textuel de l'annonce
- `useApercuSyntheseLandingPage()` : G√©n√®re l'aper√ßu textuel de la synth√®se
- `usePublierLandingPage()` : G√®re la sauvegarde (inactive)

**Structure :**
1. **Section : Options de sauvegarde Landing Page** (lignes 23-35)
   - Bouton "Sauvegarder l'Annonce" (inactif)
2. **Aper√ßu de l'Annonce** (lignes 37-45)
   - Affiche : `${titre}\n\n${accroche}\n\n${descriptif}\n\n${appelAction}`
3. **Aper√ßu de la Synth√®se** (lignes 47-55)
   - Affiche : `${titre}\n\n${referenceEtPrix}\n\n${detailsCles}\n\n${donneesFinancieres}\n\n${informationsComplementaires}`

**Gestion du loading et des erreurs :**
```typescript
// Lignes 40-42
content={isLoadingAnnonce ? "Chargement en cours..." : 
        errorAnnonce ? `Erreur: ${errorAnnonce}` :
        `${annonceLandingPage.titre}\n\n${annonceLandingPage.accroche}...`}
```

### 5.5. Logique de navigation et √©tat

**Gestion de l'√©tat `editMode` :**

```mermaid
graph LR
    A[AccueilCreerLandingPageAnnonce] -->|useState editMode| B[MenuOngletLandingPage]
    B -->|onEditModeChange callback| A
    B -->|prop editMode| C[File1.AnnonceLandingPage]
    B -->|prop editMode| D[File2.SyntheseLandingPage]
    C -->|Affichage conditionnel| E[EditableField vs ReadOnlyField]
    D -->|Affichage conditionnel| E
```

**Callback flow :**
```typescript
// AccueilCreerLandingPageAnnonce.tsx, lignes 67-69
onEditModeChange={(isEditMode) => {
  setEditMode(isEditMode);
}}
```

---

## VI. PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI

### 6.1. Sources de donn√©es (cl√©s localStorage)

**Cl√©s LUES :**
| Cl√© localStorage | Type de donn√©es | Description |
|------------------|----------------|-------------|
| `generation_website_ad` | JSON | Donn√©es originales de l'annonce Landing Page g√©n√©r√©es par OpenAI |
| `generation_summary_sheet` | JSON | Donn√©es originales de la synth√®se Landing Page g√©n√©r√©es par OpenAI |
| `key-modifs-creer-landing-page-annonce` | JSON | Modifications utilisateur de l'annonce Landing Page |
| `key-modifs-creer-landing-page-synthese` | JSON | Modifications utilisateur de la synth√®se Landing Page |

**Priorit√© de lecture :**
1. **1√®re priorit√© :** Donn√©es modifi√©es (`key-modifs-*`)
2. **2√®me priorit√© :** Donn√©es originales OpenAI (`generation_*`)

### 6.2. Logique de priorit√© (modifs > originales)

**Annonce Landing Page :**
```typescript
// HookRecuperationAnnonceVersLandingPage.ts, lignes 18-57
useEffect(() => {
  try {
    setIsLoading(true);

    // V√©rifier d'abord s'il existe des donn√©es modifi√©es
    const modifiedDataJson = localStorage.getItem('key-modifs-creer-landing-page-annonce');

    if (modifiedDataJson) {
      // Utiliser les donn√©es modifi√©es si elles existent
      const modifiedData = JSON.parse(modifiedDataJson);
      setAnnonceLandingPage({
        titre: modifiedData.titre || '',
        accroche: modifiedData.accroche || '',
        descriptif: modifiedData.descriptif || '',
        appelAction: modifiedData.appelAction || ''
      });
    } else {
      // Sinon, r√©cup√©ration des donn√©es originales depuis le localStorage
      const annonceLandingPageData = localStorage.getItem('generation_website_ad');

      if (annonceLandingPageData) {
        const parsedData = JSON.parse(annonceLandingPageData);
        setAnnonceLandingPage({
          titre: parsedData.titre || '',
          accroche: parsedData.accroche || '',
          descriptif: parsedData.descriptif || '',
          appelAction: parsedData.cta || '' // ‚ö†Ô∏è Mapping cta ‚Üí appelAction
        });
      }
    }

    setIsLoading(false);
  } catch (err) {
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

**Synth√®se Landing Page :**
```typescript
// HookRecuperationFichedeSyntheseVersLandingPage.ts, lignes 18-57
useEffect(() => {
  try {
    setIsLoading(true);

    const modifiedDataJson = localStorage.getItem('key-modifs-creer-landing-page-synthese');

    if (modifiedDataJson) {
      const modifiedData = JSON.parse(modifiedDataJson);
      setFichedeSyntheseLandingPage({
        titre: modifiedData.titre || '',
        referenceEtPrix: modifiedData.referenceEtPrix || '',
        detailsCles: modifiedData.detailsCles || '',
        donneesFinancieres: modifiedData.donneesFinancieres || '',
        informationsComplementaires: modifiedData.informationsComplementaires || ''
      });
    } else {
      const syntheseLandingPageData = localStorage.getItem('generation_summary_sheet');

      if (syntheseLandingPageData) {
        const parsedData = JSON.parse(syntheseLandingPageData);
        setFichedeSyntheseLandingPage({
          titre: parsedData.titre || '',
          referenceEtPrix: parsedData.referenceEtPrix || '',
          detailsCles: parsedData.detailsCles || '',
          donneesFinancieres: parsedData.donneesFinancieres || '',
          informationsComplementaires: parsedData.informationsComplementaires || ''
        });
      }
    }

    setIsLoading(false);
  } catch (err) {
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

### 6.3. Hooks de r√©cup√©ration d√©taill√©s

**Hook `useRecuperationAnnonceVersLandingPage` :**
- **Fichier :** `HookRecuperationAnnonceVersLandingPage.ts`
- **√âtat g√©r√© :** `annonceLandingPage`, `isLoading`, `error`
- **Fonction d'update :** `updateAnnonceLandingPage(newData: Partial)`
- **Sauvegarde :** Ligne 63 ‚Üí `localStorage.setItem('key-modifs-creer-landing-page-annonce', JSON.stringify(updatedData))`

**Hook `useRecuperationFichedeSyntheseVersLandingPage` :**
- **Fichier :** `HookRecuperationFichedeSyntheseVersLandingPage.ts`
- **√âtat g√©r√© :** `fichedeSyntheseLandingPage`, `isLoading`, `error`
- **Fonction d'update :** `updateFichedeSyntheseLandingPage(newData: Partial)`
- **Sauvegarde :** Ligne 63 ‚Üí `localStorage.setItem('key-modifs-creer-landing-page-synthese', JSON.stringify(updatedData))`

### 6.4. Mapping des champs OpenAI ‚Üí Interface

**Annonce Landing Page :**

| Champ OpenAI (`generation_website_ad`) | Champ Interface (`AnnonceLandingPageData`) | Fichier | Ligne |
|-----------------------------------------|---------------------------------------------|---------|-------|
| `titre` | `titre` | `HookRecuperationAnnonceVersLandingPage.ts` | 43 |
| `accroche` | `accroche` | `HookRecuperationAnnonceVersLandingPage.ts` | 44 |
| `descriptif` | `descriptif` | `HookRecuperationAnnonceVersLandingPage.ts` | 45 |
| **`cta`** | **`appelAction`** | `HookRecuperationAnnonceVersLandingPage.ts` | **46** ‚ö†Ô∏è |

**Synth√®se Landing Page (pas de mapping n√©cessaire) :**

| Champ OpenAI (`generation_summary_sheet`) | Champ Interface (`FichedeSyntheseLandingPageData`) | Coh√©rence |
|--------------------------------------------|------------------------------------------------|-----------|
| `titre` | `titre` | ‚úÖ Identique |
| `referenceEtPrix` | `referenceEtPrix` | ‚úÖ Identique |
| `detailsCles` | `detailsCles` | ‚úÖ Identique |
| `donneesFinancieres` | `donneesFinancieres` | ‚úÖ Identique |
| `informationsComplementaires` | `informationsComplementaires` | ‚úÖ Identique |

---

## VII. STRUCTURE DES DONN√âES localStorage

### 7.1. Cl√©s LUES

| Cl√© | Type | Utilisation | Hook lecteur |
|-----|------|------------|--------------|
| `generation_website_ad` | JSON | Donn√©es originales annonce OpenAI | `useRecuperationAnnonceVersLandingPage` |
| `generation_summary_sheet` | JSON | Donn√©es originales synth√®se OpenAI | `useRecuperationFichedeSyntheseVersLandingPage` |
| `key-modifs-creer-landing-page-annonce` | JSON | Modifications utilisateur annonce | `useRecuperationAnnonceVersLandingPage`, `useApercuAnnonceLandingPage` |
| `key-modifs-creer-landing-page-synthese` | JSON | Modifications utilisateur synth√®se | `useRecuperationFichedeSyntheseVersLandingPage`, `useApercuSyntheseLandingPage` |

### 7.2. Cl√©s √âCRITES

| Cl√© | Fonction d'√©criture | Hook √©crivain | D√©clenchement |
|-----|---------------------|---------------|---------------|
| `key-modifs-creer-landing-page-annonce` | `localStorage.setItem()` | `useRecuperationAnnonceVersLandingPage` | `updateAnnonceLandingPage()` appel√© √† chaque modification de champ |
| `key-modifs-creer-landing-page-synthese` | `localStorage.setItem()` | `useRecuperationFichedeSyntheseVersLandingPage` | `updateFichedeSyntheseLandingPage()` appel√© √† chaque modification de champ |

### 7.3. Interfaces TypeScript compl√®tes

**Interface `AnnonceLandingPageData` :**
```typescript
// HookRecuperationAnnonceVersLandingPage.ts, lignes 3-8
interface AnnonceLandingPageData {
  titre: string;
  accroche: string;
  descriptif: string;
  appelAction: string;
}
```

**Interface `FichedeSyntheseLandingPageData` :**
```typescript
// HookRecuperationFichedeSyntheseVersLandingPage.ts, lignes 4-10
interface FichedeSyntheseLandingPageData {
  titre: string;
  referenceEtPrix: string;
  detailsCles: string;
  donneesFinancieres: string;
  informationsComplementaires: string;
}
```

**Interface `SyntheseLandingPageData` (pour aper√ßus) :**
```typescript
// HookCopierApercuSyntheseLandingPage.tsx, lignes 4-10
interface SyntheseLandingPageData {
  titre: string;
  referenceEtPrix: string;
  detailsCles: string;
  donneesFinancieres: string;
  informationsComplementaires: string;
}
```

### 7.4. Tableaux r√©capitulatifs

**Tableau de correspondance localStorage ‚Üí Hooks :**

| Donn√©es | Cl√© localStorage originale | Cl√© localStorage modifi√©e | Hook de lecture | Hook d'aper√ßu |
|---------|---------------------------|---------------------------|-----------------|---------------|
| Annonce Landing Page | `generation_website_ad` | `key-modifs-creer-landing-page-annonce` | `useRecuperationAnnonceVersLandingPage` | `useApercuAnnonceLandingPage` |
| Synth√®se Landing Page | `generation_summary_sheet` | `key-modifs-creer-landing-page-synthese` | `useRecuperationFichedeSyntheseVersLandingPage` | `useApercuSyntheseLandingPage` |

---

## VIII. PROCESSUS COMPLET √âTAPE PAR √âTAPE

### 8.1. Chargement initial

**√âtape 1 : L'utilisateur clique sur "Cr√©er une Landing Page Annonce D√©di√©e"**
```typescript
// Etape6Communication.tsx, ligne 134
if (selectedOption === "creer-landing-page") {
  return ;
}
```

**√âtape 2 : `AccueilCreerLandingPageAnnonce` monte et initialise l'√©tat**
```typescript
// AccueilCreerLandingPageAnnonce.tsx, lignes 17-19
const [editMode, setEditMode] = useState(false);
const [annonceLandingPageData, setAnnonceLandingPageData] = useState({});
const [syntheseLandingPageData, setSyntheseLandingPageData] = useState({});
```

**√âtape 3 : `MenuOngletLandingPage` affiche l'onglet 1 par d√©faut**
```typescript
// MenuOngletLandingPage.tsx, ligne 41
const [activeTab, setActiveTab] = useState("tab1");
```

**√âtape 4 : `File1.AnnonceLandingPage` d√©clenche `useRecuperationAnnonceVersLandingPage`**
```typescript
// File1.AnnonceLandingPage.tsx, ligne 19
const { annonceLandingPage, updateAnnonceLandingPage, isLoading, error } = useRecuperationAnnonceVersLandingPage();
```

**√âtape 5 : Le hook v√©rifie `localStorage` et charge les donn√©es**
```typescript
// HookRecuperationAnnonceVersLandingPage.ts, lignes 23-46
const modifiedDataJson = localStorage.getItem('key-modifs-creer-landing-page-annonce');

if (modifiedDataJson) {
  // Charger les donn√©es modifi√©es
  const modifiedData = JSON.parse(modifiedDataJson);
  setAnnonceLandingPage({ ...modifiedData });
} else {
  // Charger les donn√©es originales OpenAI
  const annonceLandingPageData = localStorage.getItem('generation_website_ad');
  const parsedData = JSON.parse(annonceLandingPageData);
  setAnnonceLandingPage({
    titre: parsedData.titre || '',
    accroche: parsedData.accroche || '',
    descriptif: parsedData.descriptif || '',
    appelAction: parsedData.cta || '' // Mapping cta ‚Üí appelAction
  });
}
```

### 8.2. Affichage en mode lecture seule

**Par d√©faut, `editMode = false`**

**Rendu des champs :**
```typescript
// File1.AnnonceLandingPage.tsx, lignes 62-70
{editMode ? (

) : (

)}
```

**Composant `ReadOnlyField` :**
```typescript
// GraphismeInterieurLandingPage.tsx, lignes 33-51
export const ReadOnlyField: React.FC = ({ 
  id, content, isDescriptif = false, className
}) => {
  return (

      {isDescriptif ? (

      ) : (
        {content}
      )}

  );
};
```

**Champs utilisant `dangerouslySetInnerHTML` :**
- `Descriptif` (Annonce Landing Page)
- `R√©f√©rence & Prix`, `D√©tails cl√©s`, `Donn√©es Financi√®res`, `Informations Compl√©mentaires` (Synth√®se Landing Page)

### 8.3. Activation du mode √©dition

**L'utilisateur clique sur le bouton "Modifier"**
```typescript
// MenuOngletLandingPage.tsx, lignes 94-129

  {editMode ? (
    <>Sauvegarder
  ) : (
    <>Modifier
  )}

```

**Fonction `toggleEditMode` :**
```typescript
// MenuOngletLandingPage.tsx, lignes 63-85
const toggleEditMode = () => {
  if (editMode) {
    toast({
      title: "Modifications sauvegard√©es",
      description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s.",
    });
  }
  setEditMode(!editMode);

  if (onEditModeChange) {
    onEditModeChange(!editMode);
  }
};
```

**Propagation de l'√©tat :**
```typescript
// AccueilCreerLandingPageAnnonce.tsx, lignes 67-69
onEditModeChange={(isEditMode) => {
  setEditMode(isEditMode);
}}
```

### 8.4. Modification des champs

**Rendu du champ √©ditable :**
```typescript
// File1.AnnonceLandingPage.tsx, lignes 62-70
{editMode ? (
   handleChange("titre", value)}
    rows={1}
  />
) : (

)}
```

**Composant `EditableField` (avec WYSIWYG) :**
```typescript
// GraphismeInterieurLandingPage.tsx, lignes 63-95
export const EditableField: React.FC = ({ 
  id, value, onChange, rows = 3, className, useWysiwyg = false
}) => {
  if (useWysiwyg) {
    const simpleMode = rows <= 3;

    return (

    );
  }

  return (
     onChange(e.target.value)} 
      className={cn("w-full rounded-md border border-gray-200 p-3", className)}
      rows={rows}
    />
  );
};
```

**Utilisation de l'√©diteur WYSIWYG :**
```typescript
// File1.AnnonceLandingPage.tsx, ligne 98
<EditableField
  id="descriptif-landing-page"
  value={annonceLandingPage.descriptif}
  onChange={(value) => handleChange("descriptif", value)}
  rows={10}
  useWysiwyg={true} // ‚ö†Ô∏è Active EditeurWYSIWYG
/>
```

### 8.5. Sauvegarde automatique

**√Ä chaque modification, `handleChange` est appel√© :**
```typescript
// File1.AnnonceLandingPage.tsx, lignes 22-40
const handleChange = (name: string, value: string) => {
  // Nettoyage HTML pour certains champs
  let cleanedValue = value;
  if (name === "titre") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }
  if (name === "accroche") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }
  if (name === "appelAction") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  // Sauvegarde automatique dans localStorage
  updateAnnonceLandingPage({ [name]: cleanedValue });

  // Notification du parent (optionnel)
  if (onDataChange) {
    onDataChange({ ...annonceLandingPage, [name]: cleanedValue });
  }
};
```

**Fonction `updateAnnonceLandingPage` :**
```typescript
// HookRecuperationAnnonceVersLandingPage.ts, lignes 59-70
const updateAnnonceLandingPage = (newData: Partial<AnnonceLandingPageData>) => {
  const updatedData = { ...annonceLandingPage, ...newData };
  setAnnonceLandingPage(updatedData);

  try {
    // Sauvegarde des modifications dans localStorage
    localStorage.setItem('key-modifs-creer-landing-page-annonce', JSON.stringify(updatedData));
  } catch (err) {
    setError('Erreur lors de la sauvegarde des donn√©es');
  }
};
```

**‚ö†Ô∏è Point important :** La sauvegarde est **automatique et imm√©diate** √† chaque modification de champ. Le bouton "Sauvegarder" sert uniquement √† sortir du mode √©dition.

### 8.6. Sauvegarde finale (inactive)

**L'utilisateur clique sur "Sauvegarder" (bouton du menu) :**
```typescript
// MenuOngletLandingPage.tsx, lignes 63-85
const toggleEditMode = () => {
  if (editMode) {
    // Affichage du toast de confirmation
    toast({
      title: "Modifications sauvegard√©es",
      description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s.",
    });
  }
  setEditMode(!editMode);

  if (onEditModeChange) {
    onEditModeChange(!editMode);
  }
};
```

**Dans l'onglet 3, bouton "Sauvegarder l'Annonce" (inactive) :**
```typescript
// File3.ActionSauvegardeCreerLandingPage.tsx, lignes 23-35
<CopyOption3
  title="Sauvegarder cette annonce"
  description="Fonction pour utiliser cette annonce pour cr√©er votre Landing Page"
  icon={<Send className="h-5 w-5" />}
  buttons={[
    {
      text: "Sauvegarder l'Annonce",
      onClick: publierAnnonceLandingPage // ‚ö†Ô∏è Fonction inactive
    }
  ]}
/>
```

**Fonction `publierAnnonceLandingPage` (simulation) :**
```typescript
// HookPublierLandingPage.tsx, lignes 16-38
const publierAnnonceLandingPage = async () => {
  setIsPublishing(true);

  try {
    // Simulation d'un d√©lai de sauvegarde
    await new Promise(resolve => setTimeout(resolve, 1500));

    toast({
      title: "Annonce sauvegard√©e",
      description: "Votre annonce Landing Page a √©t√© sauvegard√©e avec succ√®s.",
    });
  } catch (error) {
    toast({
      title: "Erreur lors de la sauvegarde",
      description: "Une erreur est survenue lors de la sauvegarde.",
      variant: "destructive",
    });
  } finally {
    setIsPublishing(false);
  }
};
```

---

## IX. SYST√àME D'√âDITION - BOUTON "MODIFIER"

### 9.1. Localisation

**Fichier :** `MenuOngletLandingPage.tsx`

**Lignes :** 94-129

**Condition d'affichage :**
```typescript
// Ligne 93
{enableEditMode && (activeTab === "tab1" || activeTab === "tab2") && (
  <Button onClick={toggleEditMode} variant="outline">
    ...
  </Button>
)}
```

**R√©sultat :** Le bouton Modifier/Sauvegarder est affich√© **uniquement dans les onglets 1 et 2** (Annonce du bien et Synth√®se du bien), et **uniquement si `enableEditMode = true`**.

### 9.2. Comportement toggle (Modifier ‚Üî Sauvegarder)

**√âtat initial :** `editMode = false` ‚Üí Affichage "Modifier"

**1er clic (Modifier) :**
```typescript
// Lignes 63-85
const toggleEditMode = () => {
  if (editMode) {
    // Sortie du mode √©dition
    toast({
      title: "Modifications sauvegard√©es",
      description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s.",
    });
  }
  setEditMode(!editMode); // false ‚Üí true

  if (onEditModeChange) {
    onEditModeChange(!editMode); // Notifie le parent
  }
};
```

**R√©sultat :** `editMode = true` ‚Üí Affichage "Sauvegarder" + Les champs passent en mode √©dition

**2√®me clic (Sauvegarder) :**
```typescript
if (editMode) { // true
  toast({
    title: "Modifications sauvegard√©es",
    description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s.",
  });
}
setEditMode(!editMode); // true ‚Üí false
```

**R√©sultat :** `editMode = false` ‚Üí Affichage "Modifier" + Les champs repassent en mode lecture seule + Toast de confirmation

### 9.3. Propagation de l'√©tat

**Flux de propagation :**

```mermaid
graph TD
    A[MenuOngletLandingPage] -->|editMode local| B{Bouton Modifier/Sauvegarder}
    B -->|onClick toggleEditMode| C[Mise √† jour editMode local]
    C -->|onEditModeChange callback| D[AccueilCreerLandingPageAnnonce]
    D -->|setEditMode state| E[editMode parent]
    E -->|prop editMode| F[File1.AnnonceLandingPage]
    E -->|prop editMode| G[File2.SyntheseLandingPage]
    F -->|Affichage conditionnel| H[EditableField ou ReadOnlyField]
    G -->|Affichage conditionnel| H
```

**Code du callback :**
```typescript
// AccueilCreerLandingPageAnnonce.tsx, lignes 61-70
<MenuOngletLandingPage
  enableEditMode={true}
  tabContent1={contentTab1}
  tabContent2={contentTab2}
  tabContent3={contentTab3}
  className="mt-0"
  onEditModeChange={(isEditMode) => {
    setEditMode(isEditMode);
  }}
/>
```

### 9.4. Affichage conditionnel

**Dans `File1.AnnonceLandingPage.tsx` :**

**Exemple pour le champ "Titre" (lignes 56-71) :**
```typescript
<LabelField htmlFor="titre-landing-page">
  Titre de l'annonce
</LabelField>
{editMode ? (
  <EditableField
    id="titre-landing-page"
    value={annonceLandingPage.titre}
    onChange={(value) => handleChange("titre", value)}
    rows={1}
  />
) : (
  <ReadOnlyField 
    id="titre-landing-page" 
    content={annonceLandingPage.titre} 
  />
)}
```

**Exemple pour le champ "Descriptif" (lignes 90-106) :**
```typescript
<LabelField htmlFor="descriptif-landing-page">
  Descriptif complet
</LabelField>
{editMode ? (
  <EditableField
    id="descriptif-landing-page"
    value={annonceLandingPage.descriptif}
    onChange={(value) => handleChange("descriptif", value)}
    rows={10}
    useWysiwyg={true} // ‚ö†Ô∏è √âditeur WYSIWYG pour le descriptif
  />
) : (
  <ReadOnlyField 
    id="descriptif-landing-page" 
    content={annonceLandingPage.descriptif} 
    isDescriptif={true} // ‚ö†Ô∏è dangerouslySetInnerHTML activ√©
  />
)}
```

### 9.5. Nettoyage HTML

**Annonce Landing Page (3 champs nettoy√©s) :**
```typescript
// File1.AnnonceLandingPage.tsx, lignes 22-40
const handleChange = (name: string, value: string) => {
  let cleanedValue = value;
  if (name === "titre") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, ""); // Supprime les balises HTML
  }
  if (name === "accroche") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }
  if (name === "appelAction") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }
  // Le champ "descriptif" n'est PAS nettoy√© (HTML pr√©serv√©)

  updateAnnonceLandingPage({ [name]: cleanedValue });

  if (onDataChange) {
    onDataChange({ ...annonceLandingPage, [name]: cleanedValue });
  }
};
```

**Synth√®se Landing Page (1 seul champ nettoy√©) :**
```typescript
// File2.SyntheseLandingPage.tsx, lignes 22-36
const handleChange = (name: string, value: string) => {
  let cleanedValue = value;
  if (name === "titre") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, ""); // Seul le titre est nettoy√©
  }
  // Les 4 autres champs (referenceEtPrix, detailsCles, donneesFinancieres, informationsComplementaires) 
  // ne sont PAS nettoy√©s (HTML pr√©serv√©)

  updateFichedeSyntheseLandingPage({ [name]: cleanedValue });

  if (onDataChange) {
    onDataChange({ ...fichedeSyntheseLandingPage, [name]: cleanedValue });
  }
};
```

**Tableau r√©capitulatif du nettoyage HTML :**

| Champ | Annonce Landing Page | Synth√®se Landing Page |
|-------|----------------------|----------------------|
| Titre | ‚úÖ HTML nettoy√© | ‚úÖ HTML nettoy√© |
| Accroche | ‚úÖ HTML nettoy√© | N/A |
| Descriptif | ‚ùå HTML pr√©serv√© | N/A |
| Appel √† l'action | ‚úÖ HTML nettoy√© | N/A |
| R√©f√©rence & Prix | N/A | ‚ùå HTML pr√©serv√© |
| D√©tails cl√©s | N/A | ‚ùå HTML pr√©serv√© |
| Donn√©es Financi√®res | N/A | ‚ùå HTML pr√©serv√© |
| Informations Compl√©mentaires | N/A | ‚ùå HTML pr√©serv√© |

### 9.6. √âditeur WYSIWYG (EditeurWYSIWYG.tsx)

**Fichier :** `EditeurWYSIWYG.tsx`

**Biblioth√®que utilis√©e :** `react-quill` (ligne 3)

**Configuration critique :**
```typescript
// Lignes 14-24
const defaultModules = {
  toolbar: false // ‚ö†Ô∏è CHOIX STRAT√âGIQUE LEADGENAI : Barre d'outils d√©sactiv√©e
};

const formats = [
  'header',
  'bold', 'italic', 'underline', 'strike',
  'list', 'bullet'
];
```

**Pourquoi `toolbar: false` ?**
- Simplifier l'interface utilisateur (√©viter la surcharge visuelle)
- √âviter les erreurs de formatage de l'utilisateur
- L'utilisateur peut √©diter le texte, mais **pas le formater visuellement**
- Les formats sont **permis** mais **non accessibles visuellement**

**Style personnalis√© :**
```typescript
// Lignes 51-55
const editorStyle = {
  height: editorHeight,
  fontSize: '18px', // Augment√© √† 18px
  fontFamily: 'Nunito, sans-serif'
};
```

**CSS inline pour cacher la toolbar :**
```typescript
// Lignes 69-85
<style>{`
  .quill-custom-font .ql-editor {
    font-size: 18px;
    font-family: 'Nunito', sans-serif;
    line-height: 1.6;
  }

  /* Cacher la barre d'outils */
  .quill-custom-font .ql-toolbar {
    display: none;
  }

  /* Ajuster la hauteur sans la barre d'outils */
  .quill-custom-font .ql-container {
    border-top: 1px solid #ccc;
  }
`}</style>
```

**Utilisation dans `EditableField` :**
```typescript
// GraphismeInterieurLandingPage.tsx, lignes 71-84
if (useWysiwyg) {
  const simpleMode = rows <= 3;

  return (
    <EditeurWYSIWYG
      value={value}
      onChange={onChange}
      rows={rows}
      className={cn("w-full", className)}
      simpleMode={simpleMode}
    />
  );
}
```

---

## X. SYST√àME D'APER√áU

### 10.1. Hook Aper√ßu Annonce Landing Page

**Hook :** `useApercuAnnonceLandingPage`

**Fichier :** `HookCopierApercuAnnonceLandingPage.tsx`

**Fonction `stripHtmlTags` :**
```typescript
// Lignes 11-27
const stripHtmlTags = (html: string): string => {
  if (!html) return '';

  // Remplacer les balises </p><p> par des doubles sauts de ligne
  let text = html.replace(/<\/p>\s*<p>/gi, '\n\n');

  // Supprimer toutes les autres balises HTML
  text = text.replace(/<\/?[^>]+(>|$)/g, '');

  // Nettoyer les espaces multiples et les sauts de ligne en trop
  text = text.replace(/\n{3,}/g, '\n\n');
  text = text.trim();

  return text;
};
```

**Logique de priorit√© :**
```typescript
// Lignes 39-73
useEffect(() => {
  try {
    setIsLoading(true);

    // V√©rifier d'abord s'il existe des donn√©es modifi√©es
    const modifiedDataJson = localStorage.getItem('key-modifs-creer-landing-page-annonce');

    if (modifiedDataJson) {
      // Utiliser les donn√©es modifi√©es si elles existent
      const modifiedData = JSON.parse(modifiedDataJson);
      setApercuAnnonceLandingPage({
        titre: stripHtmlTags(modifiedData.titre || ''),
        accroche: stripHtmlTags(modifiedData.accroche || ''),
        descriptif: stripHtmlTags(modifiedData.descriptif || ''),
        appelAction: stripHtmlTags(modifiedData.appelAction || '')
      });
    } else {
      // Sinon, r√©cup√©ration des donn√©es originales
      const annonceLandingPageData = localStorage.getItem('generation_website_ad');

      if (annonceLandingPageData) {
        const parsedData = JSON.parse(annonceLandingPageData);
        setApercuAnnonceLandingPage({
          titre: stripHtmlTags(parsedData.titre || ''),
          accroche: stripHtmlTags(parsedData.accroche || ''),
          descriptif: stripHtmlTags(parsedData.descriptif || ''),
          appelAction: stripHtmlTags(parsedData.cta || '') // Mapping cta ‚Üí appelAction
        });
      }
    }

    setIsLoading(false);
  } catch (err) {
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

**Retour du hook :**
```typescript
// Lignes 75-80
return { 
  annonceLandingPage: ApercuAnnonceLandingPage, 
  isLoading, 
  error 
};
```

### 10.2. Hook Aper√ßu Synth√®se Landing Page

**Hook :** `useApercuSyntheseLandingPage`

**Fichier :** `HookCopierApercuSyntheseLandingPage.tsx`

**Fonction `stripHtmlTags` :**
```typescript
// Lignes 13-23
const stripHtmlTags = (html: string): string => {
  if (!html) return '';

  let text = html.replace(/<\/p>\s*<p>/gi, '\n\n');
  text = text.replace(/<\/?[^>]+(>|$)/g, '');
  text = text.replace(/\n{3,}/g, '\n\n');
  text = text.trim();

  return text;
};
```

**Fonction `addTitlesToSections` (lignes 26-43) :**
```typescript
const addTitlesToSections = (data: SyntheseLandingPageData): SyntheseLandingPageData => {
  return {
    titre: data.titre,
    referenceEtPrix: data.referenceEtPrix ? `${data.referenceEtPrix}` : '',
    detailsCles: data.detailsCles ? `Pr√©sentation | D√©tails cl√©s\n${data.detailsCles}` : '',
    donneesFinancieres: data.donneesFinancieres ? `Pr√©sentation | Donn√©es Financi√®res\n${data.donneesFinancieres}` : '',
    informationsComplementaires: data.informationsComplementaires ? `Pr√©sentation | Informations Compl√©mentaires\n${data.informationsComplementaires}` : '',
  };
};
```

**‚ö†Ô∏è Diff√©rence avec l'annonce :** La synth√®se ajoute automatiquement les **titres de sections** aux champs `detailsCles`, `donneesFinancieres`, `informationsComplementaires`.

**Logique de priorit√© :**
```typescript
// Lignes 56-91
useEffect(() => {
  try {
    setIsLoading(true);

    const modifiedDataJson = localStorage.getItem('key-modifs-creer-landing-page-synthese');

    if (modifiedDataJson) {
      const modifiedData = JSON.parse(modifiedDataJson);
      setApercuSyntheseLandingPage(addTitlesToSections({
        titre: stripHtmlTags(modifiedData.titre || ''),
        referenceEtPrix: stripHtmlTags(modifiedData.referenceEtPrix || ''),
        detailsCles: stripHtmlTags(modifiedData.detailsCles || ''),
        donneesFinancieres: stripHtmlTags(modifiedData.donneesFinancieres || ''),
        informationsComplementaires: stripHtmlTags(modifiedData.informationsComplementaires || '')
      }));
    } else {
      const syntheseLandingPageData = localStorage.getItem('generation_summary_sheet');

      if (syntheseLandingPageData) {
        const parsedData = JSON.parse(syntheseLandingPageData);
        setApercuSyntheseLandingPage(addTitlesToSections({
          titre: stripHtmlTags(parsedData.titre || ''),
          referenceEtPrix: stripHtmlTags(parsedData.referenceEtPrix || ''),
          detailsCles: stripHtmlTags(parsedData.detailsCles || ''),
          donneesFinancieres: stripHtmlTags(parsedData.donneesFinancieres || ''),
          informationsComplementaires: stripHtmlTags(parsedData.informationsComplementaires || '')
        }));
      }
    }

    setIsLoading(false);
  } catch (err) {
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

### 10.3. Fonctions d√©taill√©es

**Affichage des aper√ßus dans `File3.ActionSauvegardeCreerLandingPage.tsx` :**

**Aper√ßu Annonce (lignes 37-45) :**
```typescript
<AnnoncePreview title="Aper√ßu de l'Annonce">
  <ReadOnlyField
    id="apercu-landing-page-publier"
    content={isLoadingAnnonce ? "Chargement en cours..." : 
            errorAnnonce ? `Erreur: ${errorAnnonce}` :
            `${annonceLandingPage.titre}\n\n${annonceLandingPage.accroche}\n\n${annonceLandingPage.descriptif}\n\n${annonceLandingPage.appelAction}`}
  />
</AnnoncePreview>
```

**Aper√ßu Synth√®se (lignes 47-55) :**
```typescript
<AnnoncePreview title="Aper√ßu de la Synth√®se">
  <ReadOnlyField
    id="apercu-synthese-landing-page-publier"
    content={isLoadingSynthese ? "Chargement en cours..." : 
            errorSynthese ? `Erreur: ${errorSynthese}` :
            `${syntheseLandingPage.titre}\n\n${syntheseLandingPage.referenceEtPrix}\n\n${syntheseLandingPage.detailsCles}\n\n${syntheseLandingPage.donneesFinancieres}\n\n${syntheseLandingPage.informationsComplementaires}`}
  />
</AnnoncePreview>
```

**Structure de l'aper√ßu Synth√®se (exemple) :**
```
[Titre de la synth√®se]

R√©f√©rence : REF123
Prix : 150 000‚Ç¨

Pr√©sentation | D√©tails cl√©s
Surface : 80m¬≤
Nombre de pi√®ces : 3

Pr√©sentation | Donn√©es Financi√®res
Chiffre d'affaires : 200 000‚Ç¨
EBE : 50 000‚Ç¨

Pr√©sentation | Informations Compl√©mentaires
Emplacement : Centre-ville
√âtat : Bon √©tat g√©n√©ral
```

---

## XI. FONCTION DE SAUVEGARDE (INACTIVE)

### 11.1. Hook `usePublierLandingPage`

**Fichier :** `HookPublierLandingPage.tsx`

**√âtat g√©r√© :**
```typescript
// Lignes 7-9
const { toast } = useToast();
const [isPublishing, setIsPublishing] = useState(false);
```

**R√©cup√©ration des donn√©es :**
```typescript
// Lignes 11-12
const { annonceLandingPage } = useApercuAnnonceLandingPage();
const { syntheseLandingPage } = useApercuSyntheseLandingPage();
```

**Fonction de sauvegarde (simulation) :**
```typescript
// Lignes 16-38
const publierAnnonceLandingPage = async () => {
  setIsPublishing(true);

  try {
    // Simulation d'un d√©lai de sauvegarde
    await new Promise(resolve => setTimeout(resolve, 1500));

    toast({
      title: "Annonce sauvegard√©e",
      description: "Votre annonce Landing Page a √©t√© sauvegard√©e avec succ√®s.",
    });
  } catch (error) {
    toast({
      title: "Erreur lors de la sauvegarde",
      description: "Une erreur est survenue lors de la sauvegarde.",
      variant: "destructive",
    });
    console.error("Erreur de sauvegarde:", error);
  } finally {
    setIsPublishing(false);
  }
};
```

**Retour du hook :**
```typescript
// Lignes 40-46
return {
  publierAnnonceLandingPage,
  isPublishing,
  // Renvoyer les donn√©es des annonces pour un acc√®s facile dans le composant
  annonceLandingPage,
  syntheseLandingPage
};
```

### 11.2. Bouton "Sauvegarder l'Annonce"

**Fichier :** `File3.ActionSauvegardeCreerLandingPage.tsx`

**Utilisation du hook :**
```typescript
// Lignes 17-20
const { 
  publierAnnonceLandingPage, 
  isPublishing
} = usePublierLandingPage();
```

**Bouton de sauvegarde :**
```typescript
// Lignes 23-35
<CopyOptionsContainer>
  <CopyOption3
    title="Sauvegarder cette annonce"
    description="Fonction pour utiliser cette annonce pour cr√©er votre Landing Page"
    icon={<Send className="h-5 w-5" />}
    buttons={[
      {
        text: "Sauvegarder l'Annonce",
        onClick: publierAnnonceLandingPage
      }
    ]}
  />
</CopyOptionsContainer>
```

### 11.3. Simulation actuelle

**Fonctionnement actuel :**
1. L'utilisateur clique sur "Sauvegarder l'Annonce"
2. `setIsPublishing(true)` ‚Üí Le bouton pourrait afficher un loader (non impl√©ment√©)
3. Attente de 1,5 secondes (`await new Promise(resolve => setTimeout(resolve, 1500))`)
4. Affichage d'un toast de succ√®s : "Annonce sauvegard√©e"
5. `setIsPublishing(false)`

**Aucune action r√©elle :**
- ‚ùå Pas d'enregistrement dans Supabase
- ‚ùå Pas d'appel √† une API externe (Brevo)
- ‚ùå Pas de g√©n√©ration de Landing Page

**Future impl√©mentation (√† pr√©voir) :**
- ‚úÖ Enregistrer dans Supabase (`tables: annonces_landing_page`, `syntheses_landing_page`)
- ‚úÖ Appel √† `/newsletter-builder` (Brevo) pour g√©n√©rer la Landing Page
- ‚úÖ R√©cup√©ration de l'URL de la Landing Page g√©n√©r√©e
- ‚úÖ Affichage d'un lien vers la Landing Page dans le toast

---

## XII. CONTRAINTES ET VALIDATION

### 12.1. Validation des champs (nettoyage HTML)

**Annonce Landing Page :**

| Champ | Nettoyage HTML | R√®gle | Fichier | Ligne |
|-------|---------------|-------|---------|-------|
| Titre | ‚úÖ OUI | `value.replace(/<\/?[^>]+(>|$)/g, "")` | `File1.AnnonceLandingPage.tsx` | 25 |
| Accroche | ‚úÖ OUI | `value.replace(/<\/?[^>]+(>|$)/g, "")` | `File1.AnnonceLandingPage.tsx` | 28 |
| Descriptif | ‚ùå NON | HTML pr√©serv√© | `File1.AnnonceLandingPage.tsx` | - |
| Appel √† l'action | ‚úÖ OUI | `value.replace(/<\/?[^>]+(>|$)/g, "")` | `File1.AnnonceLandingPage.tsx` | 31 |

**Synth√®se Landing Page :**

| Champ | Nettoyage HTML | R√®gle | Fichier | Ligne |
|-------|---------------|-------|---------|-------|
| Titre | ‚úÖ OUI | `value.replace(/<\/?[^>]+(>|$)/g, "")` | `File2.SyntheseLandingPage.tsx` | 26 |
| R√©f√©rence & Prix | ‚ùå NON | HTML pr√©serv√© | `File2.SyntheseLandingPage.tsx` | - |
| D√©tails cl√©s | ‚ùå NON | HTML pr√©serv√© | `File2.SyntheseLandingPage.tsx` | - |
| Donn√©es Financi√®res | ‚ùå NON | HTML pr√©serv√© | `File2.SyntheseLandingPage.tsx` | - |
| Informations Compl√©mentaires | ‚ùå NON | HTML pr√©serv√© | `File2.SyntheseLandingPage.tsx` | - |

**Raison strat√©gique :**
- **Titres** : Doivent √™tre en texte pur (pas de formatage HTML)
- **Accroches/Appels √† l'action** : Doivent √™tre en texte pur
- **Descriptifs/D√©tails** : Peuvent contenir du HTML (gras, italique, listes, etc.) pour la richesse du contenu

### 12.2. Gestion des erreurs (loading, error)

**√âtats de chargement :**

**Hook `useRecuperationAnnonceVersLandingPage` :**
```typescript
// Lignes 14-16
const [isLoading, setIsLoading] = useState<boolean>(true);
const [error, setError] = useState<string | null>(null);
```

**Affichage conditionnel dans `File1.AnnonceLandingPage.tsx` :**
```typescript
// Lignes 42-52
if (isLoading) {
  return (
    <div className="p-4 text-center">
      <p>Chargement en cours...</p>
    </div>
  );
}

if (error) {
  return <div className="p-4 text-red-500">Erreur : {error}</div>;
}
```

**M√™me logique pour `File2.SyntheseLandingPage.tsx`**

**Hook d'aper√ßu :**
```typescript
// HookCopierApercuAnnonceLandingPage.tsx, lignes 36-38
const [isLoading, setIsLoading] = useState<boolean>(true);
const [error, setError] = useState<string | null>(null);
```

**Affichage dans `File3.ActionSauvegardeCreerLandingPage.tsx` :**
```typescript
// Lignes 40-42
content={isLoadingAnnonce ? "Chargement en cours..." : 
        errorAnnonce ? `Erreur: ${errorAnnonce}` :
        `${annonceLandingPage.titre}\n\n...`}
```

### 12.3. Toasts de notification

**Toast de sauvegarde (sortie du mode √©dition) :**
```typescript
// MenuOngletLandingPage.tsx, lignes 68-72
toast({
  title: "Modifications sauvegard√©es",
  description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s.",
});
```

**Toast de sauvegarde Landing Page (simulation) :**
```typescript
// HookPublierLandingPage.tsx, lignes 24-27
toast({
  title: "Annonce sauvegard√©e",
  description: "Votre annonce Landing Page a √©t√© sauvegard√©e avec succ√®s.",
});
```

**Toast d'erreur (sauvegarde Landing Page) :**
```typescript
// HookPublierLandingPage.tsx, lignes 29-33
toast({
  title: "Erreur lors de la sauvegarde",
  description: "Une erreur est survenue lors de la sauvegarde.",
  variant: "destructive",
});
```

### 12.4. S√©curit√©

**‚ö†Ô∏è Risque de s√©curit√© : `dangerouslySetInnerHTML`**

**Fichier :** `GraphismeInterieurLandingPage.tsx`, ligne 45

```typescript
{isDescriptif ? (
  <div className="whitespace-pre-line" dangerouslySetInnerHTML={{ __html: content }} />
) : (
  <div className="whitespace-pre-line">{content}</div>
)}
```

**Champs concern√©s :**
- `Descriptif` (Annonce Landing Page)
- `R√©f√©rence & Prix`, `D√©tails cl√©s`, `Donn√©es Financi√®res`, `Informations Compl√©mentaires` (Synth√®se Landing Page)

**Risque :**
- Si les donn√©es OpenAI ou les modifications utilisateur contiennent du **JavaScript malveillant**, celui-ci sera **ex√©cut√©**
- Exemple : `<img src="x" onerror="alert('XSS')">`

**Solution recommand√©e :**
- Utiliser **DOMPurify** pour nettoyer le HTML avant l'affichage :
  ```typescript
  import DOMPurify from 'dompurify';

  {isDescriptif ? (
    <div className="whitespace-pre-line" dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(content) }} />
  ) : (
    <div className="whitespace-pre-line">{content}</div>
  )}
  ```

**‚ö†Ô∏è Risque de s√©curit√© : `localStorage` non chiffr√©**

**Donn√©es sensibles stock√©es :**
- `key-modifs-creer-landing-page-annonce`
- `key-modifs-creer-landing-page-synthese`

**Risque :**
- Accessibles via les DevTools du navigateur
- Accessibles via JavaScript (`localStorage.getItem(...)`)
- Pas de protection si l'utilisateur partage son ordinateur

**Solution recommand√©e :**
- Migrer vers Supabase (donn√©es chiffr√©es en base)
- Impl√©menter RLS (Row Level Security) pour limiter l'acc√®s aux donn√©es

---

## XIII. COMPOSANTS GRAPHIQUES R√âUTILISABLES

### 13.1. LabelField

**Fichier :** `GraphismeInterieurLandingPage.tsx`

**Lignes :** 14-23

**Interface :**
```typescript
interface LabelFieldProps {
  htmlFor: string;
  children: ReactNode;
  className?: string;
}
```

**Composant :**
```typescript
export const LabelField: React.FC<LabelFieldProps> = ({ htmlFor, children, className }) => {
  return (
    <label 
      htmlFor={htmlFor} 
      className={cn("text-sm font-medium block mb-1", className)}
    >
      {children}
    </label>
  );
};
```

**Utilisation :**
```typescript
<LabelField htmlFor="titre-landing-page">
  Titre de l'annonce
</LabelField>
```

### 13.2. ReadOnlyField

**Fichier :** `GraphismeInterieurLandingPage.tsx`

**Lignes :** 33-51

**Interface :**
```typescript
interface ReadOnlyFieldProps {
  id: string;
  content: string;
  isDescriptif?: boolean;
  className?: string;
}
```

**Composant :**
```typescript
export const ReadOnlyField: React.FC<ReadOnlyFieldProps> = ({ 
  id, content, isDescriptif = false, className
}) => {
  return (
    <div 
      id={id} 
      className={cn("bg-white rounded-md border border-gray-200 p-3", className)}
    >
      {isDescriptif ? (
        <div className="whitespace-pre-line" dangerouslySetInnerHTML={{ __html: content }} />
      ) : (
        <div className="whitespace-pre-line">{content}</div>
      )}
    </div>
  );
};
```

**Utilisation :**
```typescript
<ReadOnlyField 
  id="titre-landing-page" 
  content={annonceLandingPage.titre} 
/>

<ReadOnlyField 
  id="descriptif-landing-page" 
  content={annonceLandingPage.descriptif} 
  isDescriptif={true} // ‚ö†Ô∏è Active dangerouslySetInnerHTML
/>
```

### 13.3. EditableField

**Fichier :** `GraphismeInterieurLandingPage.tsx`

**Lignes :** 63-95

**Interface :**
```typescript
interface EditableFieldProps {
  id: string;
  value: string;
  onChange: (value: string) => void;
  rows?: number;
  className?: string;
  useWysiwyg?: boolean;
}
```

**Composant :**
```typescript
export const EditableField: React.FC<EditableFieldProps> = ({ 
  id, value, onChange, rows = 3, className, useWysiwyg = false
}) => {
  if (useWysiwyg) {
    const simpleMode = rows <= 3;

    return (
      <EditeurWYSIWYG
        value={value}
        onChange={onChange}
        rows={rows}
        className={cn("w-full", className)}
        simpleMode={simpleMode}
      />
    );
  }

  return (
    <textarea 
      id={id} 
      value={value} 
      onChange={(e) => onChange(e.target.value)} 
      className={cn("w-full rounded-md border border-gray-200 p-3", className)}
      rows={rows}
    />
  );
};
```

**Utilisation :**
```typescript
<EditableField
  id="titre-landing-page"
  value={annonceLandingPage.titre}
  onChange={(value) => handleChange("titre", value)}
  rows={1}
/>

<EditableField
  id="descriptif-landing-page"
  value={annonceLandingPage.descriptif}
  onChange={(value) => handleChange("descriptif", value)}
  rows={10}
  useWysiwyg={true} // ‚ö†Ô∏è Active EditeurWYSIWYG
/>
```

### 13.4. CopyOption3

**Fichier :** `GraphismeInterieurLandingPage.tsx`

**Lignes :** 181-213

**Interface :**
```typescript
interface CopyOption3Props {
  title: string;
  description: string;
  icon: React.ReactNode;
  buttons: Array<{
    text: string;
    onClick: () => void;
  }>;
  className?: string;
}
```

**Composant :**
```typescript
export const CopyOption3: React.FC<CopyOption3Props> = ({
  title, description, icon, buttons, className
}) => {
  return (
    <div className={cn("border-l-4 border-l-realestate-mauve bg-white p-4 rounded-r-lg shadow-sm hover:shadow-md transition-all", className)}>
      <div className="flex items-start mb-3">
        <div className="p-2 rounded-lg bg-realestate-purple-light text-realestate-purple-dark mr-3">
          {icon}
        </div>
        <div>
          <h4 className="font-semibold">{title}</h4>
          <p className="text-sm text-gray-600">{description}</p>
        </div>
      </div>
      <div className="space-y-3">
        {buttons.map((button, index) => (
          <Button 
            key={index} 
            onClick={button.onClick} 
            className="w-full bg-realestate-mauve hover:bg-realestate-mauve-dark text-white justify-start"
          >
            <ClipboardCopy className="mr-2 h-4 w-4" />
            {button.text}
          </Button>
        ))}
      </div>
    </div>
  );
};
```

**Utilisation :**
```typescript
<CopyOption3
  title="Sauvegarder cette annonce"
  description="Fonction pour utiliser cette annonce pour cr√©er votre Landing Page"
  icon={<Send className="h-5 w-5" />}
  buttons={[
    {
      text: "Sauvegarder l'Annonce",
      onClick: publierAnnonceLandingPage
    }
  ]}
/>
```

### 13.5. AnnoncePreview

**Fichier :** `GraphismeInterieurLandingPage.tsx`

**Lignes :** 236-249

**Interface :**
```typescript
interface AnnoncePreviewProps {
  title: string;
  className?: string;
  children?: ReactNode;
}
```

**Composant :**
```typescript
export const AnnoncePreview: React.FC<AnnoncePreviewProps> = ({ 
  title, className, children
}) => {
  return (
    <div className={cn("mt-6 p-4 bg-realestate-purple-light/10 border border-realestate-purple-light rounded-lg", className)}>
      <h4 className="font-semibold mb-2">{title}</h4>
      <div className="bg-white p-4 rounded border border-gray-200 max-h-64 overflow-y-auto">
        {children}
      </div>
    </div>
  );
};
```

**Utilisation :**
```typescript
<AnnoncePreview title="Aper√ßu de l'Annonce">
  <ReadOnlyField
    id="apercu-landing-page-publier"
    content={`${annonceLandingPage.titre}\n\n${annonceLandingPage.accroche}\n\n...`}
  />
</AnnoncePreview>
```

---

## XIV. TABLEAUX R√âCAPITULATIFS

### 14.1. Tableau des champs Annonce Landing Page

| Champ | ID HTML | √âditable | Nettoyage HTML | WYSIWYG | Lignes (File1) |
|-------|---------|----------|---------------|---------|----------------|
| Titre | `titre-landing-page` | ‚úÖ OUI | ‚úÖ OUI | ‚ùå NON | 56-71 |
| Accroche | `accroche-landing-page` | ‚úÖ OUI | ‚úÖ OUI | ‚ùå NON | 73-88 |
| Descriptif | `descriptif-landing-page` | ‚úÖ OUI | ‚ùå NON | ‚úÖ OUI | 90-106 |
| Appel √† l'action | `appel-action-landing-page` | ‚úÖ OUI | ‚úÖ OUI | ‚ùå NON | 108-123 |

### 14.2. Tableau des champs Synth√®se Landing Page

| Champ | ID HTML | √âditable | Nettoyage HTML | WYSIWYG | Lignes (File2) |
|-------|---------|----------|---------------|---------|----------------|
| Titre | `titre-synthese-landing-page` | ‚úÖ OUI | ‚úÖ OUI | ‚ùå NON | 57-72 |
| R√©f√©rence & Prix | `reference-prix-synthese-landing-page` | ‚úÖ OUI | ‚ùå NON | ‚úÖ OUI | 74-90 |
| D√©tails cl√©s | `details-cles-synthese-landing-page` | ‚úÖ OUI | ‚ùå NON | ‚úÖ OUI | 92-109 |
| Donn√©es Financi√®res | `donnees-financieres-synthese-landing-page` | ‚úÖ OUI | ‚ùå NON | ‚úÖ OUI | 111-128 |
| Informations Compl√©mentaires | `infos-complementaires-synthese-landing-page` | ‚úÖ OUI | ‚ùå NON | ‚úÖ OUI | 130-147 |

### 14.3. Tableau des hooks

| Hook | R√¥le | √âtat retourn√© | Fonction retourn√©e | Fichier |
|------|------|--------------|-------------------|---------|
| `useRecuperationAnnonceVersLandingPage` | R√©cup√®re et met √† jour l'annonce Landing Page | `annonceLandingPage`, `isLoading`, `error` | `updateAnnonceLandingPage` | `HookRecuperationAnnonceVersLandingPage.ts` |
| `useRecuperationFichedeSyntheseVersLandingPage` | R√©cup√®re et met √† jour la synth√®se Landing Page | `fichedeSyntheseLandingPage`, `isLoading`, `error` | `updateFichedeSyntheseLandingPage` | `HookRecuperationFichedeSyntheseVersLandingPage.ts` |
| `useApercuAnnonceLandingPage` | G√©n√®re l'aper√ßu textuel de l'annonce | `annonceLandingPage`, `isLoading`, `error` | N/A | `HookCopierApercuAnnonceLandingPage.tsx` |
| `useApercuSyntheseLandingPage` | G√©n√®re l'aper√ßu textuel de la synth√®se | `syntheseLandingPage`, `isLoading`, `error` | N/A | `HookCopierApercuSyntheseLandingPage.tsx` |
| `usePublierLandingPage` | G√®re la sauvegarde Landing Page (inactive) | `isPublishing`, `annonceLandingPage`, `syntheseLandingPage` | `publierAnnonceLandingPage` | `HookPublierLandingPage.tsx` |

### 14.4. Tableau des fonctions de sauvegarde

| Fonction | Type | Action | Fichier | Ligne |
|----------|------|--------|---------|-------|
| `updateAnnonceLandingPage(newData)` | Automatique | Sauvegarde dans `localStorage` (`key-modifs-creer-landing-page-annonce`) | `HookRecuperationAnnonceVersLandingPage.ts` | 59-70 |
| `updateFichedeSyntheseLandingPage(newData)` | Automatique | Sauvegarde dans `localStorage` (`key-modifs-creer-landing-page-synthese`) | `HookRecuperationFichedeSyntheseVersLandingPage.ts` | 59-70 |
| `publierAnnonceLandingPage()` | Manuelle (inactive) | Simulation de sauvegarde (1,5s delay + toast) | `HookPublierLandingPage.tsx` | 16-38 |

### 14.5. Matrice Onglets √ó Actions √ó Fichiers

| Onglet | Affichage | Actions | Fichiers utilis√©s | Hooks utilis√©s |
|--------|-----------|---------|-------------------|----------------|
| **Onglet 1**<br/>Annonce du bien | 4 champs :<br/>- Titre<br/>- Accroche<br/>- Descriptif<br/>- Appel √† l'action | - Lecture seule<br/>- √âdition (si mode actif)<br/>- Sauvegarde automatique | `File1.AnnonceLandingPage.tsx`<br/>`GraphismeInterieurLandingPage.tsx`<br/>`EditeurWYSIWYG.tsx` | `useRecuperationAnnonceVersLandingPage` |
| **Onglet 2**<br/>Synth√®se du bien | 5 champs :<br/>- Titre<br/>- R√©f√©rence & Prix<br/>- D√©tails cl√©s<br/>- Donn√©es Financi√®res<br/>- Informations Compl√©mentaires | - Lecture seule<br/>- √âdition (si mode actif)<br/>- Sauvegarde automatique | `File2.SyntheseLandingPage.tsx`<br/>`GraphismeInterieurLandingPage.tsx`<br/>`EditeurWYSIWYG.tsx` | `useRecuperationFichedeSyntheseVersLandingPage` |
| **Onglet 3**<br/>Utiliser l'Annonce | - 1 bouton de sauvegarde (inactif)<br/>- 2 aper√ßus | - Sauvegarde Landing Page (simulation) | `File3.ActionSauvegardeCreerLandingPage.tsx`<br/>`GraphismeInterieurLandingPage.tsx` | `useApercuAnnonceLandingPage`<br/>`useApercuSyntheseLandingPage`<br/>`usePublierLandingPage` |

---

## XV. DONN√âES √Ä PRENDRE EN CONSID√âRATION

### 15.1. Points d'attention techniques

**1. Mapping incoh√©rent `cta` ‚Üí `appelAction`**

**Contexte :**
- OpenAI retourne un champ nomm√© `cta`
- L'interface React utilise `appelAction`

**Localisation :**
```typescript
// Fichier: HookRecuperationAnnonceVersLandingPage.ts, ligne 46
appelAction: parsedData.cta || '' // Mapping manuel cta ‚Üí appelAction
```

**Raison strat√©gique :**
- Nomenclature m√©tier fran√ßaise ("Appel √† l'action") vs. nomenclature technique anglaise ("CTA")
- Coh√©rence avec les autres canaux (qui utilisent tous `appelAction`)

**Impact :**
- ‚úÖ Permet de standardiser la nomenclature c√¥t√© interface React
- ‚ö†Ô∏è N√©cessite un mapping manuel √† chaque r√©cup√©ration de donn√©es OpenAI

---

**2. Nettoyage HTML complexe avec `stripHtmlTags()`**

**Contexte :**
- `stripHtmlTags()` existe dans 2 fichiers avec des logiques quasi-identiques
- Version 1 (Annonce) : Pr√©serve les transitions `</p><p>` avec `\n\n`
- Version 2 (Synth√®se) : Pr√©serve √©galement les transitions `</p><p>` avec `\n\n`

**Localisation :**
- `HookCopierApercuAnnonceLandingPage.tsx` (lignes 11-27)
- `HookCopierApercuSyntheseLandingPage.tsx` (lignes 13-23)

**Raison strat√©gique :**
- Am√©liorer la lisibilit√© du texte brut en pr√©servant les sauts de ligne entre paragraphes
- Adapter le nettoyage au format de donn√©es (mais ici les deux fonctions sont quasi-identiques)

**Impact :**
- ‚úÖ Texte brut copi√© est bien structur√© (sauts de ligne logiques)
- ‚ö†Ô∏è Code dupliqu√© (2 fonctions similaires)

---

**3. √âditeur WYSIWYG sans barre d'outils (`toolbar: false`)**

**Contexte :**
- `EditeurWYSIWYG.tsx` utilise `react-quill` avec `toolbar: false`
- Les formats sont permis (`header`, `bold`, `italic`, etc.) mais **non accessibles visuellement**

**Localisation :**
```typescript
// Fichier: EditeurWYSIWYG.tsx, lignes 15-16
const defaultModules = {
  toolbar: false // ‚ö†Ô∏è CHOIX STRAT√âGIQUE LEADGENAI
};
```

**Raison strat√©gique :**
- Simplifier l'interface utilisateur (√©viter la surcharge visuelle)
- √âviter les erreurs de formatage de l'utilisateur
- L'utilisateur peut √©diter le texte, mais **pas le formater visuellement**

**Impact :**
- ‚úÖ Interface √©pur√©e, focus sur le contenu
- ‚ö†Ô∏è Utilisateur ne peut pas ajouter de formatage (gras, italique, etc.)

---

**4. Fonction `addTitlesToSections` (Synth√®se uniquement)**

**Contexte :**
- La synth√®se ajoute automatiquement des **titres de sections** aux champs `detailsCles`, `donneesFinancieres`, `informationsComplementaires`
- Exemple : "Pr√©sentation | D√©tails cl√©s"

**Localisation :**
```typescript
// Fichier: HookCopierApercuSyntheseLandingPage.tsx, lignes 26-43
const addTitlesToSections = (data: SyntheseLandingPageData): SyntheseLandingPageData => {
  return {
    titre: data.titre,
    referenceEtPrix: data.referenceEtPrix ? `${data.referenceEtPrix}` : '',
    detailsCles: data.detailsCles ? `Pr√©sentation | D√©tails cl√©s\n${data.detailsCles}` : '',
    donneesFinancieres: data.donneesFinancieres ? `Pr√©sentation | Donn√©es Financi√®res\n${data.donneesFinancieres}` : '',
    informationsComplementaires: data.informationsComplementaires ? `Pr√©sentation | Informations Compl√©mentaires\n${data.informationsComplementaires}` : '',
  };
};
```

**Raison strat√©gique :**
- Pr√©server la structure hi√©rarchique de la Fiche de Synth√®se (Titre de section ‚Üí Liste de d√©tails)
- Automatiser l'ajout de contexte pour l'aper√ßu

**Impact :**
- ‚úÖ Aper√ßu bien structur√© avec titres de sections
- ‚ö†Ô∏è Logique hard-cod√©e (titres de sections fixes)

---

**5. Sauvegarde automatique imm√©diate (pas de confirmation)**

**Contexte :**
- √Ä chaque modification de champ, `updateAnnonceLandingPage` ou `updateFichedeSyntheseLandingPage` est appel√©
- La sauvegarde dans `localStorage` est **imm√©diate**
- Le bouton "Sauvegarder" du menu sert uniquement √† **sortir du mode √©dition**

**Localisation :**
```typescript
// File1.AnnonceLandingPage.tsx, ligne 36
updateAnnonceLandingPage({ [name]: cleanedValue });
```

**Raison strat√©gique :**
- √âviter la perte de donn√©es en cas de fermeture accidentelle du navigateur
- Simplifier l'UX (pas besoin de cliquer sur "Sauvegarder" apr√®s chaque modification)

**Impact :**
- ‚úÖ Protection contre la perte de donn√©es
- ‚ö†Ô∏è Impossibilit√© d'annuler les modifications (pas de fonction "Annuler")

---

### 15.2. D√©pendances critiques

**Biblioth√®que :** `react-quill` (version install√©e √† v√©rifier dans `package.json`)

**Utilisation :**
- `EditeurWYSIWYG.tsx` utilise `react-quill` pour l'√©diteur WYSIWYG
- D√©pendance obligatoire pour le mode √©dition

**Configuration critique :**
```typescript
// Fichier: EditeurWYSIWYG.tsx, lignes 14-24
const defaultModules = {
  toolbar: false // ‚ö†Ô∏è Ne pas modifier
};

const formats = [
  'header',
  'bold', 'italic', 'underline', 'strike',
  'list', 'bullet'
];
```

**Import CSS obligatoire :**
```typescript
// Fichier: EditeurWYSIWYG.tsx, ligne 4
import "react-quill/dist/quill.snow.css";
```

**Risques lors de la migration :**
- ‚ö†Ô∏è Si `react-quill` est retir√©, le mode √©dition ne fonctionnera plus
- ‚ö†Ô∏è La configuration `toolbar: false` doit √™tre pr√©serv√©e (choix strat√©gique LeadGenAI)

---

### 15.3. Fonctions cl√©s √† pr√©server

**Fonctions critiques √† NE PAS modifier sans validation :**

1. **`stripHtmlTags()`** (2 versions)
   - `HookCopierApercuAnnonceLandingPage.tsx` (lignes 11-27)
   - `HookCopierApercuSyntheseLandingPage.tsx` (lignes 13-23)
   - Logique de nettoyage HTML pr√©servant les transitions `</p><p>` ‚Üí `\n\n`

2. **`addTitlesToSections()`**
   - `HookCopierApercuSyntheseLandingPage.tsx` (lignes 26-43)
   - Ajout automatique des titres de sections

3. **Nettoyage HTML automatique dans `handleChange`**
   - `File1.AnnonceLandingPage.tsx` (lignes 22-40)
   - `File2.SyntheseLandingPage.tsx` (lignes 22-36)
   - Suppression des balises HTML pour certains champs

4. **Fonction `publierAnnonceLandingPage`**
   - `HookPublierLandingPage.tsx` (lignes 16-38)
   - Actuellement inactive (simulation), mais structure √† pr√©server pour future impl√©mentation

---

### 15.4. Mapping OpenAI ‚Üí Interface (cta vs appelAction)

**Tableau de mapping complet :**

**Annonce Landing Page :**

| Champ OpenAI (`generation_website_ad`) | Champ Interface (`AnnonceLandingPageData`) | Fichier | Ligne |
|-----------------------------------------|---------------------------------------------|---------|-------|
| `titre` | `titre` | `HookRecuperationAnnonceVersLandingPage.ts` | 43 |
| `accroche` | `accroche` | `HookRecuperationAnnonceVersLandingPage.ts` | 44 |
| `descriptif` | `descriptif` | `HookRecuperationAnnonceVersLandingPage.ts` | 45 |
| **`cta`** | **`appelAction`** | `HookRecuperationAnnonceVersLandingPage.ts` | **46** ‚ö†Ô∏è |

**Synth√®se Landing Page (pas de mapping n√©cessaire) :**

| Champ OpenAI (`generation_summary_sheet`) | Champ Interface (`FichedeSyntheseLandingPageData`) | Coh√©rence |
|--------------------------------------------|------------------------------------------------|-----------|
| `titre` | `titre` | ‚úÖ Identique |
| `referenceEtPrix` | `referenceEtPrix` | ‚úÖ Identique |
| `detailsCles` | `detailsCles` | ‚úÖ Identique |
| `donneesFinancieres` | `donneesFinancieres` | ‚úÖ Identique |
| `informationsComplementaires` | `informationsComplementaires` | ‚úÖ Identique |

**Points critiques pour la migration Supabase :**

1. **Pr√©server le mapping `cta` ‚Üí `appelAction`** lors de la r√©cup√©ration des donn√©es OpenAI
2. **Utiliser `appelAction` dans les tables Supabase** (pas `cta`)
3. **V√©rifier la coh√©rence** des noms de colonnes entre `generation_website_ad` et `generation_summary_sheet`

**Recommandation :**
- Cr√©er une **fonction utilitaire** `mapOpenAIToInterface()` pour centraliser le mapping
- Exemple :
  ```typescript
  const mapOpenAIToInterface = (openAIData: any): AnnonceLandingPageData => {
    return {
      titre: openAIData.titre || '',
      accroche: openAIData.accroche || '',
      descriptif: openAIData.descriptif || '',
      appelAction: openAIData.cta || '' // Mapping centralis√©
    };
  };
  ```

---

