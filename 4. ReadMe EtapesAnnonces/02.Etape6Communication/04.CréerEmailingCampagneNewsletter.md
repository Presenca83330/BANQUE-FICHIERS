# üìß **AUDIT TECHNIQUE EXHAUSTIF - CANAL "CR√âER UN EMAILING ANNONCE OU UNE CAMPAGNE NEWSLETTER"**

---

## **I. MISSION DU DOCUMENT**

Ce document constitue l'**audit technique exhaustif** du canal **"Cr√©er un Emailing Annonce ou une Campagne Newsletter"** au sein de l'application LeadGenAI.

**Objectifs du document :**
- **Cartographier** tous les fichiers, composants, hooks et fonctions impliqu√©s dans ce canal
- **Analyser** le flux complet de donn√©es depuis OpenAI jusqu'√† l'interface utilisateur
- **Documenter** l'ensemble des processus : r√©cup√©ration, affichage, √©dition, copie et sauvegarde
- **Pr√©parer** la migration future du syst√®me localStorage vers une architecture Supabase multi-tenant

**P√©rim√®tre :**
- **Localisation** : `/etape6communication` ‚Üí option `"creer-campagne-newsletter"`
- **Type d'annonce** : Annonce Newsletter g√©n√©r√©e par OpenAI pour l'emailing immobilier commercial
- **Fonctionnalit√©s** : Affichage, √©dition (WYSIWYG), copie (texte + HTML), sauvegarde, aper√ßu HTML

---

## **II. SOMMAIRE CLIQUABLE**

1. [MISSION DU DOCUMENT](#i-mission-du-document)
2. [SOMMAIRE CLIQUABLE](#ii-sommaire-cliquable)
3. [ARCHITECTURE GLOBALE - CANAL](#iii-architecture-globale---canal)
4. [LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS](#iv-liste-exhaustive-des-fichiers-utilis√©s)
5. [SYST√àME D'ONGLETS](#v-syst√®me-donglets)
6. [PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI](#vi-processus-de-r√©cup√©ration-des-donn√©es-openai)
7. [STRUCTURE DES DONN√âES localStorage](#vii-structure-des-donn√©es-localstorage)
8. [PROCESSUS COMPLET √âTAPE PAR √âTAPE](#viii-processus-complet-√©tape-par-√©tape)
9. [SYST√àME D'√âDITION - BOUTON "MODIFIER"](#ix-syst√®me-d√©dition---bouton-modifier)
10. [OPTIONS DE COPIE](#x-options-de-copie)
11. [SYST√àME D'APER√áU](#xi-syst√®me-daper√ßu)
12. [CONTRAINTES ET VALIDATION](#xii-contraintes-et-validation)
13. [COMPOSANTS GRAPHIQUES R√âUTILISABLES](#xiii-composants-graphiques-r√©utilisables)
14. [TABLEAUX R√âCAPITULATIFS](#xiv-tableaux-r√©capitulatifs)
15. [DONN√âES √Ä PRENDRE EN CONSID√âRATION](#xv-donn√©es-√†-prendre-en-consid√©ration)

---

## **III. ARCHITECTURE GLOBALE - CANAL**

### **3.1. Vue d'ensemble du canal**

Le canal **"Cr√©er un Emailing Annonce ou une Campagne Newsletter"** permet √† l'utilisateur de :
1. **Visualiser** une annonce newsletter g√©n√©r√©e par OpenAI (5 champs)
2. **Modifier** cette annonce avec un √©diteur WYSIWYG (ReactQuill sans toolbar)
3. **Copier** l'annonce en **format texte** pour utilisation externe
4. **Copier** l'annonce en **format HTML** pour int√©gration dans un logiciel d'emailing
5. **Visualiser** un aper√ßu HTML de l'emailing dans le navigateur
6. **Sauvegarder** l'annonce (fonctionnalit√© future vers Supabase et `/newsletter-builder`)

### **3.2. Position dans √âtape 6 Communication**

- **Route** : `/etape6communication`
- **Activation** : `setSelectedOption("creer-campagne-newsletter")`
- **Composant racine** : ``
- **Fichier** : `src/components/1-Sources-Restitution-Utilisateur/4.EtapeCreerCampagneNewsletter/AccueilCreerCampagneNewsletter.tsx`

### **3.3. Sch√©ma Mermaid complet (flux de donn√©es)**

```mermaid
graph TB
    A[√âtape 1-5: Formulaire Utilisateur] -->|Envoi donn√©es| B[OpenAI API]
    B -->|G√©n√©ration Newsletter| C[generation_newsletter]
    C --> D{localStorage}

    D -->|Lecture prioritaire| E[key-modifs-creer-campagne-newsletter]
    D -->|Lecture secondaire| F[generation_newsletter]

    E --> G[useRecuperationAnnonceNewsletterVersCreerNewsletter]
    F --> G

    G --> H[File1.AnnonceNewsletter]
    H -->|Affichage| I[Onglet 1: Annonce]

    G --> J[useApercuAnnonceNewsletter]
    J -->|stripHtmlTagsNewsletter| K[File2.ActionUtilisateurCopierNewsletter]
    K --> L[Onglet 2: Copier l'Annonce]

    G --> M[useApercuSauvegardeAnnonceNewsletter]
    M --> N[File3.ActionUtilisateurSauvegarderNewsletter]
    N --> O[Onglet 3: Utiliser l'Annonce]

    H -->|Modification| P[EditeurWYSIWYG - ReactQuill]
    P -->|Auto-save| E

    K -->|copierAnnonceNewsletter| Q[Clipboard - Format Texte]
    K -->|copierHTMLNewsletter| R[Clipboard - HTML]
    K -->|ouvrirApercuHTML| S[Nouvelle fen√™tre - Aper√ßu HTML]

    R --> T[generateNewsletterHTML]
    S --> T
    T --> U[NEWSLETTER_TEMPLATE]

    N -->|sauvegarderAnnonceNewsletter| V[Future: Supabase + Newsletter Builder]

    style A fill:#FFE5E5
    style B fill:#FFD700
    style C fill:#90EE90
    style D fill:#87CEEB
    style E fill:#FFA07A
    style F fill:#90EE90
    style G fill:#DDA0DD
    style H fill:#F0E68C
    style I fill:#FFB6C1
    style J fill:#DDA0DD
    style K fill:#F0E68C
    style L fill:#FFB6C1
    style M fill:#DDA0DD
    style N fill:#F0E68C
    style O fill:#FFB6C1
    style P fill:#98FB98
    style Q fill:#87CEEB
    style R fill:#87CEEB
    style S fill:#87CEEB
    style T fill:#FFE4B5
    style U fill:#FFE4B5
    style V fill:#D3D3D3
```

---

## **IV. LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS**

### **4.1. Fichiers de composition**

| **Fichier** | **R√¥le** | **Localisation** |
|-------------|----------|------------------|
| `AccueilCreerCampagneNewsletter.tsx` | Composant racine du canal Newsletter | `src/components/1-Sources-Restitution-Utilisateur/4.EtapeCreerCampagneNewsletter/` |
| `MenuOngletPortailsImmobiliers.tsx` | Syst√®me d'onglets avec bouton "Modifier" | `src/components/1-Sources-Restitution-Utilisateur/4.EtapeCreerCampagneNewsletter/` |
| `File1.AnnonceNewsletter.tsx` | Onglet 1 - Affichage et √©dition de l'annonce | `src/components/1-Sources-Restitution-Utilisateur/4.EtapeCreerCampagneNewsletter/` |
| `File2.ActionUtilisateurCopierNewsletter.tsx` | Onglet 2 - Options de copie (texte + HTML) | `src/components/1-Sources-Restitution-Utilisateur/4.EtapeCreerCampagneNewsletter/` |
| `File3.ActionUtilisateurSauvegarderNewsletter.tsx` | Onglet 3 - Sauvegarde et visualisation | `src/components/1-Sources-Restitution-Utilisateur/4.EtapeCreerCampagneNewsletter/` |

### **4.2. Hooks de r√©cup√©ration**

| **Fichier** | **Hook** | **R√¥le** |
|-------------|----------|----------|
| `HookRecuperationAnnonceNewsletterVersCreerNewsletter.ts` | `useRecuperationAnnonceNewsletterVersCreerNewsletter` | R√©cup√©ration avec priorit√© (modifs > original) + fonction `updateAnnonceNewsletter` |

### **4.3. Hooks d'aper√ßu**

| **Fichier** | **Hook** | **R√¥le** |
|-------------|----------|----------|
| `HookCopierApercuAnnonceNewsletter.tsx` | `useApercuAnnonceNewsletter` | Aper√ßu texte avec nettoyage HTML (`stripHtmlTagsNewsletter`) pour copie texte |
| `HookApercuSauvegardeAnnonceNewsletter.tsx` | `useApercuSauvegardeAnnonceNewsletter` | Aper√ßu complet (5 champs s√©par√©s) pour visualisation sauvegarde |
| | `ApercuSauvegardeAnnonceNewsletter5champs` | Composant React pour affichage des 5 champs en lecture seule |

### **4.4. Hooks de copie**

| **Fichier** | **Hook/Fonction** | **R√¥le** |
|-------------|-------------------|----------|
| `HookCopierTexteCampagneNewsletter.tsx` | `useCopierTexteCampagneNewsletter` | Copie texte (stripped HTML) via `navigator.clipboard` |
| `HookCopierHTMLCampagneNewsletter.tsx` | `useCopierHTMLCampagneNewsletter` | Copie HTML complet + aper√ßu navigateur via `generateNewsletterHTML` |

### **4.5. Hooks de sauvegarde**

| **Fichier** | **Hook** | **R√¥le** |
|-------------|----------|----------|
| `HookSauvegarderCampagneNewsletter.tsx` | `useSauvegarderCampagneNewsletter` | Sauvegarde (actuellement inactiv√©e - "en d√©veloppement") |

### **4.6. Templates et utilitaires**

| **Fichier** | **Type** | **R√¥le** |
|-------------|----------|----------|
| `TemplateNewsletterHTML.ts` | Template + Fonctions | Template HTML complet + fonctions de formatage (`formatPointsFortsForEmail`, `formatPrixEtReferenceForEmail`, `generateNewsletterHTML`) |
| `EditeurWYSIWYG.tsx` | Composant | √âditeur ReactQuill sans toolbar pour √©dition HTML |
| `GraphismeInterieurNewsletter.tsx` | Composants UI | Composants r√©utilisables (LabelField, ReadOnlyField, EditableField, CopyNewsletter3, etc.) |

### **4.7. Prompt OpenAI**

| **Fichier** | **Type** | **R√¥le** |
|-------------|----------|----------|
| `src/services/openai/1.GenerateurAnnoncesOutilsSeo/7.PromptsOpenAi/3.PromptAnnonceNewsletter.ts` | Prompt | Instructions compl√®tes pour la g√©n√©ration OpenAI (structure, formatage HTML, JSON) |

### **4.8. Arborescence compl√®te**

```
src/components/1-Sources-Restitution-Utilisateur/4.EtapeCreerCampagneNewsletter/
‚îú‚îÄ‚îÄ AccueilCreerCampagneNewsletter.tsx         // Composant racine
‚îú‚îÄ‚îÄ MenuOngletPortailsImmobiliers.tsx           // Syst√®me d'onglets
‚îú‚îÄ‚îÄ File1.AnnonceNewsletter.tsx                 // Onglet 1
‚îú‚îÄ‚îÄ File2.ActionUtilisateurCopierNewsletter.tsx // Onglet 2
‚îú‚îÄ‚îÄ File3.ActionUtilisateurSauvegarderNewsletter.tsx // Onglet 3
‚îú‚îÄ‚îÄ HookRecuperationAnnonceNewsletterVersCreerNewsletter.ts
‚îú‚îÄ‚îÄ HookCopierApercuAnnonceNewsletter.tsx
‚îú‚îÄ‚îÄ HookCopierTexteCampagneNewsletter.tsx
‚îú‚îÄ‚îÄ HookCopierHTMLCampagneNewsletter.tsx
‚îú‚îÄ‚îÄ HookSauvegarderCampagneNewsletter.tsx
‚îú‚îÄ‚îÄ HookApercuSauvegardeAnnonceNewsletter.tsx
‚îú‚îÄ‚îÄ TemplateNewsletterHTML.ts
‚îú‚îÄ‚îÄ EditeurWYSIWYG.tsx
‚îî‚îÄ‚îÄ GraphismeInterieurNewsletter.tsx
```

---

## **V. SYST√àME D'ONGLETS**

### **5.1. MenuOnglet (MenuOngletPortailsImmobiliers.tsx)**

**Fonctionnalit√©s :**
- Affichage de **3 onglets** : "Annonce", "Copier l'Annonce", "Utiliser l'Annonce"
- Bouton **"Modifier"** / **"Sauvegarder"** (toggle) dans l'onglet 1
- Gestion de l'√©tat `newsletterEditMode` (propag√© vers `File1.AnnonceNewsletter`)
- Toast de confirmation lors de la sauvegarde
- D√©sactivation du mode √©dition lors du changement d'onglet

**√âtats g√©r√©s :**
```typescript
const [activeNewsletterTab, setActiveNewsletterTab] = useState("newsletter-tab1");
const [newsletterEditMode, setNewsletterEditMode] = useState(false);
```

**Valeurs des onglets :**
- `"newsletter-tab1"` ‚Üí Annonce
- `"newsletter-tab2"` ‚Üí Copier l'Annonce
- `"newsletter-tab3"` ‚Üí Utiliser l'Annonce

### **5.2. Onglet 1 : Annonce (File1.AnnonceNewsletter.tsx)**

**Objectif** : Affichage et √©dition des **5 champs** de l'annonce newsletter

**Champs affich√©s :**
1. **Titre** (label: "Titre")
2. **Accroche** (label: "Accroche")
3. **Points Forts** (label: "Points Forts")
4. **Call To Action** (label: "Appel √† l'action")
5. **Prix et R√©f√©rence** (label: "Prix ou Loyer & R√©f√©rence")

**Mode lecture seule :**
- Composant : ``
- Propri√©t√© : `isDescriptif={true}` ‚Üí utilise `dangerouslySetInnerHTML` pour afficher le HTML

**Mode √©dition :**
- Composant : ``
- Propri√©t√© : `useWysiwyg={true}` ‚Üí utilise `` (ReactQuill sans toolbar)
- Nombre de lignes : `rows={2|3|8}` selon le champ

**Fonction de mise √† jour :**
```typescript
const handleChange = (name: string, value: string) => {
  const updatedData = { [name]: value };
  updateAnnonceNewsletter(updatedData); // Sauvegarde auto localStorage
  if (onDataChange) {
    onDataChange({ ...annonceNewsletter, ...updatedData });
  }
};
```

### **5.3. Onglet 2 : Copier l'Annonce (File2.ActionUtilisateurCopierNewsletter.tsx)**

**Objectif** : Copier l'annonce en **format texte** ou **format HTML**

**Structure :**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Options de copie de l'annonce newsletter                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Format Texte                ‚îÇ Format HTML Emailing          ‚îÇ
‚îÇ [Copier le texte de         ‚îÇ [Copier le code de l'Emailing]‚îÇ
‚îÇ  l'Annonce Newsletter]      ‚îÇ [Voir l'Aper√ßu de cet Emailing]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Aper√ßu de l'Annonce Newsletter                              ‚îÇ
‚îÇ [Affichage texte complet: titre + accroche + pointsForts   ‚îÇ
‚îÇ  + callToAction + prixEtReference]                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Format Texte :**
- Hook : `useCopierTexteCampagneNewsletter()`
- Fonction : `copierAnnonceNewsletter()`
- Nettoyage : `stripHtmlTagsNewsletter()` avec gestion sp√©ciale des transitions `p‚Üíul`
- R√©sultat : Texte brut avec puces `‚Ä¢` et double saut de ligne avant les listes

**Format HTML Emailing :**
- Hook : `useCopierHTMLCampagneNewsletter()`
- Fonction : `copierHTMLNewsletter()` ‚Üí copie HTML complet dans clipboard
- Fonction : `ouvrirApercuHTML()` ‚Üí ouvre `window.open()` avec le HTML g√©n√©r√©
- Template : `NEWSLETTER_TEMPLATE` (606 lignes de HTML inline CSS)

### **5.4. Onglet 3 : Utiliser l'Annonce (File3.ActionUtilisateurSauvegarderNewsletter.tsx)**

**Objectif** : Sauvegarder l'annonce (fonctionnalit√© future)

**Structure :**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Option de sauvegarde Newsletter                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Sauvegarder cette annonce   ‚îÇ (vide)                        ‚îÇ
‚îÇ [Sauvegarder l'Annonce]     ‚îÇ                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Visualisation de l'Annonce Newsletter sauvegard√©e          ‚îÇ
‚îÇ [Affichage 5 champs s√©par√©s avec labels]                   ‚îÇ
‚îÇ - Titre                                                     ‚îÇ
‚îÇ - Accroche                                                  ‚îÇ
‚îÇ - Points Forts                                              ‚îÇ
‚îÇ - Appel √† l'action                                          ‚îÇ
‚îÇ - Prix ou Loyer & R√©f√©rence                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Statut actuel :**
- Bouton "Sauvegarder l'Annonce" ‚Üí toast "Fonctionnalit√© en d√©veloppement"
- Future int√©gration : Supabase + `/newsletter-builder`

### **5.5. Logique de navigation et √©tat**

**Changement d'onglet :**
```typescript
const handleNewsletterTabChange = (value: string) => {
  setActiveNewsletterTab(value);
  if (newsletterEditMode) {
    toggleNewsletterEditMode(); // D√©sactive le mode √©dition
  }
  if (onTabChange) onTabChange(value);
};
```

**Toggle mode √©dition :**
```typescript
const toggleNewsletterEditMode = () => {
  const newEditMode = !newsletterEditMode;
  setNewsletterEditMode(newEditMode);

  if (!newEditMode) {
    toast({
      title: "Modifications newsletter sauvegard√©es",
      description: "Les changements de la campagne newsletter ont √©t√© enregistr√©s avec succ√®s."
    });
  }

  if (onEditModeChange) onEditModeChange(newEditMode);
};
```

---

## **VI. PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI**

### **6.1. Sources de donn√©es (cl√©s localStorage)**

| **Cl√© localStorage** | **Type** | **Origine** | **Priorit√©** |
|----------------------|----------|-------------|--------------|
| `generation_newsletter` | JSON | OpenAI | 2 (secondaire) |
| `key-modifs-creer-campagne-newsletter` | JSON | Utilisateur | 1 (prioritaire) |

### **6.2. Logique de priorit√© (modifs > originales)**

**Ordre de lecture :**
1. V√©rifier si `key-modifs-creer-campagne-newsletter` existe
2. Si oui ‚Üí charger ces donn√©es (modifications utilisateur)
3. Si non ‚Üí charger `generation_newsletter` (donn√©es OpenAI originales)

**Impl√©mentation dans `useRecuperationAnnonceNewsletterVersCreerNewsletter` :**
```typescript
const modifiedDataJson = localStorage.getItem('key-modifs-creer-campagne-newsletter');

if (modifiedDataJson) {
  const modifiedData = JSON.parse(modifiedDataJson);
  setAnnonceNewsletter({
    titre: modifiedData.titre || '',
    accroche: modifiedData.accroche || '',
    pointsForts: modifiedData.pointsForts || '',
    callToAction: modifiedData.callToAction || '',
    prixEtReference: modifiedData.prixEtReference || ''
  });
} else {
  const annonceNewsletterData = localStorage.getItem('generation_newsletter');
  if (annonceNewsletterData) {
    const parsedData = JSON.parse(annonceNewsletterData);
    setAnnonceNewsletter({ /* ... */ });
  }
}
```

### **6.3. Hooks de r√©cup√©ration d√©taill√©s**

#### **A. Hook principal : `useRecuperationAnnonceNewsletterVersCreerNewsletter`**

**Fichier :** `HookRecuperationAnnonceNewsletterVersCreerNewsletter.ts`

**Retour :**
```typescript
{
  annonceNewsletter: AnnonceNewsletterData,
  updateAnnonceNewsletter: (newData: Partial) => void,
  isLoading: boolean,
  error: string | null
}
```

**Fonction de mise √† jour :**
```typescript
const updateAnnonceNewsletter = (newData: Partial) => {
  const updatedData = { ...annonceNewsletter, ...newData };
  setAnnonceNewsletter(updatedData);

  try {
    localStorage.setItem('key-modifs-creer-campagne-newsletter', JSON.stringify(updatedData));
  } catch (err) {
    console.error('Erreur lors de la sauvegarde des donn√©es:', err);
    setError('Erreur lors de la sauvegarde des donn√©es');
  }
};
```

#### **B. Hook d'aper√ßu : `useApercuAnnonceNewsletter`**

**Fichier :** `HookCopierApercuAnnonceNewsletter.tsx`

**Particularit√© :** Applique `stripHtmlTagsNewsletter()` sur tous les champs pour g√©n√©rer un aper√ßu texte propre

**Fonction de nettoyage HTML :**
```typescript
const stripHtmlTagsNewsletter = (html: string): string => {
  let modifiedHtml = html
    .replace(/<\/h2>\s*/gi, '###SAUT_LIGNE###')
    .replace(/<\/p>\s*/gi, '###SAUT_LIGNE###')
    .replace(/<\/p>\s*/gi, '###DOUBLE_SAUT_LIGNE###'); // ‚ö†Ô∏è Double saut pour p‚Üíul

  modifiedHtml = modifiedHtml
    .replace(/]*>/gi, '')
    .replace(/<\/ul>/gi, '\n')
    .replace(/]*>/gi, '‚Ä¢ ')
    .replace(/<\/li>/gi, '\n');

  let textSansTags = modifiedHtml.replace(/<\/?[^>]+(>|$)/g, '');

  textSansTags = textSansTags
    .replace(/###DOUBLE_SAUT_LIGNE###/g, '\n\n')
    .replace(/###SAUT_LIGNE###/g, '\n');

  textSansTags = textSansTags.replace(/\n{4,}/g, '\n\n');

  return textSansTags;
};
```

#### **C. Hook de sauvegarde : `useApercuSauvegardeAnnonceNewsletter`**

**Fichier :** `HookApercuSauvegardeAnnonceNewsletter.tsx`

**Particularit√© :** Fournit les donn√©es brutes (avec HTML) pour affichage des 5 champs s√©par√©s via le composant `ApercuSauvegardeAnnonceNewsletter5champs`

### **6.4. Mapping des champs OpenAI ‚Üí Interface**

| **Champ OpenAI (cl√© JSON)** | **Champ Interface** | **Label UI** | **Format OpenAI** | **Traitement** |
|-----------------------------|---------------------|--------------|-------------------|----------------|
| `titre` | `titre` | "Titre" | `TITRE EN MAJUSCULES` | HTML ‚Üí WYSIWYG |
| `accroche` | `accroche` | "Accroche" | `Phrase 1.Phrase 2.` | HTML ‚Üí WYSIWYG |
| `pointsForts` | `pointsForts` | "Points Forts" | `Points Forts :...` | HTML ‚Üí WYSIWYG |
| `callToAction` | `callToAction` | "Appel √† l'action" | `PHRASE 1.PHRASE 2.` | HTML ‚Üí WYSIWYG |
| `prixEtReference` | `prixEtReference` | "Prix ou Loyer & R√©f√©rence" | `Prix FAI: 456‚Ç¨R√©f√©rence: REF-123` | HTML ‚Üí WYSIWYG |

**‚ö†Ô∏è PARTICULARIT√â :** Tous les champs sont stock√©s et √©dit√©s en **HTML** (contrairement au canal Outils SEO qui est en texte brut).

---

## **VII. STRUCTURE DES DONN√âES localStorage**

### **7.1. Cl√©s LUES**

| **Cl√©** | **Origine** | **Structure** | **Utilisation** |
|---------|-------------|---------------|-----------------|
| `generation_newsletter` | OpenAI | JSON (5 champs) | Donn√©es originales (priorit√© 2) |
| `key-modifs-creer-campagne-newsletter` | Utilisateur | JSON (5 champs) | Modifications utilisateur (priorit√© 1) |

**Exemple de structure `generation_newsletter` :**
```json
{
  "titre": "CARCASSONNE | RESTAURANT √Ä VENDRE | EMPLACEMENT PREMIUM EN ANGLE | ...",
  "accroche": "CARCASSONNE AGENCE IMMOBILIERE vous invite √† d√©couvrir...Cette affaire rare...",
  "pointsForts": "Points Forts :Emplacement: ......",
  "callToAction": "EMPLACEMENT PREMIUM, AFFAIRE RARE.CLIQUEZ POUR EN SAVOIR PLUS.",
  "prixEtReference": "Prix FAI: 456 895‚Ç¨R√©f√©rence: REF-789"
}
```

### **7.2. Cl√©s √âCRITES**

| **Cl√©** | **D√©clencheur** | **Contenu** | **Fr√©quence** |
|---------|-----------------|-------------|---------------|
| `key-modifs-creer-campagne-newsletter` | Modification dans `EditableField` (WYSIWYG) | JSON (5 champs modifi√©s) | **Automatique** √† chaque modification |

**Exemple apr√®s modification :**
```json
{
  "titre": "CARCASSONNE | RESTAURANT √Ä VENDRE MODIFI√â | ...",
  "accroche": "Texte d'accroche modifi√©...",
  "pointsForts": "Points Forts :Nouveau point fort",
  "callToAction": "NOUVEAU CTA",
  "prixEtReference": "Prix FAI: 500 000‚Ç¨"
}
```

### **7.3. Interfaces TypeScript compl√®tes**

```typescript
interface AnnonceNewsletterData {
  titre: string;          // HTML: ...
  accroche: string;       // HTML: ......
  pointsForts: string;    // HTML: ......
  callToAction: string;   // HTML: ......
  prixEtReference: string; // HTML: ...
}

interface AnnonceNewsletterWithAgency extends AnnonceNewsletterData {
  agencyName: string;     // R√©cup√©r√© depuis localStorage (propertyData | etape1Data)
  imageUrl: string;       // URL fixe: https://www.presenca.fr/wp-content/uploads/image-newsletter.jpg
}
```

### **7.4. Tableaux r√©capitulatifs**

#### **Tableau 1 : Cl√©s localStorage et sources**

| **Cl√©** | **Type** | **Origine** | **Priorit√©** | **Hooks lecteurs** |
|---------|----------|-------------|--------------|-------------------|
| `generation_newsletter` | READ | OpenAI | 2 | `useRecuperationAnnonceNewsletterVersCreerNewsletter`, `useApercuAnnonceNewsletter`, `useApercuSauvegardeAnnonceNewsletter` |
| `key-modifs-creer-campagne-newsletter` | READ/WRITE | Utilisateur | 1 | Tous les hooks de r√©cup√©ration |
| `propertyData` | READ | √âtape 1 | - | `getAgencyName()` (dans `TemplateNewsletterHTML.ts`) |
| `etape1Data` | READ | √âtape 1 | - | `getAgencyName()` (fallback) |

#### **Tableau 2 : Flux de donn√©es**

| **Action** | **Hook/Fonction** | **Source** | **Destination** | **Traitement** |
|------------|-------------------|------------|-----------------|----------------|
| Chargement initial | `useRecuperationAnnonceNewsletterVersCreerNewsletter` | `key-modifs` > `generation_newsletter` | State `annonceNewsletter` | Parsing JSON |
| Modification champ | `handleChange` ‚Üí `updateAnnonceNewsletter` | State `annonceNewsletter` | `key-modifs-creer-campagne-newsletter` | Merge + stringify |
| Aper√ßu texte | `useApercuAnnonceNewsletter` | `key-modifs` > `generation_newsletter` | State `ApercuAnnonceNewsletter` | `stripHtmlTagsNewsletter()` |
| Copie texte | `copierAnnonceNewsletter` | `ApercuAnnonceNewsletter` | Clipboard | Concat√©nation avec `\n\n` |
| Copie HTML | `copierHTMLNewsletter` | `annonceNewsletter` | Clipboard | `generateNewsletterHTML()` |
| Aper√ßu HTML | `ouvrirApercuHTML` | `annonceNewsletter` | `window.open()` | `generateNewsletterHTML()` |
| Sauvegarde | `sauvegarderAnnonceNewsletter` | - | - | **Inactif** (toast "en d√©veloppement") |

---

## **VIII. PROCESSUS COMPLET √âTAPE PAR √âTAPE**

### **8.1. Chargement initial**

1. **Utilisateur acc√®de** √† `/etape6communication`
2. **S√©lectionne** l'option `"creer-campagne-newsletter"`
3. **Rendu** de ``
4. **Rendu** de `` avec onglet actif `"newsletter-tab1"`
5. **Rendu** de `` avec `editMode={false}`
6. **Hook** `useRecuperationAnnonceNewsletterVersCreerNewsletter()` s'ex√©cute :
   - Lecture `localStorage.getItem('key-modifs-creer-campagne-newsletter')`
   - Si existe ‚Üí charger ces donn√©es
   - Sinon ‚Üí Lecture `localStorage.getItem('generation_newsletter')` ‚Üí charger
7. **√âtat** `annonceNewsletter` mis √† jour
8. **Affichage** des 5 champs en mode lecture seule (``)

### **8.2. Affichage en mode lecture seule**

**Composant :** ``

**Structure :**
```typescript

  {isDescriptif ? (

  ) : (
    {content}
  )}

```

**Propri√©t√© `isDescriptif={true}` :**
- Tous les champs de Newsletter utilisent `isDescriptif={true}`
- Permet l'affichage du HTML via `dangerouslySetInnerHTML`

### **8.3. Activation du mode √©dition**

1. **Utilisateur clique** sur le bouton "Modifier" (dans `MenuOngletNewsletter`)
2. **Toggle** `newsletterEditMode` de `false` √† `true`
3. **Callback** `onEditModeChange(true)` vers `AccueilCreerCampagneNewsletter`
4. **√âtat** `editMode` devient `true`
5. **Prop** `editMode={true}` propag√©e vers ``
6. **Rendu conditionnel** : `` remplace ``
7. **Affichage** de l'√©diteur WYSIWYG (``)

### **8.4. Modification des champs**

**Flux de modification :**
1. **Utilisateur modifie** le contenu dans l'√©diteur WYSIWYG (ReactQuill)
2. **Event** `onChange` de ReactQuill d√©clench√©
3. **Callback** `handleChange(content)` dans `EditeurWYSIWYG.tsx`
4. **Mise √† jour** `setEditorValue(content)` (√©tat local)
5. **Callback** `onChange(content)` vers le parent `EditableField`
6. **Callback** `onChange={(value) => handleChange("titre", value)}` vers `File1.AnnonceNewsletter`
7. **Fonction** `handleChange(name, value)` :
   - Cr√©e `updatedData = { [name]: value }`
   - Appelle `updateAnnonceNewsletter(updatedData)`
8. **Hook** `useRecuperationAnnonceNewsletterVersCreerNewsletter` :
   - Merge `{ ...annonceNewsletter, ...newData }`
   - **Sauvegarde imm√©diate** dans `localStorage.setItem('key-modifs-creer-campagne-newsletter', JSON.stringify(updatedData))`

**‚ö†Ô∏è SAUVEGARDE AUTOMATIQUE ET IMM√âDIATE** : Chaque modification est instantan√©ment persist√©e dans localStorage.

### **8.5. Sauvegarde automatique**

**D√©clencheur :** Chaque modification dans un `EditableField`

**Process :**
```typescript
const updateAnnonceNewsletter = (newData: Partial) => {
  const updatedData = { ...annonceNewsletter, ...newData };
  setAnnonceNewsletter(updatedData);

  try {
    localStorage.setItem('key-modifs-creer-campagne-newsletter', JSON.stringify(updatedData));
  } catch (err) {
    console.error('Erreur lors de la sauvegarde des donn√©es:', err);
    setError('Erreur lors de la sauvegarde des donn√©es');
  }
};
```

**Bouton "Sauvegarder" (dans MenuOnglet) :**
- **NE fait PAS** de sauvegarde suppl√©mentaire (d√©j√† auto-sauvegard√©)
- **D√©sactive** le mode √©dition (`newsletterEditMode = false`)
- **Affiche** un toast de confirmation :
  ```typescript
  toast({
    title: "Modifications newsletter sauvegard√©es",
    description: "Les changements de la campagne newsletter ont √©t√© enregistr√©s avec succ√®s."
  });
  ```

### **8.6. Copie au format Texte/HTML**

#### **A. Copie format TEXTE**

**Onglet :** `"newsletter-tab2"` ‚Üí `File2.ActionUtilisateurCopierNewsletter`

**Bouton :** "Copier le texte de l'Annonce Newsletter"

**Process :**
1. **Hook** `useApercuAnnonceNewsletter()` charge les donn√©es avec `stripHtmlTagsNewsletter()`
2. **Fonction** `copierAnnonceNewsletter()` s'ex√©cute :
   ```typescript
   let texteToCopy = "";
   texteToCopy += annonceNewsletter.titre + "\n\n";
   texteToCopy += annonceNewsletter.accroche + "\n\n";
   texteToCopy += annonceNewsletter.pointsForts + "\n\n";
   texteToCopy += annonceNewsletter.callToAction + "\n\n";
   texteToCopy += annonceNewsletter.prixEtReference;

   await navigator.clipboard.writeText(texteToCopy);
   ```
3. **Toast** de succ√®s affich√©

**R√©sultat texte copi√© (exemple) :**
```
CARCASSONNE | RESTAURANT √Ä VENDRE | EMPLACEMENT PREMIUM | ...

CARCASSONNE AGENCE IMMOBILIERE vous invite √† d√©couvrir ce restaurant d'exception...
Cette affaire rare se distingue par...

Points Forts :

‚Ä¢ Emplacement strat√©gique : Tr√®s bel emplacement, quartier dynamique.
‚Ä¢ Cadre de l'√©tablissement : Surface de 205m2, belle d√©coration.
...

EMPLACEMENT PREMIUM, AFFAIRE RARE √Ä LA VENTE.
CLIQUEZ POUR EN SAVOIR PLUS.

‚Ä¢ Prix FAI : 456 895‚Ç¨
‚Ä¢ R√©f√©rence : REF-789
```

#### **B. Copie format HTML**

**Bouton :** "Copier le code de l'Emailing"

**Process :**
1. **Hook** `useRecuperationAnnonceNewsletterVersCreerNewsletter()` (donn√©es avec HTML)
2. **Fonction** `copierHTMLNewsletter()` s'ex√©cute :
   - Appelle `generateNewsletterHTML(annonceNewsletter)`
   - R√©cup√®re le nom de l'agence via `getAgencyName()`
   - Remplace les placeholders dans `NEWSLETTER_TEMPLATE`
   - Formate `pointsForts` via `formatPointsFortsForEmail()`
   - Formate `prixEtReference` via `formatPrixEtReferenceForEmail()`
3. **HTML complet** g√©n√©r√© (95 lignes)
4. **Copie** via `navigator.clipboard.writeText(htmlContent)`
5. **Toast** de succ√®s

**Bouton :** "Voir l'Aper√ßu de cet Emailing"

**Process :**
1. M√™me g√©n√©ration HTML que "Copier le code"
2. **Ouverture** nouvelle fen√™tre : `window.open('', '_blank')`
3. **√âcriture** HTML : `newWindow.document.write(htmlContent)`
4. **Toast** de succ√®s

---

## **IX. SYST√àME D'√âDITION - BOUTON "MODIFIER"**

### **9.1. Localisation**

**Fichier :** `MenuOngletPortailsImmobiliers.tsx`

**Position :** Onglet 1 uniquement ("Annonce"), en haut √† droite

**Condition d'affichage :**
```typescript
{enableEditMode && (

      {newsletterEditMode ? (
        <>Sauvegarder
      ) : (
        <>Modifier
      )}

)}
```

### **9.2. Comportement toggle (Modifier ‚Üî Sauvegarder)**

**√âtat initial :** "Modifier" (ic√¥ne `Edit`)

**Clic sur "Modifier" :**
1. `toggleNewsletterEditMode()` ex√©cut√©
2. `newsletterEditMode` passe de `false` √† `true`
3. Bouton affiche "Sauvegarder" (ic√¥ne `Save`)
4. Callback `onEditModeChange(true)` vers parent
5. `editMode` propag√© vers `File1.AnnonceNewsletter`
6. Affichage des `` (WYSIWYG)

**Clic sur "Sauvegarder" :**
1. `toggleNewsletterEditMode()` ex√©cut√©
2. `newsletterEditMode` passe de `true` √† `false`
3. **Toast affich√©** :
   ```typescript
   toast({
     title: "Modifications newsletter sauvegard√©es",
     description: "Les changements de la campagne newsletter ont √©t√© enregistr√©s avec succ√®s."
   });
   ```
4. Bouton affiche "Modifier" (ic√¥ne `Edit`)
5. Callback `onEditModeChange(false)` vers parent
6. Affichage des ``

### **9.3. Propagation de l'√©tat**

**Flux de propagation :**
```
MenuOngletNewsletter (newsletterEditMode)
    ‚Üì onEditModeChange(isEditMode)
AccueilCreerCampagneNewsletter (editMode)
    ‚Üì editMode={editMode}
File1.AnnonceNewsletter
    ‚Üì editMode ?  : 
```

### **9.4. Affichage conditionnel**

**Dans `File1.AnnonceNewsletter.tsx` :**
```typescript
{editMode ? (
   handleChange("titre", value)}
    rows={2}
    useWysiwyg={true}
  />
) : (

)}
```

### **9.5. Nettoyage HTML**

**‚ö†Ô∏è AUCUN NETTOYAGE HTML APPLIQU√â**

Contrairement aux autres canaux, le canal Newsletter **NE nettoie PAS** les balises HTML car :
- Les donn√©es OpenAI sont d√©j√† en **HTML structur√©** (``, ``, ``, ``, ``)
- Le format HTML est **requis** pour l'emailing
- L'√©dition WYSIWYG **produit du HTML** (ReactQuill)

**Affichage lecture seule :**
```typescript

```

**Affichage √©dition :**
```typescript

```

### **9.6. √âditeur WYSIWYG (EditeurWYSIWYG.tsx)**

**Technologie :** ReactQuill

**Configuration :**
```typescript
const defaultModules = {
  toolbar: false  // ‚ö†Ô∏è Barre d'outils D√âSACTIV√âE
};

const formats = [
  'header',
  'bold', 'italic', 'underline', 'strike',
  'list', 'bullet'
];
```

**Style :**
```css
.quill-custom-font .ql-editor {
  font-size: 18px;
  font-family: 'Nunito', sans-serif;
  line-height: 1.6;
}

.quill-custom-font .ql-toolbar {
  display: none;  /* Toolbar cach√©e */
}
```

**Hauteur dynamique :**
```typescript
const editorHeight = `${Math.max(150, rows * 40)}px`;
```

**Propri√©t√© `simpleMode` :**
- `simpleMode = true` si `rows <= 3` (champs courts : titre, accroche, CTA)
- `simpleMode = false` si `rows > 3` (champs longs : pointsForts)
- **Non utilis√©e actuellement** (toolbar toujours d√©sactiv√©e)

---

## **X. OPTIONS DE COPIE**

### **10.1. FORMAT TEXTE**

#### **A. Bouton "Copier le texte de l'Annonce Newsletter"**

**Composant :** `CopyNewsletter3` (dans `File2.ActionUtilisateurCopierNewsletter`)

**Hook :** `useCopierTexteCampagneNewsletter()`

**Fonction :** `copierAnnonceNewsletter()`

**Process d√©taill√© :**
1. **V√©rification** de l'√©tat de chargement (`isLoading`)
2. **V√©rification** des erreurs (`error`)
3. **Construction** du texte :
   ```typescript
   let texteToCopy = "";
   texteToCopy += annonceNewsletter.titre + "\n\n";
   texteToCopy += annonceNewsletter.accroche + "\n\n";
   texteToCopy += annonceNewsletter.pointsForts + "\n\n";
   texteToCopy += annonceNewsletter.callToAction + "\n\n";
   texteToCopy += annonceNewsletter.prixEtReference;
   ```
4. **Copie** dans clipboard : `await navigator.clipboard.writeText(texteToCopy)`
5. **Toast** de succ√®s :
   ```typescript
   toast({
     title: "Succ√®s",
     description: "L'annonce newsletter a √©t√© copi√©e dans le presse-papier",
     duration: 3000,
   });
   ```

**Donn√©es source :** `useApercuAnnonceNewsletter()` ‚Üí donn√©es avec `stripHtmlTagsNewsletter()`

**R√©sultat copi√© (exemple) :**
```
CARCASSONNE | RESTAURANT √Ä VENDRE | ...

CARCASSONNE AGENCE pr√©sente ce restaurant...
Cette affaire se distingue par...

Points Forts :

‚Ä¢ Emplacement : Quartier dynamique.
‚Ä¢ Cadre : 205m2, d√©coration raffin√©e.

EMPLACEMENT PREMIUM, AFFAIRE RARE.
CLIQUEZ POUR EN SAVOIR PLUS.

‚Ä¢ Prix FAI : 456 895‚Ç¨
‚Ä¢ R√©f√©rence : REF-789
```

### **10.2. FORMAT HTML**

#### **A. Bouton "Copier le code de l'Emailing"**

**Hook :** `useCopierHTMLCampagneNewsletter()`

**Fonction :** `copierHTMLNewsletter()`

**Process d√©taill√© :**
1. **V√©rification** de l'√©tat de chargement et erreurs
2. **G√©n√©ration** du HTML : `const htmlContent = generateNewsletterHTML(annonceNewsletter)`
3. **Copie** dans clipboard : `await navigator.clipboard.writeText(htmlContent)`
4. **Toast** de succ√®s

**Donn√©es source :** `useRecuperationAnnonceNewsletterVersCreerNewsletter()` ‚Üí donn√©es **avec HTML**

#### **B. Bouton "Voir l'Aper√ßu de cet Emailing"**

**Fonction :** `ouvrirApercuHTML()`

**Process d√©taill√© :**
1. **G√©n√©ration** du HTML : `const htmlContent = generateNewsletterHTML(annonceNewsletter)`
2. **Ouverture** nouvelle fen√™tre : `const newWindow = window.open('', '_blank')`
3. **√âcriture** du HTML : `newWindow.document.write(htmlContent)`
4. **Fermeture** du flux : `newWindow.document.close()`
5. **Toast** de succ√®s

### **10.3. Logique de formatage d√©taill√©e**

#### **A. Fonction `generateNewsletterHTML(annonceData)`**

**Fichier :** `TemplateNewsletterHTML.ts`

**Process :**
1. **R√©cup√©ration** du nom de l'agence :
   ```typescript
   const getAgencyName = (): string => {
     const propertyData = localStorage.getItem('propertyData');
     if (propertyData) {
       const parsedData = JSON.parse(propertyData);
       return parsedData.agencyName || parsedData.agency || 'VOTRE AGENCE';
     }

     const etape1Data = localStorage.getItem('etape1Data');
     if (etape1Data) {
       const parsedEtape1 = JSON.parse(etape1Data);
       return parsedEtape1.agencyName || parsedEtape1.agency || 'VOTRE AGENCE';
     }

     return 'VOTRE AGENCE';
   };
   ```

2. **Construction** de l'objet `AnnonceNewsletterWithAgency` :
   ```typescript
   const dataWithAgency: AnnonceNewsletterWithAgency = {
     ...annonceData,
     agencyName: getAgencyName(),
     imageUrl: 'https://www.presenca.fr/wp-content/uploads/image-newsletter.jpg',
     pointsForts: formatPointsFortsForEmail(annonceData.pointsForts),
     prixEtReference: formatPrixEtReferenceForEmail(annonceData.prixEtReference)
   };
   ```

3. **Remplacement** des placeholders dans `NEWSLETTER_TEMPLATE` :
   ```typescript
   let html = NEWSLETTER_TEMPLATE;

   Object.entries(dataWithAgency).forEach(([key, value]) => {
     const placeholder = `{{${key}}}`;
     html = html.replace(new RegExp(placeholder, 'g'), value || '');
   });

   return html;
   ```

#### **B. Fonction `formatPointsFortsForEmail(pointsFortsHTML)`**

**Objectif :** Convertir le HTML brut des Points Forts en HTML optimis√© pour emailing

**Process :**
1. **V√©rification** si d√©j√† format√© (contient ``) ‚Üí retour tel quel
2. **Parsing** du HTML avec `DOMParser` :
   ```typescript
   const parser = new DOMParser();
   const doc = parser.parseFromString(pointsFortsHTML, 'text/html');
   const listItems = doc.querySelectorAll('li');
   ```
3. **It√©ration** sur chaque `` :
   - Extraction du titre (texte en ``)
   - Extraction de la description (apr√®s `:`)
   - Construction de la ligne format√©e :
     ```typescript
     formattedPoints += `${titre} : ${description}`;
     ```
4. **Retour** du HTML format√©

**Exemple transformation :**

**Entr√©e :**
```html

  Emplacement strat√©gique: Tr√®s bel emplacement en angle...
  Cadre de l'√©tablissement: Surface de 205m2...

```

**Sortie :**
```html
Emplacement strat√©gique : Tr√®s bel emplacement en angle...
Cadre de l'√©tablissement : Surface de 205m2...
```

#### **C. Fonction `formatPrixEtReferenceForEmail(prixEtReferenceHTML)`**

**Objectif :** Convertir le Prix et R√©f√©rence en liste HTML avec style inline

**‚ö†Ô∏è CORRECTION APPLIQU√âE** pour g√©rer le format coll√© "Prix FAI : FAI: 456 890‚Ç¨R√©f√©rence: ERT+90"

**Process :**
1. **V√©rification** si d√©j√† format√© (contient ``) ‚Üí retour tel quel
2. **Nettoyage** HTML : `const cleanText = stripHtmlTags(prixEtReferenceHTML)`
3. **Split** sur `‚Ç¨` pour s√©parer prix et r√©f√©rence :
   ```typescript
   const parts = cleanText.split('‚Ç¨');

   if (parts.length >= 2) {
     const prixPart = parts[0].trim() + '‚Ç¨';
     const prixClean = prixPart.replace(/prix\s*:?\s*/gi, '').replace(/fai\s*:?\s*/gi, '').trim();

     const refPart = parts[1].trim();
     const refClean = refPart.replace(/r√©f√©rence\s*:?\s*/gi, '').replace(/ref\s*:?\s*/gi, '').trim();

     let formattedPrixRef = '';
     formattedPrixRef += `Prix FAI : ${prixClean}`;
     formattedPrixRef += `R√©f√©rence : ${refClean}`;
     formattedPrixRef += '';

     return formattedPrixRef;
   }
   ```
4. **Fallback** si pas de `‚Ç¨` : traitement ligne par ligne

**Exemple transformation :**

**Entr√©e (format OpenAI) :**
```html

  Prix FAI: 456 895‚Ç¨
  R√©f√©rence: REF-789

```

**Sortie (avec styles inline) :**
```html

  Prix FAI : 456 895‚Ç¨
  R√©f√©rence : REF-789

```

#### **D. Template `NEWSLETTER_TEMPLATE`**

**Structure compl√®te (95 lignes) :**

```html

  Newsletter

          {{agencyName}}

          {{titre}}

        {{accroche}}

          {{pointsForts}}

          {{callToAction}}

          {{prixEtReference}}

          D√©couvrir cette Opportunit√©

        Mentions L√©gales

```

**Placeholders utilis√©s :**
- `{{agencyName}}` ‚Üí Nom de l'agence
- `{{imageUrl}}` ‚Üí URL de l'image
- `{{titre}}` ‚Üí Titre de l'annonce
- `{{accroche}}` ‚Üí Accroche
- `{{pointsForts}}` ‚Üí Points forts (HTML format√©)
- `{{callToAction}}` ‚Üí CTA
- `{{prixEtReference}}` ‚Üí Prix et r√©f√©rence (HTML format√©)

---

## **XI. SYST√àME D'APER√áU**

### **11.1. Hook Aper√ßu : `useApercuAnnonceNewsletter`**

**Fichier :** `HookCopierApercuAnnonceNewsletter.tsx`

**Objectif :** Fournir une version **texte brut** de l'annonce pour l'aper√ßu et la copie texte

**Process :**
1. **Lecture** localStorage (priorit√© : `key-modifs` > `generation_newsletter`)
2. **Application** de `stripHtmlTagsNewsletter()` sur **tous les champs**
3. **Stockage** dans `ApercuAnnonceNewsletter`

**Retour :**
```typescript
{
  annonceNewsletter: {
    titre: string,         // Texte brut (HTML supprim√©)
    accroche: string,      // Texte brut
    pointsForts: string,   // Texte brut avec puces ‚Ä¢
    callToAction: string,  // Texte brut
    prixEtReference: string // Texte brut avec puces ‚Ä¢
  },
  isLoading: boolean,
  error: string | null
}
```

**Fonction `stripHtmlTagsNewsletter()` :**

**Particularit√© :** Gestion optimis√©e des transitions `p‚Üíul` avec **double saut de ligne**

**Process :**
1. **Marquage** des transitions :
   - `` ‚Üí `###SAUT_LIGNE###`
   - `` ‚Üí `###SAUT_LIGNE###`
   - `` ‚Üí `###DOUBLE_SAUT_LIGNE###` ‚ö†Ô∏è
2. **Conversion** des listes HTML :
   - `` ‚Üí supprim√©
   - `` ‚Üí `\n`
   - `` ‚Üí `‚Ä¢ `
   - `` ‚Üí `\n`
3. **Suppression** de toutes les balises HTML
4. **Remplacement** des marqueurs :
   - `###DOUBLE_SAUT_LIGNE###` ‚Üí `\n\n`
   - `###SAUT_LIGNE###` ‚Üí `\n`
5. **Nettoyage** des sauts multiples : `\n{4,}` ‚Üí `\n\n`

**Exemple transformation :**

**Entr√©e HTML :**
```html
Points Forts :

  Emplacement : Quartier dynamique.
  Cadre : 205m2.

```

**Sortie Texte :**
```
Points Forts :

‚Ä¢ Emplacement : Quartier dynamique.
‚Ä¢ Cadre : 205m2.
```

### **11.2. Hook Aper√ßu : `useApercuSauvegardeAnnonceNewsletter`**

**Fichier :** `HookApercuSauvegardeAnnonceNewsletter.tsx`

**Objectif :** Fournir les donn√©es **avec HTML** pour l'aper√ßu de sauvegarde (5 champs s√©par√©s)

**Diff√©rence avec `useApercuAnnonceNewsletter` :**
- **Pas de nettoyage HTML**
- Donn√©es brutes conserv√©es pour affichage via `dangerouslySetInnerHTML`

**Utilisation :**
- Composant `ApercuSauvegardeAnnonceNewsletter5champs` (dans le m√™me fichier)
- Affichage des 5 champs avec `` + ``

**Structure du composant `ApercuSauvegardeAnnonceNewsletter5champs` :**
```typescript

    Titre

    Accroche

```

### **11.3. Fonctions d√©taill√©es**

#### **Affichage de l'aper√ßu dans Onglet 2 (Copier l'Annonce)**

**Composant :** `` (dans `File2.ActionUtilisateurCopierNewsletter`)

**Structure :**
```typescript

```

**Rendu :**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Aper√ßu de l'Annonce Newsletter                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ CARCASSONNE | RESTAURANT √Ä VENDRE | ...         ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ CARCASSONNE AGENCE pr√©sente...                  ‚îÇ
‚îÇ Cette affaire se distingue...                   ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ Points Forts :                                   ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ ‚Ä¢ Emplacement : Quartier dynamique.             ‚îÇ
‚îÇ ‚Ä¢ Cadre : 205m2.                                 ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ EMPLACEMENT PREMIUM, AFFAIRE RARE.              ‚îÇ
‚îÇ CLIQUEZ POUR EN SAVOIR PLUS.                    ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ ‚Ä¢ Prix FAI : 456 895‚Ç¨                            ‚îÇ
‚îÇ ‚Ä¢ R√©f√©rence : REF-789                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **Affichage de la visualisation dans Onglet 3 (Utiliser l'Annonce)**

**Composant :** `` (dans `File3.ActionUtilisateurSauvegarderNewsletter`)

**Rendu :**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Visualisation de l'Annonce Newsletter sauvegard√©e‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Titre                                            ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ CARCASSONNE | RESTAURANT √Ä VENDRE | ...     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ Accroche                                         ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ CARCASSONNE AGENCE pr√©sente...              ‚îÇ ‚îÇ
‚îÇ ‚îÇ Cette affaire se distingue...               ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ Points Forts                                     ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ Points Forts :                               ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚Ä¢ Emplacement : ...                          ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚Ä¢ Cadre : ...                                ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ Appel √† l'action                                 ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ EMPLACEMENT PREMIUM, AFFAIRE RARE.          ‚îÇ ‚îÇ
‚îÇ ‚îÇ CLIQUEZ POUR EN SAVOIR PLUS.                ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                  ‚îÇ
‚îÇ Prix ou Loyer & R√©f√©rence                        ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ ‚Ä¢ Prix FAI : 456 895‚Ç¨                        ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚Ä¢ R√©f√©rence : REF-789                        ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## **XII. CONTRAINTES ET VALIDATION**

### **12.1. Validation des champs (nettoyage HTML)**

**‚ö†Ô∏è PARTICULARIT√â DU CANAL NEWSLETTER :**

**AUCUN nettoyage HTML appliqu√©** car :
1. **OpenAI g√©n√®re du HTML structur√©** (``, ``, ``, ``, ``)
2. **Le format HTML est requis** pour l'emailing
3. **L'√©dition WYSIWYG produit du HTML** (ReactQuill)
4. **Le template d'emailing attend du HTML**

**Diff√©rence avec les autres canaux :**
- **Site Internet Annonces** : Nettoyage partiel (titre, accroche, CTA) + conservation HTML (descriptif)
- **Outils SEO** : Nettoyage total (texte brut uniquement)
- **Newsletter** : **Aucun nettoyage** (HTML int√©gral conserv√©)

**Fonction de nettoyage HTML utilis√©e uniquement pour l'aper√ßu texte :**
```typescript
// Dans HookCopierApercuAnnonceNewsletter.tsx
const stripHtmlTagsNewsletter = (html: string): string => {
  // Utilis√© UNIQUEMENT pour l'aper√ßu texte et la copie texte
  // PAS pour l'affichage ou l'√©dition
}
```

### **12.2. Gestion des erreurs (loading, error)**

**√âtats g√©r√©s dans tous les hooks de r√©cup√©ration :**
```typescript
const [isLoading, setIsLoading] = useState(true);
const [error, setError] = useState(null);
```

**Affichage conditionnel dans `File1.AnnonceNewsletter` :**
```typescript
if (isLoading) {
  return Chargement des donn√©es...;
}

if (error) {
  return {error};
}
```

**Gestion des erreurs de copie :**
```typescript
try {
  await navigator.clipboard.writeText(texteToCopy);
  toast({ title: "Succ√®s", ... });
} catch (error) {
  console.error('Erreur lors de la copie:', error);
  toast({
    title: "Erreur",
    description: "Une erreur s'est produite lors de la copie",
    variant: "destructive",
    duration: 3000,
  });
}
```

**Gestion des erreurs de sauvegarde localStorage :**
```typescript
try {
  localStorage.setItem('key-modifs-creer-campagne-newsletter', JSON.stringify(updatedData));
} catch (err) {
  console.error('Erreur lors de la sauvegarde des donn√©es:', err);
  setError('Erreur lors de la sauvegarde des donn√©es');
}
```

### **12.3. Toasts de notification**

**Types de toasts utilis√©s :**

| **Action** | **Titre** | **Description** | **Variant** | **Dur√©e** |
|------------|-----------|-----------------|-------------|-----------|
| Sauvegarde modifications (bouton "Sauvegarder") | "Modifications newsletter sauvegard√©es" | "Les changements de la campagne newsletter ont √©t√© enregistr√©s avec succ√®s." | default | - |
| Copie texte - succ√®s | "Succ√®s" | "L'annonce newsletter a √©t√© copi√©e dans le presse-papier" | default | 3000ms |
| Copie HTML - succ√®s | "Succ√®s" | "Le code HTML de l'emailing a √©t√© copi√© dans le presse-papier" | default | 3000ms |
| Aper√ßu HTML - succ√®s | "Succ√®s" | "L'aper√ßu de l'emailing a √©t√© ouvert dans votre explorateur" | default | 3000ms |
| Sauvegarde annonce | "Fonctionnalit√© en d√©veloppement" | "La sauvegarde automatique sera disponible prochainement." | default | - |
| Copie - donn√©es en chargement | "Information" | "Les donn√©es sont en cours de chargement..." | default | 3000ms |
| Copie - erreur r√©cup√©ration | "Erreur" | "Impossible de r√©cup√©rer les donn√©es de l'annonce newsletter" | destructive | 3000ms |
| Copie - erreur g√©n√©rale | "Erreur" | "Une erreur s'est produite lors de la copie..." | destructive | 3000ms |
| Aper√ßu HTML - erreur | "Erreur" | "Une erreur s'est produite lors de l'ouverture de l'aper√ßu" | destructive | 3000ms |

### **12.4. S√©curit√©**

**Utilisation de `dangerouslySetInnerHTML` :**
```typescript
// Dans ReadOnlyField
{isDescriptif ? (

) : (
  {content}
)}
```

**‚ö†Ô∏è RISQUE DE S√âCURIT√â :**
- Pas de sanitization du HTML (pas de `DOMPurify`)
- Injection possible si les donn√©es OpenAI sont compromises
- **Recommandation future** : Int√©grer `DOMPurify` pour nettoyer le HTML avant affichage

**Mitigation actuelle :**
- Source de donn√©es contr√¥l√©e (OpenAI + localStorage)
- Pas d'input utilisateur direct dans le HTML (passage par ReactQuill)
- ReactQuill effectue une certaine sanitization

---

## **XIII. COMPOSANTS GRAPHIQUES R√âUTILISABLES**

### **13.1. LabelField**

**Fichier :** `GraphismeInterieurNewsletter.tsx`

**Interface :**
```typescript
interface LabelFieldProps {
  htmlFor: string;
  children: ReactNode;
  className?: string;
}
```

**Rendu :**
```typescript

  {children}

```

**Utilisation :**
```typescript
Titre
```

### **13.2. ReadOnlyField**

**Interface :**
```typescript
interface ReadOnlyFieldProps {
  id: string;
  content: string;
  isDescriptif?: boolean;
  className?: string;
}
```

**Rendu :**
```typescript

  {isDescriptif ? (

  ) : (
    {content}
  )}

```

**Utilisation :**
```typescript

```

### **13.3. EditableField**

**Interface :**
```typescript
interface EditableFieldProps {
  id: string;
  value: string;
  onChange: (value: string) => void;
  rows?: number;
  className?: string;
  useWysiwyg?: boolean;
}
```

**Rendu conditionnel :**
```typescript
if (useWysiwyg) {
  const simpleMode = rows <= 3;
  return (

  );
}

return (
   onChange(e.target.value)} 
    className={cn("w-full rounded-md border border-gray-200 p-3", className)}
    rows={rows}
  />
);
```

**Utilisation :**
```typescript
<EditableField
  id="titre"
  value={annonceNewsletter.titre}
  onChange={(value) => handleChange("titre", value)}
  rows={2}
  useWysiwyg={true}  // ‚ö†Ô∏è Tous les champs Newsletter utilisent useWysiwyg={true}
/>
```

### **13.4. CopyNewsletter3**

**Interface :**
```typescript
interface CopyNewsletter3Props {
  title: string;
  description: string;
  icon: React.ReactNode;
  buttons: Array<{
    text: string;
    onClick: () => void;
  }>;
  className?: string;
}
```

**Rendu :**
```typescript
<div className={cn("border-l-4 border-l-realestate-mauve bg-white p-4 rounded-r-lg shadow-sm hover:shadow-md transition-all", className)}>
  <div className="flex items-start mb-3">
    <div className="p-2 rounded-lg bg-realestate-purple-light text-realestate-purple-dark mr-3">
      {icon}
    </div>
    <div>
      <h4 className="font-semibold">{title}</h4>
      <p className="text-sm text-gray-600">{description}</p>
    </div>
  </div>
  <div className="space-y-3">
    {buttons.map((button, index) => (
      <Button key={index} onClick={button.onClick} className="w-full bg-realestate-mauve hover:bg-realestate-mauve-dark text-white justify-start">
        <ClipboardCopy className="mr-2 h-4 w-4" />
        {button.text}
      </Button>
    ))}
  </div>
</div>
```

**Utilisation :**
```typescript
<CopyNewsletter3
  title="Format Texte"
  description="Format pour copier le texte de votre annonce newsletter"
  icon={<FileText className="h-5 w-5" />}
  buttons={[
    { text: "Copier le texte de l'Annonce Newsletter", onClick: copierAnnonceNewsletter }
  ]}
/>
```

### **13.5. CopyNewsletterOptionsContainer**

**Interface :**
```typescript
interface CopyNewsletterOptionsContainerProps {
  children: ReactNode;
  className?: string;
}
```

**Rendu :**
```typescript
<div className={cn("grid md:grid-cols-2 gap-6", className)}>
  {children}
</div>
```

**Utilisation :**
```typescript
<CopyNewsletterOptionsContainer>
  <CopyNewsletter3 title="Format Texte" ... />
  <CopyNewsletter3 title="Format HTML Emailing" ... />
</CopyNewsletterOptionsContainer>
```

### **13.6. NewsletterPreview**

**Interface :**
```typescript
interface NewsletterPreviewProps {
  title: string;
  className?: string;
  children?: ReactNode;
}
```

**Rendu :**
```typescript
<div className={cn("mt-6 p-4 bg-realestate-purple-light/10 border border-realestate-purple-light rounded-lg", className)}>
  <h4 className="font-semibold mb-2">{title}</h4>
  <div className="bg-white p-4 rounded border border-gray-200 max-h-64 overflow-y-auto">
    {children}
  </div>
</div>
```

**Utilisation :**
```typescript
<NewsletterPreview title="Aper√ßu de l'Annonce Newsletter">
  <ReadOnlyField id="apercu-newsletter" content={...} />
</NewsletterPreview>
```

### **13.7. EditeurWYSIWYG**

**Interface :**
```typescript
interface EditeurWYSIWYGProps {
  value: string;
  onChange: (content: string) => void;
  rows?: number;
  className?: string;
  simpleMode?: boolean;
}
```

**Configuration :**
```typescript
const defaultModules = {
  toolbar: false  // ‚ö†Ô∏è Toolbar d√©sactiv√©e
};

const formats = [
  'header',
  'bold', 'italic', 'underline', 'strike',
  'list', 'bullet'
];
```

**Rendu :**
```typescript
<div className="quill-custom-font">
  <ReactQuill
    theme="snow"
    value={editorValue}
    onChange={handleChange}
    modules={defaultModules}
    formats={formats}
    style={{ height: editorHeight, fontSize: '18px', fontFamily: 'Nunito, sans-serif' }}
    className={className}
    placeholder=""
  />
  <style>{`
    .quill-custom-font .ql-editor {
      font-size: 18px;
      font-family: 'Nunito', sans-serif;
      line-height: 1.6;
    }
    .quill-custom-font .ql-toolbar {
      display: none;  /* Toolbar cach√©e */
    }
    .quill-custom-font .ql-container {
      border-top: 1px solid #ccc;
    }
  `}</style>
</div>
```

**Particularit√©s :**
- Police : `Nunito, sans-serif` √† `18px`
- Hauteur dynamique : `Math.max(150, rows * 40)px`
- Toolbar d√©sactiv√©e (affichage et fonctionnalit√©)
- Formats permis : header, bold, italic, underline, strike, list, bullet

---

## **XIV. TABLEAUX R√âCAPITULATIFS**

### **14.1. Tableau des champs de l'annonce newsletter**

| **Champ** | **Label UI** | **Format OpenAI** | **Stockage** | **√âdition** | **Rows** |
|-----------|--------------|-------------------|--------------|-------------|----------|
| `titre` | "Titre" | `<p>TEXTE EN MAJUSCULES</p>` | HTML | WYSIWYG | 2 |
| `accroche` | "Accroche" | `<p>Phrase 1.<br>Phrase 2.</p>` | HTML | WYSIWYG | 3 |
| `pointsForts` | "Points Forts" | `<p><strong>Points Forts :</strong></p><ul><li>...</li></ul>` | HTML | WYSIWYG | 8 |
| `callToAction` | "Appel √† l'action" | `<p>PHRASE 1.<br>PHRASE 2.</p>` | HTML | WYSIWYG | 3 |
| `prixEtReference` | "Prix ou Loyer & R√©f√©rence" | `<ul><li><strong>Prix FAI</strong>: 456‚Ç¨</li><li><strong>R√©f√©rence</strong>: REF-123</li></ul>` | HTML | WYSIWYG | 3 |

### **14.2. Tableau des hooks**

| **Hook** | **Fichier** | **R√¥le** | **Traitement HTML** | **Retour** |
|----------|-------------|----------|---------------------|------------|
| `useRecuperationAnnonceNewsletterVersCreerNewsletter` | `HookRecuperationAnnonceNewsletterVersCreerNewsletter.ts` | R√©cup√©ration + Update | Aucun (HTML conserv√©) | `{ annonceNewsletter, updateAnnonceNewsletter, isLoading, error }` |
| `useApercuAnnonceNewsletter` | `HookCopierApercuAnnonceNewsletter.tsx` | Aper√ßu texte | `stripHtmlTagsNewsletter()` | `{ annonceNewsletter, isLoading, error }` |
| `useApercuSauvegardeAnnonceNewsletter` | `HookApercuSauvegardeAnnonceNewsletter.tsx` | Aper√ßu sauvegarde | Aucun (HTML conserv√©) | `{ annonceNewsletter, isLoading, error }` |
| `useCopierTexteCampagneNewsletter` | `HookCopierTexteCampagneNewsletter.tsx` | Copie texte | Utilise `useApercuAnnonceNewsletter` (stripped) | `{ copierAnnonceNewsletter }` |
| `useCopierHTMLCampagneNewsletter` | `HookCopierHTMLCampagneNewsletter.tsx` | Copie HTML + Aper√ßu | Utilise `useRecuperationAnnonceNewsletterVersCreerNewsletter` (HTML) | `{ copierHTMLNewsletter, ouvrirApercuHTML }` |
| `useSauvegarderCampagneNewsletter` | `HookSauvegarderCampagneNewsletter.tsx` | Sauvegarde (inactif) | - | `{ sauvegarderAnnonceNewsletter, isSaving }` |

### **14.3. Tableau des fonctions de copie**

| **Fonction** | **Hook** | **Source de donn√©es** | **Traitement** | **Destination** | **Toast** |
|--------------|----------|----------------------|----------------|-----------------|-----------|
| `copierAnnonceNewsletter()` | `useCopierTexteCampagneNewsletter` | `useApercuAnnonceNewsletter` (texte stripped) | Concat√©nation avec `\n\n` | `navigator.clipboard` | "L'annonce newsletter a √©t√© copi√©e" |
| `copierHTMLNewsletter()` | `useCopierHTMLCampagneNewsletter` | `useRecuperationAnnonceNewsletterVersCreerNewsletter` (HTML) | `generateNewsletterHTML()` | `navigator.clipboard` | "Le code HTML de l'emailing a √©t√© copi√©" |
| `ouvrirApercuHTML()` | `useCopierHTMLCampagneNewsletter` | `useRecuperationAnnonceNewsletterVersCreerNewsletter` (HTML) | `generateNewsletterHTML()` | `window.open()` | "L'aper√ßu de l'emailing a √©t√© ouvert" |
| `sauvegarderAnnonceNewsletter()` | `useSauvegarderCampagneNewsletter` | - | - | - | "Fonctionnalit√© en d√©veloppement" |

### **14.4. Tableau des fonctions de formatage HTML**

| **Fonction** | **Fichier** | **Input** | **Output** | **Utilisation** |
|--------------|-------------|-----------|------------|-----------------|
| `stripHtmlTags()` | `TemplateNewsletterHTML.ts` | HTML | Texte brut | Helper pour `formatPointsFortsForEmail` et `formatPrixEtReferenceForEmail` |
| `formatPointsFortsForEmail()` | `TemplateNewsletterHTML.ts` | `<ul><li><strong>Titre</strong>: Description</li></ul>` | HTML avec styles inline | Template HTML emailing |
| `formatPrixEtReferenceForEmail()` | `TemplateNewsletterHTML.ts` | `<ul><li><strong>Prix FAI</strong>: 456‚Ç¨</li><li><strong>R√©f√©rence</strong>: REF-123</li></ul>` | HTML avec styles inline | Template HTML emailing |
| `getAgencyName()` | `TemplateNewsletterHTML.ts` | `localStorage` (`propertyData` ou `etape1Data`) | String (nom agence) | Template HTML emailing |
| `generateNewsletterHTML()` | `TemplateNewsletterHTML.ts` | `AnnonceNewsletterData` | HTML complet (95 lignes) | Copie HTML + Aper√ßu HTML |
| `stripHtmlTagsNewsletter()` | `HookCopierApercuAnnonceNewsletter.tsx` | HTML | Texte brut (avec puces `‚Ä¢` et double saut `p‚Üíul`) | Aper√ßu texte + Copie texte |

### **14.5. Matrice Onglets √ó Actions √ó Fichiers**

| **Onglet** | **Action** | **Bouton** | **Hook/Fonction** | **Fichier** | **Destination** |
|------------|------------|-----------|-------------------|-------------|-----------------|
| **1. Annonce** | Afficher | - | `useRecuperationAnnonceNewsletterVersCreerNewsletter` | `File1.AnnonceNewsletter.tsx` | UI (ReadOnlyField) |
| | Modifier | "Modifier" | `toggleNewsletterEditMode` | `MenuOngletPortailsImmobiliers.tsx` | `editMode = true` |
| | √âditer | - | `handleChange` ‚Üí `updateAnnonceNewsletter` | `File1.AnnonceNewsletter.tsx` | `key-modifs-creer-campagne-newsletter` |
| | Sauvegarder | "Sauvegarder" | `toggleNewsletterEditMode` | `MenuOngletPortailsImmobiliers.tsx` | Toast + `editMode = false` |
| **2. Copier l'Annonce** | Copier texte | "Copier le texte de l'Annonce Newsletter" | `copierAnnonceNewsletter` | `File2.ActionUtilisateurCopierNewsletter.tsx` | Clipboard |
| | Copier HTML | "Copier le code de l'Emailing" | `copierHTMLNewsletter` | `File2.ActionUtilisateurCopierNewsletter.tsx` | Clipboard |
| | Aper√ßu HTML | "Voir l'Aper√ßu de cet Emailing" | `ouvrirApercuHTML` | `File2.ActionUtilisateurCopierNewsletter.tsx` | `window.open()` |
| | Afficher aper√ßu | - | `useApercuAnnonceNewsletter` | `File2.ActionUtilisateurCopierNewsletter.tsx` | UI (NewsletterPreview) |
| **3. Utiliser l'Annonce** | Sauvegarder | "Sauvegarder l'Annonce" | `sauvegarderAnnonceNewsletter` | `File3.ActionUtilisateurSauvegarderNewsletter.tsx` | Toast (inactif) |
| | Visualiser | - | `ApercuSauvegardeAnnonceNewsletter5champs` | `File3.ActionUtilisateurSauvegarderNewsletter.tsx` | UI (NewsletterPreview) |

---

## **XV. DONN√âES √Ä PRENDRE EN CONSID√âRATION**

### **15.1. Points d'attention techniques**

1. **Conservation du HTML int√©gral**
   - Tous les champs sont en HTML (contrairement au canal Outils SEO)
   - Pas de nettoyage HTML (sauf pour aper√ßu/copie texte)
   - `dangerouslySetInnerHTML` utilis√© partout (risque s√©curit√©)

2. **Nettoyage HTML sp√©cial pour texte**
   - `stripHtmlTagsNewsletter()` avec gestion `p‚Üíul` (double saut de ligne)
   - Conversion `<li>` ‚Üí `‚Ä¢ ` (puce unicode)
   - Pr√©servation de la structure visuelle en texte brut

3. **√âditeur WYSIWYG sans toolbar**
   - ReactQuill configur√© sans barre d'outils
   - Formats permis : header, bold, italic, underline, strike, list, bullet
   - Police `Nunito 18px` (coh√©rence graphique)

4. **Sauvegarde automatique**
   - Chaque modification ‚Üí sauvegarde imm√©diate dans localStorage
   - Bouton "Sauvegarder" ‚Üí d√©sactive mode √©dition + toast (pas de sauvegarde suppl√©mentaire)

5. **Template HTML emailing complexe**
   - 95 lignes de HTML inline CSS
   - Styles inline pour compatibilit√© clients email
   - Image fixe : `https://www.presenca.fr/wp-content/uploads/image-newsletter.jpg`
   - R√©cup√©ration nom agence depuis `propertyData` ou `etape1Data`

6. **Formatage HTML pour emailing**
   - `formatPointsFortsForEmail()` : Ajout styles inline (`margin-bottom:7px`)
   - `formatPrixEtReferenceForEmail()` : Gestion format coll√© "Prix FAI : FAI: 456‚Ç¨R√©f√©rence: ERT+90"
   - Parsing `<li>` avec `DOMParser` pour extraction titre/description

7. **Aper√ßu HTML dans navigateur**
   - `window.open('', '_blank')` ‚Üí nouvelle fen√™tre
   - `newWindow.document.write(htmlContent)` ‚Üí √©criture HTML
   - `newWindow.document.close()` ‚Üí fermeture flux
   - Toast de confirmation

8. **Fonction de sauvegarde inactive**
   - `sauvegarderAnnonceNewsletter()` ‚Üí toast "Fonctionnalit√© en d√©veloppement"
   - Future int√©gration : Supabase + `/newsletter-builder`

### **15.2. D√©pendances critiques**

| **D√©pendance** | **Utilisation** | **Remplacement potentiel** |
|----------------|-----------------|----------------------------|
| `react-quill` | √âditeur WYSIWYG | `@tiptap/react`, `draft-js`, `slate` |
| `navigator.clipboard` | Copie dans presse-papier | Fallback avec `document.execCommand('copy')` (deprecated) |
| `DOMParser` | Parsing HTML pour formatage | `cheerio` (Node.js), `jsdom` |
| `localStorage` | Stockage donn√©es | **Supabase** (migration pr√©vue) |
| `@/hooks/use-toast` | Notifications utilisateur | - |
| `lucide-react` | Ic√¥nes UI | `react-icons`, `heroicons` |

### **15.3. Fonctions cl√©s √† pr√©server**

**Lors de la migration vers Supabase :**

1. **Logique de priorit√© (modifs > original)**
   ```sql
   SELECT 
     COALESCE(modifications.titre, original.titre) as titre,
     COALESCE(modifications.accroche, original.accroche) as accroche,
     ...
   FROM annonces_newsletter_original original
   LEFT JOIN annonces_newsletter_modifications modifications 
     ON original.id = modifications.original_id
   ```

2. **Fonction `stripHtmlTagsNewsletter()` (double saut p‚Üíul)**
   - √Ä pr√©server pour la copie texte
   - Peut √™tre migr√© en fonction Supabase ou conserver en frontend

3. **Fonction `formatPointsFortsForEmail()` et `formatPrixEtReferenceForEmail()`**
   - √Ä pr√©server pour la g√©n√©ration HTML
   - Possibilit√© de cr√©er un Edge Function Supabase

4. **Template `NEWSLETTER_TEMPLATE`**
   - √Ä stocker en base de donn√©es (table `email_templates`)
   - Versioning possible (historique des templates)

5. **Fonction `getAgencyName()`**
   - √Ä remplacer par requ√™te Supabase :
     ```sql
     SELECT organisation_nom 
     FROM organisations 
     WHERE organisation_id = get_user_organisation_id(auth.uid())
     ```

### **15.4. Mapping OpenAI ‚Üí Interface**

**‚ö†Ô∏è PARTICULARIT√â :** Contrairement aux autres canaux, **AUCUN mapping de noms de champs** n'est n√©cessaire.

**Raison :** OpenAI g√©n√®re d√©j√† les cl√©s JSON avec les noms exacts utilis√©s dans l'interface :
- `titre` ‚Üí `titre`
- `accroche` ‚Üí `accroche`
- `pointsForts` ‚Üí `pointsForts`
- `callToAction` ‚Üí `callToAction`
- `prixEtReference` ‚Üí `prixEtReference`

**Diff√©rence avec les autres canaux :**
- **Site Internet** : `cta` (OpenAI) ‚Üí `appelAction` (interface)
- **Newsletter** : **Aucune transformation** (noms identiques)

**Prompt OpenAI (rappel) :**
```typescript
// src/services/openai/1.GenerateurAnnoncesOutilsSeo/7.PromptsOpenAi/3.PromptAnnonceNewsletter.ts

export const promptAnnonceNewsletter = `
...
RESTITUTION
R√©ponds uniquement avec un objet JSON au format suivant (sans backticks, ni code fence):
{
  "titre": "<p>TITRE EN MAJUSCULES</p>",
  "accroche": "<p>Phrase 1.<br>Phrase 2.</p>",
  "pointsForts": "<p><strong>Points Forts :</strong></p><ul><li>...</li></ul>",
  "callToAction": "<p>PHRASE 1.<br>PHRASE 2.</p>",
  "prixEtReference": "<ul><li><strong>Prix FAI</strong>: 456‚Ç¨</li><li><strong>R√©f√©rence</strong>: REF-123</li></ul>"
}
...
`;
```

---

**Points cl√©s √† retenir :**
- **HTML int√©gral conserv√©** (contrairement √† Outils SEO qui est en texte brut)
- **WYSIWYG sans toolbar** (ReactQuill)
- **Sauvegarde automatique** √† chaque modification
- **Template HTML 95 lignes** avec styles inline pour emailing
- **Fonction de nettoyage sp√©ciale** `stripHtmlTagsNewsletter()` avec double saut `p‚Üíul`
- **Fonction de sauvegarde inactive** (future int√©gration Supabase + Newsletter Builder)

