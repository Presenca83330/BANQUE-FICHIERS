## üîç PHASE 1 : IDENTIFICATION ET LECTURE DES FICHIERS

Je vais commencer par identifier et lire **TOUS** les fichiers concern√©s par ce canal.

Parfait ! Je continue la lecture de tous les fichiers restants du canal "Portails Immobiliers".

Excellent ! Maintenant je continue l'audit en lisant les documents de r√©f√©rence OpenAI et les autres fichiers n√©cessaires :

Parfait ! Je dispose maintenant de tous les √©l√©ments. Je vais maintenant **g√©n√©rer le document Markdown exhaustif complet** pour le canal "Copier / Publier sur mes Portails Immobiliers" en suivant **exactement la m√™me structure** que les documents pr√©c√©dents.

---

# üìã AUDIT EXHAUSTIF - CANAL "COPIER / PUBLIER SUR MES PORTAILS IMMOBILIERS"

## I. MISSION DU DOCUMENT üìò

Ce document constitue la **bible technique compl√®te** du canal **"Copier / Publier sur mes Portails Immobiliers"** dans l'application LeadGenAI. Il documente exhaustivement :

- **L'architecture globale** du canal (fichiers, hooks, composants)
- **Le syst√®me d'onglets** (4 onglets : Annonce, Synth√®se, Copier l'Annonce, Publier l'Annonce)
- **Le processus de r√©cup√©ration** des donn√©es OpenAI depuis `localStorage`
- **Le syst√®me d'√©dition** avec bouton "Modifier" et √©diteur WYSIWYG
- **Les options de copie** (Format Texte uniquement - 3 boutons)
- **Les options de publication** (vers portails - 2 boutons - **INACTIVES**)
- **Les hooks de r√©cup√©ration et d'aper√ßu** (logique de priorit√© modifications > originales)
- **La structure des donn√©es** `localStorage` (cl√©s LUES et √âCRITES)
- **Le mapping complet** OpenAI ‚Üí Interface React

**Public cible** : D√©veloppeurs, auditeurs de code, √©quipe de migration Supabase

**P√©rim√®tre** : √âtape 5 (OpenAI) ‚Üí `localStorage` ‚Üí √âtape 6 Communication ‚Üí Canal Portails Immobiliers

---

## II. SOMMAIRE üìë

1. [Mission du Document](#i-mission-du-document-)
2. [Sommaire](#ii-sommaire-)
3. [Architecture Globale - Canal](#iii-architecture-globale---canal-)
4. [Liste Exhaustive des Fichiers Utilis√©s](#iv-liste-exhaustive-des-fichiers-utilis√©s-)
5. [Syst√®me d'Onglets](#v-syst√®me-donglets-)
6. [Processus de R√©cup√©ration des Donn√©es OpenAI](#vi-processus-de-r√©cup√©ration-des-donn√©es-openai-)
7. [Structure des Donn√©es localStorage](#vii-structure-des-donn√©es-localstorage-)
8. [Processus Complet √âtape par √âtape](#viii-processus-complet-√©tape-par-√©tape-)
9. [Syst√®me d'√âdition - Bouton "Modifier"](#ix-syst√®me-d√©dition---bouton-modifier-)
10. [Options de Copie](#x-options-de-copie-)
11. [Options de Publication](#xi-options-de-publication-)
12. [Syst√®me d'Aper√ßu](#xii-syst√®me-daper√ßu-)
13. [Contraintes et Validation](#xiii-contraintes-et-validation-)
14. [Composants Graphiques R√©utilisables](#xiv-composants-graphiques-r√©utilisables-)
15. [Tableaux R√©capitulatifs](#xv-tableaux-r√©capitulatifs-)
16. [Donn√©es √† Prendre en Consid√©ration](#xvi-donn√©es-√†-prendre-en-consid√©ration-)

---

## III. ARCHITECTURE GLOBALE - CANAL üèóÔ∏è

### 3.1. Vue d'ensemble du canal

Le canal **"Copier / Publier sur mes Portails Immobiliers"** permet aux utilisateurs de :

1. **Visualiser** deux types d'annonces g√©n√©r√©es par OpenAI :
   - **Annonce Portails Immobiliers** (titre, accroche, descriptif, appel √† l'action)
   - **Synth√®se Portails Immobiliers** (titre, r√©f√©rence & prix, d√©tails cl√©s, donn√©es financi√®res, informations compl√©mentaires)

2. **Modifier** les annonces via un √©diteur WYSIWYG ReactQuill (sans barre d'outils)

3. **Copier** les annonces au format texte brut (3 options) :
   - Copier l'Annonce
   - Copier la Synth√®se
   - Copier les 2 Annonces

4. **Publier** les annonces vers les portails immobiliers (2 options - **FONCTIONS INACTIVES**) :
   - Envoyer l'Annonce vers les portails
   - Envoyer les 2 Annonces vers les portails

### 3.2. Position dans √âtape 6 Communication

Le canal "Copier / Publier sur mes Portails Immobiliers" est accessible depuis :
- **Page** : `/etape6communication`
- **Composant racine** : `Etape6Communication.tsx` (ligne 118-120)
- **Action** : Clic sur la carte "Copier / Publier sur mes Portails Immobiliers"
- **Activation** : `setSelectedOption("publier-portails-immobiliers")`
- **Rendu** : ``

### 3.3. Sch√©ma Mermaid complet (flux de donn√©es)

```mermaid
graph TB
    subgraph OPENAI["√âTAPE 5 : G√âN√âRATION OPENAI"]
        S1[Service 1: Annonce Site Internet]
        S2[Service 2: Fiche de Synth√®se]
    end

    subgraph STORAGE["LOCALSTORAGE - CL√âS ORIGINALES"]
        G1[generation_website_ad{titre, accroche, descriptif, cta}]
        G2[generation_summary_sheet{titre, referenceEtPrix, detailsCles,donneesFinancieres, informationsComplementaires}]
    end

    S1 --> G1
    S2 --> G2

    subgraph CANAL["CANAL PORTAILS IMMOBILIERS"]
        ACCUEIL[AccueilCopierPublierPortailsImmobiliers.tsx]

        subgraph ONGLETS["4 ONGLETS"]
            TAB1[Onglet 1: Annonce]
            TAB2[Onglet 2: Synth√®se]
            TAB3[Onglet 3: Copier l'Annonce]
            TAB4[Onglet 4: Publier l'Annonce]
        end

        subgraph HOOKS_RECUP["HOOKS DE R√âCUP√âRATION"]
            H1[HookRecuperationAnnonceVersPortailsImmobiliers]
            H2[HookRecuperationFichedeSyntheseVersPortailsImmobiliers]
        end

        subgraph HOOKS_APERCU["HOOKS D'APER√áU"]
            H3[HookCopierApercuAnnoncePortailsImmobiliers]
            H4[HookCopierApercuSynthesePortailsImmobiliers]
        end

        subgraph HOOKS_COPIE["HOOKS DE COPIE"]
            H5[HookCopierPortailsImmobiliersFormatTexte]
        end

        subgraph HOOKS_PUBLICATION["HOOKS DE PUBLICATION"]
            H6[HookPublierPortailsImmobiliers]
        end
    end

    G1 --> H1
    G2 --> H2

    subgraph PRIORITY["LOGIQUE DE PRIORIT√â"]
        P1{key-modifs-* existe ?}
        P2[Utiliser key-modifs-*]
        P3[Utiliser generation_*]
    end

    H1 --> P1
    H2 --> P1

    P1 -->|OUI| P2
    P1 -->|NON| P3

    subgraph MODIFS["LOCALSTORAGE - CL√âS MODIFICATIONS"]
        M1[key-modifs-annonce-portails-immobiliers]
        M2[key-modifs-synthese-portails-immobiliers]
    end

    P2 --> M1
    P2 --> M2

    subgraph ACTIONS["ACTIONS UTILISATEUR"]
        A1[‚úèÔ∏è √âditer via WYSIWYG]
        A2[üìã Copier Format Texte]
        A3[üëÅÔ∏è Aper√ßu]
        A4[üíæ Sauvegarde automatique]
        A5[üì§ Publier INACTIF]
    end

    ACCUEIL --> ONGLETS
    TAB1 --> H1
    TAB2 --> H2
    TAB3 --> H3
    TAB3 --> H4
    TAB3 --> H5
    TAB4 --> H6

    H3 --> P1
    H4 --> P1

    A1 --> M1
    A1 --> M2

    style OPENAI fill:#e1f5ff
    style STORAGE fill:#fff4e6
    style MODIFS fill:#f3e5f5
    style ACTIONS fill:#e8f5e9
    style CANAL fill:#fce4ec
```

---

## IV. LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS üìÇ

### 4.1. Fichiers de composition

| Fichier | R√¥le | Lignes | D√©pendances |
|---------|------|--------|-------------|
| `AccueilCopierPublierPortailsImmobiliers.tsx` | Composant racine du canal | 82 | MenuOnglet, File1-4, GraphismeInterieur |
| `MenuOngletPortailsImmobiliers.tsx` | Gestion des 4 onglets + bouton Modifier | 188 | Tabs Radix UI, useToast |
| `File1.AnnoncePortailsImmobiliers.tsx` | Affichage/√©dition de l'annonce | 136 | HookRecuperationAnnonce, GraphismeInterieur |
| `File2.SynthesePortailsImmobiliers.tsx` | Affichage/√©dition de la synth√®se | 151 | HookRecuperationSynthese, GraphismeInterieur |
| `File3.ActionUtilisateurCopierPortailsImmobiliers.tsx` | Options de copie (3 boutons) | 75 | HookCopierFormatTexte, HookApercu |
| `File4.ActionUtilisateurPublierPortailsImmobiliers.tsx` | Options de publication (2 boutons - **INACTIVES**) | 68 | HookPublier, HookApercu |

### 4.2. Hooks de r√©cup√©ration

| Hook | Fichier | R√¥le | Cl√©s localStorage LUES | Cl√©s localStorage √âCRITES |
|------|---------|------|------------------------|---------------------------|
| `useRecuperationAnnonceVersPortailsImmobiliers` | `HookRecuperationAnnonceVersPortailsImmobiliers.ts` | R√©cup√©ration de l'annonce (priorit√© modifs > original) | `key-modifs-annonce-portails-immobiliers``generation_website_ad` | `key-modifs-annonce-portails-immobiliers` |
| `useRecuperationFichedeSyntheseVersPortailsImmobiliers` | `HookRecuperationFichedeSyntheseVersPortailsImmobiliers.ts` | R√©cup√©ration de la synth√®se (priorit√© modifs > original) | `key-modifs-synthese-portails-immobiliers``generation_summary_sheet` | `key-modifs-synthese-portails-immobiliers` |

### 4.3. Hooks d'aper√ßu

| Hook | Fichier | R√¥le | Nettoyage HTML |
|------|---------|------|----------------|
| `useApercuAnnoncePortailsImmobiliers` | `HookCopierApercuAnnoncePortailsImmobiliers.tsx` | G√©n√©ration de l'aper√ßu de l'annonce (texte brut) | `stripHtmlTags()` |
| `useApercuSynthesePortailsImmobiliers` | `HookCopierApercuSynthesePortailsImmobiliers.tsx` | G√©n√©ration de l'aper√ßu de la synth√®se (texte brut + titres de sections) | `stripHtmlTags()` + `addTitlesToSections()` |

### 4.4. Hooks de copie

| Hook | Fichier | R√¥le | Fonctions de copie |
|------|---------|------|--------------------|
| `useCopierPortailsImmobiliersFormatTexte` | `HookCopierPortailsImmobiliersFormatTexte.tsx` | Copie au format texte brut (3 options) | `copierAnnoncePortailsImmobiliers()``copierSynthesePortailsImmobiliers()``copierLesDeuxAnnoncesSynthese()` |

### 4.5. Hooks de publication

| Hook | Fichier | R√¥le | √âtat |
|------|---------|------|------|
| `usePublierPortailsImmobiliers` | `HookPublierPortailsImmobiliers.tsx` | Publication vers portails (2 options) | **INACTIF** - Fonctions simul√©es |

### 4.6. Composants graphiques

| Composant | Fichier | R√¥le |
|-----------|---------|------|
| `LabelField` | `GraphismeInterieurPortailsImmobiliers.tsx` | Libell√© des champs |
| `ReadOnlyField` | `GraphismeInterieurPortailsImmobiliers.tsx` | Affichage en lecture seule (avec dangerouslySetInnerHTML si `isDescriptif=true`) |
| `EditableField` | `GraphismeInterieurPortailsImmobiliers.tsx` | Affichage en mode √©dition (WYSIWYG ReactQuill ou textarea) |
| `CopyOption3` | `GraphismeInterieurPortailsImmobiliers.tsx` | Carte de copie avec 3 boutons |
| `CopyOptionsContainer` | `GraphismeInterieurPortailsImmobiliers.tsx` | Conteneur grid pour les options de copie |
| `AnnoncePreview` | `GraphismeInterieurPortailsImmobiliers.tsx` | Aper√ßu des annonces |
| `EditeurWYSIWYG` | `EditeurWYSIWYG.tsx` | √âditeur ReactQuill sans barre d'outils |

### 4.7. Arborescence compl√®te avec descriptions

```
src/components/1-Sources-Restitution-Utilisateur/3.EtapeCopierPublierPortailsImmobiliers/
‚îÇ
‚îú‚îÄ‚îÄ AccueilCopierPublierPortailsImmobiliers.tsx    [RACINE - G√®re le state editMode et les callbacks]
‚îÇ
‚îú‚îÄ‚îÄ MenuOngletPortailsImmobiliers.tsx               [4 ONGLETS + BOUTON MODIFIER]
‚îÇ   ‚îú‚îÄ‚îÄ Onglet 1: "Annonce"
‚îÇ   ‚îú‚îÄ‚îÄ Onglet 2: "Synth√®se"
‚îÇ   ‚îú‚îÄ‚îÄ Onglet 3: "Copier l'Annonce"
‚îÇ   ‚îî‚îÄ‚îÄ Onglet 4: "Publier l'Annonce"
‚îÇ
‚îú‚îÄ‚îÄ File1.AnnoncePortailsImmobiliers.tsx            [ONGLET 1 - Affichage/√©dition de l'annonce]
‚îÇ   ‚îú‚îÄ‚îÄ Champs: titre, accroche, descriptif, appelAction
‚îÇ   ‚îî‚îÄ‚îÄ Utilise: useRecuperationAnnonceVersPortailsImmobiliers
‚îÇ
‚îú‚îÄ‚îÄ File2.SynthesePortailsImmobiliers.tsx           [ONGLET 2 - Affichage/√©dition de la synth√®se]
‚îÇ   ‚îú‚îÄ‚îÄ Champs: titre, referenceEtPrix, detailsCles, donneesFinancieres, informationsComplementaires
‚îÇ   ‚îî‚îÄ‚îÄ Utilise: useRecuperationFichedeSyntheseVersPortailsImmobiliers
‚îÇ
‚îú‚îÄ‚îÄ File3.ActionUtilisateurCopierPortailsImmobiliers.tsx  [ONGLET 3 - 3 BOUTONS DE COPIE]
‚îÇ   ‚îú‚îÄ‚îÄ Bouton 1: Copier l'Annonce
‚îÇ   ‚îú‚îÄ‚îÄ Bouton 2: Copier la Synth√®se
‚îÇ   ‚îú‚îÄ‚îÄ Bouton 3: Copier les 2 Annonces
‚îÇ   ‚îî‚îÄ‚îÄ Utilise: useCopierPortailsImmobiliersFormatTexte, useApercuAnnonce, useApercuSynthese
‚îÇ
‚îú‚îÄ‚îÄ File4.ActionUtilisateurPublierPortailsImmobiliers.tsx [ONGLET 4 - 2 BOUTONS DE PUBLICATION - INACTIFS]
‚îÇ   ‚îú‚îÄ‚îÄ Bouton 1: Envoyer l'Annonce vers les portails
‚îÇ   ‚îú‚îÄ‚îÄ Bouton 2: Envoyer les 2 Annonces vers les portails
‚îÇ   ‚îî‚îÄ‚îÄ Utilise: usePublierPortailsImmobiliers
‚îÇ
‚îú‚îÄ‚îÄ HookRecuperationAnnonceVersPortailsImmobiliers.ts     [HOOK R√âCUP√âRATION ANNONCE]
‚îÇ   ‚îú‚îÄ‚îÄ Lecture: key-modifs-annonce-portails-immobiliers > generation_website_ad
‚îÇ   ‚îî‚îÄ‚îÄ √âcriture: key-modifs-annonce-portails-immobiliers
‚îÇ
‚îú‚îÄ‚îÄ HookRecuperationFichedeSyntheseVersPortailsImmobiliers.ts [HOOK R√âCUP√âRATION SYNTH√àSE]
‚îÇ   ‚îú‚îÄ‚îÄ Lecture: key-modifs-synthese-portails-immobiliers > generation_summary_sheet
‚îÇ   ‚îî‚îÄ‚îÄ √âcriture: key-modifs-synthese-portails-immobiliers
‚îÇ
‚îú‚îÄ‚îÄ HookCopierApercuAnnoncePortailsImmobiliers.tsx        [HOOK APER√áU ANNONCE - Texte brut]
‚îÇ   ‚îú‚îÄ‚îÄ Fonction: stripHtmlTags()
‚îÇ   ‚îî‚îÄ‚îÄ Source: key-modifs-annonce-portails-immobiliers > generation_website_ad
‚îÇ
‚îú‚îÄ‚îÄ HookCopierApercuSynthesePortailsImmobiliers.tsx       [HOOK APER√áU SYNTH√àSE - Texte brut + titres]
‚îÇ   ‚îú‚îÄ‚îÄ Fonction: stripHtmlTags() + addTitlesToSections()
‚îÇ   ‚îî‚îÄ‚îÄ Source: key-modifs-synthese-portails-immobiliers > generation_summary_sheet
‚îÇ
‚îú‚îÄ‚îÄ HookCopierPortailsImmobiliersFormatTexte.tsx          [HOOK COPIE - 3 FONCTIONS]
‚îÇ   ‚îú‚îÄ‚îÄ copierAnnoncePortailsImmobiliers()
‚îÇ   ‚îú‚îÄ‚îÄ copierSynthesePortailsImmobiliers()
‚îÇ   ‚îî‚îÄ‚îÄ copierLesDeuxAnnoncesSynthese()
‚îÇ
‚îú‚îÄ‚îÄ HookPublierPortailsImmobiliers.tsx                    [HOOK PUBLICATION - INACTIF]
‚îÇ   ‚îú‚îÄ‚îÄ publierAnnoncePortailsImmobiliers() - Simulation
‚îÇ   ‚îî‚îÄ‚îÄ publierLesDeuxAnnoncesSynthese() - Simulation
‚îÇ
‚îú‚îÄ‚îÄ GraphismeInterieurPortailsImmobiliers.tsx             [COMPOSANTS GRAPHIQUES]
‚îÇ   ‚îú‚îÄ‚îÄ LabelField
‚îÇ   ‚îú‚îÄ‚îÄ ReadOnlyField
‚îÇ   ‚îú‚îÄ‚îÄ EditableField
‚îÇ   ‚îú‚îÄ‚îÄ CopyOption3
‚îÇ   ‚îú‚îÄ‚îÄ CopyOptionsContainer
‚îÇ   ‚îî‚îÄ‚îÄ AnnoncePreview
‚îÇ
‚îî‚îÄ‚îÄ EditeurWYSIWYG.tsx                                    [√âDITEUR REACTQUILL]
    ‚îî‚îÄ‚îÄ ReactQuill sans toolbar (modules: { toolbar: false })
```

---

## V. SYST√àME D'ONGLETS üìë

### 5.1. MenuOngletPortailsImmobiliers

**Fichier** : `MenuOngletPortailsImmobiliers.tsx`

**Responsabilit√©s** :
- Gestion des 4 onglets via `Tabs` de Radix UI
- Gestion du bouton "Modifier" / "Sauvegarder" (onglets 1 et 2 uniquement)
- Propagation de l'√©tat `editMode` vers le parent via `onEditModeChange`
- Toast de confirmation lors de la sauvegarde

**Props** :
```typescript
interface MenuOngletPortailsImmobiliersProps {
  tabTitles?: string[];          // Titres des onglets (d√©faut: ["Annonce", "Synth√®se", "Copier l'Annonce", "Publier l'Annonce"])
  tabContent1?: ReactNode;       // Contenu onglet 1
  tabContent2?: ReactNode;       // Contenu onglet 2
  tabContent3?: ReactNode;       // Contenu onglet 3
  tabContent4?: ReactNode;       // Contenu onglet 4
  enableEditMode?: boolean;      // Active le bouton Modifier (d√©faut: false)
  onTabChange?: (tabValue: string) => void;
  onEditModeChange?: (isEditMode: boolean) => void;
  className?: string;
}
```

**√âtat local** :
```typescript
const [activeTab, setActiveTab] = useState("tab1");
const [editMode, setEditMode] = useState(false);
```

**Logique du bouton "Modifier"** :
- **Localisation** : Lignes 112-132 (onglet 1) et 142-162 (onglet 2)
- **Comportement toggle** :
  - Clic 1 : `editMode = true` ‚Üí Affiche "Sauvegarder"
  - Clic 2 : `editMode = false` ‚Üí Affiche "Modifier" + Toast de confirmation
- **Changement d'onglet** : Si `editMode = true`, d√©sactive automatiquement le mode √©dition (ligne 51-54)

**Code du bouton** (ligne 115-130) :
```typescript

  {editMode ? (
    <>

      Sauvegarder

  ) : (
    <>

      Modifier

  )}

```

### 5.2. Onglet 1 : Annonce Portails Immobiliers

**Composant** : `File1.AnnoncePortailsImmobiliers.tsx`

**Props re√ßues** :
```typescript
interface AnnoncePortailsImmobiliersProps {
  editMode?: boolean;           // √âtat du mode √©dition
  onDataChange?: (data: any) => void;
}
```

**Hook utilis√©** :
```typescript
const { annoncePortailsImmobiliers, updateAnnoncePortailsImmobiliers, isLoading, error } = 
  useRecuperationAnnonceVersPortailsImmobiliers();
```

**Champs affich√©s** :

| Champ | Label | Composant (lecture) | Composant (√©dition) | `useWysiwyg` | `rows` |
|-------|-------|---------------------|---------------------|--------------|--------|
| `titre` | "Titre" | `ReadOnlyField` | `EditableField` | `true` | `1` |
| `accroche` | "Accroche" | `ReadOnlyField` | `EditableField` | `true` | `1` |
| `descriptif` | "Descriptif" | `ReadOnlyField` (isDescriptif=true) | `EditableField` | `true` | `6` |
| `appelAction` | "Appel √† l'action" | `ReadOnlyField` | `EditableField` | `true` | `1` |

**Nettoyage HTML lors de la modification** (lignes 21-44) :
```typescript
const handleChange = (name: string, value: string) => {
  let cleanedValue = value;
  if (name === "titre") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }
  if (name === "accroche" || name === "appelAction") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  const updatedData = { [name]: cleanedValue };
  updateAnnoncePortailsImmobiliers(updatedData);

  if (onDataChange) {
    onDataChange({
      ...annoncePortailsImmobiliers,
      ...updatedData
    });
  }
};
```

**√âtats de chargement** :
- `isLoading = true` : "Chargement des donn√©es..."
- `error !== null` : Message d'erreur en rouge

### 5.3. Onglet 2 : Synth√®se Portails Immobiliers

**Composant** : `File2.SynthesePortailsImmobiliers.tsx`

**Props re√ßues** :
```typescript
interface SynthesePortailsImmobiliersProps {
  editMode?: boolean;
  onDataChange?: (data: any) => void;
}
```

**Hook utilis√©** :
```typescript
const { fichedeSynthesePortailsImmobiliers, updateFichedeSynthesePortailsImmobiliers, isLoading, error } = 
  useRecuperationFichedeSyntheseVersPortailsImmobiliers();
```

**Champs affich√©s** :

| Champ | Label | Composant (lecture) | Composant (√©dition) | `useWysiwyg` | `rows` | `isDescriptif` |
|-------|-------|---------------------|---------------------|--------------|--------|----------------|
| `titre` | "Titre" | `ReadOnlyField` | `EditableField` | `true` | `1` | `false` |
| `referenceEtPrix` | "R√©f√©rence & Prix" | `ReadOnlyField` | `EditableField` | `true` | `3` | `true` |
| `detailsCles` | "Pr√©sentation \| D√©tails cl√©s" | `ReadOnlyField` | `EditableField` | `true` | `6` | `true` |
| `donneesFinancieres` | "Pr√©sentation \| Donn√©es Financi√®res" | `ReadOnlyField` | `EditableField` | `true` | `6` | `true` |
| `informationsComplementaires` | "Pr√©sentation \| Informations compl√©mentaires" | `ReadOnlyField` | `EditableField` | `true` | `6` | `true` |

**Nettoyage HTML lors de la modification** (lignes 21-39) :
```typescript
const handleChange = (name: string, value: string) => {
  let cleanedValue = value;
  if (name === "titre") {
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  const updatedData = { [name]: cleanedValue };
  updateFichedeSynthesePortailsImmobiliers(updatedData);

  if (onDataChange) {
    onDataChange({
      ...fichedeSynthesePortailsImmobiliers,
      ...updatedData
    });
  }
};
```

**‚ö†Ô∏è Nettoyage HTML uniquement sur le champ `titre`** (contrairement √† l'onglet 1 qui nettoie √©galement `accroche` et `appelAction`)

### 5.4. Onglet 3 : Copier l'Annonce

**Composant** : `File3.ActionUtilisateurCopierPortailsImmobiliers.tsx`

**Hooks utilis√©s** :
```typescript
const { annoncePortailsImmobiliers, isLoading: isLoadingAnnonce, error: errorAnnonce } = 
  useApercuAnnoncePortailsImmobiliers();

const { synthesePortailsImmobiliers, isLoading: isLoadingSynthese, error: errorSynthese } = 
  useApercuSynthesePortailsImmobiliers();

const { copierAnnoncePortailsImmobiliers, copierSynthesePortailsImmobiliers, copierLesDeuxAnnoncesSynthese } = 
  useCopierPortailsImmobiliersFormatTexte();
```

**Structure visuelle** :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        OPTIONS                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  COPIER AU FORMAT TEXTE  ‚îÇ   (Vide pour sym√©trie)   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Copier l'Annonce        ‚îÇ                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Copier la Synth√®se      ‚îÇ                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Copier les 2 Annonces   ‚îÇ                           ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  APER√áU DE L'ANNONCE (texte brut)                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ titre, accroche, descriptif, appelAction              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  APER√áU DE LA SYNTH√àSE (texte brut + titres de sections)   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ titre, R√©f√©rence & Prix, Pr√©sentation | D√©tails cl√©s, ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Pr√©sentation | Donn√©es Financi√®res,                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Pr√©sentation | Informations compl√©mentaires           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Code de la carte de copie** (lignes 25-38) :
```typescript
}
  buttons={[
    {
      text: "Copier l'Annonce",
      onClick: copierAnnoncePortailsImmobiliers,
    },
    {
      text: "Copier la Synth√®se",
      onClick: copierSynthesePortailsImmobiliers,
    },
    {
      text: "Copier les 2 Annonces",
      onClick: copierLesDeuxAnnoncesSynthese,
    },
  ]}
/>
```

### 5.5. Onglet 4 : Publier l'Annonce

**Composant** : `File4.ActionUtilisateurPublierPortailsImmobiliers.tsx`

**‚ö†Ô∏è FONCTIONS INACTIVES** : Les fonctions de publication sont simul√©es et affichent un toast "Fonctionnalit√© en d√©veloppement".

**Hooks utilis√©s** :
```typescript
const { annoncePortailsImmobiliers, isLoading: isLoadingAnnonce, error: errorAnnonce } = 
  useApercuAnnoncePortailsImmobiliers();

const { synthesePortailsImmobiliers, isLoading: isLoadingSynthese, error: errorSynthese } = 
  useApercuSynthesePortailsImmobiliers();

const { publierAnnoncePortailsImmobiliers, publierLesDeuxAnnoncesSynthese, isPublishing } = 
  usePublierPortailsImmobiliers();
```

**Structure visuelle** :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        OPTIONS                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ  PORTAILS IMMOBILIERS    ‚îÇ   (Vide pour sym√©trie)   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Envoyer l'Annonce       ‚îÇ                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Envoyer les 2 Annonces  ‚îÇ                           ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  APER√áU DE L'ANNONCE (texte brut)                           ‚îÇ
‚îÇ  APER√áU DE LA SYNTH√àSE (texte brut + titres de sections)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Code de la carte de publication** (lignes 25-38) :
```typescript
}
  buttonText="Envoyer l'Annonce vers les portails"
  buttonIcon={}
  onClick={publierAnnoncePortailsImmobiliers}
/>

}
  buttonText="Envoyer les 2 Annonces vers les portails"
  buttonIcon={}
  onClick={publierLesDeuxAnnoncesSynthese}
/>
```

### 5.6. Logique de navigation et √©tat

**√âtat global** (dans `AccueilCopierPublierPortailsImmobiliers.tsx`) :
```typescript
const [editMode, setEditMode] = useState(false);
const [annoncePortailsImmobiliersData, setAnnoncePortailsImmobiliersData] = useState({});
const [synthesePortailsImmobiliersData, setSynthesePortailsImmobiliersData] = useState({});
```

**Flux de donn√©es** :
1. `MenuOngletPortailsImmobiliers` g√®re le state `editMode` local
2. Lors du toggle, appel `onEditModeChange(newEditMode)` ‚Üí Met √† jour `editMode` dans `AccueilCopierPublierPortailsImmobiliers`
3. `editMode` est propag√© vers `File1.AnnoncePortailsImmobiliers` et `File2.SynthesePortailsImmobiliers`
4. Changement de champ ‚Üí `handleChange()` ‚Üí `updateAnnonce/updateSynthese()` ‚Üí `localStorage.setItem()`
5. Callback `onDataChange()` ‚Üí Met √† jour `annoncePortailsImmobiliersData` / `synthesePortailsImmobiliersData` dans le parent

**‚ö†Ô∏è Note** : Les states `annoncePortailsImmobiliersData` et `synthesePortailsImmobiliersData` sont d√©finis mais **non utilis√©s** dans le reste du code (lignes 18-19 et 22-28 de `AccueilCopierPublierPortailsImmobiliers.tsx`).

---

## VI. PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI üîÑ

### 6.1. Sources de donn√©es (cl√©s localStorage)

#### 6.1.1. Cl√©s ORIGINALES (√©crites par OpenAI √† l'√âtape 5)

| Cl√© | √âcrite par | Contenu | Structure |
|-----|------------|---------|-----------|
| `generation_website_ad` | `Etape5.tsx` (ligne 79) | Annonce site internet | `{ titre: string, accroche: string, descriptif: string, cta: string }` |
| `generation_summary_sheet` | `Etape5.tsx` (ligne 86) | Fiche de synth√®se | `{ titre: string, referenceEtPrix: string, detailsCles: string, donneesFinancieres: string, informationsComplementaires: string }` |

#### 6.1.2. Cl√©s MODIFICATIONS (√©crites lors de l'√©dition)

| Cl√© | √âcrite par | Contenu |
|-----|------------|---------|
| `key-modifs-annonce-portails-immobiliers` | `HookRecuperationAnnonceVersPortailsImmobiliers.ts` (ligne 43) | Modifications de l'annonce |
| `key-modifs-synthese-portails-immobiliers` | `HookRecuperationFichedeSyntheseVersPortailsImmobiliers.ts` (ligne 72) | Modifications de la synth√®se |

### 6.2. Logique de priorit√© (modifs > originales)

#### 6.2.1. Hook `useRecuperationAnnonceVersPortailsImmobiliers`

**Fichier** : `HookRecuperationAnnonceVersPortailsImmobiliers.ts`

**Logique de lecture** (lignes 22-56) :
```typescript
useEffect(() => {
  try {
    setIsLoading(true);

    // 1. PRIORIT√â : V√©rifier les donn√©es modifi√©es
    const modifiedDataJson = localStorage.getItem('key-modifs-annonce-portails-immobiliers');

    if (modifiedDataJson) {
      // Utiliser les donn√©es modifi√©es si elles existent
      const modifiedData = JSON.parse(modifiedDataJson);
      setAnnoncePortailsImmobiliers({
        titre: modifiedData.titre || '',
        accroche: modifiedData.accroche || '',
        descriptif: modifiedData.descriptif || '',
        appelAction: modifiedData.appelAction || ''
      });
    } else {
      // 2. FALLBACK : R√©cup√©ration des donn√©es originales
      const annoncePortailsImmobiliersData = localStorage.getItem('generation_website_ad');

      if (annoncePortailsImmobiliersData) {
        const parsedData = JSON.parse(annoncePortailsImmobiliersData);
        setAnnoncePortailsImmobiliers({
          titre: parsedData.titre || '',
          accroche: parsedData.accroche || '',
          descriptif: parsedData.descriptif || '',
          appelAction: parsedData.cta || '' // ‚ö†Ô∏è Mapping cta ‚Üí appelAction
        });
      } else {
        console.log('Aucune donn√©e d\'annonce portails immobiliers trouv√©e dans le localStorage');
      }
    }

    setIsLoading(false);
  } catch (err) {
    console.error('Erreur lors de la r√©cup√©ration des donn√©es:', err);
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

**‚ö†Ô∏è MAPPING CRITIQUE** : OpenAI renvoie `cta` mais l'interface React attend `appelAction` (ligne 38)

**Fonction de mise √† jour** (lignes 58-69) :
```typescript
const updateAnnoncePortailsImmobiliers = (newData: Partial) => {
  const updatedData = { ...annoncePortailsImmobiliers, ...newData };
  setAnnoncePortailsImmobiliers(updatedData);

  try {
    // Sauvegarde automatique dans localStorage
    localStorage.setItem('key-modifs-annonce-portails-immobiliers', JSON.stringify(updatedData));
  } catch (err) {
    console.error('Erreur lors de la sauvegarde des donn√©es:', err);
    setError('Erreur lors de la sauvegarde des donn√©es');
  }
};
```

#### 6.2.2. Hook `useRecuperationFichedeSyntheseVersPortailsImmobiliers`

**Fichier** : `HookRecuperationFichedeSyntheseVersPortailsImmobiliers.ts`

**Logique de lecture** (lignes 22-57) :
```typescript
useEffect(() => {
  try {
    setIsLoading(true);

    // 1. PRIORIT√â : V√©rifier les donn√©es modifi√©es
    const modifiedDataJson = localStorage.getItem('key-modifs-synthese-portails-immobiliers');

    if (modifiedDataJson) {
      const modifiedData = JSON.parse(modifiedDataJson);
      setFichedeSynthesePortailsImmobiliers({
        titre: modifiedData.titre || '',
        referenceEtPrix: modifiedData.referenceEtPrix || '',
        detailsCles: modifiedData.detailsCles || '',
        donneesFinancieres: modifiedData.donneesFinancieres || '',
        informationsComplementaires: modifiedData.informationsComplementaires || ''
      });
    } else {
      // 2. FALLBACK : R√©cup√©ration des donn√©es originales
      const fichedeSyntheseData = localStorage.getItem('generation_summary_sheet');

      if (fichedeSyntheseData) {
        const parsedData = JSON.parse(fichedeSyntheseData);
        setFichedeSynthesePortailsImmobiliers({
          titre: parsedData.titre || '',
          referenceEtPrix: parsedData.referenceEtPrix || '',
          detailsCles: parsedData.detailsCles || '',
          donneesFinancieres: parsedData.donneesFinancieres || '',
          informationsComplementaires: parsedData.informationsComplementaires || ''
        });
      } else {
        console.log('Aucune donn√©e de fiche de synth√®se pour portails immobiliers trouv√©e dans le localStorage');
      }
    }

    setIsLoading(false);
  } catch (err) {
    console.error('Erreur lors de la r√©cup√©ration des donn√©es:', err);
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

**‚úÖ PAS DE MAPPING** : Les noms de champs sont identiques entre OpenAI et l'interface React

**Fonction de mise √† jour** (lignes 66-77) :
```typescript
const updateFichedeSynthesePortailsImmobiliers = (newData: Partial) => {
  const updatedData = { ...fichedeSynthesePortailsImmobiliers, ...newData };
  setFichedeSynthesePortailsImmobiliers(updatedData);

  try {
    localStorage.setItem('key-modifs-synthese-portails-immobiliers', JSON.stringify(updatedData));
  } catch (err) {
    console.error('Erreur lors de la sauvegarde des donn√©es:', err);
    setError('Erreur lors de la sauvegarde des donn√©es');
  }
};
```

### 6.3. Hooks de r√©cup√©ration d√©taill√©s

**Tableau r√©capitulatif** :

| Hook | Cl√© prioritaire | Cl√© fallback | Mapping | Fonction de mise √† jour |
|------|-----------------|--------------|---------|-------------------------|
| `useRecuperationAnnonceVersPortailsImmobiliers` | `key-modifs-annonce-portails-immobiliers` | `generation_website_ad` | `cta` ‚Üí `appelAction` | `updateAnnoncePortailsImmobiliers()` |
| `useRecuperationFichedeSyntheseVersPortailsImmobiliers` | `key-modifs-synthese-portails-immobiliers` | `generation_summary_sheet` | Aucun | `updateFichedeSynthesePortailsImmobiliers()` |

### 6.4. Mapping des champs OpenAI ‚Üí Interface

#### 6.4.1. Annonce Portails Immobiliers

| Champ OpenAI | Champ Interface | Type | Note |
|--------------|-----------------|------|------|
| `titre` | `titre` | `string` | ‚úÖ Mapping direct |
| `accroche` | `accroche` | `string` | ‚úÖ Mapping direct |
| `descriptif` | `descriptif` | `string` | ‚úÖ Mapping direct |
| `cta` | `appelAction` | `string` | ‚ö†Ô∏è **MAPPING REQUIS** |

#### 6.4.2. Synth√®se Portails Immobiliers

| Champ OpenAI | Champ Interface | Type | Note |
|--------------|-----------------|------|------|
| `titre` | `titre` | `string` | ‚úÖ Mapping direct |
| `referenceEtPrix` | `referenceEtPrix` | `string` | ‚úÖ Mapping direct |
| `detailsCles` | `detailsCles` | `string` | ‚úÖ Mapping direct |
| `donneesFinancieres` | `donneesFinancieres` | `string` | ‚úÖ Mapping direct |
| `informationsComplementaires` | `informationsComplementaires` | `string` | ‚úÖ Mapping direct |

---

## VII. STRUCTURE DES DONN√âES LOCALSTORAGE üíæ

### 7.1. Cl√©s LUES

#### 7.1.1. `generation_website_ad` (Cl√© originale OpenAI)

**Source** : √âtape 5 - `Etape5.tsx` ligne 79

**Structure JSON** :
```json
{
  "titre": "Titre de l'annonce",
  "accroche": "Phrase d'accroche",
  "descriptif": "Description compl√®te du bien...",
  "cta": "Appel √† l'action"
}
```

**Taille estim√©e** : 2-3 KB

**Format** :
- `titre` : Texte brut
- `accroche` : Texte brut
- `descriptif` : HTML (balises ``, ``, ``, ``)
- `cta` : Texte brut

#### 7.1.2. `generation_summary_sheet` (Cl√© originale OpenAI)

**Source** : √âtape 5 - `Etape5.tsx` ligne 86

**Structure JSON** :
```json
{
  "titre": "Titre de la synth√®se",
  "referenceEtPrix": "R√©f√©rence: XXXPrix: XXX ‚Ç¨",
  "detailsCles": "D√©tail 1D√©tail 2",
  "donneesFinancieres": "Donn√©e 1Donn√©e 2",
  "informationsComplementaires": "Info 1Info 2"
}
```

**Taille estim√©e** : 3-4 KB

**Format** :
- `titre` : Texte brut
- `referenceEtPrix` : HTML (balises ``)
- `detailsCles` : HTML (balises ``, ``, ``)
- `donneesFinancieres` : HTML (balises ``, ``, ``)
- `informationsComplementaires` : HTML (balises ``, ``, ``)

### 7.2. Cl√©s √âCRITES

#### 7.2.1. `key-modifs-annonce-portails-immobiliers`

**√âcrite par** : `HookRecuperationAnnonceVersPortailsImmobiliers.ts` ligne 43

**Structure JSON** :
```json
{
  "titre": "Titre modifi√©",
  "accroche": "Accroche modifi√©e",
  "descriptif": "Descriptif modifi√©...",
  "appelAction": "Appel √† l'action modifi√©"
}
```

**‚ö†Ô∏è Note** : Le champ `appelAction` (et non `cta`) est stock√© dans cette cl√©

#### 7.2.2. `key-modifs-synthese-portails-immobiliers`

**√âcrite par** : `HookRecuperationFichedeSyntheseVersPortailsImmobiliers.ts` ligne 72

**Structure JSON** :
```json
{
  "titre": "Titre modifi√©",
  "referenceEtPrix": "R√©f√©rence et prix modifi√©s...",
  "detailsCles": "D√©tails modifi√©s...",
  "donneesFinancieres": "Donn√©es modifi√©es...",
  "informationsComplementaires": "Informations modifi√©es..."
}
```

### 7.3. Interfaces TypeScript compl√®tes

#### 7.3.1. Interface `AnnoncePortailsImmobiliersData`

**Fichiers concern√©s** :
- `HookRecuperationAnnonceVersPortailsImmobiliers.ts` (lignes 3-8)
- `HookCopierApercuAnnoncePortailsImmobiliers.tsx` (lignes 3-8)

```typescript
interface AnnoncePortailsImmobiliersData {
  titre: string;
  accroche: string;
  descriptif: string;
  appelAction: string;  // ‚ö†Ô∏è Nomm√© "cta" dans OpenAI
}
```

#### 7.3.2. Interface `SynthesePortailsImmobiliersData`

**Fichiers concern√©s** :
- `HookRecuperationFichedeSyntheseVersPortailsImmobiliers.ts` (lignes 3-9)
- `HookCopierApercuSynthesePortailsImmobiliers.tsx` (lignes 3-9)

```typescript
interface FichedeSynthesePortailsImmobiliersData {
  titre: string;
  referenceEtPrix: string;
  detailsCles: string;
  donneesFinancieres: string;
  informationsComplementaires: string;
}
```

### 7.4. Tableaux r√©capitulatifs

#### 7.4.1. Tableau des cl√©s localStorage

| Cl√© | Type | √âcrite par | Lue par | Taille | Priorit√© |
|-----|------|------------|---------|--------|----------|
| `generation_website_ad` | Originale OpenAI | `Etape5.tsx` | `HookRecuperationAnnonceVersPortailsImmobiliers``HookCopierApercuAnnoncePortailsImmobiliers` | 2-3 KB | 2 (fallback) |
| `generation_summary_sheet` | Originale OpenAI | `Etape5.tsx` | `HookRecuperationFichedeSyntheseVersPortailsImmobiliers``HookCopierApercuSynthesePortailsImmobiliers` | 3-4 KB | 2 (fallback) |
| `key-modifs-annonce-portails-immobiliers` | Modifications | `updateAnnoncePortailsImmobiliers()` | `HookRecuperationAnnonceVersPortailsImmobiliers``HookCopierApercuAnnoncePortailsImmobiliers` | Variable | 1 (prioritaire) |
| `key-modifs-synthese-portails-immobiliers` | Modifications | `updateFichedeSynthesePortailsImmobiliers()` | `HookRecuperationFichedeSyntheseVersPortailsImmobiliers``HookCopierApercuSynthesePortailsImmobiliers` | Variable | 1 (prioritaire) |

#### 7.4.2. Tableau du mapping OpenAI ‚Üí Interface

| Service OpenAI | Cl√© localStorage | Champ OpenAI | Champ Interface | Mapping requis |
|----------------|------------------|--------------|-----------------|----------------|
| `generateWebsiteAd` | `generation_website_ad` | `titre` | `titre` | ‚úÖ Direct |
| `generateWebsiteAd` | `generation_website_ad` | `accroche` | `accroche` | ‚úÖ Direct |
| `generateWebsiteAd` | `generation_website_ad` | `descriptif` | `descriptif` | ‚úÖ Direct |
| `generateWebsiteAd` | `generation_website_ad` | `cta` | `appelAction` | ‚ö†Ô∏è **REQUIS** |
| `generateSummarySheetAd` | `generation_summary_sheet` | `titre` | `titre` | ‚úÖ Direct |
| `generateSummarySheetAd` | `generation_summary_sheet` | `referenceEtPrix` | `referenceEtPrix` | ‚úÖ Direct |
| `generateSummarySheetAd` | `generation_summary_sheet` | `detailsCles` | `detailsCles` | ‚úÖ Direct |
| `generateSummarySheetAd` | `generation_summary_sheet` | `donneesFinancieres` | `donneesFinancieres` | ‚úÖ Direct |
| `generateSummarySheetAd` | `generation_summary_sheet` | `informationsComplementaires` | `informationsComplementaires` | ‚úÖ Direct |

---

## VIII. PROCESSUS COMPLET √âTAPE PAR √âTAPE üî¢

### 8.1. Chargement initial

**D√©clencheur** : Utilisateur clique sur la carte "Copier / Publier sur mes Portails Immobiliers" dans `/etape6communication`

**S√©quence** :

1. **Rendu du composant racine** : `AccueilCopierPublierPortailsImmobiliers.tsx`
   - Initialisation des states : `editMode = false`, `annoncePortailsImmobiliersData = {}`, `synthesePortailsImmobiliersData = {}`

2. **Rendu de `MenuOngletPortailsImmobiliers`**
   - Onglet actif par d√©faut : `tab1` ("Annonce")
   - Mode √©dition d√©sactiv√© : `editMode = false`

3. **Chargement de l'Onglet 1** : `File1.AnnoncePortailsImmobiliers`
   - Appel du hook `useRecuperationAnnonceVersPortailsImmobiliers()`
   - `useEffect()` d√©clench√© :
     - Tentative de lecture `key-modifs-annonce-portails-immobiliers`
     - Si absent ‚Üí Lecture `generation_website_ad`
     - Mapping `cta` ‚Üí `appelAction`
     - `setIsLoading(false)`
   - Affichage des 4 champs en mode lecture seule (`ReadOnlyField`)

**√âtat de l'interface apr√®s chargement** :
- ‚úÖ Donn√©es affich√©es en lecture seule
- ‚úÖ Bouton "Modifier" visible
- ‚úÖ Onglets 2, 3, 4 pr√™ts √† √™tre activ√©s

### 8.2. Affichage en mode lecture seule

**Composants utilis√©s** : `ReadOnlyField` (dans `GraphismeInterieurPortailsImmobiliers.tsx`)

**Props** :
```typescript
interface ReadOnlyFieldProps {
  id: string;              // Identifiant du champ
  content: string;         // Contenu √† afficher
  isDescriptif?: boolean;  // true = dangerouslySetInnerHTML, false = whitespace-pre-line
  className?: string;
}
```

**Rendu selon `isDescriptif`** (lignes 33-50) :
```typescript
export const ReadOnlyField: React.FC = ({ 
  id, 
  content, 
  isDescriptif = false,
  className
}) => {
  return (

      {isDescriptif ? (

      ) : (
        {content}
      )}

  );
};
```

**‚ö†Ô∏è S√©curit√©** : `dangerouslySetInnerHTML` utilis√© uniquement pour les champs marqu√©s `isDescriptif=true`

**Champs avec `isDescriptif=true`** :
- Onglet 1 : `descriptif` (ligne 109)
- Onglet 2 : `referenceEtPrix` (ligne 85), `detailsCles` (ligne 105), `donneesFinancieres` (ligne 125), `informationsComplementaires` (ligne 145)

### 8.3. Activation du mode √©dition

**D√©clencheur** : Clic sur le bouton "Modifier"

**S√©quence** :

1. **Dans `MenuOngletPortailsImmobiliers`** (lignes 60-76) :
   ```typescript
   const toggleEditMode = () => {
     const newEditMode = !editMode;
     setEditMode(newEditMode);

     if (!newEditMode) {
       toast({
         title: "Modifications sauvegard√©es",
         description: "Les changements ont √©t√© enregistr√©s avec succ√®s."
       });
     }

     if (onEditModeChange) {
       onEditModeChange(newEditMode);
     }
   };
   ```

2. **Propagation vers le parent** : `onEditModeChange(true)` ‚Üí `setEditMode(true)` dans `AccueilCopierPublierPortailsImmobiliers`

3. **Re-rendu de `File1.AnnoncePortailsImmobiliers`** avec `editMode={true}`

4. **Affichage conditionnel** (ligne 59-72) :
   ```typescript
   {editMode ? (
      handleChange("titre", value)}
       rows={1}
       useWysiwyg={true}
     />
   ) : (

   )}
   ```

5. **Chargement de l'√©diteur WYSIWYG** : `EditeurWYSIWYG.tsx` (ReactQuill sans toolbar)

**√âtat de l'interface apr√®s activation** :
- ‚úÖ Bouton affiche "Sauvegarder"
- ‚úÖ Champs affich√©s avec `EditableField` (√©diteur WYSIWYG)
- ‚úÖ Modifications possibles

### 8.4. Modification des champs

**Composant utilis√©** : `EditableField` ‚Üí `EditeurWYSIWYG`

**√âditeur WYSIWYG** (`EditeurWYSIWYG.tsx`) :
```typescript
const EditeurWYSIWYG: React.FC = ({ 
  value, 
  onChange, 
  rows = 3, 
  className,
  simpleMode = false
}) => {
  const [editorValue, setEditorValue] = useState(value);

  useEffect(() => {
    setEditorValue(value);
  }, [value]);

  const handleChange = (content: string) => {
    setEditorValue(content);
    onChange(content);
  };

  const editorHeight = `${Math.max(150, rows * 40)}px`;

  return (

  );
};
```

**‚ö†Ô∏è Particularit√©** : Barre d'outils d√©sactiv√©e via `modules={{ toolbar: false }}`

**√âv√©nement de modification** :
1. Utilisateur tape dans l'√©diteur ‚Üí `handleChange(content)` dans `EditeurWYSIWYG`
2. `onChange(content)` appel√© ‚Üí `handleChange(name, value)` dans `File1.AnnoncePortailsImmobiliers`
3. Nettoyage HTML pour certains champs (titre, accroche, appelAction)
4. `updateAnnoncePortailsImmobiliers({ [name]: cleanedValue })`

### 8.5. Sauvegarde automatique

**Fonction de sauvegarde** (dans `HookRecuperationAnnonceVersPortailsImmobiliers.ts`, lignes 58-69) :
```typescript
const updateAnnoncePortailsImmobiliers = (newData: Partial) => {
  const updatedData = { ...annoncePortailsImmobiliers, ...newData };
  setAnnoncePortailsImmobiliers(updatedData);

  try {
    localStorage.setItem('key-modifs-annonce-portails-immobiliers', JSON.stringify(updatedData));
  } catch (err) {
    console.error('Erreur lors de la sauvegarde des donn√©es:', err);
    setError('Erreur lors de la sauvegarde des donn√©es');
  }
};
```

**S√©quence** :
1. Modification d'un champ ‚Üí `handleChange(name, value)`
2. Nettoyage HTML (si applicable)
3. Fusion avec les donn√©es existantes : `{ ...annoncePortailsImmobiliers, ...newData }`
4. Mise √† jour du state local : `setAnnoncePortailsImmobiliers(updatedData)`
5. **Sauvegarde imm√©diate dans `localStorage`** : `localStorage.setItem('key-modifs-annonce-portails-immobiliers', ...)`
6. Callback vers le parent : `onDataChange({ ...annoncePortailsImmobiliers, ...updatedData })`

**‚ö†Ô∏è Note** : La sauvegarde est **automatique et imm√©diate** lors de chaque modification. Le bouton "Sauvegarder" sert uniquement √† **quitter le mode √©dition** et afficher un toast de confirmation.

### 8.6. Copie au format Texte

**Onglet concern√©** : Onglet 3 "Copier l'Annonce"

**Hook utilis√©** : `useCopierPortailsImmobiliersFormatTexte` (dans `HookCopierPortailsImmobiliersFormatTexte.tsx`)

**3 fonctions de copie disponibles** :

#### 8.6.1. `copierAnnoncePortailsImmobiliers()` (lignes 8-69)

```typescript
const copierAnnoncePortailsImmobiliers = async () => {
  if (isLoadingAnnonce) {
    toast({
      title: "Chargement en cours",
      description: "Veuillez patienter pendant le chargement des donn√©es.",
    });
    return;
  }

  if (errorAnnonce) {
    toast({
      title: "Erreur",
      description: "Impossible de copier l'annonce en raison d'une erreur.",
      variant: "destructive",
    });
    return;
  }

  try {
    setIsCopying(true);

    const texteAnnonce = `${annoncePortailsImmobiliers.titre}

${annoncePortailsImmobiliers.accroche}

${annoncePortailsImmobiliers.descriptif}

${annoncePortailsImmobiliers.appelAction}`;

    await navigator.clipboard.writeText(texteAnnonce);

    toast({
      title: "Copi√© !",
      description: "L'annonce a √©t√© copi√©e dans votre presse-papiers.",
    });
  } catch (error) {
    toast({
      title: "Erreur",
      description: "Impossible de copier le texte.",
      variant: "destructive",
    });
  } finally {
    setIsCopying(false);
  }
};
```

**Formatage** : Titre ‚Üí Accroche ‚Üí Descriptif ‚Üí Appel √† l'action (s√©par√©s par double saut de ligne)

#### 8.6.2. `copierSynthesePortailsImmobiliers()` (lignes 73-131)

```typescript
const copierSynthesePortailsImmobiliers = async () => {
  if (isLoadingSynthese) {
    toast({
      title: "Chargement en cours",
      description: "Veuillez patienter pendant le chargement des donn√©es.",
    });
    return;
  }

  if (errorSynthese) {
    toast({
      title: "Erreur",
      description: "Impossible de copier la synth√®se en raison d'une erreur.",
      variant: "destructive",
    });
    return;
  }

  try {
    setIsCopying(true);

    const texteSynthese = `${synthesePortailsImmobiliers.titre}

${synthesePortailsImmobiliers.referenceEtPrix}

${synthesePortailsImmobiliers.detailsCles}

${synthesePortailsImmobiliers.donneesFinancieres}

${synthesePortailsImmobiliers.informationsComplementaires}`;

    await navigator.clipboard.writeText(texteSynthese);

    toast({
      title: "Copi√© !",
      description: "La synth√®se a √©t√© copi√©e dans votre presse-papiers.",
    });
  } catch (error) {
    toast({
      title: "Erreur",
      description: "Impossible de copier le texte.",
      variant: "destructive",
    });
  } finally {
    setIsCopying(false);
  }
};
```

**Formatage** : Titre ‚Üí R√©f√©rence & Prix ‚Üí D√©tails Cl√©s ‚Üí Donn√©es Financi√®res ‚Üí Informations Compl√©mentaires (s√©par√©s par double saut de ligne)

**‚ö†Ô∏è Note** : Les titres de sections ("Pr√©sentation | D√©tails cl√©s", etc.) sont **inclus automatiquement** via `addTitlesToSections()` dans `useApercuSynthesePortailsImmobiliers`

#### 8.6.3. `copierLesDeuxAnnoncesSynthese()` (lignes 135-210)

```typescript
const copierLesDeuxAnnoncesSynthese = async () => {
  if (isLoadingAnnonce || isLoadingSynthese) {
    toast({
      title: "Chargement en cours",
      description: "Veuillez patienter pendant le chargement des donn√©es.",
    });
    return;
  }

  if (errorAnnonce || errorSynthese) {
    toast({
      title: "Erreur",
      description: "Impossible de copier les annonces en raison d'une erreur.",
      variant: "destructive",
    });
    return;
  }

  try {
    setIsCopying(true);

    const texteAnnonce = `${annoncePortailsImmobiliers.titre}

${annoncePortailsImmobiliers.accroche}

${annoncePortailsImmobiliers.descriptif}

${annoncePortailsImmobiliers.appelAction}`;

    const texteSynthese = `${synthesePortailsImmobiliers.titre}

${synthesePortailsImmobiliers.referenceEtPrix}

${synthesePortailsImmobiliers.detailsCles}

${synthesePortailsImmobiliers.donneesFinancieres}

${synthesePortailsImmobiliers.informationsComplementaires}`;

    const texteCombine = `${texteAnnonce}

---

${texteSynthese}`;

    await navigator.clipboard.writeText(texteCombine);

    toast({
      title: "Copi√© !",
      description: "Les 2 annonces ont √©t√© copi√©es dans votre presse-papiers.",
    });
  } catch (error) {
    toast({
      title: "Erreur",
      description: "Impossible de copier le texte.",
      variant: "destructive",
    });
  } finally {
    setIsCopying(false);
  }
};
```

**Formatage** : Annonce compl√®te ‚Üí S√©parateur `---` ‚Üí Synth√®se compl√®te

---

## IX. SYST√àME D'√âDITION - BOUTON "MODIFIER" ‚úèÔ∏è

### 9.1. Localisation

**Fichier** : `MenuOngletPortailsImmobiliers.tsx`

**Onglets concern√©s** : Onglet 1 ("Annonce") et Onglet 2 ("Synth√®se")

**Ligne du bouton** : 115-130 (Onglet 1) et 145-160 (Onglet 2)

**Condition d'affichage** :
```typescript
{enableEditMode && (

      {editMode ? (
        <>

          Sauvegarder

      ) : (
        <>

          Modifier

      )}

)}
```

**‚ö†Ô∏è Note** : Le bouton n'appara√Æt que si `enableEditMode={true}` est pass√© en prop (ce qui est le cas dans `AccueilCopierPublierPortailsImmobiliers.tsx` ligne 69)

### 9.2. Comportement toggle (Modifier ‚Üî Sauvegarder)

**Fonction `toggleEditMode()`** (lignes 60-76) :
```typescript
const toggleEditMode = () => {
  const newEditMode = !editMode;
  setEditMode(newEditMode);

  if (!newEditMode) {
    // Si on d√©sactive le mode √©dition, on affiche un toast
    toast({
      title: "Modifications sauvegard√©es",
      description: "Les changements ont √©t√© enregistr√©s avec succ√®s."
    });
  }

  if (onEditModeChange) {
    onEditModeChange(newEditMode);
  }
};
```

**S√©quence du toggle** :

| √âtat initial | Action | Nouvel √©tat | Toast |
|--------------|--------|-------------|-------|
| `editMode = false` | Clic sur "Modifier" | `editMode = true` | Aucun |
| `editMode = true` | Clic sur "Sauvegarder" | `editMode = false` | "Modifications sauvegard√©es" |

**‚ö†Ô∏è Note** : Le toast "Modifications sauvegard√©es" est affich√© **uniquement lors de la d√©sactivation du mode √©dition**, alors que la sauvegarde r√©elle dans `localStorage` se fait **automatiquement lors de chaque modification de champ**.

### 9.3. Propagation de l'√©tat

**Flux de propagation** :

```
MenuOngletPortailsImmobiliers (state editMode)
          ‚Üì (onEditModeChange)
AccueilCopierPublierPortailsImmobiliers (state editMode)
          ‚Üì (props editMode)
File1.AnnoncePortailsImmobiliers (props editMode)
          ‚Üì (affichage conditionnel)
ReadOnlyField OU EditableField
```

**Code de propagation** (dans `AccueilCopierPublierPortailsImmobiliers.tsx`, lignes 67-77) :
```typescript
 {
    setEditMode(isEditMode);
  }}
/>
```

### 9.4. Affichage conditionnel

**Dans `File1.AnnoncePortailsImmobiliers.tsx`** (exemple du champ `titre`, lignes 59-72) :
```typescript

  Titre
  {editMode ? (
     handleChange("titre", value)}
      rows={1}
      useWysiwyg={true}
    />
  ) : (

  )}

```

**Logique** :
- `editMode = false` ‚Üí `ReadOnlyField` (affichage statique)
- `editMode = true` ‚Üí `EditableField` (√©diteur WYSIWYG)

### 9.5. Nettoyage HTML

**Fonction `handleChange()` dans `File1.AnnoncePortailsImmobiliers.tsx`** (lignes 21-44) :
```typescript
const handleChange = (name: string, value: string) => {
  // Pour le champ titre, on supprime les balises HTML
  let cleanedValue = value;
  if (name === "titre") {
    // Supprime les balises  et autres balises HTML
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  if (name === "accroche" || name === "appelAction") {
    // Supprime les balises  et autres balises HTML
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  const updatedData = { [name]: cleanedValue };
  updateAnnoncePortailsImmobiliers(updatedData);

  // Notification au composant parent si n√©cessaire
  if (onDataChange) {
    onDataChange({
      ...annoncePortailsImmobiliers,
      ...updatedData
    });
  }
};
```

**Champs nettoy√©s** :
- `titre` : Suppression de toutes les balises HTML
- `accroche` : Suppression de toutes les balises HTML
- `appelAction` : Suppression de toutes les balises HTML
- `descriptif` : **PAS de nettoyage** (conserve le HTML)

**Dans `File2.SynthesePortailsImmobiliers.tsx`** (lignes 21-39) :
```typescript
const handleChange = (name: string, value: string) => {
  // Pour le champ titre, on supprime les balises HTML
  let cleanedValue = value;
  if (name === "titre") {
    // Supprime les balises  et autres balises HTML
    cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
  }

  const updatedData = { [name]: cleanedValue };
  updateFichedeSynthesePortailsImmobiliers(updatedData);

  // Notification au composant parent si n√©cessaire
  if (onDataChange) {
    onDataChange({
      ...fichedeSynthesePortailsImmobiliers,
      ...updatedData
    });
  }
};
```

**Champs nettoy√©s** :
- `titre` : Suppression de toutes les balises HTML
- `referenceEtPrix`, `detailsCles`, `donneesFinancieres`, `informationsComplementaires` : **PAS de nettoyage** (conserve le HTML)

### 9.6. √âditeur WYSIWYG (EditeurWYSIWYG.tsx)

**Fichier** : `EditeurWYSIWYG.tsx`

**Biblioth√®que** : ReactQuill 2.0.0

**Configuration** :

| Param√®tre | Valeur | Note |
|-----------|--------|------|
| `theme` | `"snow"` | Th√®me par d√©faut de ReactQuill |
| `modules` | `{ toolbar: false }` | ‚ö†Ô∏è **Barre d'outils d√©sactiv√©e** |
| `formats` | `['header', 'bold', 'italic', 'underline', 'strike', 'list', 'bullet']` | Formats autoris√©s |
| `fontSize` | `18px` | Taille de police augment√©e |
| `fontFamily` | `'Nunito', sans-serif` | Police personnalis√©e |

**Props** :
```typescript
interface EditeurWYSIWYGProps {
  value: string;        // Valeur HTML √† afficher
  onChange: (content: string) => void;  // Callback lors de modification
  rows?: number;        // Nombre de lignes (calcul de la hauteur)
  className?: string;
  simpleMode?: boolean; // Non utilis√© actuellement
}
```

**Calcul de la hauteur** (ligne 48) :
```typescript
const editorHeight = `${Math.max(150, rows * 40)}px`;
```

**CSS personnalis√©** (lignes 69-84) :
```css
.quill-custom-font .ql-editor {
  font-size: 18px;
  font-family: 'Nunito', sans-serif;
  line-height: 1.6;
}

/* Cacher la barre d'outils */
.quill-custom-font .ql-toolbar {
  display: none;
}

/* Ajuster la hauteur sans la barre d'outils */
.quill-custom-font .ql-container {
  border-top: 1px solid #ccc;
}
```

**‚ö†Ô∏è Limitation** : L'utilisateur peut formater le texte (gras, italique, listes) en utilisant des raccourcis clavier (Ctrl+B, Ctrl+I, etc.), mais **aucune barre d'outils visuelle** n'est disponible.

---

## X. OPTIONS DE COPIE üìã

### 10.1. FORMAT TEXTE

**Onglet** : Onglet 3 "Copier l'Annonce"

**Composant** : `File3.ActionUtilisateurCopierPortailsImmobiliers.tsx`

**Hook** : `useCopierPortailsImmobiliersFormatTexte` (dans `HookCopierPortailsImmobiliersFormatTexte.tsx`)

#### A. Copier l'Annonce

**Fonction** : `copierAnnoncePortailsImmobiliers()` (lignes 8-69)

**Formatage du texte** (lignes 29-35) :
```typescript
const texteAnnonce = `${annoncePortailsImmobiliers.titre}

${annoncePortailsImmobiliers.accroche}

${annoncePortailsImmobiliers.descriptif}

${annoncePortailsImmobiliers.appelAction}`;
```

**Structure du texte copi√©** :
```
Titre de l'annonce

Phrase d'accroche

Description compl√®te du bien...

Appel √† l'action
```

**Gestion d'erreurs** :
- `isLoadingAnnonce = true` ‚Üí Toast "Chargement en cours"
- `errorAnnonce !== null` ‚Üí Toast "Impossible de copier l'annonce"
- Erreur clipboard ‚Üí Toast "Impossible de copier le texte"

**Toast de succ√®s** :
- Titre : "Copi√© !"
- Description : "L'annonce a √©t√© copi√©e dans votre presse-papiers."

#### B. Copier la Synth√®se

**Fonction** : `copierSynthesePortailsImmobiliers()` (lignes 73-131)

**Formatage du texte** (lignes 95-103) :
```typescript
const texteSynthese = `${synthesePortailsImmobiliers.titre}

${synthesePortailsImmobiliers.referenceEtPrix}

${synthesePortailsImmobiliers.detailsCles}

${synthesePortailsImmobiliers.donneesFinancieres}

${synthesePortailsImmobiliers.informationsComplementaires}`;
```

**Structure du texte copi√©** :
```
Titre de la synth√®se

R√©f√©rence: XXX
Prix: XXX ‚Ç¨

Pr√©sentation | D√©tails cl√©s
- D√©tail 1
- D√©tail 2

Pr√©sentation | Donn√©es Financi√®res
- Donn√©e 1
- Donn√©e 2

Pr√©sentation | Informations compl√©mentaires
- Info 1
- Info 2
```

**‚ö†Ô∏è Note** : Les titres de sections ("Pr√©sentation | D√©tails cl√©s", etc.) sont **ajout√©s automatiquement** par `addTitlesToSections()` dans `useApercuSynthesePortailsImmobiliers`

**Toast de succ√®s** :
- Titre : "Copi√© !"
- Description : "La synth√®se a √©t√© copi√©e dans votre presse-papiers."

#### C. Copier les 2 Annonces

**Fonction** : `copierLesDeuxAnnoncesSynthese()` (lignes 135-210)

**Formatage du texte** (lignes 157-183) :
```typescript
const texteAnnonce = `${annoncePortailsImmobiliers.titre}

${annoncePortailsImmobiliers.accroche}

${annoncePortailsImmobiliers.descriptif}

${annoncePortailsImmobiliers.appelAction}`;

const texteSynthese = `${synthesePortailsImmobiliers.titre}

${synthesePortailsImmobiliers.referenceEtPrix}

${synthesePortailsImmobiliers.detailsCles}

${synthesePortailsImmobiliers.donneesFinancieres}

${synthesePortailsImmobiliers.informationsComplementaires}`;

const texteCombine = `${texteAnnonce}

---

${texteSynthese}`;
```

**Structure du texte copi√©** :
```
[ANNONCE COMPL√àTE]

---

[SYNTH√àSE COMPL√àTE]
```

**S√©parateur** : `---` (triple tiret)

**Toast de succ√®s** :
- Titre : "Copi√© !"
- Description : "Les 2 annonces ont √©t√© copi√©es dans votre presse-papiers."

### 10.2. Logique de formatage d√©taill√©e

#### 10.2.1. Nettoyage HTML pour l'aper√ßu

**Fonction** : `stripHtmlTags()` (dans `HookCopierApercuAnnoncePortailsImmobiliers.tsx`, lignes 11-26)

```typescript
const stripHtmlTags = (html: string): string => {
  if (!html) return '';

  // √âtape 1: Ajouter des marqueurs sp√©ciaux avant de supprimer les balises
  let modifiedHtml = html
    .replace(/<\/h2>\s*/gi, '###SAUT_LIGNE###')  // Marquer transitions h2->p
    .replace(/<\/p>\s*/gi, '###SAUT_LIGNE###'); // Marquer transitions p->h2

  // √âtape 2: Supprimer toutes les balises HTML
  let textSansTags = modifiedHtml.replace(/<\/?[^>]+(>|$)/g, '');

  // √âtape 3: Remplacer les marqueurs par des sauts de ligne
  textSansTags = textSansTags.replace(/###SAUT_LIGNE###/g, '\n\n');

  return textSansTags;
};
```

**Logique** :
1. D√©tection des transitions `` et `` ‚Üí Insertion de marqueurs `###SAUT_LIGNE###`
2. Suppression de **toutes** les balises HTML
3. Remplacement des marqueurs par des doubles sauts de ligne (`\n\n`)

**‚ö†Ô∏è Variante pour la synth√®se** (dans `HookCopierApercuSynthesePortailsImmobiliers.tsx`, lignes 12-22) :

```typescript
const stripHtmlTags = (html: string): string => {
  if (!html) return '';

  // Remplacer les transitions entre paragraphes par des sauts de ligne
  let textWithLineBreaks = html.replace(/<\/p>/gi, '\n');

  // Supprimer toutes les balises HTML restantes
  let textSansTags = textWithLineBreaks.replace(/<\/?[^>]+(>|$)/g, '');

  return textSansTags;
};
```

**Diff√©rence** : Transitions `` remplac√©es par un simple saut de ligne (`\n` au lieu de `\n\n`)

#### 10.2.2. Ajout des titres de sections (Synth√®se uniquement)

**Fonction** : `addTitlesToSections()` (dans `HookCopierApercuSynthesePortailsImmobiliers.tsx`, lignes 25-42)

```typescript
const addTitlesToSections = (data: SynthesePortailsImmobiliersData): SynthesePortailsImmobiliersData => {
  const updatedData = { ...data };

  // N'ajouter le titre que si les donn√©es existent et ne sont pas vides
  if (updatedData.detailsCles && updatedData.detailsCles.trim() !== '') {
    updatedData.detailsCles = "Pr√©sentation | D√©tails cl√©s\n" + updatedData.detailsCles;
  }

  if (updatedData.donneesFinancieres && updatedData.donneesFinancieres.trim() !== '') {
    updatedData.donneesFinancieres = "Pr√©sentation | Donn√©es Financi√®res\n" + updatedData.donneesFinancieres;
  }

  if (updatedData.informationsComplementaires && updatedData.informationsComplementaires.trim() !== '') {
    updatedData.informationsComplementaires = "Pr√©sentation | Informations compl√©mentaires\n" + updatedData.informationsComplementaires;
  }

  return updatedData;
};
```

**Logique** :
- V√©rifie que le champ n'est pas vide
- Pr√©fixe le champ avec le titre de section + saut de ligne (`\n`)

**Champs concern√©s** :
- `detailsCles` ‚Üí "Pr√©sentation | D√©tails cl√©s"
- `donneesFinancieres` ‚Üí "Pr√©sentation | Donn√©es Financi√®res"
- `informationsComplementaires` ‚Üí "Pr√©sentation | Informations compl√©mentaires"

**‚ö†Ô∏è Note** : Les champs `titre` et `referenceEtPrix` ne re√ßoivent **pas** de titre de section

---

## XI. OPTIONS DE PUBLICATION üì§

### 11.1. √âtat actuel : FONCTIONS INACTIVES

**Onglet** : Onglet 4 "Publier l'Annonce"

**Composant** : `File4.ActionUtilisateurPublierPortailsImmobiliers.tsx`

**Hook** : `usePublierPortailsImmobiliers` (dans `HookPublierPortailsImmobiliers.tsx`)

**‚ö†Ô∏è IMPORTANT** : Les fonctions de publication sont **simul√©es** et affichent uniquement un toast "Fonctionnalit√© en d√©veloppement". Elles ne font **aucune action r√©elle** vers des portails immobiliers.

### 11.2. Fonction 1 : Publier l'Annonce

**Fonction** : `publierAnnoncePortailsImmobiliers()` (lignes 17-46)

```typescript
const publierAnnoncePortailsImmobiliers = async () => {
  setIsPublishing(true);

  try {
    // Simulation d'un d√©lai d'envoi
    await new Promise(resolve => setTimeout(resolve, 1500));

    // Cette fonction est inactive pour le moment
    // Elle sera impl√©ment√©e lorsque l'API des portails sera disponible

    toast({
      title: "Fonctionnalit√© en d√©veloppement",
      description: "La publication automatique sera disponible prochainement.",
    });
  } catch (error) {
    toast({
      title: "Erreur lors de la publication",
      description: "Une erreur est survenue lors de la tentative de publication.",
      variant: "destructive",
    });
    console.error("Erreur de publication:", error);
  } finally {
    setIsPublishing(false);
  }
};
```

**Comportement actuel** :
1. Activation du state `isPublishing = true`
2. Attente de 1,5 seconde (simulation)
3. Affichage du toast "Fonctionnalit√© en d√©veloppement"
4. D√©sactivation du state `isPublishing = false`

**Toast affich√©** :
- Titre : "Fonctionnalit√© en d√©veloppement"
- Description : "La publication automatique sera disponible prochainement."

### 11.3. Fonction 2 : Publier les 2 Annonces

**Fonction** : `publierLesDeuxAnnoncesSynthese()` (lignes 49-78)

```typescript
const publierLesDeuxAnnoncesSynthese = async () => {
  setIsPublishing(true);

  try {
    // Simulation d'un d√©lai d'envoi
    await new Promise(resolve => setTimeout(resolve, 2000));

    // Cette fonction est inactive pour le moment
    // Elle sera impl√©ment√©e lorsque l'API des portails sera disponible

    toast({
      title: "Fonctionnalit√© en d√©veloppement",
      description: "La publication automatique sera disponible prochainement.",
    });
  } catch (error) {
    toast({
      title: "Erreur lors de la publication",
      description: "Une erreur est survenue lors de la tentative de publication.",
      variant: "destructive",
    });
    console.error("Erreur de publication:", error);
  } finally {
    setIsPublishing(false);
  }
};
```

**Comportement actuel** :
1. Activation du state `isPublishing = true`
2. Attente de 2 secondes (simulation)
3. Affichage du toast "Fonctionnalit√© en d√©veloppement"
4. D√©sactivation du state `isPublishing = false`

**‚ö†Ô∏è Diff√©rence avec la fonction 1** : D√©lai de simulation plus long (2 secondes au lieu de 1,5)

### 11.4. Retour des donn√©es du hook

```typescript
return {
  publierAnnoncePortailsImmobiliers,
  publierLesDeuxAnnoncesSynthese,
  isPublishing,
  // Renvoyer les donn√©es des annonces pour un acc√®s facile dans le composant
  annoncePortailsImmobiliers,
  synthesePortailsImmobiliers
};
```

**‚ö†Ô∏è Note** : Le hook renvoie √©galement `annoncePortailsImmobiliers` et `synthesePortailsImmobiliers` (r√©cup√©r√©s via les hooks `useApercuAnnonce` et `useApercuSynthese`), mais ces donn√©es ne sont **pas utilis√©es** dans les fonctions de publication actuelles.

### 11.5. Plan d'impl√©mentation future

**Pour activer la publication vers les portails, il faudrait** :

1. **Int√©grer les API des portails immobiliers** :
   - SeLoger
   - Leboncoin
   - Logic-immo
   - PAP
   - Bien'ici
   - Etc.

2. **G√©rer les connexions API** :
   - Stockage des cl√©s API dans la table `connexions` (ou √©quivalent)
   - Authentification OAuth ou API key
   - Gestion des tokens de rafra√Æchissement

3. **Formater les donn√©es selon les sp√©cifications de chaque portail** :
   - Mapping des champs (titre, description, prix, etc.)
   - Conversion des formats (HTML ‚Üí texte brut, etc.)
   - Upload des images

4. **G√©rer les erreurs et les retours** :
   - V√©rification de la publication r√©ussie
   - Gestion des erreurs sp√©cifiques √† chaque portail
   - Notification de l'utilisateur

5. **Supabase - Migration n√©cessaire** :
   - Cr√©er une table `publications_portails` pour suivre l'√©tat des publications
   - Cr√©er des Edge Functions pour g√©rer les appels API vers les portails
   - Impl√©menter RLS pour s√©curiser les donn√©es

---

## XII. SYST√àME D'APER√áU üëÅÔ∏è

### 12.1. Hook Aper√ßu Annonce : `useApercuAnnoncePortailsImmobiliers`

**Fichier** : `HookCopierApercuAnnoncePortailsImmobiliers.tsx`

**R√¥le** : R√©cup√©ration des donn√©es de l'annonce avec nettoyage HTML pour affichage en texte brut

**Interface** :
```typescript
interface AnnoncePortailsImmobiliersData {
  titre: string;
  accroche: string;
  descriptif: string;
  appelAction: string;
}
```

**Fonction de nettoyage HTML** (lignes 11-26) :
```typescript
const stripHtmlTags = (html: string): string => {
  if (!html) return '';

  // √âtape 1: Ajouter des marqueurs sp√©ciaux avant de supprimer les balises
  let modifiedHtml = html
    .replace(/<\/h2>\s*/gi, '###SAUT_LIGNE###')  // Marquer transitions h2->p
    .replace(/<\/p>\s*/gi, '###SAUT_LIGNE###'); // Marquer transitions p->h2

  // √âtape 2: Supprimer toutes les balises HTML
  let textSansTags = modifiedHtml.replace(/<\/?[^>]+(>|$)/g, '');

  // √âtape 3: Remplacer les marqueurs par des sauts de ligne
  textSansTags = textSansTags.replace(/###SAUT_LIGNE###/g, '\n\n');

  return textSansTags;
};
```

**Logique de r√©cup√©ration** (lignes 38-71) :
```typescript
useEffect(() => {
  try {
    setIsLoading(true);

    // V√©rifier d'abord s'il existe des donn√©es modifi√©es
    const modifiedDataJson = localStorage.getItem('key-modifs-annonce-portails-immobiliers');

    if (modifiedDataJson) {
      // Utiliser les donn√©es modifi√©es si elles existent
      const modifiedData = JSON.parse(modifiedDataJson);
      setApercuAnnoncePortailsImmobiliers({
        titre: stripHtmlTags(modifiedData.titre || ''),
        accroche: stripHtmlTags(modifiedData.accroche || ''),
        descriptif: stripHtmlTags(modifiedData.descriptif || ''),
        appelAction: stripHtmlTags(modifiedData.appelAction || '')
      });
    } else {
      // Sinon, r√©cup√©ration des donn√©es originales depuis le localStorage
      const annoncePortailsImmobiliersData = localStorage.getItem('generation_website_ad');

      if (annoncePortailsImmobiliersData) {
        const parsedData = JSON.parse(annoncePortailsImmobiliersData);
        setApercuAnnoncePortailsImmobiliers({
          titre: stripHtmlTags(parsedData.titre || ''),
          accroche: stripHtmlTags(parsedData.accroche || ''),
          descriptif: stripHtmlTags(parsedData.descriptif || ''),
          appelAction: stripHtmlTags(parsedData.cta || '') // Note: utilisation de 'cta' au lieu de 'appelAction'
        });
      } else {
        console.log('Aucune donn√©e d\'annonce portails immobiliers trouv√©e dans le localStorage');
      }
    }

    setIsLoading(false);
  } catch (err) {
    console.error('Erreur lors de la r√©cup√©ration des donn√©es:', err);
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

**‚ö†Ô∏è Mapping critique** : `parsedData.cta` ‚Üí `appelAction` (ligne 64)

**Retour du hook** :
```typescript
return { annoncePortailsImmobiliers: ApercuAnnoncePortailsImmobiliers, isLoading, error };
```

### 12.2. Hook Aper√ßu Synth√®se : `useApercuSynthesePortailsImmobiliers`

**Fichier** : `HookCopierApercuSynthesePortailsImmobiliers.tsx`

**R√¥le** : R√©cup√©ration des donn√©es de la synth√®se avec nettoyage HTML et ajout des titres de sections

**Interface** :
```typescript
interface SynthesePortailsImmobiliersData {
  titre: string;
  referenceEtPrix: string;
  detailsCles: string;
  donneesFinancieres: string;
  informationsComplementaires: string;
}
```

**Fonction de nettoyage HTML** (lignes 12-22) :
```typescript
const stripHtmlTags = (html: string): string => {
  if (!html) return '';

  // Remplacer les transitions entre paragraphes par des sauts de ligne
  let textWithLineBreaks = html.replace(/<\/p>/gi, '\n');

  // Supprimer toutes les balises HTML restantes
  let textSansTags = textWithLineBreaks.replace(/<\/?[^>]+(>|$)/g, '');

  return textSansTags;
};
```

**Fonction d'ajout des titres de sections** (lignes 25-42) :
```typescript
const addTitlesToSections = (data: SynthesePortailsImmobiliersData): SynthesePortailsImmobiliersData => {
  const updatedData = { ...data };

  // N'ajouter le titre que si les donn√©es existent et ne sont pas vides
  if (updatedData.detailsCles && updatedData.detailsCles.trim() !== '') {
    updatedData.detailsCles = "Pr√©sentation | D√©tails cl√©s\n" + updatedData.detailsCles;
  }

  if (updatedData.donneesFinancieres && updatedData.donneesFinancieres.trim() !== '') {
    updatedData.donneesFinancieres = "Pr√©sentation | Donn√©es Financi√®res\n" + updatedData.donneesFinancieres;
  }

  if (updatedData.informationsComplementaires && updatedData.informationsComplementaires.trim() !== '') {
    updatedData.informationsComplementaires = "Pr√©sentation | Informations compl√©mentaires\n" + updatedData.informationsComplementaires;
  }

  return updatedData;
};
```

**Logique de r√©cup√©ration** (lignes 55-90) :
```typescript
useEffect(() => {
  try {
    setIsLoading(true);

    // V√©rifier d'abord s'il existe des donn√©es modifi√©es
    const modifiedDataJson = localStorage.getItem('key-modifs-synthese-portails-immobiliers');

    if (modifiedDataJson) {
      // Utiliser les donn√©es modifi√©es si elles existent
      const modifiedData = JSON.parse(modifiedDataJson);
      setApercuSynthesePortailsImmobiliers(addTitlesToSections({
        titre: stripHtmlTags(modifiedData.titre || ''),
        referenceEtPrix: stripHtmlTags(modifiedData.referenceEtPrix || ''),
        detailsCles: stripHtmlTags(modifiedData.detailsCles || ''),
        donneesFinancieres: stripHtmlTags(modifiedData.donneesFinancieres || ''),
        informationsComplementaires: stripHtmlTags(modifiedData.informationsComplementaires || '')
      }));
    } else {
      // Sinon, r√©cup√©ration des donn√©es originales depuis le localStorage
      const synthesePortailsImmobiliersData = localStorage.getItem('generation_summary_sheet');

      if (synthesePortailsImmobiliersData) {
        const parsedData = JSON.parse(synthesePortailsImmobiliersData);
        setApercuSynthesePortailsImmobiliers(addTitlesToSections({
          titre: stripHtmlTags(parsedData.titre || ''),
          referenceEtPrix: stripHtmlTags(parsedData.referenceEtPrix || ''),
          detailsCles: stripHtmlTags(parsedData.detailsCles || ''),
          donneesFinancieres: stripHtmlTags(parsedData.donneesFinancieres || ''),
          informationsComplementaires: stripHtmlTags(parsedData.informationsComplementaires || '')
        }));
      } else {
        console.log('Aucune donn√©e de synth√®se pour portails immobiliers trouv√©e dans le localStorage');
      }
    }

    setIsLoading(false);
  } catch (err) {
    console.error('Erreur lors de la r√©cup√©ration des donn√©es:', err);
    setError('Erreur lors de la r√©cup√©ration des donn√©es');
    setIsLoading(false);
  }
}, []);
```

**Retour du hook** :
```typescript
return { synthesePortailsImmobiliers: ApercuSynthesePortailsImmobiliers, isLoading, error };
```

### 12.3. Affichage des aper√ßus

**Composant** : `AnnoncePreview` (dans `GraphismeInterieurPortailsImmobiliers.tsx`, lignes 230-249)

```typescript
export const AnnoncePreview: React.FC = ({ 
  title, 
  className,
  children
}) => {
  return (

      {title}

        {children}

  );
};
```

**Utilisation dans `File3.ActionUtilisateurCopierPortailsImmobiliers.tsx`** (lignes 42-75) :

```typescript
{/* Aper√ßu de l'annonce */}

  {isLoadingAnnonce ? (
    Chargement de l'annonce...
  ) : errorAnnonce ? (
    {errorAnnonce}
  ) : (

      {annoncePortailsImmobiliers.titre && Titre : {annoncePortailsImmobiliers.titre}}
      {annoncePortailsImmobiliers.accroche && Accroche : {annoncePortailsImmobiliers.accroche}}
      {annoncePortailsImmobiliers.descriptif && Descriptif : {annoncePortailsImmobiliers.descriptif}}
      {annoncePortailsImmobiliers.appelAction && Appel √† l'action : {annoncePortailsImmobiliers.appelAction}}

  )}

{/* Aper√ßu de la synth√®se */}

  {isLoadingSynthese ? (
    Chargement de la synth√®se...
  ) : errorSynthese ? (
    {errorSynthese}
  ) : (

      {synthesePortailsImmobiliers.titre && Titre : {synthesePortailsImmobiliers.titre}}
      {synthesePortailsImmobiliers.referenceEtPrix && {synthesePortailsImmobiliers.referenceEtPrix}}
      {synthesePortailsImmobiliers.detailsCles && {synthesePortailsImmobiliers.detailsCles}}
      {synthesePortailsImmobiliers.donneesFinancieres && {synthesePortailsImmobiliers.donneesFinancieres}}
      {synthesePortailsImmobiliers.informationsComplementaires && {synthesePortailsImmobiliers.informationsComplementaires}}

  )}

```

**Format d'affichage** :
- Champs affich√©s avec label en gras (``)
- Texte en `whitespace-pre-line` pour pr√©server les sauts de ligne
- Champs conditionnels (`&&`) pour √©viter d'afficher des sections vides
- √âtats de chargement et d'erreur g√©r√©s

---

## XIII. CONTRAINTES ET VALIDATION ‚úÖ

### 13.1. Validation des champs (nettoyage HTML)

**Champs nettoy√©s dans `File1.AnnoncePortailsImmobiliers.tsx`** :
- `titre` : Suppression de toutes les balises HTML
- `accroche` : Suppression de toutes les balises HTML
- `appelAction` : Suppression de toutes les balises HTML

**Champs NON nettoy√©s** :
- `descriptif` : Conserve le HTML (affich√© avec `dangerouslySetInnerHTML`)

**Regex de nettoyage** :
```javascript
cleanedValue = value.replace(/<\/?[^>]+(>|$)/g, "");
```

**Champs nettoy√©s dans `File2.SynthesePortailsImmobiliers.tsx`** :
- `titre` : Suppression de toutes les balises HTML

**Champs NON nettoy√©s** :
- `referenceEtPrix`, `detailsCles`, `donneesFinancieres`, `informationsComplementaires` : Conservent le HTML

### 13.2. Gestion des erreurs (loading, error)

**√âtats de chargement** :

| Hook | State `isLoading` | State `error` | Comportement |
|------|-------------------|---------------|--------------|
| `useRecuperationAnnonceVersPortailsImmobiliers` | `true` ‚Üí "Chargement des donn√©es..." | Message d'erreur en rouge | Bloque l'affichage |
| `useRecuperationFichedeSyntheseVersPortailsImmobiliers` | `true` ‚Üí "Chargement des donn√©es..." | Message d'erreur en rouge | Bloque l'affichage |
| `useApercuAnnoncePortailsImmobiliers` | `true` ‚Üí "Chargement de l'annonce..." | Message d'erreur en rouge | Affiche dans l'aper√ßu |
| `useApercuSynthesePortailsImmobiliers` | `true` ‚Üí "Chargement de la synth√®se..." | Message d'erreur en rouge | Affiche dans l'aper√ßu |

**Gestion des erreurs dans les hooks de copie** :

```typescript
// Hook: useCopierPortailsImmobiliersFormatTexte
if (isLoadingAnnonce) {
  toast({
    title: "Chargement en cours",
    description: "Veuillez patienter pendant le chargement des donn√©es.",
  });
  return;
}

if (errorAnnonce) {
  toast({
    title: "Erreur",
    description: "Impossible de copier l'annonce en raison d'une erreur.",
    variant: "destructive",
  });
  return;
}
```

**Gestion des erreurs de clipboard** :

```typescript
try {
  await navigator.clipboard.writeText(texteAnnonce);
  toast({
    title: "Copi√© !",
    description: "L'annonce a √©t√© copi√©e dans votre presse-papiers.",
  });
} catch (error) {
  toast({
    title: "Erreur",
    description: "Impossible de copier le texte.",
    variant: "destructive",
  });
}
```

### 13.3. Toasts de notification

**Biblioth√®que** : `useToast` de `@/hooks/use-toast`

**Toasts de succ√®s** :

| Action | Titre | Description |
|--------|-------|-------------|
| Sauvegarde (d√©sactivation mode √©dition) | "Modifications sauvegard√©es" | "Les changements ont √©t√© enregistr√©s avec succ√®s." |
| Copie Annonce | "Copi√© !" | "L'annonce a √©t√© copi√©e dans votre presse-papiers." |
| Copie Synth√®se | "Copi√© !" | "La synth√®se a √©t√© copi√©e dans votre presse-papiers." |
| Copie Les 2 Annonces | "Copi√© !" | "Les 2 annonces ont √©t√© copi√©es dans votre presse-papiers." |

**Toasts d'information** :

| Action | Titre | Description |
|--------|-------|-------------|
| Publication Annonce | "Fonctionnalit√© en d√©veloppement" | "La publication automatique sera disponible prochainement." |
| Publication Les 2 Annonces | "Fonctionnalit√© en d√©veloppement" | "La publication automatique sera disponible prochainement." |
| Chargement en cours | "Chargement en cours" | "Veuillez patienter pendant le chargement des donn√©es." |

**Toasts d'erreur** :

| Action | Titre | Description | Variant |
|--------|-------|-------------|---------|
| Copie impossible (erreur) | "Erreur" | "Impossible de copier l'annonce en raison d'une erreur." | `destructive` |
| Copie impossible (clipboard) | "Erreur" | "Impossible de copier le texte." | `destructive` |
| Publication √©chou√©e | "Erreur lors de la publication" | "Une erreur est survenue lors de la tentative de publication." | `destructive` |

### 13.4. S√©curit√©

**Utilisation de `dangerouslySetInnerHTML`** :

| Composant | Champ | Condition | Risque |
|-----------|-------|-----------|--------|
| `ReadOnlyField` | Tous | `isDescriptif = true` | Injection XSS si donn√©es non valid√©es |

**‚ö†Ô∏è Point d'attention** : Les donn√©es proviennent d'OpenAI (source contr√¥l√©e), mais un nettoyage suppl√©mentaire des balises HTML pourrait √™tre envisag√© pour renforcer la s√©curit√©.

**Recommandations** :
- Utiliser une biblioth√®que comme `DOMPurify` pour nettoyer le HTML avant `dangerouslySetInnerHTML`
- Valider les donn√©es c√¥t√© backend (Supabase) avant stockage
- Impl√©menter une politique de Content Security Policy (CSP)

---

## XIV. COMPOSANTS GRAPHIQUES R√âUTILISABLES üé®

### 14.1. LabelField

**Fichier** : `GraphismeInterieurPortailsImmobiliers.tsx` (lignes 14-23)

**Props** :
```typescript
interface LabelFieldProps {
  htmlFor: string;
  children: ReactNode;
  className?: string;
}
```

**Code** :
```typescript
export const LabelField: React.FC = ({ htmlFor, children, className }) => {
  return (

      {children}

  );
};
```

**Utilisation** :
```tsx
Titre
```

### 14.2. ReadOnlyField

**Fichier** : `GraphismeInterieurPortailsImmobiliers.tsx` (lignes 33-51)

**Props** :
```typescript
interface ReadOnlyFieldProps {
  id: string;
  content: string;
  isDescriptif?: boolean;
  className?: string;
}
```

**Code** :
```typescript
export const ReadOnlyField: React.FC = ({ 
  id, 
  content, 
  isDescriptif = false,
  className
}) => {
  return (

      {isDescriptif ? (

      ) : (
        {content}
      )}

  );
};
```

**Utilisation** :
```tsx

```

### 14.3. EditableField

**Fichier** : `GraphismeInterieurPortailsImmobiliers.tsx` (lignes 63-95)

**Props** :
```typescript
interface EditableFieldProps {
  id: string;
  value: string;
  onChange: (value: string) => void;
  rows?: number;
  className?: string;
  useWysiwyg?: boolean;
}
```

**Code** :
```typescript
export const EditableField: React.FC = ({ 
  id, 
  value, 
  onChange, 
  rows = 3,
  className,
  useWysiwyg = false
}) => {
  if (useWysiwyg) {
    // Utilisez le mode simple pour les champs qui ne sont pas des descriptions longues
    const simpleMode = rows <= 3;

    return (

    );
  }

  return (
     onChange(e.target.value)} 
      className={cn("w-full rounded-md border border-gray-200 p-3", className)}
      rows={rows}
    />
  );
};
```

**Utilisation** :
```tsx
<EditableField
  id="titre"
  value={annoncePortailsImmobiliers.titre}
  onChange={(value) => handleChange("titre", value)}
  rows={1}
  useWysiwyg={true}
/>
```

### 14.4. CopyOption3

**Fichier** : `GraphismeInterieurPortailsImmobiliers.tsx` (lignes 181-213)

**Props** :
```typescript
interface CopyOption3Props {
  title: string;
  description: string;
  icon: React.ReactNode;
  buttons: Array<{
    text: string;
    onClick: () => void;
  }>;
  className?: string;
}
```

**Code** :
```typescript
export const CopyOption3: React.FC<CopyOption3Props> = ({
  title,
  description,
  icon,
  buttons,
  className
}) => {
  return (
    <div className={cn("border-l-4 border-l-realestate-mauve bg-white p-4 rounded-r-lg shadow-sm hover:shadow-md transition-all", className)}>
      <div className="flex items-start mb-3">
        <div className="p-2 rounded-lg bg-realestate-purple-light text-realestate-purple-dark mr-3">
          {icon}
        </div>
        <div>
          <h4 className="font-semibold">{title}</h4>
          <p className="text-sm text-gray-600">{description}</p>
        </div>
      </div>
      <div className="space-y-3">
        {buttons.map((button, index) => (
          <Button 
            key={index} 
            onClick={button.onClick} 
            className="w-full bg-realestate-mauve hover:bg-realestate-mauve-dark text-white justify-start"
          >
            <ClipboardCopy className="mr-2 h-4 w-4" />
            {button.text}
          </Button>
        ))}
      </div>
    </div>
  );
};
```

**Utilisation** :
```tsx
<CopyOption3
  title="Copier au Format Texte"
  description="Copiez vos annonces au format texte brut pour les coller facilement sur vos portails immobiliers."
  icon={<FileText className="h-6 w-6" />}
  buttons={[
    {
      text: "Copier l'Annonce",
      onClick: copierAnnoncePortailsImmobiliers,
    },
    {
      text: "Copier la Synth√®se",
      onClick: copierSynthesePortailsImmobiliers,
    },
    {
      text: "Copier les 2 Annonces",
      onClick: copierLesDeuxAnnoncesSynthese,
    },
  ]}
/>
```

### 14.5. CopyOptionsContainer

**Fichier** : `GraphismeInterieurPortailsImmobiliers.tsx` (lignes 221-227)

**Props** :
```typescript
interface CopyOptionsContainerProps {
  children: ReactNode;
  className?: string;
}
```

**Code** :
```typescript
export const CopyOptionsContainer: React.FC<CopyOptionsContainerProps> = ({ children, className }) => {
  return (
    <div className={cn("grid md:grid-cols-2 gap-6", className)}>
      {children}
    </div>
  );
};
```

**Utilisation** :
```tsx
<CopyOptionsContainer>
  <CopyOption3 ... />
  <div></div> {/* Vide pour sym√©trie */}
</CopyOptionsContainer>
```

### 14.6. AnnoncePreview

**Fichier** : `GraphismeInterieurPortailsImmobiliers.tsx` (lignes 236-249)

**Props** :
```typescript
interface AnnoncePreviewProps {
  title: string;
  className?: string;
  children?: ReactNode;
}
```

**Code** :
```typescript
export const AnnoncePreview: React.FC<AnnoncePreviewProps> = ({ 
  title, 
  className,
  children
}) => {
  return (
    <div className={cn("mt-6 p-4 bg-realestate-purple-light/10 border border-realestate-purple-light rounded-lg", className)}>
      <h4 className="font-semibold mb-2">{title}</h4>
      <div className="bg-white p-4 rounded border border-gray-200 max-h-64 overflow-y-auto">
        {children}
      </div>
    </div>
  );
};
```

**Utilisation** :
```tsx
<AnnoncePreview title="Aper√ßu de l'Annonce">
  <div className="whitespace-pre-line">
    {annoncePortailsImmobiliers.titre && <p><strong>Titre :</strong> {annoncePortailsImmobiliers.titre}</p>}
    {annoncePortailsImmobiliers.accroche && <p><strong>Accroche :</strong> {annoncePortailsImmobiliers.accroche}</p>}
  </div>
</AnnoncePreview>
```

---

## XV. TABLEAUX R√âCAPITULATIFS üìä

### 15.1. Tableau des champs - Annonce Portails Immobiliers

| Champ | Label | Type | Nettoyage HTML (√©dition) | `useWysiwyg` | `rows` | `isDescriptif` (lecture) |
|-------|-------|------|--------------------------|--------------|--------|--------------------------|
| `titre` | "Titre" | `string` | ‚úÖ Oui | `true` | `1` | `false` |
| `accroche` | "Accroche" | `string` | ‚úÖ Oui | `true` | `1` | `false` |
| `descriptif` | "Descriptif" | `string` | ‚ùå Non | `true` | `6` | `true` |
| `appelAction` | "Appel √† l'action" | `string` | ‚úÖ Oui | `true` | `1` | `false` |

### 15.2. Tableau des champs - Synth√®se Portails Immobiliers

| Champ | Label | Type | Nettoyage HTML (√©dition) | `useWysiwyg` | `rows` | `isDescriptif` (lecture) | Titre de section ajout√© |
|-------|-------|------|--------------------------|--------------|--------|--------------------------|-------------------------|
| `titre` | "Titre" | `string` | ‚úÖ Oui | `true` | `1` | `false` | ‚ùå Non |
| `referenceEtPrix` | "R√©f√©rence & Prix" | `string` | ‚ùå Non | `true` | `3` | `true` | ‚ùå Non |
| `detailsCles` | "Pr√©sentation \| D√©tails cl√©s" | `string` | ‚ùå Non | `true` | `6` | `true` | ‚úÖ "Pr√©sentation \| D√©tails cl√©s" |
| `donneesFinancieres` | "Pr√©sentation \| Donn√©es Financi√®res" | `string` | ‚ùå Non | `true` | `6` | `true` | ‚úÖ "Pr√©sentation \| Donn√©es Financi√®res" |
| `informationsComplementaires` | "Pr√©sentation \| Informations compl√©mentaires" | `string` | ‚ùå Non | `true` | `6` | `true` | ‚úÖ "Pr√©sentation \| Informations compl√©mentaires" |

### 15.3. Tableau des hooks

| Hook | Fichier | R√¥le | Cl√©s localStorage | Fonctions retourn√©es |
|------|---------|------|-------------------|----------------------|
| `useRecuperationAnnonceVersPortailsImmobiliers` | `HookRecuperationAnnonceVersPortailsImmobiliers.ts` | R√©cup√©ration de l'annonce | `key-modifs-annonce-portails-immobiliers`<br/>`generation_website_ad` | `annoncePortailsImmobiliers`<br/>`updateAnnoncePortailsImmobiliers`<br/>`isLoading`<br/>`error` |
| `useRecuperationFichedeSyntheseVersPortailsImmobiliers` | `HookRecuperationFichedeSyntheseVersPortailsImmobiliers.ts` | R√©cup√©ration de la synth√®se | `key-modifs-synthese-portails-immobiliers`<br/>`generation_summary_sheet` | `fichedeSynthesePortailsImmobiliers`<br/>`updateFichedeSynthesePortailsImmobiliers`<br/>`isLoading`<br/>`error` |
| `useApercuAnnoncePortailsImmobiliers` | `HookCopierApercuAnnoncePortailsImmobiliers.tsx` | Aper√ßu de l'annonce (texte brut) | `key-modifs-annonce-portails-immobiliers`<br/>`generation_website_ad` | `annoncePortailsImmobiliers`<br/>`isLoading`<br/>`error` |
| `useApercuSynthesePortailsImmobiliers` | `HookCopierApercuSynthesePortailsImmobiliers.tsx` | Aper√ßu de la synth√®se (texte brut + titres) | `key-modifs-synthese-portails-immobiliers`<br/>`generation_summary_sheet` | `synthesePortailsImmobiliers`<br/>`isLoading`<br/>`error` |
| `useCopierPortailsImmobiliersFormatTexte` | `HookCopierPortailsImmobiliersFormatTexte.tsx` | Copie au format texte | N/A | `copierAnnoncePortailsImmobiliers`<br/>`copierSynthesePortailsImmobiliers`<br/>`copierLesDeuxAnnoncesSynthese`<br/>`isCopying`<br/>`isLoading`<br/>`error` |
| `usePublierPortailsImmobiliers` | `HookPublierPortailsImmobiliers.tsx` | Publication (INACTIF) | N/A | `publierAnnoncePortailsImmobiliers`<br/>`publierLesDeuxAnnoncesSynthese`<br/>`isPublishing`<br/>`annoncePortailsImmobiliers`<br/>`synthesePortailsImmobiliers` |

### 15.4. Tableau des fonctions de copie

| Fonction | Hook | Format | Contenu | Toast de succ√®s |
|----------|------|--------|---------|-----------------|
| `copierAnnoncePortailsImmobiliers()` | `useCopierPortailsImmobiliersFormatTexte` | Texte brut | titre + accroche + descriptif + appelAction | "L'annonce a √©t√© copi√©e dans votre presse-papiers." |
| `copierSynthesePortailsImmobiliers()` | `useCopierPortailsImmobiliersFormatTexte` | Texte brut + titres de sections | titre + referenceEtPrix + detailsCles + donneesFinancieres + informationsComplementaires | "La synth√®se a √©t√© copi√©e dans votre presse-papiers." |
| `copierLesDeuxAnnoncesSynthese()` | `useCopierPortailsImmobiliersFormatTexte` | Texte brut (annonce + s√©parateur + synth√®se) | Annonce compl√®te + "---" + Synth√®se compl√®te | "Les 2 annonces ont √©t√© copi√©es dans votre presse-papiers." |

### 15.5. Matrice Onglets √ó Actions √ó Fichiers

| Onglet | Actions disponibles | Fichiers utilis√©s | Hooks utilis√©s |
|--------|---------------------|-------------------|----------------|
| **Onglet 1 : Annonce** | Visualiser, Modifier | `File1.AnnoncePortailsImmobiliers.tsx`<br/>`EditeurWYSIWYG.tsx`<br/>`GraphismeInterieurPortailsImmobiliers.tsx` | `useRecuperationAnnonceVersPortailsImmobiliers` |
| **Onglet 2 : Synth√®se** | Visualiser, Modifier | `File2.SynthesePortailsImmobiliers.tsx`<br/>`EditeurWYSIWYG.tsx`<br/>`GraphismeInterieurPortailsImmobiliers.tsx` | `useRecuperationFichedeSyntheseVersPortailsImmobiliers` |
| **Onglet 3 : Copier l'Annonce** | Copier Format Texte (3 boutons), Aper√ßu | `File3.ActionUtilisateurCopierPortailsImmobiliers.tsx`<br/>`GraphismeInterieurPortailsImmobiliers.tsx` | `useApercuAnnoncePortailsImmobiliers`<br/>`useApercuSynthesePortailsImmobiliers`<br/>`useCopierPortailsImmobiliersFormatTexte` |
| **Onglet 4 : Publier l'Annonce** | Publier (INACTIF - 2 boutons), Aper√ßu | `File4.ActionUtilisateurPublierPortailsImmobiliers.tsx`<br/>`GraphismeInterieurPortailsImmobiliers.tsx` | `useApercuAnnoncePortailsImmobiliers`<br/>`useApercuSynthesePortailsImmobiliers`<br/>`usePublierPortailsImmobiliers` |

---

## XVI. DONN√âES √Ä PRENDRE EN CONSID√âRATION üîç

### 16.1. Points d'attention techniques

**1. Mapping critique `cta` ‚Üí `appelAction`**
- OpenAI renvoie `cta` mais l'interface React attend `appelAction`
- Mapping effectu√© dans `HookRecuperationAnnonceVersPortailsImmobiliers.ts` (ligne 38)
- Mapping √©galement dans `HookCopierApercuAnnoncePortailsImmobiliers.tsx` (ligne 64)
- **‚ö†Ô∏è √Ä v√©rifier lors de la migration Supabase** : Le nom du champ en base de donn√©es doit √™tre coh√©rent

**2. Fonctions de publication INACTIVES**
- Les fonctions `publierAnnoncePortailsImmobiliers()` et `publierLesDeuxAnnoncesSynthese()` sont **simul√©es**
- Aucune connexion API r√©elle vers les portails immobiliers
- Toast "Fonctionnalit√© en d√©veloppement" affich√©
- **‚ö†Ô∏è Migration Supabase** : Cr√©er des Edge Functions pour g√©rer les appels API vers les portails

**3. Sauvegarde automatique lors de l'√©dition**
- Chaque modification de champ d√©clenche une sauvegarde imm√©diate dans `localStorage`
- Le bouton "Sauvegarder" sert uniquement √† quitter le mode √©dition (et affiche un toast)
- **‚ö†Ô∏è Migration Supabase** : Impl√©menter un debounce pour √©viter trop d'appels √† la base de donn√©es

**4. Nettoyage HTML incoh√©rent**
- Onglet 1 : Nettoyage sur `titre`, `accroche`, `appelAction` (mais pas `descriptif`)
- Onglet 2 : Nettoyage uniquement sur `titre`
- **‚ö†Ô∏è √Ä harmoniser** : D√©finir une strat√©gie de nettoyage coh√©rente pour tous les champs

**5. Utilisation de `dangerouslySetInnerHTML`**
- Utilis√© dans `ReadOnlyField` pour les champs avec `isDescriptif=true`
- Risque potentiel d'injection XSS si les donn√©es ne sont pas valid√©es
- **‚ö†Ô∏è Recommandation** : Utiliser `DOMPurify` pour nettoyer le HTML avant affichage

**6. States `annoncePortailsImmobiliersData` et `synthesePortailsImmobiliersData` non utilis√©s**
- D√©finis dans `AccueilCopierPublierPortailsImmobiliers.tsx` (lignes 18-19)
- Mis √† jour via les callbacks `onDataChange` (lignes 22-28)
- Mais **jamais utilis√©s** dans le reste du code
- **‚ö†Ô∏è √Ä nettoyer** : Supprimer ces states inutiles ou les utiliser

### 16.2. D√©pendances critiques

**Biblioth√®ques externes** :
- `react-quill` : √âditeur WYSIWYG (version 2.0.0)
- `@radix-ui/react-tabs` : Gestion des onglets
- `lucide-react` : Ic√¥nes
- `navigator.clipboard` : API de copie dans le presse-papiers (n√©cessite HTTPS ou localhost)

**Hooks Lovable** :
- `useToast` : Notifications toast
- `useIsMobile` : D√©tection mobile (pour le responsive des onglets)

**Components Lovable** :
- `Button` : Boutons de l'UI
- `Tabs`, `TabsList`, `TabsTrigger`, `TabsContent` : Composants d'onglets

### 16.3. Fonctions cl√©s √† pr√©server

**Lors de la migration vers Supabase, il est crucial de pr√©server** :

1. **La logique de priorit√©** : `key-modifs-*` > `generation_*`
   - Impl√©menter en SQL avec `COALESCE(modifs.field, original.field)`

2. **Le mapping `cta` ‚Üí `appelAction`**
   - Cr√©er une vue SQL ou une fonction pour g√©rer automatiquement ce mapping

3. **Le nettoyage HTML**
   - Fonction `stripHtmlTags()` √† porter en SQL ou Edge Function

4. **L'ajout des titres de sections**
   - Fonction `addTitlesToSections()` √† porter en Edge Function ou vue SQL

5. **Le formatage pour la copie**
   - Fonctions `copierAnnoncePortailsImmobiliers()`, `copierSynthesePortailsImmobiliers()`, `copierLesDeuxAnnoncesSynthese()`
   - √Ä conserver c√¥t√© client (React) car elles manipulent le clipboard

### 16.4. Mapping OpenAI ‚Üí Interface

**Champs avec mapping** :

| Service OpenAI | Champ OpenAI | Champ Interface | Fichiers concern√©s |
|----------------|--------------|-----------------|-------------------|
| `generateWebsiteAd` | `cta` | `appelAction` | `HookRecuperationAnnonceVersPortailsImmobiliers.ts`<br/>`HookCopierApercuAnnoncePortailsImmobiliers.tsx` |

**Champs sans mapping** :
- Tous les champs de `generateSummarySheetAd` ont des noms identiques entre OpenAI et l'interface

### 16.5. Strat√©gie de migration localStorage ‚Üí Supabase

**Tables Supabase √† cr√©er** :

1. **`annonces_portails`** (stockage des annonces)
   - `id` : UUID (PK)
   - `organisation_id` : UUID (FK)
   - `user_id` : UUID (FK)
   - `titre` : TEXT
   - `accroche` : TEXT
   - `descriptif` : TEXT
   - `appel_action` : TEXT
   - `created_at` : TIMESTAMP
   - `updated_at` : TIMESTAMP

2. **`syntheses_portails`** (stockage des synth√®ses)
   - `id` : UUID (PK)
   - `organisation_id` : UUID (FK)
   - `user_id` : UUID (FK)
   - `titre` : TEXT
   - `reference_et_prix` : TEXT
   - `details_cles` : TEXT
   - `donnees_financieres` : TEXT
   - `informations_complementaires` : TEXT
   - `created_at` : TIMESTAMP
   - `updated_at` : TIMESTAMP

3. **`publications_portails`** (suivi des publications)
   - `id` : UUID (PK)
   - `organisation_id` : UUID (FK)
   - `user_id` : UUID (FK)
   - `annonce_id` : UUID (FK)
   - `synthese_id` : UUID (FK)
   - `portail_name` : TEXT (SeLoger, Leboncoin, etc.)
   - `status` : TEXT (pending, published, failed)
   - `external_id` : TEXT (ID de l'annonce sur le portail)
   - `published_at` : TIMESTAMP
   - `error_message` : TEXT

**RLS Policies** :
- Utilisateur ne peut voir que ses propres annonces/synth√®ses
- Utilisateur d'une organisation peut voir les annonces/synth√®ses de son organisation (selon r√¥le)
- Admin Presenca peut voir toutes les annonces/synth√®ses

**Edge Functions √† cr√©er** :
- `fetch-annonce-portails` : R√©cup√©ration d'une annonce
- `upsert-annonce-portails` : Cr√©ation/mise √† jour d'une annonce
- `fetch-synthese-portails` : R√©cup√©ration d'une synth√®se
- `upsert-synthese-portails` : Cr√©ation/mise √† jour d'une synth√®se
- `publish-to-seloger` : Publication vers SeLoger
- `publish-to-leboncoin` : Publication vers Leboncoin
- Etc. (une fonction par portail)

---

