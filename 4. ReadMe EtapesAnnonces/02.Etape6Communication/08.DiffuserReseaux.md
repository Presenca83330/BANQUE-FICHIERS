# üìÑ DOCUMENT D'AUDIT TECHNIQUE CANAL - COPIER / DIFFUSER SUR MES R√âSEAUX SOCIAUX

---

## I. MISSION DU DOCUMENT

Ce document pr√©sente l'audit technique exhaustif du canal **"Copier / Diffuser sur mes R√©seaux Sociaux"** de l'application LeadGenAI AdBuilder.

**Objectifs de l'audit :**
- Identifier tous les fichiers, composants, hooks et fonctions utilis√©s
- Tracer le flux complet des donn√©es (OpenAI ‚Üí localStorage ‚Üí Interface)
- Documenter le syst√®me d'√©dition et de sauvegarde
- Cartographier les options de copie et d'envoi
- Analyser les contraintes et validation
- Pr√©parer la migration future vers Supabase

**P√©rim√®tre :**
- Fichiers de composition (Accueil, Onglets, Files)
- Hooks de r√©cup√©ration, personnalisation et utilisation
- Composants graphiques r√©utilisables
- Syst√®me de gestion localStorage
- Options de copie (Format Texte) et envoi (Zoho Social - inactif)

---

## II. SOMMAIRE CLIQUABLE

1. [MISSION DU DOCUMENT](#i-mission-du-document)
2. [SOMMAIRE CLIQUABLE](#ii-sommaire-cliquable)
3. [ARCHITECTURE GLOBALE - CANAL](#iii-architecture-globale---canal)
4. [LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS](#iv-liste-exhaustive-des-fichiers-utilis√©s)
5. [SYST√àME D'ONGLETS](#v-syst√®me-donglets)
6. [PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI](#vi-processus-de-r√©cup√©ration-des-donn√©es-openai)
7. [STRUCTURE DES DONN√âES LOCALSTORAGE](#vii-structure-des-donn√©es-localstorage)
8. [PROCESSUS COMPLET √âTAPE PAR √âTAPE](#viii-processus-complet-√©tape-par-√©tape)
9. [SYST√àME D'√âDITION - BOUTON "MODIFIER"](#ix-syst√®me-d√©dition---bouton-modifier)
10. [OPTIONS DE COPIE](#x-options-de-copie)
11. [SYST√àME D'APER√áU](#xi-syst√®me-daper√ßu)
12. [CONTRAINTES ET VALIDATION](#xii-contraintes-et-validation)
13. [COMPOSANTS GRAPHIQUES R√âUTILISABLES](#xiii-composants-graphiques-r√©utilisables)
14. [TABLEAUX R√âCAPITULATIFS](#xiv-tableaux-r√©capitulatifs)
15. [DONN√âES √Ä PRENDRE EN CONSID√âRATION](#xv-donn√©es-√†-prendre-en-consid√©ration)

---

## III. ARCHITECTURE GLOBALE - CANAL

### 3.1. Vue d'ensemble du canal

**Fonction principale :**
Visualiser, modifier et copier une annonce R√©seaux Sociaux g√©n√©r√©e par OpenAI, avec personnalisation de l'URL et de la photo de couverture. Pr√©paration pour envoi futur via Zoho Social.

**Localisation dans l'application :**
- Route : `/etape6communication`
- Composant racine : `AccueilDiffuserReseauxAnnonce.tsx`
- Activation : `setSelectedOption("diffuser-reseaux-sociaux")` dans `Etape6Communication.tsx`

**Donn√©es trait√©es :**
- **Annonce R√©seaux Sociaux** (4 champs) : `titre`, `accroche`, `pointsForts`, `appelAction`
- **URL de l'annonce** : lien vers l'annonce immobili√®re
- **Photo de couverture** : image redimensionn√©e automatiquement en 1080x566 pixels

### 3.2. Position dans √âtape 6 Communication

Le canal **"Copier / Diffuser sur mes R√©seaux Sociaux"** fait partie des 8 canaux de diffusion disponibles dans l'√âtape 6 Communication :
1. Site Internet (Annonces)
2. Site Internet (Outils SEO)
3. Portails Immobiliers
4. Newsletter
5. Campagne SMS
6. Google Business Profile
7. **R√©seaux Sociaux** ‚Üê *Canal actuel*
8. Landing Page

### 3.3. Sch√©ma Mermaid complet (flux de donn√©es)

```mermaid
graph TD
    subgraph "√âTAPE 5 - G√âN√âRATION OPENAI"
        A[OpenAI APIgpt-4o] --> B[R√©ponse JSON4 champs]
        B --> C[localStoragegeneration_reseauxsociaux_ad]
    end

    subgraph "ONGLET 1 - ANNONCE R√âSEAUX SOCIAUX"
        D[Hook-1-RecuperationDataReseaux] --> E{Modifsexistent?}
        E -->|OUI| F[key-modifs-diffuser-reseaux-sociaux-annonce]
        E -->|NON| C
        F --> G[√âtat annonceReseaux]
        C --> G
        G --> H[File1.AnnonceReseaux4 champs affich√©s]
        H -->|Mode Lecture| I[ReadOnlyReseauxAnnonce]
        H -->|Mode √âdition| J[EditableReseauxAnnonce+ EditeurWYSIWYG pouraccroche & pointsForts]
        J -->|onChange| K[updateAnnonceReseaux]
        K --> F
    end

    subgraph "ONGLET 2 - PERSONNALISER"
        L[Hook-2-PersonnaliserUrlReseaux] --> M{Modifs URL?}
        M -->|OUI| N[key-modifs-url-annonce-reseaux-sociaux]
        M -->|NON| O[Valeur vide]

        P[Hook-2-PersonnaliserPhotoReseaux] --> Q{Photo existe?}
        Q -->|OUI| R[key-modifs-photo-annonce-reseaux-sociaux]
        Q -->|NON| S[Valeur vide]

        N --> T[File2.PersonnaliserReseauxURL + Photo]
        O --> T
        R --> T
        S --> T

        T -->|Mode Lecture| U[ReadOnlyReseauxAnnonce URL]
        T -->|Mode √âdition| V[EditableReseauxAnnonce URL]
        T --> W[UploadPhotoRedimensionnement 1080x566]

        V -->|onChange| X[updateUrlAnnonce]
        W -->|onFileSelect| Y[processAndStorePhotoCanvas resize + base64]
        X --> N
        Y --> R
    end

    subgraph "ONGLET 3 - UTILISER L'ANNONCE"
        AA[HookUtiliserApercuReseaux] --> F
        AA --> N
        AA --> R

        AB[HookUtiliserCopierTexteReseaux] --> AC[recupererAnnonceReseaux+recupererUrlAnnonce]
        AC --> AD[construireTexteReseauxTitre + Accroche + Points Forts+ Appel Action + URL]
        AD --> AE[navigator.clipboard.writeText]
        AE --> AF[Toast: Succ√®s]

        AG[HookUtiliserZohoReseauxFonctionEnvoi] --> AH[envoyerCampagneZohoINACTIF]
        AH --> AI[Toast: Fonction en pr√©paration]

        AA --> AJ[File3.ActionUtilisateurReseaux3 aper√ßus + 2 boutons]
        AB --> AJ
        AG --> AJ
    end

    subgraph "NAVIGATION"
        AK[MenuOngletDiffuserReseaux] --> H
        AK --> T
        AK --> AJ
        AK --> AL[Bouton Modifier/Sauvegarder]
        AL -->|Toggle| AM[√âtat editMode]
        AM --> H
        AM --> T
    end

    style C fill:#ffe6e6
    style F fill:#e6f3ff
    style N fill:#e6f3ff
    style R fill:#e6f3ff
    style AD fill:#e6ffe6
    style AH fill:#fff3e6
```

**L√©gende :**
- üî¥ `localStorage` OpenAI original (lecture seule)
- üîµ `localStorage` modifications utilisateur (lecture/√©criture)
- üü¢ Fonction de copie active
- üü† Fonction d'envoi inactive

---

## IV. LISTE EXHAUSTIVE DES FICHIERS UTILIS√âS

### 4.1. Fichiers de composition

| Fichier | R√¥le | Lignes cl√©s |
|---------|------|-------------|
| `AccueilDiffuserReseauxAnnonce.tsx` | Point d'entr√©e du canal, g√®re l'√©tat global `editMode` et la communication entre onglets | 14-64 |
| `MenuOngletDiffuserReseaux.tsx` | Syst√®me d'onglets avec bouton Modifier/Sauvegarder int√©gr√© | 31-176 |
| `File1.AnnonceReseaux.tsx` | Onglet 1 - Affichage et √©dition des 4 champs de l'annonce | 14-121 |
| `File2.PersonnaliserReseaux.tsx` | Onglet 2 - Personnalisation URL + Photo de couverture | 16-175 |
| `File3.ActionUtilisateurReseaux.tsx` | Onglet 3 - Options de copie et envoi + Aper√ßus | 6-38 |

### 4.2. Hooks de r√©cup√©ration

| Hook | Fonction | Donn√©es sources |
|------|----------|-----------------|
| `Hook-1-RecuperationDataReseaux.ts` | R√©cup√©ration prioritaire des donn√©es d'annonce (modifs > originales) | `key-modifs-diffuser-reseaux-sociaux-annonce` ‚ûú `generation_reseauxsociaux_ad` |

**D√©tail du processus de r√©cup√©ration :**
```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 28-59)
// 1. Tentative de lecture des modifications utilisateur
const donneesModifiees = localStorage.getItem('key-modifs-diffuser-reseaux-sociaux-annonce');

// 2. Si modifications existent ‚Üí utilisation directe
if (donneesModifiees) {
  setAnnonceReseaux(JSON.parse(donneesModifiees));
}
// 3. Sinon ‚Üí lecture des donn√©es OpenAI originales
else {
  const donneesOriginales = localStorage.getItem('generation_reseauxsociaux_ad');
  // Mapping des champs OpenAI ‚Üí Interface (lignes 52-56)
  setAnnonceReseaux({
    titre: cleanOpenAIContent(dataOriginales.TitreAnnonceReseaux),
    accroche: cleanOpenAIContent(dataOriginales.AccrocheImpactanteAnnonceReseaux),
    pointsForts: cleanOpenAIContent(dataOriginales.AtoutsAnnonceReseaux),
    appelAction: cleanOpenAIContent(dataOriginales.CtaAnnonceReseaux)
  });
}
```

### 4.3. Hooks de personnalisation

| Hook | Fonction | Donn√©es sources |
|------|----------|-----------------|
| `Hook-2-PersonnaliserUrlReseaux.tsx` | Gestion de l'URL de l'annonce | `key-modifs-url-annonce-reseaux-sociaux` |
| `Hook-2-PersonnaliserPhotoReseaux.tsx` | Upload, redimensionnement Canvas (1080x566) et stockage base64 de la photo | `key-modifs-photo-annonce-reseaux-sociaux` |

**D√©tail du redimensionnement photo :**
```typescript
// Hook-2-PersonnaliserPhotoReseaux.tsx (lignes 24-86)
const resizeImageWithCanvas = async (file: File): Promise => {
  const img = new Image();
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d')!;

  canvas.width = 1080;  // Format R√©seaux Sociaux
  canvas.height = 566;  // Ratio 1.91:1

  // Calcul pour centrer l'image (cover)
  // Dessin sur Canvas + conversion base64
  return canvas.toDataURL('image/jpeg', 0.9);
};
```

### 4.4. Hooks d'utilisation (Onglet 3)

| Hook | Fonction | Donn√©es sources |
|------|----------|-----------------|
| `Hook-3-UtiliserApercuReseaux.tsx` | Aper√ßu temps r√©el de l'annonce, URL et photo | √âcoute `storage` event + `setInterval(1000ms)` |
| `Hook-3-UtiliserCopierTexteReseaux.tsx` | Copie format√©e de l'annonce compl√®te (Texte) | R√©cup√©ration depuis tous les hooks |
| `Hook-3-UtiliserZohoReseauxFonctionEnvoi.tsx` | Envoi via Zoho Social (**INACTIF**) | Toast "Fonction en pr√©paration" |

### 4.5. Composants graphiques

| Composant | Fichier source | Utilisation |
|-----------|----------------|-------------|
| `LabelReseauxAnnonce` | `GraphismeInterieurDiffuserReseaux.tsx` (lignes 107-116) | Labels des champs |
| `ReadOnlyReseauxAnnonce` | `GraphismeInterieurDiffuserReseaux.tsx` (lignes 125-138) | Affichage lecture seule (pas de transformation HTML) |
| `EditableReseauxAnnonce` | `GraphismeInterieurDiffuserReseaux.tsx` (lignes 150-181) | Champs √©ditables avec ou sans WYSIWYG |
| `EditButton` | `GraphismeInterieurDiffuserReseaux.tsx` (lignes 192-216) | Bouton Modifier/Sauvegarder |
| `CopyReseauxOption` | `GraphismeInterieurDiffuserReseaux.tsx` (lignes 229-255) | Cadre d'option de copie/envoi |
| `ReseauxAnnoncePreview` | `GraphismeInterieurDiffuserReseaux.tsx` (lignes 324-337) | Cadre d'aper√ßu |
| `EditeurWYSIWYG` | `EditeurWYSIWYG.tsx` | Textarea + s√©lecteur d'emojis (barre d'outils d√©sactiv√©e) |
| `UploadPhoto` | `GraphismeUploadPhoto.tsx` | Zone de drag & drop pour upload photo |

### 4.6. Arborescence compl√®te avec descriptions

```
src/components/1-Sources-Restitution-Utilisateur/7.EtapeDiffuserReseauxAnnonce/
‚îú‚îÄ‚îÄ AccueilDiffuserReseauxAnnonce.tsx          [Point d'entr√©e, gestion editMode global]
‚îú‚îÄ‚îÄ MenuOngletDiffuserReseaux.tsx              [Navigation entre onglets + bouton Modifier]
‚îÇ
‚îú‚îÄ‚îÄ File1.AnnonceReseaux.tsx                   [Onglet 1 - Annonce R√©seaux Sociaux]
‚îú‚îÄ‚îÄ File2.PersonnaliserReseaux.tsx             [Onglet 2 - Personnaliser URL + Photo]
‚îú‚îÄ‚îÄ File3.ActionUtilisateurReseaux.tsx         [Onglet 3 - Utiliser l'annonce]
‚îÇ
‚îú‚îÄ‚îÄ Hook-1-RecuperationDataReseaux.ts          [R√©cup√©ration donn√©es annonce avec priorit√©]
‚îú‚îÄ‚îÄ Hook-2-PersonnaliserUrlReseaux.tsx         [Gestion URL]
‚îú‚îÄ‚îÄ Hook-2-PersonnaliserPhotoReseaux.tsx       [Upload + Resize + Stockage photo]
‚îÇ
‚îú‚îÄ‚îÄ Hook-3-UtiliserApercuReseaux.tsx           [Aper√ßus temps r√©el]
‚îú‚îÄ‚îÄ Hook-3-UtiliserCopierTexteReseaux.tsx      [Copie format texte]
‚îú‚îÄ‚îÄ Hook-3-UtiliserZohoReseauxFonctionEnvoi.tsx [Envoi Zoho - INACTIF]
‚îÇ
‚îú‚îÄ‚îÄ GraphismeInterieurDiffuserReseaux.tsx      [Composants UI r√©utilisables]
‚îú‚îÄ‚îÄ EditeurWYSIWYG.tsx                         [Textarea + emojis]
‚îî‚îÄ‚îÄ GraphismeUploadPhoto.tsx                   [Upload photo avec drag & drop]

src/services/openai/1.GenerateurAnnoncesOutilsSeo/
‚îú‚îÄ‚îÄ 0.APIAutresFonctionsLeadGenAI/
‚îÇ   ‚îî‚îÄ‚îÄ 3.API-AnnonceReseauxSociaux.ts         [Service OpenAI pour g√©n√©ration]
‚îî‚îÄ‚îÄ 7.PromptsOpenAi/
    ‚îî‚îÄ‚îÄ 7.PromptReseauxSociauxAnnonce.ts       [Prompt complet 502 lignes]
```

---

## V. SYST√àME D'ONGLETS

### 5.1. MenuOnglet - `MenuOngletDiffuserReseaux.tsx`

**Composant de navigation :**
```typescript
// MenuOngletDiffuserReseaux.tsx (lignes 31-40)
interface MenuOngletDiffuserReseauxProps {
  tabTitles?: string[];
  tabContent1?: ReactNode;
  tabContent2?: ReactNode;
  tabContent3?: ReactNode;
  enableEditMode?: boolean;
  onTabChange?: (tabIndex: number) => void;
  onEditModeChange?: (isEditMode: boolean) => void;
  className?: string;
}
```

**Titres par d√©faut :**
```typescript
// Lignes 45-49
const defaultTabTitles = [
  "Annonce R√©seaux Sociaux",
  "Personnaliser l'annonce",
  "Utiliser l'annonce"
];
```

**Bouton Modifier/Sauvegarder :**
- Affich√© uniquement sur les onglets 1 et 2 si `enableEditMode={true}`
- Logique toggle : `Modifier` ‚Üî `Sauvegarder` (lignes 62-75)
- Toast de succ√®s √† la sauvegarde (ligne 69)

### 5.2. Onglet 1 : Annonce R√©seaux Sociaux

**Fichier :** `File1.AnnonceReseaux.tsx`

**Champs affich√©s :**
| Champ | Label | Composant Lecture | Composant √âdition | Rows | WYSIWYG |
|-------|-------|-------------------|-------------------|------|---------|
| `titre` | Titre de l'Annonce | `ReadOnlyReseauxAnnonce` | `EditableReseauxAnnonce` | 2 | ‚ùå |
| `accroche` | Accroche | `ReadOnlyReseauxAnnonce` | `EditableReseauxAnnonce` | 5 | ‚úÖ |
| `pointsForts` | Points Forts | `ReadOnlyReseauxAnnonce` | `EditableReseauxAnnonce` | 8 | ‚úÖ |
| `appelAction` | Appel √† l'action | `ReadOnlyReseauxAnnonce` | `EditableReseauxAnnonce` | 5 | ‚ùå |

**Logique d'√©dition :**
```typescript
// File1.AnnonceReseaux.tsx (lignes 24-38)
const handleChange = (field: keyof AnnonceReseauxData, value: string) => {
  const updatedData = { ...annonceReseaux, [field]: value };
  updateAnnonceReseaux({ [field]: value });

  // Notification au composant parent
  if (onDataChange) {
    onDataChange(updatedData);
  }
};
```

**Sauvegarde :**
- **Automatique et imm√©diate** via `updateAnnonceReseaux()` (ligne 27)
- Stockage dans `key-modifs-diffuser-reseaux-sociaux-annonce`
- Aucune validation de champ

### 5.3. Onglet 2 : Personnaliser l'annonce

**Fichier :** `File2.PersonnaliserReseaux.tsx`

**Section 1 - URL de l'annonce :**
```typescript
// File2.PersonnaliserReseaux.tsx (lignes 50-75)

  URL de l'annonce

{editMode ? (
   updateUrlAnnonce(value)}
    rows={1}
  />
) : (

)}
```

**Section 2 - Photo de couverture :**

**Processus complet :**
1. **Upload fichier** via `UploadPhoto` (drag & drop ou clic)
2. **Traitement** via `processAndStorePhoto()` :
   ```typescript
   // Hook-2-PersonnaliserPhotoReseaux.tsx (lignes 88-110)
   const processAndStorePhoto = async (file: File) => {
     setPhotoData(prev => ({ ...prev, isProcessing: true }));

     try {
       const base64Image = await resizeImageWithCanvas(file);
       localStorage.setItem('key-modifs-photo-annonce-reseaux-sociaux', base64Image);
       setPhotoData({ photoUrl: base64Image, isProcessing: false });
     } catch (error) {
       console.error('Erreur traitement photo:', error);
       setPhotoData(prev => ({ ...prev, isProcessing: false }));
     }
   };
   ```
3. **Redimensionnement Canvas** en 1080x566 pixels :
   ```typescript
   // Hook-2-PersonnaliserPhotoReseaux.tsx (lignes 24-86)
   const resizeImageWithCanvas = async (file: File): Promise => {
     const targetWidth = 1080;
     const targetHeight = 566;
     const targetRatio = targetWidth / targetHeight; // 1.91:1

     // Calcul dimensions pour remplir le canvas (cover)
     // Centrage de l'image
     // Retour base64
   };
   ```
4. **Stockage** en `key-modifs-photo-annonce-reseaux-sociaux` (base64)
5. **Affichage** de l'aper√ßu dans l'onglet 3

**Suppression photo :**
```typescript
// Hook-2-PersonnaliserPhotoReseaux.tsx (lignes 112-119)
const removePhoto = () => {
  localStorage.removeItem('key-modifs-photo-annonce-reseaux-sociaux');
  setPhotoData({ photoUrl: '', isProcessing: false });
};
```

### 5.4. Onglet 3 : Utiliser l'annonce

**Fichier :** `File3.ActionUtilisateurReseaux.tsx`

**Structure :**
```typescript
// File3.ActionUtilisateurReseaux.tsx (lignes 8-36)

  {/* Titre Options */}
  Options

  {/* Deux cadres c√¥te √† c√¥te */}

           {/* Copie Format Texte */}
     {/* Envoi Zoho - INACTIF */}

  {/* Aper√ßus temps r√©el */}

```

**Cadre 1 - Copier au Format Texte :**
- Hook : `HookUtiliserCopierTexteReseaux`
- Bouton : "Copier l'Annonce"
- Action : Copie texte brut dans le presse-papier

**Cadre 2 - Envoyer via Zoho Social :**
- Hook : `HookUtiliserZohoReseauxFonctionEnvoi`
- Bouton : "Envoyer la Campagne R√©seaux Sociaux"
- Statut : **INACTIF** (toast "Fonction en pr√©paration")

**Aper√ßus :**
- Hook : `HookUtiliserApercuReseaux`
- 3 aper√ßus temps r√©el :
  1. Annonce R√©seaux Sociaux (titre + accroche + points forts + appel action)
  2. URL de l'annonce
  3. Photo de couverture

### 5.5. Logique de navigation et √©tat

**Gestion de l'√©tat `editMode` :**
```typescript
// AccueilDiffuserReseauxAnnonce.tsx (lignes 15-17)
const [editMode, setEditMode] = useState(false);

// Callback pour MenuOngletDiffuserReseaux
onEditModeChange={(isEditMode) => {
  setEditMode(isEditMode);
}}
```

**Propagation aux onglets :**
```typescript
// AccueilDiffuserReseauxAnnonce.tsx (lignes 31-52)
const contentTab1 = (

);

const contentTab2 = (

);
```

**R√©initialisation √† chaque changement d'onglet :**
```typescript
// MenuOngletDiffuserReseaux.tsx (lignes 56-61)
const handleTabChange = (value: string) => {
  setActiveTab(value);

  if (enableEditMode) {
    setEditMode(false);  // ‚Üê Retour en mode lecture
  }

  onTabChange?.(tabTitles.indexOf(value));
};
```

---

## VI. PROCESSUS DE R√âCUP√âRATION DES DONN√âES OPENAI

### 6.1. Sources de donn√©es (cl√©s localStorage)

**Cl√©s LUES :**

| Cl√© localStorage | Type | Contenu | G√©n√©ration |
|------------------|------|---------|------------|
| `generation_reseauxsociaux_ad` | JSON | Annonce OpenAI originale (4 champs) | √âtape 5 (ligne 121 `Etape5.tsx`) |
| `key-modifs-diffuser-reseaux-sociaux-annonce` | JSON | Modifications utilisateur de l'annonce | Onglet 1 (√©dition) |
| `key-modifs-url-annonce-reseaux-sociaux` | String | URL personnalis√©e | Onglet 2 (√©dition) |
| `key-modifs-photo-annonce-reseaux-sociaux` | Base64 | Photo redimensionn√©e 1080x566 | Onglet 2 (upload) |

### 6.2. Logique de priorit√© (modifs > originales)

**Algorithme de r√©cup√©ration :**

```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 28-59)
useEffect(() => {
  try {
    // 1Ô∏è‚É£ PRIORIT√â HAUTE : Modifications utilisateur
    const donneesModifiees = localStorage.getItem('key-modifs-diffuser-reseaux-sociaux-annonce');

    if (donneesModifiees) {
      const dataModifiees = JSON.parse(donneesModifiees);
      setAnnonceReseaux({
        titre: dataModifiees.titre || '',
        accroche: dataModifiees.accroche || '',
        pointsForts: dataModifiees.pointsForts || '',
        appelAction: dataModifiees.appelAction || ''
      });
    } else {
      // 2Ô∏è‚É£ PRIORIT√â BASSE : Donn√©es OpenAI originales
      const donneesOriginales = localStorage.getItem('generation_reseauxsociaux_ad');

      if (donneesOriginales) {
        const dataOriginales = JSON.parse(donneesOriginales);
        setAnnonceReseaux({
          titre: cleanOpenAIContent(dataOriginales.TitreAnnonceReseaux || ''),
          accroche: cleanOpenAIContent(dataOriginales.AccrocheImpactanteAnnonceReseaux || ''),
          pointsForts: cleanOpenAIContent(dataOriginales.AtoutsAnnonceReseaux || ''),
          appelAction: cleanOpenAIContent(dataOriginales.CtaAnnonceReseaux || '')
        });
      }
    }

    setIsLoading(false);
  } catch (error) {
    console.error('Erreur chargement donn√©es:', error);
    setError('Impossible de charger les donn√©es');
    setIsLoading(false);
  }
}, []);
```

### 6.3. Hooks de r√©cup√©ration d√©taill√©s

**Hook `useRecuperationDataReseaux` :**

```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 3-104)
interface AnnonceReseauxData {
  titre: string;
  accroche: string;
  pointsForts: string;
  appelAction: string;
}

// Fonction de nettoyage du contenu OpenAI
function cleanOpenAIContent(text: string): string {
  if (!text) return '';
  return text
    .replace(/\\n/g, '\n')      // Correction des sauts de ligne √©chapp√©s
    .replace(/\\\\/g, '\\');    // Correction des backslashes doubles
}

export const useRecuperationDataReseaux = () => {
  const [annonceReseaux, setAnnonceReseaux] = useState({
    titre: '',
    accroche: '',
    pointsForts: '',
    appelAction: ''
  });
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);

  // Chargement initial (voir code ci-dessus)

  // Fonction de mise √† jour
  const updateAnnonceReseaux = (nouvellesDonnees: Partial) => {
    setAnnonceReseaux(prev => {
      const updated = { ...prev, ...nouvellesDonnees };
      localStorage.setItem('key-modifs-diffuser-reseaux-sociaux-annonce', JSON.stringify(updated));
      return updated;
    });
  };

  return {
    annonceReseaux,
    setAnnonceReseaux,
    updateAnnonceReseaux,
    isLoading,
    error
  };
};
```

**Hook `usePersonnaliserUrlReseaux` :**

```typescript
// Hook-2-PersonnaliserUrlReseaux.tsx (lignes 8-43)
export const usePersonnaliserUrlReseaux = () => {
  const [personnaliserData, setPersonnaliserData] = useState({
    urlAnnonce: ''
  });

  // Chargement au d√©marrage
  useEffect(() => {
    const urlSaved = localStorage.getItem('key-modifs-url-annonce-reseaux-sociaux') || '';
    setPersonnaliserData({ urlAnnonce: urlSaved });
  }, []);

  // Mise √† jour URL
  const updateUrlAnnonce = (value: string) => {
    setPersonnaliserData(prev => ({ ...prev, urlAnnonce: value }));
    localStorage.setItem('key-modifs-url-annonce-reseaux-sociaux', value);
  };

  // R√©cup√©ration URL (pour onglet 3)
  const getUrlAnnonce = (): string => {
    return localStorage.getItem('key-modifs-url-annonce-reseaux-sociaux') || '';
  };

  return {
    personnaliserData,
    updateUrlAnnonce,
    getUrlAnnonce,
    getAllData: () => ({
      urlAnnonce: localStorage.getItem('key-modifs-url-annonce-reseaux-sociaux') || ''
    })
  };
};
```

### 6.4. Mapping des champs OpenAI ‚Üí Interface

**Tableau de correspondance :**

| Champ OpenAI (JSON) | Champ Interface (TypeScript) | Transformation | Fichier |
|---------------------|------------------------------|----------------|---------|
| `TitreAnnonceReseaux` | `titre` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts:53` |
| `AccrocheImpactanteAnnonceReseaux` | `accroche` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts:54` |
| `AtoutsAnnonceReseaux` | `pointsForts` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts:55` |
| `CtaAnnonceReseaux` | `appelAction` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts:56` |

**Point d'attention :**
- **Pas de mapping `cta` vs `appelAction`** comme dans d'autres canaux (Site Internet, Portails)
- Le champ OpenAI `CtaAnnonceReseaux` est directement mapp√© vers `appelAction`
- Le nettoyage `cleanOpenAIContent()` corrige uniquement les √©chappements (`\\n` ‚Üí `\n`, `\\\\` ‚Üí `\\`)

**Exemple de r√©ponse OpenAI :**
```json
{
  "TitreAnnonceReseaux": "üåü RESTAURANT √Ä VENDRE ‚Äì PARIS 11e",
  "AccrocheImpactanteAnnonceReseaux": "Emplacement premium en angle, rare √† la vente.\\n\\nAffaire en angle...",
  "AtoutsAnnonceReseaux": "Les Atouts du bien\\n\\n‚òëÔ∏è Emplacement Premium en angle...",
  "CtaAnnonceReseaux": "Int√©ress√©(e) ?\\nüìû Contactez-nous..."
}
```

**Apr√®s `cleanOpenAIContent()` :**
```typescript
{
  titre: "üåü RESTAURANT √Ä VENDRE ‚Äì PARIS 11e",
  accroche: "Emplacement premium en angle, rare √† la vente.\n\nAffaire en angle...",
  pointsForts: "Les Atouts du bien\n\n‚òëÔ∏è Emplacement Premium en angle...",
  appelAction: "Int√©ress√©(e) ?\nüìû Contactez-nous..."
}
```

---

## VII. STRUCTURE DES DONN√âES LOCALSTORAGE

### 7.1. Cl√©s LUES

| Cl√© | Type | Structure | Exemple |
|-----|------|-----------|---------|
| `generation_reseauxsociaux_ad` | JSON | `{ TitreAnnonceReseaux, AccrocheImpactanteAnnonceReseaux, AtoutsAnnonceReseaux, CtaAnnonceReseaux }` | Voir prompt ligne 496-501 |
| `key-modifs-diffuser-reseaux-sociaux-annonce` | JSON | `{ titre, accroche, pointsForts, appelAction }` | `{ "titre": "üåü BAR...", "accroche": "..." }` |
| `key-modifs-url-annonce-reseaux-sociaux` | String | URL brute | `"https://example.com/annonce/123"` |
| `key-modifs-photo-annonce-reseaux-sociaux` | Base64 | `data:image/jpeg;base64,...` | Image 1080x566 pixels |

### 7.2. Cl√©s √âCRITES

| Cl√© | √âcrite par | D√©clencheur | Fr√©quence |
|-----|------------|-------------|-----------|
| `key-modifs-diffuser-reseaux-sociaux-annonce` | `updateAnnonceReseaux()` | Modification d'un champ de l'annonce | √Ä chaque `onChange` |
| `key-modifs-url-annonce-reseaux-sociaux` | `updateUrlAnnonce()` | Modification du champ URL | √Ä chaque `onChange` |
| `key-modifs-photo-annonce-reseaux-sociaux` | `processAndStorePhoto()` | Upload photo termin√© | √Ä chaque upload |

### 7.3. Interfaces TypeScript compl√®tes

```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 3-8)
interface AnnonceReseauxData {
  titre: string;
  accroche: string;
  pointsForts: string;
  appelAction: string;
}

// Hook-2-PersonnaliserUrlReseaux.tsx (lignes 3-5)
interface PersonnaliserReseauxData {
  urlAnnonce: string;
}

// Hook-2-PersonnaliserPhotoReseaux.tsx (lignes 3-6)
interface PersonnaliserPhotoReseauxData {
  photoUrl: string;
  isProcessing: boolean;
}

// 3.API-AnnonceReseauxSociaux.ts (lignes 140-145)
interface OpenAIReseauxSociauxResponse {
  TitreAnnonceReseaux: string;
  AccrocheImpactanteAnnonceReseaux: string;
  AtoutsAnnonceReseaux: string;
  CtaAnnonceReseaux: string;
}
```

### 7.4. Tableaux r√©capitulatifs

**Tableau des cl√©s localStorage - Lecture :**

| Cl√© | Origine | Format | Taille estim√©e | Utilis√©e par |
|-----|---------|--------|----------------|--------------|
| `generation_reseauxsociaux_ad` | √âtape 5 (OpenAI) | JSON | ~2-4 KB | `useRecuperationDataReseaux` |
| `key-modifs-diffuser-reseaux-sociaux-annonce` | Onglet 1 (√©dition) | JSON | ~2-4 KB | `useRecuperationDataReseaux` |
| `key-modifs-url-annonce-reseaux-sociaux` | Onglet 2 (√©dition) | String | ~50-200 B | `usePersonnaliserUrlReseaux` |
| `key-modifs-photo-annonce-reseaux-sociaux` | Onglet 2 (upload) | Base64 | ~100-300 KB | `usePersonnaliserPhotoReseaux` |

**Tableau des cl√©s localStorage - √âcriture :**

| Cl√© | Fonction d'√©criture | Fichier | Ligne | D√©clencheur |
|-----|---------------------|---------|-------|-------------|
| `key-modifs-diffuser-reseaux-sociaux-annonce` | `updateAnnonceReseaux()` | `Hook-1-RecuperationDataReseaux.ts` | 71 | `onChange` champs |
| `key-modifs-url-annonce-reseaux-sociaux` | `updateUrlAnnonce()` | `Hook-2-PersonnaliserUrlReseaux.tsx` | 21 | `onChange` URL |
| `key-modifs-photo-annonce-reseaux-sociaux` | `processAndStorePhoto()` | `Hook-2-PersonnaliserPhotoReseaux.tsx` | 93 | Upload photo |

---

## VIII. PROCESSUS COMPLET √âTAPE PAR √âTAPE

### 8.1. Chargement initial

**S√©quence de d√©marrage :**

1. **Navigation vers `/etape6communication`**
2. **Activation du canal** via `setSelectedOption("diffuser-reseaux-sociaux")`
3. **Montage de `AccueilDiffuserReseauxAnnonce`**
   - √âtat `editMode` initialis√© √† `false`
   - Rendu de `MenuOngletDiffuserReseaux` avec `enableEditMode={true}`
4. **Affichage de l'Onglet 1 par d√©faut**
   - Montage de `File1.AnnonceReseaux` avec `editMode={false}`
   - Appel du hook `useRecuperationDataReseaux()`
5. **Lecture localStorage** (priorit√© modifs > originales)
   - Tentative `key-modifs-diffuser-reseaux-sociaux-annonce`
   - Si absent ‚Üí lecture `generation_reseauxsociaux_ad` + `cleanOpenAIContent()`
6. **Affichage en mode lecture seule**
   - Composants `ReadOnlyReseauxAnnonce` pour les 4 champs

### 8.2. Affichage en mode lecture seule

**Composants utilis√©s :**
```typescript
// File1.AnnonceReseaux.tsx (lignes 45-118)
{!editMode ? (
  <>

      Titre de l'Annonce

) : (
  // ... version √©ditable
)}
```

**Comportement de `ReadOnlyReseauxAnnonce` :**
```typescript
// GraphismeInterieurDiffuserReseaux.tsx (lignes 125-138)
export const ReadOnlyReseauxAnnonce: React.FC = ({ 
  id, 
  content, 
  className
}) => {
  return (

      {/* Affichage brut, whitespace-pre-line, PAS de dangerouslySetInnerHTML */}
      {content}

  );
};
```

**Point cl√© :** Contrairement au canal Google Business Profile, **aucune transformation HTML** n'est appliqu√©e ici. Le contenu est affich√© tel quel.

### 8.3. Activation du mode √©dition

**D√©clencheur :** Clic sur le bouton "Modifier" dans `MenuOngletDiffuserReseaux`

```typescript
// MenuOngletDiffuserReseaux.tsx (lignes 62-75)
const toggleEditMode = () => {
  if (editMode) {
    // Passage en mode lecture
    toast({
      title: "Modifications sauvegard√©es",
      description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s",
    });
  }

  const newEditMode = !editMode;
  setEditMode(newEditMode);

  if (onEditModeChange) {
    onEditModeChange(newEditMode);  // ‚Üê Propagation vers AccueilDiffuserReseauxAnnonce
  }
};
```

**Propagation de l'√©tat :**
```
MenuOngletDiffuserReseaux.toggleEditMode()
  ‚Üì
onEditModeChange(true)
  ‚Üì
AccueilDiffuserReseauxAnnonce.setEditMode(true)
  ‚Üì
File1.AnnonceReseaux (editMode={true})
  ‚Üì
Affichage des composants EditableReseauxAnnonce
```

### 8.4. Modification des champs

**Champs avec `EditableReseauxAnnonce` standard (textarea) :**
- `titre` (2 lignes)
- `appelAction` (5 lignes)

**Champs avec `EditableReseauxAnnonce` + WYSIWYG :**
- `accroche` (5 lignes, `useWysiwyg={true}`)
- `pointsForts` (8 lignes, `useWysiwyg={true}`)

**Composant `EditableReseauxAnnonce` :**
```typescript
// GraphismeInterieurDiffuserReseaux.tsx (lignes 150-181)
export const EditableReseauxAnnonce: React.FC = ({ 
  id, 
  value, 
  onChange, 
  rows = 3,
  className,
  useWysiwyg = false
}) => {
  if (useWysiwyg) {
    const simpleMode = rows <= 3;

    return (

    );
  }

  return (
     onChange(e.target.value)} 
      className={cn("w-full rounded-md border border-gray-200 p-3", className)}
      rows={rows}
    />
  );
};
```

**Composant `EditeurWYSIWYG` :**
```typescript
// EditeurWYSIWYG.tsx (lignes 70-194)
const EditeurWYSIWYG: React.FC<EditeurWYSIWYGProps> = ({ 
  value, 
  onChange, 
  rows = 3, 
  className,
  simpleMode = false
}) => {
  const [editorValue, setEditorValue] = useState(value);
  const [isEmojiOpen, setIsEmojiOpen] = useState(false);
  const textareaRef = useRef<HTMLTextAreaElement>(null);

  // Gestion du changement
  const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    const content = e.target.value;
    setEditorValue(content);
    onChange(content);
  };

  // Insertion emoji √† la position du curseur
  const insertEmoji = (emoji: string) => {
    // ... logique d'insertion
  };

  return (
    <div className="relative">
      {/* Bouton emoji en bas √† droite */}
      <Popover open={isEmojiOpen} onOpenChange={setIsEmojiOpen}>
        {/* S√©lecteur emojis par cat√©gorie */}
      </Popover>

      {/* Textarea standard */}
      <textarea
        ref={textareaRef}
        value={editorValue}
        onChange={handleChange}
        rows={rows}
        className="w-full rounded-md border border-gray-200 p-3"
        style={{ fontSize: '18px', fontFamily: 'Nunito' }}
      />
    </div>
  );
};
```

**Point cl√© :** Contrairement au canal Site Internet, **la barre d'outils WYSIWYG est d√©sactiv√©e**. Seul le s√©lecteur d'emojis est disponible.

### 8.5. Sauvegarde automatique

**D√©clencheur :** `onChange` de chaque champ

```typescript
// File1.AnnonceReseaux.tsx (lignes 24-38)
const handleChange = (field: keyof AnnonceReseauxData, value: string) => {
  const updatedData = { ...annonceReseaux, [field]: value };

  // ‚úÖ Sauvegarde imm√©diate dans localStorage
  updateAnnonceReseaux({ [field]: value });

  // Notification au parent (optionnelle)
  if (onDataChange) {
    onDataChange(updatedData);
  }
};
```

**Fonction `updateAnnonceReseaux` :**
```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 66-73)
const updateAnnonceReseaux = (nouvellesDonnees: Partial<AnnonceReseauxData>) => {
  setAnnonceReseaux(prev => {
    const updated = { ...prev, ...nouvellesDonnees };

    // ‚úÖ √âcriture imm√©diate dans localStorage
    localStorage.setItem(
      'key-modifs-diffuser-reseaux-sociaux-annonce', 
      JSON.stringify(updated)
    );

    return updated;
  });
};
```

**Comportement du bouton "Sauvegarder" :**
- **Ne d√©clenche PAS de sauvegarde** (d√©j√† faite automatiquement)
- **D√©sactive le mode √©dition** (`editMode` ‚Üí `false`)
- **Affiche un toast de succ√®s**

```typescript
// MenuOngletDiffuserReseaux.tsx (lignes 62-75)
const toggleEditMode = () => {
  if (editMode) {
    toast({
      title: "Modifications sauvegard√©es",
      description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s",
    });
  }

  setEditMode(!editMode);
  onEditModeChange?.(!editMode);
};
```

### 8.6. Copie au format Texte

**Processus complet :**

1. **Clic sur "Copier l'Annonce"** dans l'onglet 3
2. **Appel de `copierTexteReseaux()`** :
   ```typescript
   // Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 60-90)
   const copierTexteReseaux = () => {
     const texteReseaux = construireTexteReseaux();

     if (texteReseaux) {
       navigator.clipboard.writeText(texteReseaux).then(() => {
         console.log('Annonce R√©seaux copi√©e avec succ√®s:', texteReseaux);
         toast({
           title: "Succ√®s",
           description: "Votre Annonce R√©seaux Sociaux a √©t√© copi√©e"
         });
       }).catch((error) => {
         console.error('Erreur copie:', error);
         toast({
           title: "Erreur",
           description: "Impossible de copier l'annonce",
           variant: "destructive"
         });
       });
     } else {
       console.warn('Aucun contenu √† copier');
       toast({
         title: "Attention",
         description: "Aucun contenu disponible √† copier",
         variant: "destructive"
       });
     }
   };
   ```

3. **Construction du texte via `construireTexteReseaux()` :**
   ```typescript
   // Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 43-58)
   const construireTexteReseaux = (): string => {
     const annonceReseaux = recupererAnnonceReseaux().trim();
     const urlAnnonce = recupererUrlAnnonce().trim();

     let texteFinal = '';

     // Ajouter l'annonce R√©seaux Sociaux avec ses sauts de ligne
     if (annonceReseaux) {
       texteFinal += annonceReseaux;
     }

     // Ajouter double saut de ligne puis l'URL
     if (urlAnnonce) {
       if (texteFinal) {
         texteFinal += '\n\n'; // Double saut de ligne
       }
       texteFinal += urlAnnonce;
     }

     return texteFinal;
   };
   ```

4. **R√©cup√©ration de l'annonce via `recupererAnnonceReseaux()` :**
   ```typescript
   // Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 17-30)
   const recupererAnnonceReseaux = (): string => {
     if (dataReseaux.titre || dataReseaux.accroche || 
         dataReseaux.pointsForts || dataReseaux.appelAction) {

       // Assembler toutes les parties en format texte sans titres
       const contenuComplet = [
         dataReseaux.titre,
         dataReseaux.accroche,
         dataReseaux.pointsForts,
         dataReseaux.appelAction
       ].filter(Boolean).join('\n\n');

       return contenuComplet;
     }
     return '';
   };
   ```

5. **R√©cup√©ration de l'URL via `recupererUrlAnnonce()` :**
   ```typescript
   // Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 33-36)
   const recupererUrlAnnonce = (): string => {
     return getUrlAnnonce();
   };
   ```

6. **Copie dans le presse-papier** via `navigator.clipboard.writeText()`
7. **Affichage du toast de succ√®s**

**Format final du texte copi√© :**
```
üåü RESTAURANT √Ä VENDRE ‚Äì PARIS 11e

Emplacement premium en angle, rare √† la vente.

Affaire en angle id√©alement situ√©e dans un quartier commer√ßant...

Les Atouts du bien

‚òëÔ∏è Emplacement Premium en angle, Paris 11√®me...
‚òëÔ∏è Surface de 205 m¬≤, deux √©tages...
‚òëÔ∏è Capacit√© d'accueil de 60 places assises...

Int√©ress√©(e) ? 
üìû Contactez-nous pour organiser une visite...
Prix FAI : 456.000‚Ç¨
R√©f√©rence : B78-8956

https://example.com/annonce/123
```

---

## IX. SYST√àME D'√âDITION - BOUTON "MODIFIER"

### 9.1. Localisation

**Fichier :** `MenuOngletDiffuserReseaux.tsx`

**Position :**
- Affich√© uniquement dans les **onglets 1 et 2** (pas dans l'onglet 3)
- Condition : `enableEditMode={true}` (activ√© par d√©faut)

**Code d'affichage conditionnel :**
```typescript
// MenuOngletDiffuserReseaux.tsx (lignes 93-149)
<TabsContent value={tabTitles[0]}>  {/* Onglet 1 */}
  <div className="flex justify-end items-center mb-4">
    {enableEditMode && (
      <EditButton 
        editMode={editMode} 
        onClick={toggleEditMode} 
      />
    )}
  </div>
  {tabContent1}
</TabsContent>

<TabsContent value={tabTitles[1]}>  {/* Onglet 2 */}
  <div className="flex justify-end items-center mb-4">
    {enableEditMode && (
      <EditButton 
        editMode={editMode} 
        onClick={toggleEditMode} 
      />
    )}
  </div>
  {tabContent2}
</TabsContent>

<TabsContent value={tabTitles[2]}>  {/* Onglet 3 - PAS de bouton */}
  {tabContent3}
</TabsContent>
```

### 9.2. Comportement toggle (Modifier ‚Üî Sauvegarder)

**Composant `EditButton` :**
```typescript
// GraphismeInterieurDiffuserReseaux.tsx (lignes 192-216)
export const EditButton: React.FC<EditButtonProps> = ({ 
  editMode, 
  onClick, 
  className 
}) => {
  return (
    <Button 
      onClick={onClick} 
      variant="outline" 
      className={cn("border-realestate-purple text-realestate-purple hover:bg-realestate-purple hover:text-white", className)}
    >
      {editMode ? (
        <>
          <Save className="mr-2 h-4 w-4" />
          Sauvegarder
        </>
      ) : (
        <>
          <Edit className="mr-2 h-4 w-4" />
          Modifier
        </>
      )}
    </Button>
  );
};
```

**Fonction `toggleEditMode` :**
```typescript
// MenuOngletDiffuserReseaux.tsx (lignes 62-75)
const toggleEditMode = () => {
  if (editMode) {
    // Mode √âdition ‚Üí Lecture : affichage du toast
    toast({
      title: "Modifications sauvegard√©es",
      description: "Vos modifications ont √©t√© enregistr√©es avec succ√®s",
    });
  }

  // Toggle de l'√©tat local
  const newEditMode = !editMode;
  setEditMode(newEditMode);

  // Propagation au composant parent
  if (onEditModeChange) {
    onEditModeChange(newEditMode);
  }
};
```

**√âtats du bouton :**

| √âtat `editMode` | Ic√¥ne | Texte | Action au clic |
|-----------------|-------|-------|----------------|
| `false` | `<Edit />` | "Modifier" | Passe en mode √©dition |
| `true` | `<Save />` | "Sauvegarder" | Passe en mode lecture + toast |

### 9.3. Propagation de l'√©tat

**Flux de propagation :**

```mermaid
graph TD
    A[MenuOngletDiffuserReseaux<br/>toggleEditMode] --> B[setState: editMode]
    B --> C[onEditModeChange newEditMode]
    C --> D[AccueilDiffuserReseauxAnnonce<br/>setEditMode]
    D --> E[Props vers File1.AnnonceReseaux<br/>editMode=true/false]
    D --> F[Props vers File2.PersonnaliserReseaux<br/>editMode=true/false]
    E --> G[Affichage conditionnel<br/>ReadOnly vs Editable]
    F --> G
```

**Code de propagation :**
```typescript
// AccueilDiffuserReseauxAnnonce.tsx (lignes 60-64)
<MenuOngletDiffuserReseaux
  enableEditMode={true}
  tabContent1={contentTab1}
  tabContent2={contentTab2}
  tabContent3={contentTab3}
  className="mt-0"
  onEditModeChange={(isEditMode) => {
    setEditMode(isEditMode);  // ‚Üê Mise √† jour de l'√©tat global
  }}
/>
```

### 9.4. Affichage conditionnel

**Dans `File1.AnnonceReseaux` :**
```typescript
// File1.AnnonceReseaux.tsx (lignes 45-75)
{!editMode ? (
  // Mode Lecture
  <>
    <LabelReseauxAnnonce htmlFor="titre-annonce-reseaux">
      Titre de l'Annonce
    </LabelReseauxAnnonce>
    <ReadOnlyReseauxAnnonce
      id="titre-annonce-reseaux"
      content={annonceReseaux.titre}
    />
  </>
) : (
  // Mode √âdition
  <>
    <LabelReseauxAnnonce htmlFor="titre-annonce-reseaux">
      Titre de l'Annonce
    </LabelReseauxAnnonce>
    <EditableReseauxAnnonce
      id="titre-annonce-reseaux"
      value={annonceReseaux.titre}
      onChange={(value) => handleChange('titre', value)}
      rows={2}
    />
  </>
)}
```

### 9.5. Nettoyage HTML

**Absence de nettoyage HTML dans ce canal :**

Contrairement aux canaux Site Internet et Portails Immobiliers, **aucune fonction de suppression des balises HTML** n'est appliqu√©e dans le canal R√©seaux Sociaux.

**Raisons :**
1. Les champs `accroche` et `pointsForts` utilisent `EditeurWYSIWYG` sans barre d'outils
2. L'utilisateur ne peut pas ins√©rer de balises HTML manuellement
3. Le contenu OpenAI original ne contient pas de HTML (que du texte brut avec emojis et sauts de ligne)
4. Les composants `ReadOnlyReseauxAnnonce` et `EditableReseauxAnnonce` n'utilisent **pas** `dangerouslySetInnerHTML`

**Affichage du contenu :**
```typescript
// GraphismeInterieurDiffuserReseaux.tsx (lignes 125-138)
export const ReadOnlyReseauxAnnonce: React.FC<ReadOnlyReseauxAnnonceProps> = ({ 
  id, content, className
}) => {
  return (
    <div id={id} className={cn("bg-white rounded-md border border-gray-200 p-3", className)}>
      {/* Affichage texte brut avec pr√©servation des sauts de ligne */}
      <div className="whitespace-pre-line">{content}</div>
    </div>
  );
};
```

### 9.6. √âditeur WYSIWYG (EditeurWYSIWYG.tsx)

**Caract√©ristiques :**

| Propri√©t√© | Valeur | D√©tail |
|-----------|--------|--------|
| **Barre d'outils** | ‚ùå D√©sactiv√©e | Pas de formatage HTML possible |
| **Emojis** | ‚úÖ Activ√©s | S√©lecteur par cat√©gorie en bas √† droite |
| **Format de sortie** | Texte brut | Pas de balises HTML g√©n√©r√©es |
| **Police** | Nunito 18px | Coh√©rence avec le reste de l'app |
| **Lignes configurables** | `rows` prop | Hauteur adaptative |

**Cat√©gories d'emojis disponibles :**
```typescript
// EditeurWYSIWYG.tsx (lignes 16-59)
const emojiData = {
  "personnes": ["üòÄ", "üòÉ", "üòÑ", ...],      // 50 emojis
  "alimentation": ["üçé", "üçè", "üçê", ...],    // 50 emojis
  "activites": ["‚öΩ", "üèÄ", "üèà", ...],       // 50 emojis
  "voyages": ["üöó", "üöï", "üöô", ...],        // 50 emojis
  "objets": ["üíª", "üñ•", "üñ®", ...],        // 50 emojis
  "symboles": ["‚ù§", "üß°", "üíõ", ...],       // 50 emojis
};
```

**Fonction d'insertion emoji :**
```typescript
// EditeurWYSIWYG.tsx (lignes 97-118)
const insertEmoji = (emoji: string) => {
  if (textareaRef.current) {
    const textarea = textareaRef.current;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;

    // Cr√©er le nouveau contenu avec l'emoji ins√©r√©
    const newContent = editorValue.substring(0, start) + emoji + editorValue.substring(end);

    // Mettre √† jour le contenu
    setEditorValue(newContent);
    onChange(newContent);

    // Repositionner le curseur apr√®s l'emoji
    setTimeout(() => {
      textarea.focus();
      textarea.setSelectionRange(start + emoji.length, start + emoji.length);
    }, 0);
  }

  setIsEmojiOpen(false);
};
```

**Diff√©rence avec le canal Site Internet :**
- **Site Internet** : Utilise ReactQuill avec barre d'outils compl√®te (gras, italic, listes, etc.)
- **R√©seaux Sociaux** : Utilise une `<textarea>` standard + s√©lecteur d'emojis uniquement

**Pourquoi cette diff√©rence ?**
- Les r√©seaux sociaux acceptent principalement du texte brut avec emojis
- Pas besoin de formatage HTML complexe (gras, listes, liens)
- Simplicit√© d'utilisation pour l'utilisateur final

---

## X. OPTIONS DE COPIE

### 10.1. FORMAT TEXTE

#### A. Fichier source

**Hook :** `Hook-3-UtiliserCopierTexteReseaux.tsx`

**Composant utilis√© :**
```typescript
// Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 93-100)
return (
  <CopyReseauxOption
    title="Copier au Format Texte"
    description="Format pour √™tre copi√© sur votre r√©seau social ou dans votre logiciel"
    icon={<FileText className="h-5 w-5" />}
    buttonText="Copier l'Annonce"
    buttonIcon={<FileText className="mr-2 h-4 w-4" />}
    onClick={copierTexteReseaux}
  />
);
```

#### B. Logique de r√©cup√©ration

**Fonction `recupererAnnonceReseaux()` :**
```typescript
// Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 17-30)
const recupererAnnonceReseaux = (): string => {
  if (dataReseaux.titre || dataReseaux.accroche || 
      dataReseaux.pointsForts || dataReseaux.appelAction) {

    // Assembler toutes les parties en format texte sans titres
    const contenuComplet = [
      dataReseaux.titre,
      dataReseaux.accroche,
      dataReseaux.pointsForts,
      dataReseaux.appelAction
    ].filter(Boolean).join('\n\n');  // ‚Üê Double saut de ligne entre sections

    return contenuComplet;
  }
  return '';
};
```

**Fonction `recupererUrlAnnonce()` :**
```typescript
// Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 33-36)
const recupererUrlAnnonce = (): string => {
  return getUrlAnnonce();
};
```

**Fonction `construireTexteReseaux()` :**
```typescript
// Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 43-58)
const construireTexteReseaux = (): string => {
  const annonceReseaux = recupererAnnonceReseaux().trim();
  const urlAnnonce = recupererUrlAnnonce().trim();

  let texteFinal = '';

  // Ajouter l'annonce R√©seaux Sociaux avec ses sauts de ligne
  if (annonceReseaux) {
    texteFinal += annonceReseaux;
  }

  // Ajouter double saut de ligne puis l'URL
  if (urlAnnonce) {
    if (texteFinal) {
      texteFinal += '\n\n'; // Double saut de ligne
    }
    texteFinal += urlAnnonce;
  }

  return texteFinal;
};
```

#### C. Fonction de copie

**Fonction `copierTexteReseaux()` :**
```typescript
// Hook-3-UtiliserCopierTexteReseaux.tsx (lignes 60-90)
const copierTexteReseaux = () => {
  const texteReseaux = construireTexteReseaux();

  if (texteReseaux) {
    navigator.clipboard.writeText(texteReseaux).then(() => {
      console.log('Annonce R√©seaux copi√©e avec succ√®s:', texteReseaux);
      toast({
        title: "Succ√®s",
        description: "Votre Annonce R√©seaux Sociaux a √©t√© copi√©e dans le presse-papier",
      });
    }).catch((error) => {
      console.error('Erreur lors de la copie:', error);
      toast({
        title: "Erreur",
        description: "Impossible de copier l'annonce R√©seaux Sociaux",
        variant: "destructive",
      });
    });
  } else {
    console.warn('Aucun contenu R√©seaux √† copier');
    toast({
      title: "Attention",
      description: "Aucun contenu R√©seaux Sociaux disponible √† copier",
      variant: "destructive",
    });
  }
};
```

**Gestion des erreurs :**
- Contenu vide ‚Üí Toast "Attention" + log warning
- Erreur clipboard ‚Üí Toast "Erreur" + log error
- Succ√®s ‚Üí Toast "Succ√®s" + log confirmation

### 10.2. FORMAT HTML

**Statut :** ‚ùå **NON DISPONIBLE** dans ce canal

**Raisons :**
- Les r√©seaux sociaux n'acceptent g√©n√©ralement pas de HTML
- Le contenu est pr√©vu pour √™tre copi√© en texte brut
- Pas de composant `HookUtiliserCopierHTMLReseaux`

**Comparaison avec les autres canaux :**

| Canal | Format Texte | Format HTML |
|-------|--------------|-------------|
| Site Internet | ‚úÖ | ‚úÖ |
| Portails Immobiliers | ‚úÖ | ‚ùå |
| Newsletter | ‚úÖ | ‚úÖ |
| SMS | ‚úÖ | ‚ùå |
| Google Business Profile | ‚úÖ | ‚ùå |
| **R√©seaux Sociaux** | ‚úÖ | ‚ùå |
| Landing Page | ‚ùå | ‚ùå (bouton Sauvegarder) |

### 10.3. Logique de formatage d√©taill√©e

**Structure du texte copi√© :**

```
[Titre]
‚Üì \n\n (double saut de ligne)
[Accroche]
‚Üì \n\n
[Points Forts]
‚Üì \n\n
[Appel √† l'action]
‚Üì \n\n
[URL de l'annonce]
```

**Exemple concret :**

**Donn√©es source :**
```typescript
{
  titre: "üåü RESTAURANT √Ä VENDRE ‚Äì PARIS 11e",
  accroche: "Emplacement premium en angle, rare √† la vente.\n\nAffaire en angle id√©alement situ√©e...",
  pointsForts: "Les Atouts du bien\n\n‚òëÔ∏è Emplacement Premium...\n‚òëÔ∏è Surface de 205 m¬≤...",
  appelAction: "Int√©ress√©(e) ?\nüìû Contactez-nous...\nPrix FAI : 456.000‚Ç¨\nR√©f√©rence : B78-8956",
  urlAnnonce: "https://example.com/annonce/123"
}
```

**Texte copi√© :**
```
üåü RESTAURANT √Ä VENDRE ‚Äì PARIS 11e

Emplacement premium en angle, rare √† la vente.

Affaire en angle id√©alement situ√©e dans un quartier commer√ßant et hyper attractif.
Conditions locatives attractives avec un loyer faible et renouvel√© r√©cemment. Gros CA et excellente rentabilit√©.

Les Atouts du bien

‚òëÔ∏è Emplacement Premium en angle, Paris 11√®me, forte visibilit√©, √† proximit√© imm√©diate du m√©tro.
‚òëÔ∏è Surface de 205 m¬≤, deux √©tages.
‚òëÔ∏è D√©coration raffin√©e, √©tablissement en excellent √©tat, ambiance cozy et raffin√©e, refait √† neuf en 2023.
‚òëÔ∏è Capacit√© d'accueil de 60 places assises, 40 en salle, 20 en terrasse permanente.
‚òëÔ∏è Cuisine de plain-pied avec extraction 400.
‚òëÔ∏è Appartement √† l'√©tage.
‚òëÔ∏è Conditions locatives attractives, loyer de 850‚Ç¨/mois, bail renouvel√© √† l'ouverture.
‚òëÔ∏è CA 2023 : 895.000‚Ç¨, Perf : 89.000‚Ç¨.
‚òëÔ∏è Beau potentiel de d√©veloppement.

Int√©ress√©(e) ? 
üìû Contactez-nous pour organiser une visite ou en savoir plus.
Prix FAI : 456.000‚Ç¨
R√©f√©rence : B78-8956

https://example.com/annonce/123
```

**Points cl√©s du formatage :**
1. ‚úÖ Conservation des emojis (üåü, üìû, ‚òëÔ∏è)
2. ‚úÖ Conservation des sauts de ligne internes √† chaque section
3. ‚úÖ Double saut de ligne entre sections
4. ‚úÖ URL ajout√©e √† la fin apr√®s double saut de ligne
5. ‚ùå Aucune transformation HTML
6. ‚ùå Aucun ajout de titres de sections (d√©j√† pr√©sents dans le contenu)

---

## XI. SYST√àME D'APER√áU

### 11.1. Hook Aper√ßu - `HookUtiliserApercuReseaux.tsx`

**Fonctions principales :**
1. Charger les donn√©es initiales depuis `localStorage`
2. √âcouter les modifications en temps r√©el
3. Afficher 3 aper√ßus distincts

**Code complet :**
```typescript
// Hook-3-UtiliserApercuReseaux.tsx (lignes 7-125)
const HookUtiliserApercuReseaux: React.FC = () => {
  const [annonceReseaux, setAnnonceReseaux] = useState<string>('');
  const [urlAnnonce, setUrlAnnonce] = useState<string>('');
  const [photoUrl, setPhotoUrl] = useState<string>('');

  const { annonceReseaux: dataReseaux } = useRecuperationDataReseaux();
  const { getUrlAnnonce } = usePersonnaliserUrlReseaux();
  const { getPhotoUrl } = usePersonnaliserPhotoReseaux();

  // Chargement initial
  useEffect(() => {
    const loadData = () => {
      // R√©cup√©ration de l'annonce
      const annonceComplete = [
        dataReseaux.titre,
        dataReseaux.accroche,
        dataReseaux.pointsForts,
        dataReseaux.appelAction
      ].filter(Boolean).join('\n\n');

      setAnnonceReseaux(annonceComplete);

      // R√©cup√©ration URL et photo
      setUrlAnnonce(getUrlAnnonce());
      setPhotoUrl(getPhotoUrl());
    };

    loadData();
  }, [dataReseaux, getUrlAnnonce, getPhotoUrl]);

  // √âcoute des modifications localStorage en temps r√©el
  useEffect(() => {
    const handleStorageChange = () => {
      const annonceComplete = [
        dataReseaux.titre,
        dataReseaux.accroche,
        dataReseaux.pointsForts,
        dataReseaux.appelAction
      ].filter(Boolean).join('\n\n');

      setAnnonceReseaux(annonceComplete);
      setUrlAnnonce(getUrlAnnonce());
      setPhotoUrl(getPhotoUrl());
    };

    // √âcoute √©v√©nement 'storage' (changements dans localStorage)
    window.addEventListener('storage', handleStorageChange);

    // Polling toutes les 1 seconde pour d√©tecter les changements
    const interval = setInterval(handleStorageChange, 1000);

    return () => {
      window.removeEventListener('storage', handleStorageChange);
      clearInterval(interval);
    };
  }, [dataReseaux, getUrlAnnonce, getPhotoUrl]);

  return (
    <div className="space-y-4">
      {/* Aper√ßu 1 - Annonce R√©seaux Sociaux */}
      <ReseauxAnnoncePreview title="Aper√ßu de votre Annonce R√©seaux Sociaux">
        {annonceReseaux ? (
          <div className="whitespace-pre-line">{annonceReseaux}</div>
        ) : (
          <p className="text-gray-500 italic">Aucune annonce disponible</p>
        )}
      </ReseauxAnnoncePreview>

      {/* Aper√ßu 2 - URL de l'annonce */}
      <ReseauxAnnoncePreview title="Aper√ßu de l'URL de votre annonce">
        {urlAnnonce ? (
          <div className="whitespace-pre-line">{urlAnnonce}</div>
        ) : (
          <p className="text-gray-500 italic">Aucune URL renseign√©e</p>
        )}
      </ReseauxAnnoncePreview>

      {/* Aper√ßu 3 - Photo de couverture */}
      <ReseauxAnnoncePreview title="Aper√ßu de la photo de couverture">
        {photoUrl ? (
          <img 
            src={photoUrl} 
            alt="Photo de couverture" 
            className="w-full rounded"
          />
        ) : (
          <p className="text-gray-500 italic">Aucune photo t√©l√©charg√©e</p>
        )}
      </ReseauxAnnoncePreview>
    </div>
  );
};
```

### 11.2. M√©canisme de mise √† jour temps r√©el

**Deux m√©thodes compl√©mentaires :**

1. **√âv√©nement `storage` :** D√©tecte les changements dans `localStorage` depuis d'autres onglets/fen√™tres
   ```typescript
   window.addEventListener('storage', handleStorageChange);
   ```

2. **Polling `setInterval` :** D√©tecte les changements dans le m√™me onglet toutes les 1 seconde
   ```typescript
   const interval = setInterval(handleStorageChange, 1000);
   ```

**Pourquoi les deux ?**
- `storage` event ne se d√©clenche **pas** dans le m√™me onglet qui modifie `localStorage`
- Le polling compense cette limitation pour d√©tecter les changements locaux
- Combinaison des deux = mise √† jour temps r√©el universelle

### 11.3. Fonctions d√©taill√©es

**Fonction `handleStorageChange` :**
```typescript
// Hook-3-UtiliserApercuReseaux.tsx (lignes 35-45)
const handleStorageChange = () => {
  // Reconstruction de l'annonce compl√®te
  const annonceComplete = [
    dataReseaux.titre,
    dataReseaux.accroche,
    dataReseaux.pointsForts,
    dataReseaux.appelAction
  ].filter(Boolean).join('\n\n');

  // Mise √† jour des √©tats
  setAnnonceReseaux(annonceComplete);
  setUrlAnnonce(getUrlAnnonce());
  setPhotoUrl(getPhotoUrl());
};
```

**Composant `ReseauxAnnoncePreview` :**
```typescript
// GraphismeInterieurDiffuserReseaux.tsx (lignes 324-337)
export const ReseauxAnnoncePreview: React.FC<ReseauxAnnoncePreviewProps> = ({ 
  title, 
  className,
  children
}) => {
  return (
    <div className={cn("mt-6 p-4 bg-realestate-purple-light/10 border border-realestate-purple-light rounded-lg", className)}>
      <h4 className="font-semibold mb-2">{title}</h4>
      <div className="bg-white p-4 rounded border border-gray-200 overflow-y-auto">
        {children}
      </div>
    </div>
  );
};
```

**Diff√©rences avec les autres canaux :**

| Canal | Nombre d'aper√ßus | Contenu | Transformation |
|-------|------------------|---------|----------------|
| Site Internet | 1 | Annonce HTML | `stripHtmlTags()` |
| Portails | 3 | Titre, Description, Donn√©es financi√®res | `stripHtmlTags()` |
| Newsletter | 1 | Newsletter HTML | `stripHtmlTags()` |
| SMS | 4 | SMS, Exp√©diteur, URL, Destinataires | Aucune |
| Google Business | 3 | Annonce, URL, Photo | Aucune |
| **R√©seaux Sociaux** | **3** | **Annonce, URL, Photo** | **Aucune** |
| Landing Page | 2 | Annonce, Synth√®se | `stripHtmlTags()` + `addTitlesToSections()` |

---

## XII. CONTRAINTES ET VALIDATION

### 12.1. Validation des champs (nettoyage HTML)

**Statut :** ‚ùå **AUCUNE VALIDATION** impl√©ment√©e dans ce canal

**Absence de :**
- Fonction `stripHtmlTags()` (contrairement aux canaux Site Internet, Portails, Newsletter, Landing Page)
- Validation de longueur maximale (contrairement au canal SMS)
- Validation de format (contrairement au canal SMS pour le champ Exp√©diteur)
- Nettoyage des caract√®res sp√©ciaux

**Raisons :**
1. L'`EditeurWYSIWYG` ne g√©n√®re **pas** de HTML (barre d'outils d√©sactiv√©e)
2. Le contenu OpenAI est d√©j√† au format texte brut avec emojis
3. Les champs `titre` et `appelAction` utilisent des `<textarea>` standards
4. Pas de risque d'injection HTML malveillante

**Comparaison avec d'autres canaux :**

| Canal | Nettoyage HTML | Validation longueur | Validation format |
|-------|----------------|---------------------|-------------------|
| Site Internet | ‚úÖ `stripHtmlTags()` | ‚ùå | ‚ùå |
| Portails | ‚úÖ `stripHtmlTags()` | ‚ùå | ‚ùå |
| Newsletter | ‚úÖ `stripHtmlTags()` | ‚ùå | ‚ùå |
| SMS | ‚úÖ `stripHtmlTags()` | ‚úÖ 122 chars | ‚úÖ GSM-7 |
| Google Business | ‚ùå | ‚ùå | ‚ùå |
| **R√©seaux Sociaux** | ‚ùå | ‚ùå | ‚ùå |
| Landing Page | ‚úÖ `stripHtmlTags()` | ‚ùå | ‚ùå |

### 12.2. Gestion des erreurs (loading, error)

**Hook `useRecuperationDataReseaux` :**
```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 22-25)
const [isLoading, setIsLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
```

**Gestion dans `File1.AnnonceReseaux` :**
```typescript
// File1.AnnonceReseaux.tsx (lignes 18-37)
const { annonceReseaux, updateAnnonceReseaux, isLoading, error } = useRecuperationDataReseaux();

if (isLoading) {
  return (
    <div className="flex justify-center items-center h-64">
      <p className="text-gray-500">Chargement des donn√©es...</p>
    </div>
  );
}

if (error) {
  return (
    <div className="flex justify-center items-center h-64">
      <p className="text-red-500">{error}</p>
    </div>
  );
}
```

**√âtats possibles :**

| √âtat | Affichage | Dur√©e |
|------|-----------|-------|
| `isLoading=true` | "Chargement des donn√©es..." | < 1 seconde (lecture localStorage) |
| `error!=null` | Message d'erreur en rouge | Permanent jusqu'au rechargement |
| `isLoading=false && error=null` | Contenu normal | Permanent |

**Erreurs captur√©es :**
```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 60-65)
try {
  // ... chargement donn√©es
  setIsLoading(false);
} catch (error) {
  console.error('Erreur chargement donn√©es:', error);
  setError('Impossible de charger les donn√©es');
  setIsLoading(false);
}
```

### 12.3. Toasts de notification

**Liste compl√®te des toasts dans le canal :**

| Action | Type | Titre | Description | Fichier |
|--------|------|-------|-------------|---------|
| Sauvegarde (clic bouton) | `default` | "Modifications sauvegard√©es" | "Vos modifications ont √©t√© enregistr√©es avec succ√®s" | `MenuOngletDiffuserReseaux.tsx:69` |
| Copie texte r√©ussie | `default` | "Succ√®s" | "Votre Annonce R√©seaux Sociaux a √©t√© copi√©e dans le presse-papier" | `Hook-3-UtiliserCopierTexteReseaux.tsx:72-75` |
| Copie texte √©chou√©e | `destructive` | "Erreur" | "Impossible de copier l'annonce R√©seaux Sociaux" | `Hook-3-UtiliserCopierTexteReseaux.tsx:78-82` |
| Copie texte vide | `destructive` | "Attention" | "Aucun contenu R√©seaux Sociaux disponible √† copier" | `Hook-3-UtiliserCopierTexteReseaux.tsx:85-89` |
| Envoi Zoho | `default` | "Fonction en pr√©paration" | "L'envoi via Zoho Social sera bient√¥t disponible" | `Hook-3-UtiliserZohoReseauxFonctionEnvoi.tsx:13-17` |

**Configuration des toasts :**
```typescript
// Exemple de toast de succ√®s
toast({
  title: "Succ√®s",
  description: "Votre Annonce R√©seaux Sociaux a √©t√© copi√©e dans le presse-papier",
});

// Exemple de toast d'erreur
toast({
  title: "Erreur",
  description: "Impossible de copier l'annonce R√©seaux Sociaux",
  variant: "destructive",
});
```

### 12.4. S√©curit√©

**Risques identifi√©s :**

1. **Stockage localStorage non chiffr√©**
   - Donn√©es sensibles (annonces immobili√®res) accessibles en clair
   - Risque de vol de donn√©es via extensions malveillantes ou acc√®s physique
   - Solution future : Migration vers Supabase avec encryption

2. **Photos en base64 dans localStorage**
   - Stockage de fichiers binaires volumineux (100-300 KB)
   - Risque de d√©passement de la limite `localStorage` (5-10 MB selon navigateurs)
   - Pas de compression optimale
   - Solution future : Stockage dans Supabase Storage avec URLs sign√©es

3. **Absence de validation des donn√©es**
   - Pas de sanitization des entr√©es utilisateur
   - Pas de limitation de longueur des champs
   - Risque th√©orique d'injection si le contenu est affich√© dans un contexte non s√©curis√©
   - Mitig√© par : affichage via `textContent` (pas `innerHTML`) et absence de barre d'outils WYSIWYG

4. **√âv√©nement `storage` + Polling**
   - √âcoute continue toutes les 1 seconde
   - Consommation CPU/m√©moire faible mais permanente
   - Risque de d√©rive m√©moire si la page reste ouverte longtemps
   - Solution : Optimiser avec `debounce` ou passer √† un syst√®me r√©actif (Supabase realtime)

5. **Absence de v√©rification de l'int√©grit√© des donn√©es**
   - Pas de checksum ou signature
   - Risque de corruption des donn√©es si `localStorage` est modifi√© manuellement
   - Pas de m√©canisme de r√©cup√©ration automatique

**Recommandations de s√©curit√© pour la migration Supabase :**

| Risque | Solution Supabase |
|--------|-------------------|
| Donn√©es non chiffr√©es | Encryption at rest + SSL/TLS |
| Photos volumineuses | Supabase Storage avec URLs sign√©es temporaires |
| Absence de validation | RLS policies + Triggers de validation |
| Polling inefficace | Supabase Realtime avec Postgres LISTEN/NOTIFY |
| Int√©grit√© des donn√©es | Constraints SQL + Audit logs |

---

## XIII. COMPOSANTS GRAPHIQUES R√âUTILISABLES

### 13.1. `LabelReseauxAnnonce`

**Fichier :** `GraphismeInterieurDiffuserReseaux.tsx` (lignes 107-116)

**Interface :**
```typescript
interface LabelReseauxAnnonceProps {
  htmlFor: string;
  children: ReactNode;
  className?: string;
}
```

**Code :**
```typescript
export const LabelReseauxAnnonce: React.FC<LabelReseauxAnnonceProps> = ({ 
  htmlFor, 
  children, 
  className 
}) => {
  return (
    <label 
      htmlFor={htmlFor} 
      className={cn("text-sm font-medium block mb-1", className)}
    >
      {children}
    </label>
  );
};
```

**Utilisation :**
```typescript
<LabelReseauxAnnonce htmlFor="titre-annonce-reseaux">
  Titre de l'Annonce
</LabelReseauxAnnonce>
```

**Styles appliqu√©s :**
- `text-sm` : Taille de texte petite
- `font-medium` : Poids moyen
- `block` : Affichage en bloc
- `mb-1` : Marge inf√©rieure 4px

### 13.2. `ReadOnlyReseauxAnnonce`

**Fichier :** `GraphismeInterieurDiffuserReseaux.tsx` (lignes 125-138)

**Interface :**
```typescript
interface ReadOnlyReseauxAnnonceProps {
  id: string;
  content: string;
  className?: string;
}
```

**Code :**
```typescript
export const ReadOnlyReseauxAnnonce: React.FC<ReadOnlyReseauxAnnonceProps> = ({ 
  id, 
  content, 
  className
}) => {
  return (
    <div 
      id={id} 
      className={cn("bg-white rounded-md border border-gray-200 p-3", className)}
    >
      {/* Affichage texte brut avec pr√©servation sauts de ligne */}
      <div className="whitespace-pre-line">{content}</div>
    </div>
  );
};
```

**Utilisation :**
```typescript
<ReadOnlyReseauxAnnonce
  id="titre-annonce-reseaux"
  content={annonceReseaux.titre}
/>
```

**Diff√©rence avec `ReadOnlyField` (utilis√© dans Site Internet) :**

| Propri√©t√© | `ReadOnlyField` | `ReadOnlyReseauxAnnonce` |
|-----------|-----------------|--------------------------|
| Affichage HTML | `dangerouslySetInnerHTML` si `isDescriptif=true` | ‚ùå Jamais |
| Transformation | Possible via `stripHtmlTags()` | ‚ùå Aucune |
| Pr√©servation sauts de ligne | `whitespace-pre-line` | `whitespace-pre-line` |

### 13.3. `EditableReseauxAnnonce`

**Fichier :** `GraphismeInterieurDiffuserReseaux.tsx` (lignes 150-181)

**Interface :**
```typescript
interface EditableReseauxAnnonceProps {
  id: string;
  value: string;
  onChange: (value: string) => void;
  rows?: number;
  className?: string;
  useWysiwyg?: boolean;
}
```

**Code :**
```typescript
export const EditableReseauxAnnonce: React.FC<EditableReseauxAnnonceProps> = ({ 
  id, 
  value, 
  onChange, 
  rows = 3,
  className,
  useWysiwyg = false
}) => {
  if (useWysiwyg) {
    const simpleMode = rows <= 3;

    return (
      <EditeurWYSIWYG
        value={value}
        onChange={onChange}
        rows={rows}
        className={cn("w-full", className)}
        simpleMode={simpleMode}
      />
    );
  }

  return (
    <textarea 
      id={id} 
      value={value} 
      onChange={(e) => onChange(e.target.value)} 
      className={cn("w-full rounded-md border border-gray-200 p-3", className)}
      rows={rows}
    />
  );
};
```

**Utilisation :**
```typescript
// Sans WYSIWYG
<EditableReseauxAnnonce
  id="titre-annonce-reseaux"
  value={annonceReseaux.titre}
  onChange={(value) => handleChange('titre', value)}
  rows={2}
/>

// Avec WYSIWYG
<EditableReseauxAnnonce
  id="accroche-annonce-reseaux"
  value={annonceReseaux.accroche}
  onChange={(value) => handleChange('accroche', value)}
  rows={5}
  useWysiwyg={true}
/>
```

### 13.4. `EditButton`

**Fichier :** `GraphismeInterieurDiffuserReseaux.tsx` (lignes 192-216)

**Interface :**
```typescript
interface EditButtonProps {
  editMode: boolean;
  onClick: () => void;
  className?: string;
}
```

**Code :**
```typescript
export const EditButton: React.FC<EditButtonProps> = ({ 
  editMode, 
  onClick, 
  className 
}) => {
  return (
    <Button 
      onClick={onClick} 
      variant="outline" 
      className={cn("border-realestate-purple text-realestate-purple hover:bg-realestate-purple hover:text-white", className)}
    >
      {editMode ? (
        <>
          <Save className="mr-2 h-4 w-4" />
          Sauvegarder
        </>
      ) : (
        <>
          <Edit className="mr-2 h-4 w-4" />
          Modifier
        </>
      )}
    </Button>
  );
};
```

**Utilisation :**
```typescript
<EditButton 
  editMode={editMode} 
  onClick={toggleEditMode} 
/>
```

**Styles appliqu√©s :**
- `variant="outline"` : Bouton avec bordure
- `border-realestate-purple` : Bordure violette personnalis√©e
- `hover:bg-realestate-purple` : Fond violet au survol
- `hover:text-white` : Texte blanc au survol

### 13.5. `CopyReseauxOption`

**Fichier :** `GraphismeInterieurDiffuserReseaux.tsx` (lignes 229-255)

**Interface :**
```typescript
interface CopyReseauxOptionProps {
  title: string;
  description: string;
  icon: React.ReactNode;
  buttonText: string;
  buttonIcon: React.ReactNode;
  onClick: () => void;
  className?: string;
}
```

**Code :**
```typescript
export const CopyReseauxOption: React.FC<CopyReseauxOptionProps> = ({
  title,
  description,
  icon,
  buttonText,
  buttonIcon,
  onClick,
  className
}) => {
  return (
    <div className={cn("border-l-4 border-l-realestate-mauve bg-white p-4 rounded-r-lg shadow-sm hover:shadow-md transition-all", className)}>
      <div className="flex items-start mb-3">
        <div className="p-2 rounded-lg bg-realestate-purple-light text-realestate-purple-dark mr-3">
          {icon}
        </div>
        <div>
          <h4 className="font-semibold">{title}</h4>
          <p className="text-sm text-gray-600">{description}</p>
        </div>
      </div>
      <Button onClick={onClick} className="w-full bg-realestate-mauve hover:bg-realestate-mauve-dark text-white">
        {buttonIcon}
        {buttonText}
      </Button>
    </div>
  );
};
```

**Utilisation :**
```typescript
<CopyReseauxOption
  title="Copier au Format Texte"
  description="Format pour √™tre copi√© sur votre r√©seau social ou dans votre logiciel"
  icon={<FileText className="h-5 w-5" />}
  buttonText="Copier l'Annonce"
  buttonIcon={<FileText className="mr-2 h-4 w-4" />}
  onClick={copierTexteReseaux}
/>
```

**Styles appliqu√©s :**
- `border-l-4` : Bordure gauche de 4px
- `border-l-realestate-mauve` : Couleur mauve personnalis√©e
- `shadow-sm` : Ombre l√©g√®re
- `hover:shadow-md` : Ombre plus prononc√©e au survol
- `transition-all` : Animation douce

### 13.6. `ReseauxAnnoncePreview`

**Fichier :** `GraphismeInterieurDiffuserReseaux.tsx` (lignes 324-337)

**Interface :**
```typescript
interface ReseauxAnnoncePreviewProps {
  title: string;
  className?: string;
  children?: ReactNode;
}
```

**Code :**
```typescript
export const ReseauxAnnoncePreview: React.FC<ReseauxAnnoncePreviewProps> = ({ 
  title, 
  className,
  children
}) => {
  return (
    <div className={cn("mt-6 p-4 bg-realestate-purple-light/10 border border-realestate-purple-light rounded-lg", className)}>
      <h4 className="font-semibold mb-2">{title}</h4>
      <div className="bg-white p-4 rounded border border-gray-200 overflow-y-auto">
        {children}
      </div>
    </div>
  );
};
```

**Utilisation :**
```typescript
<ReseauxAnnoncePreview title="Aper√ßu de votre Annonce R√©seaux Sociaux">
  {annonceReseaux ? (
    <div className="whitespace-pre-line">{annonceReseaux}</div>
  ) : (
    <p className="text-gray-500 italic">Aucune annonce disponible</p>
  )}
</ReseauxAnnoncePreview>
```

**Styles appliqu√©s :**
- `mt-6` : Marge sup√©rieure 24px
- `p-4` : Padding 16px
- `bg-realestate-purple-light/10` : Fond violet tr√®s clair avec opacit√© 10%
- `overflow-y-auto` : Scroll vertical si contenu trop long

---

## XIV. TABLEAUX R√âCAPITULATIFS

### 14.1. Tableau des champs - Annonce R√©seaux Sociaux

| Champ Interface | Champ OpenAI | Label affich√© | Type | Rows | WYSIWYG | Nettoyage HTML | localStorage (modifs) |
|-----------------|--------------|---------------|------|------|---------|----------------|-----------------------|
| `titre` | `TitreAnnonceReseaux` | Titre de l'Annonce | `string` | 2 | ‚ùå | ‚ùå | `key-modifs-diffuser-reseaux-sociaux-annonce` |
| `accroche` | `AccrocheImpactanteAnnonceReseaux` | Accroche | `string` | 5 | ‚úÖ | ‚ùå | `key-modifs-diffuser-reseaux-sociaux-annonce` |
| `pointsForts` | `AtoutsAnnonceReseaux` | Points Forts | `string` | 8 | ‚úÖ | ‚ùå | `key-modifs-diffuser-reseaux-sociaux-annonce` |
| `appelAction` | `CtaAnnonceReseaux` | Appel √† l'action | `string` | 5 | ‚ùå | ‚ùå | `key-modifs-diffuser-reseaux-sociaux-annonce` |

### 14.2. Tableau des champs - Personnalisation

| Champ Interface | Label affich√© | Type | Composant √âdition | Traitement sp√©cial | localStorage |
|-----------------|---------------|------|-------------------|--------------------|--------------|
| `urlAnnonce` | URL de l'annonce | `string` | `EditableReseauxAnnonce` | ‚ùå | `key-modifs-url-annonce-reseaux-sociaux` |
| `photoUrl` | Photo de couverture du post | `base64` | `UploadPhoto` | ‚úÖ Resize 1080x566 | `key-modifs-photo-annonce-reseaux-sociaux` |

### 14.3. Tableau des hooks

| Hook | Fonction principale | Donn√©es sources | Retour |
|------|---------------------|-----------------|--------|
| `useRecuperationDataReseaux` | R√©cup√©ration annonce avec priorit√© modifs > originales | `key-modifs-diffuser-reseaux-sociaux-annonce` ‚ûú `generation_reseauxsociaux_ad` | `{ annonceReseaux, updateAnnonceReseaux, isLoading, error }` |
| `usePersonnaliserUrlReseaux` | Gestion URL de l'annonce | `key-modifs-url-annonce-reseaux-sociaux` | `{ personnaliserData, updateUrlAnnonce, getUrlAnnonce, getAllData }` |
| `usePersonnaliserPhotoReseaux` | Upload, resize (1080x566) et stockage photo en base64 | `key-modifs-photo-annonce-reseaux-sociaux` | `{ photoData, processAndStorePhoto, removePhoto, getPhotoUrl, getAllData }` |
| `useApercuReseaux` | Aper√ßus temps r√©el via `storage` event + polling | Tous les hooks ci-dessus | Rendu 3 aper√ßus |
| `useCopierTexteReseaux` | Copie format√©e texte brut | `annonceReseaux` + `urlAnnonce` | Fonction `copierTexteReseaux()` |
| `useZohoReseauxFonctionEnvoi` | Envoi Zoho Social (**INACTIF**) | Aucune | Toast "Fonction en pr√©paration" |

### 14.4. Tableau des fonctions de copie

| Fonction | Hook source | Donn√©es utilis√©es | Format de sortie | S√©parateur |
|----------|-------------|-------------------|------------------|------------|
| `recupererAnnonceReseaux()` | `useRecuperationDataReseaux` | `titre`, `accroche`, `pointsForts`, `appelAction` | Texte brut | `\n\n` (double saut de ligne) |
| `recupererUrlAnnonce()` | `usePersonnaliserUrlReseaux` | `urlAnnonce` | Texte brut | N/A |
| `construireTexteReseaux()` | Combinaison des 2 ci-dessus | Annonce compl√®te + URL | Texte brut | `\n\n` entre annonce et URL |
| `copierTexteReseaux()` | `construireTexteReseaux()` | Texte final | Presse-papier | N/A |

### 14.5. Matrice Onglets √ó Actions √ó Fichiers

| Onglet | Affichage | √âdition | Aper√ßu | Copie | Fichiers concern√©s |
|--------|-----------|---------|--------|-------|-------------------|
| **1 - Annonce R√©seaux Sociaux** | ‚úÖ 4 champs | ‚úÖ Bouton Modifier | ‚ùå | ‚ùå | `File1.AnnonceReseaux.tsx`, `Hook-1-RecuperationDataReseaux.ts` |
| **2 - Personnaliser** | ‚úÖ URL + Photo | ‚úÖ Bouton Modifier | ‚ùå | ‚ùå | `File2.PersonnaliserReseaux.tsx`, `Hook-2-PersonnaliserUrlReseaux.tsx`, `Hook-2-PersonnaliserPhotoReseaux.tsx` |
| **3 - Utiliser l'annonce** | ‚ùå | ‚ùå | ‚úÖ 3 aper√ßus | ‚úÖ Texte + ‚è∏Ô∏è Zoho | `File3.ActionUtilisateurReseaux.tsx`, `Hook-3-UtiliserApercuReseaux.tsx`, `Hook-3-UtiliserCopierTexteReseaux.tsx`, `Hook-3-UtiliserZohoReseauxFonctionEnvoi.tsx` |

---

## XV. DONN√âES √Ä PRENDRE EN CONSID√âRATION

### 15.1. Points d'attention techniques

#### 1. Gestion des photos volumineuses

**Probl√©matique :**
- Photos stock√©es en base64 dans `localStorage`
- Taille moyenne : 100-300 KB par photo
- Limite `localStorage` : 5-10 MB selon navigateurs
- Risque de d√©passement si l'utilisateur stocke beaucoup de donn√©es

**Solution actuelle :**
```typescript
// Hook-2-PersonnaliserPhotoReseaux.tsx (lignes 24-86)
const resizeImageWithCanvas = async (file: File): Promise<string> => {
  const canvas = document.createElement('canvas');
  canvas.width = 1080;
  canvas.height = 566;

  // Dessin et compression JPEG √† 90%
  return canvas.toDataURL('image/jpeg', 0.9);
};
```

**Recommandations pour Supabase :**
- Utiliser **Supabase Storage** avec buckets d√©di√©s
- G√©n√©rer des **URLs sign√©es** temporaires (24h)
- Impl√©menter une compression c√¥t√© serveur (WebP)
- Ajouter un cache CDN pour les performances

#### 2. Absence de limitation de longueur des champs

**Probl√©matique :**
- Aucune validation `maxLength` sur les champs
- Risque de textes excessivement longs
- Probl√®mes d'affichage sur certains r√©seaux sociaux (Twitter : 280 chars, LinkedIn : 3000 chars)

**Comparaison avec le canal SMS :**
| Canal | Validation longueur | Compteur | Contraintes |
|-------|---------------------|----------|-------------|
| SMS | ‚úÖ 122 chars max | ‚úÖ Temps r√©el | GSM-7 uniquement |
| **R√©seaux Sociaux** | ‚ùå | ‚ùå | Aucune |

**Recommandations :**
- Ajouter un compteur de caract√®res optionnel
- Afficher des avertissements si > 280 chars (Twitter)
- Proposer une version "courte" et "longue" de l'annonce

#### 3. Syst√®me de polling toutes les 1 seconde

**Probl√©matique :**
- `setInterval(handleStorageChange, 1000)` tourne en permanence
- Consommation CPU/m√©moire continue
- Risque de d√©rive m√©moire si la page reste ouverte longtemps

**Code actuel :**
```typescript
// Hook-3-UtiliserApercuReseaux.tsx (lignes 48-50)
const interval = setInterval(handleStorageChange, 1000);
return () => {
  clearInterval(interval);
};
```

**Recommandations pour Supabase :**
- Utiliser **Supabase Realtime** avec LISTEN/NOTIFY
- √âcouter les changements directs de la base de donn√©es
- Supprimer le polling inefficace

#### 4. √âditeur WYSIWYG sans barre d'outils

**Situation actuelle :**
- `EditeurWYSIWYG.tsx` utilis√© avec `toolbar: false`
- Uniquement s√©lecteur d'emojis disponible
- Pas de formatage HTML possible

**Avantages :**
- ‚úÖ Simplicit√© d'utilisation
- ‚úÖ Pas de risque d'injection HTML
- ‚úÖ Adapt√© aux r√©seaux sociaux (texte brut)

**Inconv√©nients :**
- ‚ùå Impossible de mettre en gras, italique, listes
- ‚ùå Certains r√©seaux sociaux supportent le Markdown (Reddit, Discord)

**Recommandation :**
- Conserver l'approche actuelle pour la v1
- Proposer une option "Markdown" dans une future version

### 15.2. D√©pendances critiques

#### 1. D√©pendance stricte √† `localStorage`

**Fichiers concern√©s :**
- `Hook-1-RecuperationDataReseaux.ts` (lecture/√©criture annonce)
- `Hook-2-PersonnaliserUrlReseaux.tsx` (lecture/√©criture URL)
- `Hook-2-PersonnaliserPhotoReseaux.tsx` (lecture/√©criture photo base64)
- `Hook-3-UtiliserApercuReseaux.tsx` (√©coute `storage` event)

**Risques :**
- ‚ùå Donn√©es perdues si `localStorage` est vid√© (navigation priv√©e, nettoyage navigateur)
- ‚ùå Pas de synchronisation multi-appareils
- ‚ùå Pas de versioning ou rollback possible
- ‚ùå Pas d'audit trail des modifications

**Migration Supabase recommand√©e :**
```sql
-- Table pour les annonces R√©seaux Sociaux originales (OpenAI)
CREATE TABLE annonces_reseaux_original (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  titre TEXT NOT NULL,
  accroche TEXT NOT NULL,
  points_forts TEXT NOT NULL,
  appel_action TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Table pour les modifications utilisateur
CREATE TABLE annonces_reseaux_modifications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  annonce_original_id UUID REFERENCES annonces_reseaux_original(id) ON DELETE CASCADE,
  titre TEXT,
  accroche TEXT,
  points_forts TEXT,
  appel_action TEXT,
  url_annonce TEXT,
  photo_url TEXT, -- URL Supabase Storage
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Table pour les publications R√©seaux Sociaux
CREATE TABLE publications_reseaux (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  annonce_id UUID REFERENCES annonces_reseaux_modifications(id) ON DELETE CASCADE,
  plateforme TEXT, -- 'Facebook', 'LinkedIn', 'Twitter', etc.
  statut TEXT DEFAULT 'brouillon', -- 'brouillon', 'programm√©', 'publi√©'
  date_publication TIMESTAMPTZ,
  zoho_campaign_id TEXT, -- ID campagne Zoho Social
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 2. D√©pendance √† l'int√©grit√© des cl√©s OpenAI

**Mapping critique :**
```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 52-56)
setAnnonceReseaux({
  titre: cleanOpenAIContent(dataOriginales.TitreAnnonceReseaux),
  accroche: cleanOpenAIContent(dataOriginales.AccrocheImpactanteAnnonceReseaux),
  pointsForts: cleanOpenAIContent(dataOriginales.AtoutsAnnonceReseaux),
  appelAction: cleanOpenAIContent(dataOriginales.CtaAnnonceReseaux)
});
```

**Risques :**
- Si OpenAI change les cl√©s JSON ‚Üí rupture de l'application
- Si le format de r√©ponse change ‚Üí parsing √©chou√©
- Si le prompt est modifi√© ‚Üí contenu non conforme attendu

**Recommandations :**
- Ajouter des tests de validation du format de r√©ponse OpenAI
- Impl√©menter un fallback avec des valeurs par d√©faut
- Logger les erreurs de parsing pour d√©tecter les changements

#### 3. D√©pendance √† la fonction `cleanOpenAIContent()`

**Code critique :**
```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 10-18)
function cleanOpenAIContent(text: string): string {
  if (!text) return '';
  return text
    .replace(/\\n/g, '\n')      // Correction sauts de ligne
    .replace(/\\\\/g, '\\');    // Correction backslashes
}
```

**Point d'attention :**
- Cette fonction suppose que OpenAI retourne des `\\n` √©chapp√©s
- Si OpenAI change son format de sortie, cette fonction devient obsol√®te ou incorrecte
- Aucun test unitaire pour v√©rifier la robustesse

**Recommandations :**
- Ajouter des tests unitaires pour `cleanOpenAIContent()`
- V√©rifier si OpenAI retourne r√©ellement des `\\n` ou si c'est un artefact de `JSON.parse()`
- Envisager une fonction plus robuste avec d√©tection automatique du format

### 15.3. Fonctions cl√©s √† pr√©server

#### 1. `updateAnnonceReseaux()` - Sauvegarde automatique

**Fichier :** `Hook-1-RecuperationDataReseaux.ts` (lignes 66-73)

**Fonction critique :**
```typescript
const updateAnnonceReseaux = (nouvellesDonnees: Partial<AnnonceReseauxData>) => {
  setAnnonceReseaux(prev => {
    const updated = { ...prev, ...nouvellesDonnees };
    localStorage.setItem('key-modifs-diffuser-reseaux-sociaux-annonce', JSON.stringify(updated));
    return updated;
  });
};
```

**Importance :**
- ‚úÖ Sauvegarde imm√©diate √† chaque modification
- ‚úÖ Fusion des donn√©es partielles avec l'√©tat existant
- ‚úÖ Synchronisation √©tat React + localStorage

**Migration Supabase :**
```typescript
const updateAnnonceReseaux = async (nouvellesDonnees: Partial<AnnonceReseauxData>) => {
  setAnnonceReseaux(prev => ({ ...prev, ...nouvellesDonnees }));

  // √âcriture en base de donn√©es
  const { error } = await supabase
    .from('annonces_reseaux_modifications')
    .upsert({
      user_id: user.id,
      ...nouvellesDonnees,
      updated_at: new Date().toISOString()
    });

  if (error) {
    console.error('Erreur sauvegarde:', error);
    toast({ title: "Erreur", description: "Impossible de sauvegarder", variant: "destructive" });
  }
};
```

#### 2. `processAndStorePhoto()` - Redimensionnement photo

**Fichier :** `Hook-2-PersonnaliserPhotoReseaux.tsx` (lignes 88-110)

**Fonction critique :**
```typescript
const processAndStorePhoto = async (file: File) => {
  setPhotoData(prev => ({ ...prev, isProcessing: true }));

  try {
    const base64Image = await resizeImageWithCanvas(file);
    localStorage.setItem('key-modifs-photo-annonce-reseaux-sociaux', base64Image);
    setPhotoData({ photoUrl: base64Image, isProcessing: false });
  } catch (error) {
    console.error('Erreur traitement photo:', error);
    setPhotoData(prev => ({ ...prev, isProcessing: false }));
  }
};
```

**Importance :**
- ‚úÖ Redimensionnement automatique en 1080x566 (format R√©seaux Sociaux)
- ‚úÖ Compression JPEG √† 90% pour optimiser la taille
- ‚úÖ Gestion de l'√©tat `isProcessing` pour l'UX

**Migration Supabase :**
```typescript
const processAndStorePhoto = async (file: File) => {
  setPhotoData(prev => ({ ...prev, isProcessing: true }));

  try {
    // 1. Redimensionner l'image
    const resizedBlob = await resizeImageToBlob(file, 1080, 566);

    // 2. Upload vers Supabase Storage
    const fileName = `${user.id}/${Date.now()}.jpg`;
    const { data: uploadData, error: uploadError } = await supabase.storage
      .from('annonces-photos')
      .upload(fileName, resizedBlob);

    if (uploadError) throw uploadError;

    // 3. R√©cup√©rer l'URL publique
    const { data: urlData } = supabase.storage
      .from('annonces-photos')
      .getPublicUrl(fileName);

    // 4. Sauvegarder l'URL en base de donn√©es
    await supabase
      .from('annonces_reseaux_modifications')
      .update({ photo_url: urlData.publicUrl })
      .eq('user_id', user.id);

    setPhotoData({ photoUrl: urlData.publicUrl, isProcessing: false });
  } catch (error) {
    console.error('Erreur upload photo:', error);
    setPhotoData(prev => ({ ...prev, isProcessing: false }));
    toast({ title: "Erreur", description: "Impossible d'uploader la photo", variant: "destructive" });
  }
};
```

#### 3. `construireTexteReseaux()` - Formatage copie

**Fichier :** `Hook-3-UtiliserCopierTexteReseaux.tsx` (lignes 43-58)

**Fonction critique :**
```typescript
const construireTexteReseaux = (): string => {
  const annonceReseaux = recupererAnnonceReseaux().trim();
  const urlAnnonce = recupererUrlAnnonce().trim();

  let texteFinal = '';

  // Ajouter l'annonce R√©seaux Sociaux avec ses sauts de ligne
  if (annonceReseaux) {
    texteFinal += annonceReseaux;
  }

  // Ajouter double saut de ligne puis l'URL
  if (urlAnnonce) {
    if (texteFinal) {
      texteFinal += '\n\n'; // Double saut de ligne
    }
    texteFinal += urlAnnonce;
  }

  return texteFinal;
};
```

**Importance :**
- ‚úÖ Assemblage correct de toutes les sections avec double saut de ligne
- ‚úÖ Gestion des cas o√π certaines sections sont vides
- ‚úÖ Format optimis√© pour les r√©seaux sociaux

**√Ä pr√©server lors de la migration :**
- Structure exacte de formatage (`\n\n` entre sections)
- Ordre de pr√©sentation (Titre ‚Üí Accroche ‚Üí Points Forts ‚Üí Appel Action ‚Üí URL)
- Gestion des valeurs vides (`filter(Boolean)`)

### 15.4. Mapping OpenAI ‚Üí Interface

**Tableau de correspondance :**

| Champ OpenAI (JSON) | Champ Interface (TypeScript) | Transformation | Fichier | Ligne |
|---------------------|------------------------------|----------------|---------|-------|
| `TitreAnnonceReseaux` | `titre` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts` | 53 |
| `AccrocheImpactanteAnnonceReseaux` | `accroche` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts` | 54 |
| `AtoutsAnnonceReseaux` | `pointsForts` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts` | 55 |
| `CtaAnnonceReseaux` | `appelAction` | `cleanOpenAIContent()` | `Hook-1-RecuperationDataReseaux.ts` | 56 |

**Point cl√© :** Contrairement au canal Site Internet qui mappe `cta` ‚Üí `appelAction` via une fonction d√©di√©e, le canal R√©seaux Sociaux effectue un mapping direct sans transformation de nom de champ.

**Fonction `cleanOpenAIContent()` :**
```typescript
// Hook-1-RecuperationDataReseaux.ts (lignes 10-18)
function cleanOpenAIContent(text: string): string {
  if (!text) return '';
  return text
    .replace(/\\n/g, '\n')      // Correction des sauts de ligne √©chapp√©s
    .replace(/\\\\/g, '\\');    // Correction des backslashes doubles
}
```

**Exemple de transformation :**

**Donn√©es OpenAI (JSON brut) :**
```json
{
  "TitreAnnonceReseaux": "üåü RESTAURANT √Ä VENDRE ‚Äì PARIS 11e",
  "AccrocheImpactanteAnnonceReseaux": "Emplacement premium en angle, rare √† la vente.\\n\\nAffaire en angle id√©alement situ√©e...",
  "AtoutsAnnonceReseaux": "Les Atouts du bien\\n\\n‚òëÔ∏è Emplacement Premium...",
  "CtaAnnonceReseaux": "Int√©ress√©(e) ?\\nüìû Contactez-nous..."
}
```

**Apr√®s `cleanOpenAIContent()` :**
```typescript
{
  titre: "üåü RESTAURANT √Ä VENDRE ‚Äì PARIS 11e",
  accroche: "Emplacement premium en angle, rare √† la vente.\n\nAffaire en angle id√©alement situ√©e...",
  pointsForts: "Les Atouts du bien\n\n‚òëÔ∏è Emplacement Premium...",
  appelAction: "Int√©ress√©(e) ?\nüìû Contactez-nous..."
}
```

**Point d'attention pour la migration Supabase :**
- ‚úÖ Conserver la fonction `cleanOpenAIContent()` pour nettoyer les donn√©es OpenAI
- ‚úÖ Appliquer cette transformation **avant** de stocker en base de donn√©es
- ‚úÖ √âviter de stocker des `\\n` √©chapp√©s dans Postgres (stocker directement des sauts de ligne r√©els)



---

```
