# Stratégie – Phase FormCreation

## Objectif
Encadrer la création des formulaires (ex. `FormReseauCreation`) afin d’éviter incohérences et erreurs de mapping avec Supabase.

---

## Vérifications préalables
Avant tout codage :  
- Vérifier les tables stratégiques dans Supabase :  
  - `users`  
  - `utilisateurs`  
  - `organisations`  
  - la table métier concernée (`reseau`, `reseau_direction`, etc.)  
- Vérifier la référence des champs (orthographe exacte, types, contraintes).  

**Interdit :** inventer de nouveaux champs ou variantes orthographiques.

---

## Identification des informations indispensables
Toujours identifier les champs minimums obligatoires pour la création :  
- Identité organisationnelle (ex. réseau : `reseau_nom`, `reseau_siret`, `adresse`, `code_postal`, `ville`)  
- Identité personnelle du responsable (ex. direction réseau : `nom`, `prenom`, `email`, `telephone`)  
- Liens multi-tenant : `organisation_id`, `reseau_id`, `users_auth_id`

---

## Mapping explicite
- Chaque champ du formulaire doit être mappé à une colonne existante dans Supabase.  
- Les noms utilisés dans `formData` doivent être cohérents avec le mapping du `tableMapping`  
  - Pas de `nomOrganisation` si la colonne est `reseau_nom`.  
- Pour éviter les erreurs :  
  - Respecter le fichier **TablesReference** de la table.  
  - Vérifier que les champs auto-remplis (`statut`, `type_compte`) sont bien dans `autoFields`.

---

## Règles à respecter
- Cascade de création :  
  - Créer `organisations`  
  - Créer la table métier (ex. `reseau`)  
  - Créer `users`  
  - Créer `utilisateurs`  
  - Créer l’entité liée (ex. `reseau_direction`)  
- Audit fields (`created_by`, `updated_by`) → injecter `auth.uid()` automatiquement.  
- Validation :  
  - Utiliser des schémas robustes (**Zod recommandé**) plutôt que des regex éparses.  
- Pas de doublons d’infos :  
  - Les infos organisationnelles → table `reseau`.  
  - Les infos personnelles → table `direction_reseau` + `users/utilisateurs`.  
  - Exemple : email/téléphone = responsable, pas répétés comme “email réseau” au moment de la création.

---

## Limites à ce stade
- Ne pas coder le hook complet tout de suite.  
- Objectif = préparer le terrain :  
  - Tables validées  
  - Champs indispensables listés  
  - Mapping clair  
  - Validation définie  
- Le hook (`useCreationCompte`) sera ajouté **après validation du formulaire**.

---

## Résumé
- Vérifier tables existantes et contraintes.  
- Identifier champs indispensables.  
- Établir mapping sans erreurs d’orthographe.  
- Respecter séparation organisationnelle / personnelle.  
- Préparer validation et `autoFields`.  
- Ne pas coder le hook tant que le mapping n’est pas validé.
