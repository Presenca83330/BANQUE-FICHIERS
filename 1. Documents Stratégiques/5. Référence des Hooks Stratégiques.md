# 📌 Référence des Hooks Stratégiques – LeadGenAi

## 🔐 N1 – useAuth
**Rôle :** Gère uniquement l’authentification Supabase.
- Connexion email/password.
- Connexion Google (sans signup).
- Déconnexion.
- Gestion centralisée des erreurs.
- État session (user, loading, error).

**Fichiers :**
- `authMessages.ts` → mappe les erreurs d’authentification en messages clairs.
- `authTypes.ts` → contient `AuthUser`, `AuthSession`, `AuthResponse`, `AuthResult`.
- `useAuth.ts` → hook principal (login/logout/Google Auth, session).

**Dépendances :** `@/integrations/supabase/client`

---

## 👤 N2 – useCurrentUser
**Rôle :** Source de vérité sur le profil utilisateur enrichi.
- Charge d’abord `utilisateurs` (profil métier).
- Enrichit avec `users` (profil système).
- Vérifie statut actif (bloque inactifs/suspendus).
- Retourne un `CurrentUser` complet.

**Fichiers :**
- `helpers.ts` → utilitaires (normalizeEmail, isAdminPresenca, etc.).
- `types.ts` → contient `CurrentUser` (aligné DB).
- `useCurrentUser.ts` → hook principal (profil enrichi, reload, erreurs).

**Dépendances :** `@/integrations/supabase/client`

---

## 🏢 N3 – useMultiTenant
**Rôle :** Décide des redirections post-login.
- Vérifie statut utilisateur et organisation.
- Routes définies :
  - `admin_presenca` / `superadmin` → `/admin-presenca`
  - `reseau` / `reseau_direction` → `/espace-reseau`
  - autres → `/accueil-leadgenai`
- Fallback → `/login`.

**Fichiers :**
- `useMultiTenant.ts` → hook principal (getPostLoginRoute).

**Dépendances :** `useCurrentUser`

---

## ⚙️ N4 – useSupabaseOperations
**Rôle :** Fournit une API CRUD générique sécurisée.
- `select` → lecture multi-tenant.
- `insert` → ajoute automatiquement organisation_id.
- `update` → sécurisé, vérifie statut actif.
- `remove` → suppression sécurisée.
- Gestion centralisée des erreurs.

**Fichiers :**
- `errors.ts` → mappe erreurs DB (RLS, permissions, org).
- `helpers.ts` → utilitaires (isEmpty, isSuspended, etc.).
- `tableMapping.ts` → mapping front → tables Supabase (toutes les tables de la base doivent être listées).
- `types.ts` → contient `OperationResult<T>`.
- `useSupabaseOperations.ts` → hook principal (CRUD générique).

**Dépendances :** `useCurrentUser`, `@/integrations/supabase/client`

---

# ✅ Vue d’ensemble
- **useAuth** → gère la connexion/déconnexion uniquement.
- **useCurrentUser** → construit l’utilisateur enrichi (pivot métier).
- **useMultiTenant** → décide de la route post-login.
- **useSupabaseOperations** → centralise toutes les opérations DB multi-tenant.

Chaque hook est simple, spécialisé, et validé ✅ pour une architecture **production-ready**.

