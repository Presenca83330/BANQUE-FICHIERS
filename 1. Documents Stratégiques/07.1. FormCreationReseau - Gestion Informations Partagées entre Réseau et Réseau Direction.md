# 7.1.1. StratÃ©gie â€“ Gestion des informations partagÃ©es entre RÃ©seau et RÃ©seau Direction dans le Formulaire de CrÃ©ation 
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau/2.FormReseauCreation.tsx
  

## ğŸ¯ Contexte
Dans ton modÃ¨le actuel, deux entitÃ©s sont intimement liÃ©es :
- **Table `reseau`** : reprÃ©sente lâ€™entitÃ© juridique / organisationnelle du rÃ©seau (raison sociale, SIRET, adresse, etc.).
- **Table `reseau_direction`** : reprÃ©sente la **personne responsable** du rÃ©seau (nom, prÃ©nom, email, tÃ©lÃ©phone).

Lors de la crÃ©ation dâ€™un rÃ©seau, il est obligatoire de crÃ©er **simultanÃ©ment** :
1. Lâ€™organisation (dans `organisations`).
2. Le rÃ©seau (`reseau`).
3. Le responsable du rÃ©seau (`reseau_direction` + entrÃ©e `users` + entrÃ©e `utilisateurs`).

## ğŸ“Œ Infos partagÃ©es
Certains champs apparaissent comme Â« doublons Â» si on ne fait pas attention :

| Champ                | OÃ¹ il doit Ãªtre stockÃ© | Pourquoi |
|-----------------------|------------------------|----------|
| **Nom du rÃ©seau**     | `reseau.reseau_nom` + `organisations.organisation_nom` | IdentitÃ© de lâ€™entitÃ© juridique. |
| **SIRET**             | `reseau.reseau_siret` | SpÃ©cifique au rÃ©seau. |
| **Adresse, CP, Ville**| `reseau.reseau_adresse`, `reseau.reseau_code_postal`, `reseau.reseau_ville` | DonnÃ©es de localisation de lâ€™entitÃ©. |
| **Nom responsable**   | `users_nom`, `reseau_direction.nom` | IdentitÃ© du directeur. |
| **PrÃ©nom responsable**| `users_prenom`, `reseau_direction.prenom` | Idem. |
| **Email responsable** | `users_email`, `utilisateur_email` | Sert aussi dâ€™auth Supabase. |
| **TÃ©lÃ©phone responsable** | `users_telephone` | Contact direct du directeur. |

ğŸ‘‰ **Conclusion** :  
- Les infos **organisationnelles** (nom rÃ©seau, adresse, SIRET) restent dans `reseau`.  
- Les infos **personnelles** (nom, prÃ©nom, email, tÃ©lÃ©phone) restent dans `reseau_direction` + `users` + `utilisateurs`.  

## ğŸš¨ Risque identifiÃ©
Si le formulaire demande sÃ©parÃ©ment **email rÃ©seau** et **email responsable**, lâ€™admin peut saisir deux valeurs diffÃ©rentes â†’ incohÃ©rence.  
Idem pour tÃ©lÃ©phone.

## âœ… Solution retenue
- **Formulaire de crÃ©ation unique** (FormReseauCreation) :
  - Nom rÃ©seau + SIRET + adresse â†’ `reseau`.
  - Nom/prÃ©nom/email/tÃ©lÃ©phone responsable â†’ `reseau_direction` (et automatiquement `users` + `utilisateurs`).
- Pas de champ **email rÃ©seau** ou **tÃ©lÃ©phone rÃ©seau** sÃ©parÃ© au moment de la crÃ©ation : on considÃ¨re que le contact principal = directeur du rÃ©seau.
- Si plus tard on veut ajouter un **email gÃ©nÃ©rique du rÃ©seau** (ex. contact@reseau.com), ce sera un champ optionnel dans `reseau`, gÃ©rÃ© via la page de gestion, pas Ã  la crÃ©ation.

## ğŸ› ï¸ ImplÃ©mentation
1. **Mapping des champs dans le hook `useCreationCompte`** :
   - `nomReseau`, `siret`, `adresse`, `codePostal`, `ville` â†’ table `reseau`.
   - `nomResponsable`, `prenomResponsable`, `emailResponsable`, `telephoneResponsable` â†’ table `reseau_direction` + `users` + `utilisateurs`.
2. **Formulaire** :
   - Champs prÃ©sentÃ©s dans lâ€™ordre logique pour lâ€™admin.
   - PrÃ©headers pour clarifier : (Raison sociale), (Nom Direction RÃ©seau), etc.
3. **Hooks** :
   - Lors de la soumission â†’ crÃ©ation en cascade :
     1. Organisation â†’ 2. RÃ©seau â†’ 3. User/Utilisateur â†’ 4. Reseau_Direction.
   - ReliÃ©s par `organisation_id` et `reseau_id`.

## ğŸ“Š Avantages
- Ã‰vite les doublons.
- CohÃ©rence multi-tenant respectÃ©e (chaque user liÃ© Ã  son rÃ©seau et organisation).
- Clarifie pour lâ€™admin la distinction entre **identitÃ© juridique du rÃ©seau** et **identitÃ© personnelle du directeur**.
- Ã‰volutif : possibilitÃ© dâ€™ajouter un **email gÃ©nÃ©rique rÃ©seau** plus tard.

---
## ğŸ“Œ Gestion des coordonnÃ©es (email & tÃ©lÃ©phone) lors de la crÃ©ation dâ€™un rÃ©seau
Lors de la **crÃ©ation initiale dâ€™un rÃ©seau**, il est obligatoire dâ€™associer immÃ©diatement un utilisateur humain qui incarne ce rÃ©seau â†’ câ€™est le **Directeur de RÃ©seau (reseau_direction)**.  
Ce directeur doit exister dÃ¨s le dÃ©part car **Supabase Auth** exige quâ€™au moins un compte utilisateur actif soit crÃ©Ã© pour rattacher lâ€™organisation. 
Sans cela, on aurait une organisation sans utilisateur connectÃ©, ce qui est bloquant.

ğŸ‘‰ Par consÃ©quent :  
- Les champs **email** et **tÃ©lÃ©phone** saisis dans le formulaire de crÃ©ation rÃ©seau sont utilisÃ©s Ã  la fois comme :  
  - **coordonnÃ©es contractuelles du rÃ©seau** (stockÃ©es dans la table `reseau`),  
  - **coordonnÃ©es personnelles du directeur** (stockÃ©es dans `reseau_direction` + `users` + `utilisateurs`).  
- Lors de la crÃ©ation, ces deux ensembles de donnÃ©es sont initialisÃ©s avec **la mÃªme valeur**, afin dâ€™assurer la cohÃ©rence.

### Vision simplifiÃ©e
- **RÃ©seau** = entitÃ© contractuelle  
- **RÃ©seau Direction** = lâ€™utilisateur humain qui incarne ce rÃ©seau et qui a signÃ© avec PrÃ©senÃ§a 
- Les deux sont liÃ©s et partagent le mÃªme espace applicatif (**RESEAU-ESPACE**).  
ğŸ‘‰ Donc :  
- Email / TÃ©lÃ©phone = coordonnÃ©es contractuelles du rÃ©seau, incarnÃ©es par son directeur.  
- Un seul formulaire suffit Ã  la crÃ©ation â†’ pas besoin dâ€™entretenir deux flux distincts.  

### ModÃ¨le opÃ©rationnel
- **CrÃ©ation RÃ©seau**  
  - Lâ€™admin saisit un email et un tÃ©lÃ©phone.  
  - Ces valeurs sont stockÃ©es dans `reseau`.  
  - Elles sont automatiquement rÃ©pliquÃ©es dans `reseau_direction` pour crÃ©er le compte utilisateur Auth.  

- **Gestion RÃ©seau (formulaire commun)**  
  - Si lâ€™email ou le tÃ©lÃ©phone du rÃ©seau est modifiÃ©, la mise Ã  jour est automatiquement propagÃ©e vers `reseau_direction`.  
  - Le formulaire RÃ©seau devient le **point de vÃ©ritÃ© unique**.  

- **Gestion RÃ©seau Direction**  
  - Pas de modification possible sur email et tÃ©lÃ©phone â†’ les champs sont en lecture seule cÃ´tÃ© Direction.  
  - Le directeur peut les consulter mais ne peut pas les changer indÃ©pendamment.  


---
# 7.1.2. StratÃ©gie â€“ Gestion des informations partagÃ©es entre RÃ©seau et RÃ©seau Direction dans le Formulaire de Gestion 
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau/3.FormReseauGestion.tsx
