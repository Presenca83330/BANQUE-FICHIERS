
# ğŸ§  Brief de Programmation PRO â€“ Formulaire Agence IndÃ©pendante

---

## ğŸ¯ Mission

**Expert IA no code â€“ IntÃ©gration Supabase / Lovable**,  
tu es chargÃ© de concevoir lâ€™ensemble des fichiers, fonctions, hooks et SQL nÃ©cessaires au **formulaire de la table `agence_independante`**, en tâ€™appuyant sur la mÃªme structure que le formulaire `reseau`.

Tu disposes de toutes les ressources de rÃ©fÃ©rence :  
- `Documents-StratÃ©giques-LeadGenAI.AdBuilder.zip`  
- `001.FormCreateurReseau.DossierCrucial.zip`  
- `002.FormGestionReseau.DossierCrucial.zip`  
- `003.FormCreateurGestion.DossierCrucial.zip`  
- `004.FichiersPrÃ©paratoiresFormAgenceIndependante.zip`

---

## ğŸ§­ Ã‰tape 1 â€” Analyse prÃ©alable

Relis et analyse toutes les informations stratÃ©giques utilisÃ©es pour concevoir le formulaire `reseau`, avec ses 3 pages :
- **Accueil**
- **CrÃ©ation**
- **Gestion** (avec ses onglets GÃ©nÃ©ral, IntÃ©grations, Fichiers)
  - Documents-StratÃ©giques-LeadGenAI.AdBuilder.zip
  - 001.FormCreateurReseau.DossierCrucial.ziphttps://github.com/Presenca83330/BANQUE-FICHIERS/blob/main/V%20-%20R%C3%A9activation%20Open%20AI/2.%20InitialisationCreationFichierTable.md
  - 002.FormGestionReseau.DossierCrucial.zip
  - 003.FormCreateurGestion.DossierCrucial.zip
Tu dois tâ€™en inspirer pour concevoir la table `agence_independante` selon le mÃªme modÃ¨le structurel, logique et graphique.

---

## ğŸ§± Ã‰tape 2 â€” Conception fonctionnelle.

### 1. Formulaire de **crÃ©ation**

- CrÃ©ation simultanÃ©e des tables :  
  `users`, `utilisateur`, `organisation`, `agence_independante`.
- Application du **mÃªme modÃ¨le que pour `reseau`** :
  - **Propagation automatique** vers `agence_independante_responsable` pour les champs `email` et `telephone`.
  - **Service Role Key** pour bypass RLS (mÃªme logique `verify_jwt=false` dans `config.toml`).
  - Gestion du mot de passe via composant `SuccessAccountInfo.tsx` (affichage du lien dâ€™accÃ¨s / magic link).
- Respect du **cascade process** :
  1. Organisation â†’  
  2. Agence â†’  
  3. User/Auth â†’  
  4. Utilisateur â†’  
  5. Responsable agence.
- Structure des EF :  
  `supabase/functions/create-agence-independante-admin/index.ts`

---

### 2. Formulaire de **gestion**

#### Structure gÃ©nÃ©rale
MÃªme architecture que `reseau`, mais avec **4 onglets** :
1. **GÃ©nÃ©ral**
2. **Abonnement**
3. **IntÃ©grations** (Brevo, Zoho, OpenAI, LinkedIn, Facebook, Instagram)
4. **Fichiers**

#### ğŸ”¹ Onglet GÃ©nÃ©ral
- Mise Ã  jour de la table `agence_independante`.
- Propagation automatique vers `agence_independante_responsable` pour `email` et `telephone`.
- Respect du pattern `{ success, data, message }`.

#### ğŸ”¹ Onglet Abonnement *(nouveautÃ©)*
- Pour lâ€™instant, ne comporte que **2 champs en lecture seule** :
  - `Plan dâ€™abonnement` (affiche `abonnement_stripe_plan` ou â€œAucunâ€ si null),
  - `Date de dÃ©but dâ€™abonnement` (affiche `abonnement_stripe_debut` ou vide).
- Ces champs lisent la table `abonnement_stripe`.
- Aucun lien Stripe actif pour le moment.
- PrÃ©voir un **cadre extensible** permettant plus tard :
  - la sÃ©lection dâ€™un plan,
  - la crÃ©ation / mise Ã  jour dâ€™un abonnement via EF Stripe,
  - la synchronisation automatique des donnÃ©es (`last_synchro`, `statut`, `paiement`).
- Fichiers et hooks Ã  prÃ©voir :
  - `useAbonnementStripeView.ts` (lecture seule),
  - Dossier futur `/4.OngletAbonnement/` (structure prÃªte Ã  accueillir les EF Stripe).

#### ğŸ”¹ Onglet IntÃ©grations
- 6 intÃ©grations prÃ©vues : Brevo, Zoho, OpenAI, LinkedIn, Facebook, Instagram.
- MÃªmes EF et hooks que pour `reseau`, en adaptant les noms et tables.
- Gestion via `agence-independante-admin-update`.

#### ğŸ”¹ Onglet Fichiers
- TÃ©lÃ©versement / suppression via EF :
  `agence-independante-admin-fichiers`.
- Respect du **mapping normÃ©** :
  - `bucket-table-agence-independante/agence-{uuid}/1-logos/...`
  - `bucket-table-agence-independante/agence-{uuid}/2-documents-institutionnels/...`
- MAJ DB :
  - `_logo` â†’ chemin unique vers le logo principal,
  - `_ressources` â†’ tableau des chemins vers les documents.

#### âš™ï¸ Hooks et EF
- Hooks :  
  `useAgenceIndependanteFormData.ts`,  
  `useAgenceIndependanteIntegrations.ts`.
- EF :  
  - `gestion-agence-independante-admin/index.ts`  
  - `gestion-agence-independante-admin-donnees/index.ts`  
  - `gestion-agence-independante-admin-update/index.ts`  
  - `gestion-agence-independante-admin-fichiers/index.ts`

### 3. Respect de la structure graphique
- Il faudra impÃ©rativemetn conserver le graphisme existant
- Il a ete prÃ©parÃ© dans le fichier prÃ©paratoire : 004.FichiersPrÃ©paratoiresFormAgenceIndependante.zip
- Suaf nÃ©cesstiÃ© absolue, tu ne modifiera pas les noms des titres, champs preholder

### 4. Respect du nomming et du maping des tables
- Il faudra impÃ©rativement veiller Ã  respecter le cnom des chmamps des tables
- Ils sont prÃ©sents tu n as pas Ã  crÃ©er de nouveaux champs pour toutes les tables : users, utilisateur, organisation ,agence independante et agence indepedantez responsable et les tables de connexion
- Tu retrouvers toutes les tÃ©bles dans le fichier prÃ©paratoire : 004.FichiersPrÃ©paratoiresFormAgenceIndependante.zip

---

## ğŸ—‚ï¸ Ã‰tape 3 â€” Emplacements des fichiers

### ğŸ“ Frontend
**Fichiers :**  
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/1.FormAgenceIndependanteAccueil.tsx
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/2.FormAgenceIndependanteCreation.tsx
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/3.FormAgenceIndependanteGestion.tsx
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/SuccessAccountInfo.tsx

**Hooks CrÃ©ation :**  
- src/components/HOOKS-STRATEGIQUE/5.HOOKS-CreationCompteAdminPresenca/6.AgenceIndependante/types.ts
- src/components/HOOKS-STRATEGIQUE/5.HOOKS-CreationCompteAdminPresenca/6.AgenceIndependante/useAgenceIndependanteCreation.ts

**Hooks Gestion :**  
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/types.ts
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/useAbonnementStripeView.ts
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/useAgenceIndependanteFormData.ts
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/useAgenceIndependanteIntegrations.ts

**Composants Gestion :**  
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/components/AgenceIndependanteSelector.tsx

---

### ğŸ“ Backend (Edge Functions)
`supabase/functions/`  
- supabase/functions/create-agence-independante-admin/index.ts
- supabase/functions/gestion-agence-independante-admin/index.ts
- supabase/functions/gestion-agence-independante-admin-donnees/index.ts
- supabase/functions/gestion-agence-independante-admin-fichiers/index.ts
- supabase/functions/gestion-agence-independante-admin-update/index.ts

Respecter le naming exact et la structure EF du modÃ¨le `reseau`.

---

## ğŸ§© Ã‰tape 4 â€” Bonnes pratiques gÃ©nÃ©rales

- **Service Role Key obligatoire** pour toutes les EF (jamais exposÃ©e cÃ´tÃ© front).  
- **Frontend** : clÃ© **ANON** uniquement.  
- **Contrats de retour uniformisÃ©s** `{ success, data, message }`.  
- **Logs structurÃ©s** (`requestId`, `duration_ms`, `event`).  
- **Charte graphique** : interdiction de modifier la mise en page (labels, placeholders, styles).  
- **AtomicitÃ©** : toutes les EF doivent rollback en cas dâ€™erreur partielle.  
- **RÃ©plication** `agence_independante` â†’ `agence_independante_responsable` obligatoire pour `email` et `telephone`.

---

## ğŸ§  Ã‰tape 5 â€” Ressources Ã  analyser

- `Documents-StratÃ©giques-LeadGenAI.AdBuilder.zip`
- `TablesReferenceAgenceIndependante.ts`
- `004.FichiersPrÃ©paratoiresFormAgenceIndependante.zip`
- Hooks Supabase (`useAuth`, `useCurrentUser`, `useMultiTenant`, `useSupabaseOperations`)
- `2.INTEGRATION SUPABASE.zip`

---

ğŸ“Œ **But final :** disposer dâ€™un formulaire complet â€œAgence IndÃ©pendanteâ€ avec un socle fonctionnel identique Ã  celui du `reseau`,  
pour faire fonctionneer les pages
1.FormAgenceIndependanteAccueil.tsx
2.FormAgenceIndependanteCreation.tsx
3.FormAgenceIndependanteGestion.tsx
SuccessAccountInfo.tsx

