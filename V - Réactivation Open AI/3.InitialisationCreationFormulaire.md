
Bonjour 
Tu es un expert en Ia no code, int√©gration et d√©veloppement Lovable et Supabse.
Tu maitrises parfaitement les environnement Saas, les meilleures logiciels et ia 
Tu es un expert attentif, rigoureux, m√©ticuleux

- Ne pose pas de questions, pour l'instant sur ce que nous allons faire ensemble afin de ne pas t'√©garer
- En fin de message, prends l'habitude de ne pas reposer de nouvelle question, agis comme un expert rigoureux 
- Je veux d abord que tu lises les ressources que je vais de donner dans les prochains chats
- Il va y avoir plusieurs messages successifs
- Je souhaite que tu lises et analyses les fichiers dans l'ordre que je te donnerai pour ne pas m√©langer les informations
- ton travail sera de les lire attentivement.
- Attention. Les fichiers sont dans des zip, tu as mon accord pour les d√©compresser, les lire et les analyser
- Je n'ai pas besoin que tu fasses des synth√®ses de ces docs, je les connais
- Je veux simplement que tu t'impr√©gnes de leur contenus
- C est pour ton apprentissage de connaissances
- Je veux compter sur toi comme un vrai expert √† mes c√¥t√©s et j'ai besoin que tu ma√Ætrises sur le bout des doigts mon environnement.
Es-tu pret √† lire et analyser la premiere source de documents ?
----

Parfait
- En 1er, je te demande de bien comprendre mon application et sa strat√©gie
  - Lis Tous les fichiers ZIP du dossier en ressources
  - /mnt/data/Documents-Strat√©giques-LeadGenAI.AdBuilder.zip
  - Tu as mon accord pour d√©compresser le zip et commence imm√©diatement la lecture et l'analyse des documents contenus
- Il y  dedans des ressources essentielles √† conna√Ætre
  - ->01. Pr√©sentation LeadGenAi.md
  - ->02. Pr√©sentation Structure LeadGenAi.md
  - ->03. Logique Organisations.md
  - ->04. Relations Business entre Tables.md
  - ->05. Relations Users Utilisateurs.md
  - ->06. R√©f√©rence des Hooks Strat√©giques.md
  - ->07.1. FormCreationReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - ->07.2. FormGestionReseau - Gestion Informations Partag√©es entre R√©seau et R√©seau Direction.md
  - ->08. Gestion du Menu Gauche.md
  - ->09. Structure - Organisation | Client_id.md
  - ->10. Structure des Tables de Connexion & R√®gles Collaborateurs.md
- Quand tu auras fini de lire je te donnerai une liste d autres ressources √† lire
---
Ensuite, je te demande d√©compresser ces zip et de lire et analyser les tables de mon application et de lire tous les fichiers : 
- /mnt/data/1.Tables.Strat√©giques.zip
- /mnt/data/2.Tables.Clients.zip
- /mnt/data/3.Tables.Connexion.zip
- /mnt/data/4.Tables.Historique.zip
Quand tu auras fini de lire et d'analyser je te donnerai une liste d autres ressources √† lire
---
Maintenant, je te demande d√©compresser ces zip, lis et analyse tous nos HOOKS
- /mnt/data/v1.HOOK-useAuth.zip
- /mnt/data/2.HOOK-useCurrentUser.zip
- /mnt/data/3.HOOK-useMultiTenant.zip
- /mnt/data/v4.HOOK-useSupabaseOperations.zip

Ensuite, je te demande d√©compresser ces zip, lis le dossier :
- /mnt/data/2.INTEGRATION SUPABASE.zip
- Quand tu auras fini de lire et analyser , je te donnerai une liste d'autres ressources √† lire
---
Parfait 
- On a travaill√© sur un espace qui va me permettre en tant qu'administrateur admin_presenca de cr√©er des tables et de les mettre √† jour
- Nous avons commenc√© par un formulaire pour la table reseau
  - Ces formulaires se trouvent dans mon application dans le dossier : src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs
  - Les composants de ce formulaire reseau se trouvent dans ce dossier : src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau

## √âtape 1 ‚Äî Analyse pr√©alable
- D√©compresse et analyse toutes les informations strat√©giques utilis√©es pour concevoir le formulaire reseau, avec ses 3 pages :
  - Accueil
  - Cr√©ation
  - Gestion (avec ses onglets G√©n√©ral, Int√©grations, Fichiers)
  - /mnt/data/001.FormCreateurReseau.DossierCrucial.zip
  - /mnt/data/002.FormGestionReseau.DossierCrucial.zip
  - /mnt/data/003.FormCreateurGestion.DossierCrucial.zip
- Tu dois les ma√Ætriser parfaitement car nous allons travailler sur la conception du formulaire de la table agence_independante
- Selon le m√™me mod√®le structurel, logique et graphique
- Je te donnerai d'autres informations dans le chat suivant quand tu auras bien compris cette structure
---
## üß± √âtape 2 ‚Äî Conception du formulaire Agence Ind√©pendante
- Je vais te donner ici des informations essentielles pour la conception du formulaire de la table Agence Ind√©pendante

### 1. Formulaire de **cr√©ation**
- Cr√©ation simultan√©e des tables :  
  `users`, `utilisateur`, `organisation`, `agence_independante`.
- Application du **m√™me mod√®le que pour `reseau`** :
  - **Propagation automatique** vers `agence_independante_responsable` pour les champs `email` et `telephone`.
  - **Service Role Key** pour bypass RLS (m√™me logique `verify_jwt=false` dans `config.toml`).
  - Gestion du mot de passe via composant `SuccessAccountInfo.tsx` (affichage du lien d‚Äôacc√®s / magic link).
- Respect du **cascade process** :
  1. Organisation ‚Üí  
  2. Agence ‚Üí  
  3. User/Auth ‚Üí  
  4. Utilisateur ‚Üí  
  5. Responsable agence.
- Structure des EF :  
  `supabase/functions/create-agence-independante-admin/index.ts`

### 2. Formulaire de **gestion**
#### Structure g√©n√©rale
M√™me architecture que `reseau`, mais avec **4 onglets** :
1. **G√©n√©ral**
2. **Abonnement** (Nouveaut√© par rapport √† r√©seau)
3. **Int√©grations** (Brevo, Zoho, OpenAI, LinkedIn, Facebook, Instagram)
4. **Fichiers**
#### üîπ Onglet G√©n√©ral
- Mise √† jour de la table `agence_independante`.
  - Propagation automatique vers `agence_independante_responsable` pour `email` et `telephone`.
  - Respect du pattern `{ success, data, message }`.
#### üîπ Onglet Abonnement *(nouveaut√© par rapport √† la table r√©seau)*
- Pour l‚Äôinstant, ne comporte que **2 champs en lecture seule** :
  - `Plan d‚Äôabonnement` (affiche `abonnement_stripe_plan` ou ‚ÄúAucun‚Äù si null),
  - `Date de d√©but d‚Äôabonnement` (affiche `abonnement_stripe_debut` ou vide).
- Ces champs lisent la table `abonnement_stripe`.
  - Aucun lien Stripe actif pour le moment.
- NB. Pr√©voir un **cadre extensible** permettant plus tard :
  - la s√©lection d‚Äôun plan,
  - la cr√©ation / mise √† jour d‚Äôun abonnement via EF Stripe,
  - la synchronisation automatique des donn√©es (`last_synchro`, `statut`, `paiement`).
- Fichiers et hooks √† pr√©voir :
  - `useAbonnementStripeView.ts` (lecture seule),
  - Dossier futur `/4.OngletAbonnement/` (structure pr√™te √† accueillir les EF Stripe).
#### üîπ Onglet Int√©grations
- 6 int√©grations pr√©vues : Brevo, Zoho, OpenAI, LinkedIn, Facebook, Instagram.
  - M√™mes EF et hooks que pour `reseau`, en adaptant imp√©rativement les noms et tables.
  - Gestion via `agence-independante-admin-update`.
#### üîπ Onglet Fichiers
- T√©l√©versement / suppression via EF :
  `agence-independante-admin-fichiers`.
- Respect du **mapping norm√©** :
  - `bucket-table-agence-independante/agence-{uuid}/1-logos/...`
  - `bucket-table-agence-independante/agence-{uuid}/2-documents-institutionnels/...`
- MAJ DB :
  - `_logo` ‚Üí chemin unique vers le logo principal,
  - `_ressources` ‚Üí tableau des chemins vers les documents.
#### ‚öôÔ∏è Hooks et EF
- Hooks :  
  `useAgenceIndependanteFormData.ts`,  
  `useAgenceIndependanteIntegrations.ts`.
- EF :  
  - `gestion-agence-independante-admin/index.ts`  
  - `gestion-agence-independante-admin-donnees/index.ts`  
  - `gestion-agence-independante-admin-update/index.ts`  
  - `gestion-agence-independante-admin-fichiers/index.ts`
### 3. Respect de la structure graphique
- Il faudra imp√©rativement conserver le graphisme existant pr√©vu et d√©fini dans le fichier zip
- ->/mnt/data/002.GraphismesFormetOnglets.zip
- Sauf n√©cessti√© absolue, interdiction de modifier les noms des titres, champs preholder
### 4. Respect du nomming et du maping des tables
- Il faudra imp√©rativement veiller √† respecter le nom des champs des tables
- Ils sont pr√©sents tu n as pas √† cr√©er de nouveaux champs pour toutes les tables : users, utilisateur, organisation ,agence independante et agence indepedante responsable et les tables de connexion
- Tu retrouvers toutes les tables dans les fichiers pr√©paratoires
- /mnt/data/.TablesReferenceAgenceIndependante.ts
- et dans le fichier ZIP qu'il faudra d√©compresser :/mnt/data/Agence_Independante_UseTables.zip

## üóÇÔ∏è √âtape 3 ‚Äî Emplacements des fichiers
### üìç Frontend
**Fichiers :**  
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/1.FormAgenceIndependanteAccueil.tsx
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/2.FormAgenceIndependanteCreation.tsx
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/3.FormAgenceIndependanteGestion.tsx
- src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/6.AgenceIndependante/SuccessAccountInfo.tsx

**Hooks Cr√©ation :**  
- src/components/HOOKS-STRATEGIQUE/5.HOOKS-CreationCompteAdminPresenca/6.AgenceIndependante/types.ts
- src/components/HOOKS-STRATEGIQUE/5.HOOKS-CreationCompteAdminPresenca/6.AgenceIndependante/useAgenceIndependanteCreation.ts

**Hooks Gestion :**  
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/types.ts
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/useAbonnementStripeView.ts
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/useAgenceIndependanteFormData.ts
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/hooks/useAgenceIndependanteIntegrations.ts

**Composants Gestion :**  
- src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/6.AgenceIndependante/components/AgenceIndependanteSelector.tsx
---
### üìç Backend (Edge Functions)
`supabase/functions/`  
- supabase/functions/create-agence-independante-admin/index.ts
- supabase/functions/gestion-agence-independante-admin/index.ts
- supabase/functions/gestion-agence-independante-admin-donnees/index.ts
- supabase/functions/gestion-agence-independante-admin-fichiers/index.ts
- supabase/functions/gestion-agence-independante-admin-update/index.ts
Respecte imp√©rativement e naming exact et la structure EF du mod√®le `reseau` en l'adaptant aux champs des tables utilis√©es pour Agence Ind√©pendante
---
## üß© √âtape 4 ‚Äî Bonnes pratiques g√©n√©rales
- **Service Role Key obligatoire** pour toutes les EF (jamais expos√©e c√¥t√© front).  
- **Frontend** : cl√© **ANON** uniquement.  
- **Contrats de retour uniformis√©s** `{ success, data, message }`.  
- **Logs structur√©s** (`requestId`, `duration_ms`, `event`).  
- **Charte graphique** : interdiction de modifier la mise en page (labels, placeholders, styles).  
- **Atomicit√©** : toutes les EF doivent rollback en cas d‚Äôerreur partielle.  
- **R√©plication** `agence_independante` ‚Üí `agence_independante_responsable` obligatoire pour `email` et `telephone`.
---








