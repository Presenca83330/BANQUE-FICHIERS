# üìå FormReseauGestion ‚Äì Projet D'implantation Corrective

Ce document centralise **tous les fichiers corrig√©s** li√©s au formulaire de gestion r√©seau.  
Il est con√ßu pour √™tre int√©gr√© directement dans **Lovable** par copier/coller.

---

## 1. Types & R√©f√©rences

### üìÑ src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau/TablesReferenceReseau.ts

```typescript
export interface ReseauFormData {
  reseau_id: string;
  reseau_nom: string;
  reseau_identite_commerciale?: string;
  reseau_adresse: string;
  reseau_code_postal: string;
  reseau_ville: string;
  reseau_siret: string;
  reseau_statut?: string;
  reseau_logo?: string;
  reseau_documents?: string[];

  // FKs Int√©grations
  reseau_brevo_connexion_id?: string;
  reseau_zoho_connexion_id?: string;
  reseau_openai_connexion_id?: string;

  // Champs direction (lecture seule)
  direction_telephone?: string;
  direction_email?: string;
}

export interface ValidationErrors {
  [key: string]: string | undefined;
}

export interface ReseauSelectorItem {
  reseau_id: string;
  reseau_nom: string;
  reseau_statut?: string;
  organisation_id?: string;
}

// -----------------------------
// Int√©grations connexions
// -----------------------------
export interface BrevoIntegration {
  brevo_connexion_id: string;
  brevo_api_key: string;
  brevo_email_compte: string;
  brevo_nom_compte: string;
}

export interface ZohoIntegration {
  zoho_connexion_id: string;
  zoho_api_key: string;
  zoho_email_compte: string;
  zoho_nom_compte: string;
}

export interface OpenAIIntegration {
  openai_connexion_id: string;
  openai_api_key: string;
  openai_email_compte: string;
}
```


---

## 2. Hooks

### üìÑ src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/hooks/types.ts

```typescript
// Types partag√©s pour la gestion des r√©seaux

export interface ReseauFormData {
  reseau_id: string;
  reseau_nom: string;
  reseau_identite_commerciale?: string;
  reseau_adresse: string;
  reseau_code_postal: string;
  reseau_ville: string;
  reseau_siret: string;
  reseau_statut?: string;
  reseau_logo?: string | null;
  reseau_documents?: string[]; // paths storage (priv√©s)

  // FKs Int√©grations (dans table reseau)
  reseau_brevo_connexion_id?: string | null;
  reseau_zoho_connexion_id?: string | null;
  reseau_openai_connexion_id?: string | null;

  // Lecture seule (venant de reseau_direction)
  direction_telephone?: string | null;
  direction_email?: string | null;

  // Confort pour l'onglet Int√©grations (valeurs inject√©es si existantes)
  brevo_connexion?: BrevoIntegration | null;
  zoho_connexion?: ZohoIntegration | null;
  openai_connexion?: OpenAIIntegration | null;

  // Pivot pour les insertions (utile √† l'upsert connexions)
  organisation_id?: string;
}

export interface ValidationErrors {
  [key: string]: string | undefined;
}

export interface ReseauSelectorItem {
  reseau_id: string;
  reseau_nom: string;
  reseau_statut?: string;
  organisation_id?: string;
}

// -----------------------------
// Tables connexions (historisation API)
// -----------------------------
export interface BrevoIntegration {
  brevo_connexion_id: string;
  organisation_id: string;
  client_id: string;
  client_type: 'reseau';
  brevo_api_key: string;
  brevo_email_compte?: string | null;
  brevo_nom_compte?: string | null;
}

export interface ZohoIntegration {
  zoho_connexion_id: string;
  organisation_id: string;
  client_id: string;
  client_type: 'reseau';
  zoho_api_key: string;
  zoho_email_compte?: string | null;
  zoho_nom_compte?: string | null;
}

export interface OpenAIIntegration {
  openai_connexion_id: string;
  organisation_id: string;
  client_id: string;
  client_type: 'reseau';
  openai_api_key: string;
  openai_email_compte?: string | null;
}

// -----------------------------
// Aides pour l'onglet Int√©grations (forme des √©tats locaux)
// -----------------------------
export type IntegrationKind = 'brevo' | 'zoho' | 'openai';

export interface BrevoFormState {
  brevo_connexion_id?: string | null;
  brevo_api_key?: string;
  brevo_email_compte?: string;
  brevo_nom_compte?: string;
}

export interface ZohoFormState {
  zoho_connexion_id?: string | null;
  zoho_api_key?: string;
  zoho_email_compte?: string;
  zoho_nom_compte?: string;
}

export interface OpenAIFormState {
  openai_connexion_id?: string | null;
  openai_api_key?: string;
  openai_email_compte?: string;
}

export interface IntegrationsState {
  organisation_id?: string;
  brevo: BrevoFormState;
  zoho: ZohoFormState;
  openai: OpenAIFormState;
}

```

### üìÑ src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/hooks/useReseauFormData.ts

```typescript
import { useState, useCallback } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useToast } from '@/hooks/use-toast';
import type { ReseauFormData, ReseauSelectorItem, ValidationErrors } from './types';

export function useReseauFormData() {
  const [reseaux, setReseaux] = useState<ReseauSelectorItem[]>([]);
  const [selectedReseauId, setSelectedReseauId] = useState<string>('');
  const [formData, setFormData] = useState<Partial<ReseauFormData>>({});
  const [isLoading, setIsLoading] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [errors, setErrors] = useState<ValidationErrors>({});
  const { toast } = useToast();

  const loadReseaux = useCallback(async () => {
    setIsLoading(true);
    try {
      const { data, error } = await supabase
        .from('reseau')
        .select('reseau_id, reseau_nom, reseau_statut, organisation_id')
        .order('reseau_nom');
      if (error) throw error;
      setReseaux(data || []);
    } catch {
      toast({ title: 'Erreur', description: 'Impossible de charger les r√©seaux', variant: 'destructive' });
    } finally {
      setIsLoading(false);
    }
  }, [toast]);

  const loadReseauData = useCallback(async (reseauId: string) => {
    if (!reseauId) return;
    setIsLoading(true);
    try {
      const { data: reseau, error } = await supabase
        .from('reseau')
        .select(`
          reseau_id,
          reseau_nom,
          reseau_identite_commerciale,
          reseau_adresse,
          reseau_code_postal,
          reseau_ville,
          reseau_siret,
          reseau_statut,
          reseau_logo,
          reseau_documents,
          reseau_brevo_connexion_id,
          reseau_zoho_connexion_id,
          reseau_openai_connexion_id,
          organisation_id,
          reseau_direction!inner (
            reseau_direction_telephone,
            reseau_direction_email
          )
        `)
        .eq('reseau_id', reseauId)
        .single();

      if (error) throw error;

      const direction_telephone = reseau.reseau_direction?.[0]?.reseau_direction_telephone ?? null;
      const direction_email = reseau.reseau_direction?.[0]?.reseau_direction_email ?? null;

      setFormData({
        ...reseau,
        direction_telephone,
        direction_email,
      });
      setErrors({});
    } catch {
      toast({ title: 'Erreur', description: 'Impossible de charger les donn√©es du r√©seau', variant: 'destructive' });
    } finally {
      setIsLoading(false);
    }
  }, [toast]);

  const validateForm = useCallback((data: Partial<ReseauFormData>): ValidationErrors => {
    const newErrors: ValidationErrors = {};
    if (!data.reseau_nom?.trim()) newErrors.reseau_nom = 'Le nom du r√©seau est obligatoire';
    if (!data.reseau_adresse?.trim()) newErrors.reseau_adresse = "L'adresse est obligatoire";
    if (!data.reseau_code_postal?.trim()) newErrors.reseau_code_postal = 'Le code postal est obligatoire';
    else if (!/^\d{5}$/.test(data.reseau_code_postal)) newErrors.reseau_code_postal = 'Le code postal doit contenir 5 chiffres';
    if (!data.reseau_ville?.trim()) newErrors.reseau_ville = 'La ville est obligatoire';
    if (!data.reseau_siret?.trim()) newErrors.reseau_siret = 'Le SIRET est obligatoire';
    else if (!/^\d{14}$/.test(data.reseau_siret.replace(/\s/g, ''))) newErrors.reseau_siret = 'Le SIRET doit contenir 14 chiffres';
    return newErrors;
  }, []);

  const saveReseau = useCallback(async (dataToSave: Partial<ReseauFormData>) => {
    if (!selectedReseauId) return false;

    const validationErrors = validateForm(dataToSave);
    setErrors(validationErrors);
    if (Object.keys(validationErrors).length > 0) {
      toast({ title: 'Erreurs de validation', description: 'Veuillez corriger les erreurs', variant: 'destructive' });
      return false;
    }

    setIsSaving(true);
    try {
      const { error } = await supabase.functions.invoke('update-reseau', {
        body: JSON.stringify({
          reseauId: selectedReseauId,
          generalData: dataToSave,
        }),
      });
      if (error) throw error;

      toast({ title: 'Succ√®s', description: 'R√©seau mis √† jour avec succ√®s' });
      await loadReseauData(selectedReseauId);
      return true;
    } catch {
      toast({ title: 'Erreur', description: 'Impossible de sauvegarder les modifications', variant: 'destructive' });
      return false;
    } finally {
      setIsSaving(false);
    }
  }, [selectedReseauId, validateForm, toast, loadReseauData]);

  const updateFormField = useCallback((field: keyof ReseauFormData | string, value: any) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    if (errors[field]) {
      setErrors(prev => {
        const e = { ...prev };
        delete e[field];
        return e;
      });
    }
  }, [errors]);

  const selectReseau = useCallback((reseauId: string) => {
    setSelectedReseauId(reseauId);
    if (reseauId) {
      loadReseauData(reseauId);
    } else {
      setFormData({});
      setErrors({});
    }
  }, [loadReseauData]);

  return {
    reseaux,
    selectedReseauId,
    formData,
    isLoading,
    isSaving,
    errors,
    loadReseaux,
    selectReseau,
    updateFormField,
    saveReseau,
    validateForm,
    loadReseauData,
  };
}

```

### üìÑ src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/hooks/useReseauIntegrations.ts

```typescript
import { useCallback, useState } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useToast } from '@/hooks/use-toast';
import type {
  IntegrationsState,
  IntegrationKind,
  BrevoFormState,
  ZohoFormState,
  OpenAIFormState,
} from './types';

export function useReseauIntegrations() {
  const { toast } = useToast();
  const [state, setState] = useState<IntegrationsState>({
    organisation_id: undefined,
    brevo: {},
    zoho: {},
    openai: {},
  });
  const [isLoading, setIsLoading] = useState(false);
  const [isSaving, setIsSaving] = useState(false);

  const loadForReseau = useCallback(async (reseauId: string) => {
    if (!reseauId) return;
    setIsLoading(true);
    try {
      const { data: reseau, error } = await supabase
        .from('reseau')
        .select(`
          organisation_id,
          reseau_brevo_connexion_id,
          reseau_zoho_connexion_id,
          reseau_openai_connexion_id
        `)
        .eq('reseau_id', reseauId)
        .single();
      if (error) throw error;

      const next: IntegrationsState = {
        organisation_id: reseau.organisation_id,
        brevo: {},
        zoho: {},
        openai: {},
      };

      if (reseau.reseau_brevo_connexion_id) {
        const { data: b } = await supabase
          .from('brevo_connexion')
          .select('brevo_connexion_id, brevo_api_key, brevo_email_compte, brevo_nom_compte')
          .eq('brevo_connexion_id', reseau.reseau_brevo_connexion_id)
          .single();
        if (b) {
          next.brevo = {
            brevo_connexion_id: b.brevo_connexion_id,
            brevo_api_key: b.brevo_api_key,
            brevo_email_compte: b.brevo_email_compte ?? undefined,
            brevo_nom_compte: b.brevo_nom_compte ?? undefined,
          };
        }
      }

      if (reseau.reseau_zoho_connexion_id) {
        const { data: z } = await supabase
          .from('zoho_connexion')
          .select('zoho_connexion_id, zoho_api_key, zoho_email_compte, zoho_nom_compte')
          .eq('zoho_connexion_id', reseau.reseau_zoho_connexion_id)
          .single();
        if (z) {
          next.zoho = {
            zoho_connexion_id: z.zoho_connexion_id,
            zoho_api_key: z.zoho_api_key,
            zoho_email_compte: z.zoho_email_compte ?? undefined,
            zoho_nom_compte: z.zoho_nom_compte ?? undefined,
          };
        }
      }

      if (reseau.reseau_openai_connexion_id) {
        const { data: o } = await supabase
          .from('openai_connexion')
          .select('openai_connexion_id, openai_api_key, openai_email_compte')
          .eq('openai_connexion_id', reseau.reseau_openai_connexion_id)
          .single();
        if (o) {
          next.openai = {
            openai_connexion_id: o.openai_connexion_id,
            openai_api_key: o.openai_api_key,
            openai_email_compte: o.openai_email_compte ?? undefined,
          };
        }
      }

      setState(next);
    } catch {
      toast({ title: 'Erreur', description: 'Impossible de charger les int√©grations', variant: 'destructive' });
    } finally {
      setIsLoading(false);
    }
  }, [toast]);

  const updateField = useCallback((kind: IntegrationKind, field: string, value: string) => {
    setState(prev => ({
      ...prev,
      [kind]: { ...(prev as any)[kind], [field]: value },
    }));
  }, []);

  const saveIntegration = useCallback(
    async (reseauId: string, kind: IntegrationKind) => {
      if (!reseauId) return false;
      setIsSaving(true);
      try {
        const orgId = state.organisation_id;
        if (!orgId) throw new Error('organisation_id introuvable');

        if (kind === 'brevo') {
          const data: BrevoFormState = state.brevo;
          if (data.brevo_connexion_id) {
            const { error } = await supabase
              .from('brevo_connexion')
              .update({
                brevo_api_key: data.brevo_api_key,
                brevo_email_compte: data.brevo_email_compte ?? null,
                brevo_nom_compte: data.brevo_nom_compte ?? null,
              })
              .eq('brevo_connexion_id', data.brevo_connexion_id);
            if (error) throw error;
          } else {
            const { data: inserted, error } = await supabase
              .from('brevo_connexion')
              .insert({
                organisation_id: orgId,
                client_id: reseauId,
                client_type: 'reseau',
                brevo_api_key: data.brevo_api_key ?? '',
                brevo_email_compte: data.brevo_email_compte ?? null,
                brevo_nom_compte: data.brevo_nom_compte ?? null,
              })
              .select('brevo_connexion_id')
              .single();
            if (error) throw error;

            if (inserted?.brevo_connexion_id) {
              await supabase.functions.invoke('update-reseau', {
                body: JSON.stringify({
                  reseauId,
                  generalData: { reseau_brevo_connexion_id: inserted.brevo_connexion_id },
                }),
              });
              setState(prev => ({ ...prev, brevo: { ...prev.brevo, brevo_connexion_id: inserted.brevo_connexion_id } }));
            }
          }
        }

        if (kind === 'zoho') {
          const data: ZohoFormState = state.zoho;
          if (data.zoho_connexion_id) {
            const { error } = await supabase
              .from('zoho_connexion')
              .update({
                zoho_api_key: data.zoho_api_key,
                zoho_email_compte: data.zoho_email_compte ?? null,
                zoho_nom_compte: data.zoho_nom_compte ?? null,
              })
              .eq('zoho_connexion_id', data.zoho_connexion_id);
            if (error) throw error;
          } else {
            const { data: inserted, error } = await supabase
              .from('zoho_connexion')
              .insert({
                organisation_id: orgId,
                client_id: reseauId,
                client_type: 'reseau',
                zoho_api_key: data.zoho_api_key ?? '',
                zoho_email_compte: data.zoho_email_compte ?? null,
                zoho_nom_compte: data.zoho_nom_compte ?? null,
              })
              .select('zoho_connexion_id')
              .single();
            if (error) throw error;

            if (inserted?.zoho_connexion_id) {
              await supabase.functions.invoke('update-reseau', {
                body: JSON.stringify({
                  reseauId,
                  generalData: { reseau_zoho_connexion_id: inserted.zoho_connexion_id },
                }),
              });
              setState(prev => ({ ...prev, zoho: { ...prev.zoho, zoho_connexion_id: inserted.zoho_connexion_id } }));
            }
          }
        }

        if (kind === 'openai') {
          const data: OpenAIFormState = state.openai;
          if (data.openai_connexion_id) {
            const { error } = await supabase
              .from('openai_connexion')
              .update({
                openai_api_key: data.openai_api_key,
                openai_email_compte: data.openai_email_compte ?? null,
              })
              .eq('openai_connexion_id', data.openai_connexion_id);
            if (error) throw error;
          } else {
            const { data: inserted, error } = await supabase
              .from('openai_connexion')
              .insert({
                organisation_id: orgId,
                client_id: reseauId,
                client_type: 'reseau',
                openai_api_key: data.openai_api_key ?? '',
                openai_email_compte: data.openai_email_compte ?? null,
              })
              .select('openai_connexion_id')
              .single();
            if (error) throw error;

            if (inserted?.openai_connexion_id) {
              await supabase.functions.invoke('update-reseau', {
                body: JSON.stringify({
                  reseauId,
                  generalData: { reseau_openai_connexion_id: inserted.openai_connexion_id },
                }),
              });
              setState(prev => ({ ...prev, openai: { ...prev.openai, openai_connexion_id: inserted.openai_connexion_id } }));
            }
          }
        }

        toast({ title: 'Succ√®s', description: 'Int√©grations mises √† jour avec succ√®s' });
        return true;
      } catch {
        toast({ title: 'Erreur', description: "Impossible de sauvegarder l'int√©gration", variant: 'destructive' });
        return false;
      } finally {
        setIsSaving(false);
      }
    },
    [state, toast]
  );

  const setBrevo = useCallback((patch: Partial<BrevoFormState>) => setState(prev => ({ ...prev, brevo: { ...prev.brevo, ...patch } })), []);
  const setZoho = useCallback((patch: Partial<ZohoFormState>) => setState(prev => ({ ...prev, zoho: { ...prev.zoho, ...patch } })), []);
  const setOpenAI = useCallback((patch: Partial<OpenAIFormState>) => setState(prev => ({ ...prev, openai: { ...prev.openai, ...patch } })), []);

  return {
    integrations: state,
    isLoading,
    isSaving,
    loadForReseau,
    updateField,
    saveIntegration,
    setBrevo,
    setZoho,
    setOpenAI,
  };
}

```



---

## 3. Composants

### üìÑ src/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/components/ReseauSelector.tsx

```typescript
import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import type { ReseauSelectorItem } from '../hooks/types';

interface ReseauSelectorProps {
  reseaux: ReseauSelectorItem[];
  selectedReseauId: string;
  onSelect: (reseauId: string) => void;
  isLoading: boolean;
}

export const ReseauSelector: React.FC<ReseauSelectorProps> = ({
  reseaux,
  selectedReseauId,
  onSelect,
  isLoading,
}) => {
  return (
    <Card className="mb-6">
      <CardHeader>
        <CardTitle className="text-xl font-semibold">S√©lection du R√©seau</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          <Select
            value={selectedReseauId}
            onValueChange={onSelect}
            disabled={isLoading}
          >
            <SelectTrigger className="w-full">
              <SelectValue 
                placeholder={
                  isLoading ? "Chargement des r√©seaux..." : 
                  "S√©lectionner un r√©seau"
                } 
              />
            </SelectTrigger>
            <SelectContent>
              {reseaux?.map((reseau) => (
                <SelectItem key={reseau.reseau_id} value={reseau.reseau_id}>
                  {reseau.reseau_nom}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
      </CardContent>
    </Card>
  );
};

export default ReseauSelector;

```

### üìÑ src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/5-Graphisme/1.GraphFormulaires/5.GraphBoutonModifier.tsx

```typescript
import React, { useState } from 'react';
import { Edit, X, Save } from 'lucide-react';

interface GraphBoutonModifierProps {
  onSave?: () => void | Promise<void>;
  onCancel?: () => void;
  onEditingChange?: (isEditing: boolean) => void;
  isLoading?: boolean;
  className?: string;
}

const GraphBoutonModifier: React.FC<GraphBoutonModifierProps> = ({ 
  onSave, 
  onCancel,
  onEditingChange,
  isLoading = false,
  className = ""
}) => {
  const [isEditing, setIsEditing] = useState(false);

  const handleModifier = () => {
    setIsEditing(true);
    if (onEditingChange) onEditingChange(true);
  };

  const handleAnnuler = () => {
    setIsEditing(false);
    if (onEditingChange) onEditingChange(false);
    if (onCancel) onCancel();
  };

  const handleEnregistrer = async () => {
    if (onSave) {
      await onSave();
    }
    setIsEditing(false);
    if (onEditingChange) onEditingChange(false);
  };

  if (!isEditing) {
    return (
      <button
        onClick={handleModifier}
        className={`inline-flex items-center gap-2 px-4 py-2 bg-background border border-border rounded-lg text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground transition-colors ${className}`}
      >
        <Edit size={16} />
        Modifier
      </button>
    );
  }

  return (
    <div className={`flex gap-2 ${className}`}>
      <button
        onClick={handleAnnuler}
        disabled={isLoading}
        className="inline-flex items-center gap-2 px-4 py-2 bg-background border border-border rounded-lg text-sm font-medium text-foreground hover:bg-accent hover:text-accent-foreground transition-colors disabled:opacity-50"
      >
        <X size={16} />
        Annuler
      </button>
      <button
        onClick={handleEnregistrer}
        disabled={isLoading}
        className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors disabled:opacity-50"
      >
        <Save size={16} />
        {isLoading ? 'Enregistrement...' : 'Enregistrer'}
      </button>
    </div>
  );
};

export default GraphBoutonModifier;
```

---

## 4. Page Principale

üìÑ `src/components/ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau/3.FormReseauGestion.tsx

```typescript
import React, { useEffect, useMemo, useRef, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "../../3-Utilitaires/tabs";
import { Upload, Download, Trash2, Eye } from 'lucide-react';
import GraphBoutonModifier from '../../5-Graphisme/1.GraphFormulaires/5.GraphBoutonModifier';
import ReseauSelector from '@/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/components/ReseauSelector';
import { useReseauFormData } from '@/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/hooks/useReseauFormData';
import { useReseauIntegrations } from '@/components/HOOKS-STRATEGIQUE/6.HOOKS-GestionCompteAdminPresenca/1.Reseau/hooks/useReseauIntegrations';
import { supabase } from '@/integrations/supabase/client';
import { useToast } from '@/hooks/use-toast';

interface Props {
  onBack?: () => void;
}

const FormReseauGestion: React.FC<Props> = ({ onBack }) => {
  const { toast } = useToast();

  const {
    reseaux,
    selectedReseauId,
    formData,
    isLoading,
    isSaving,
    errors,
    loadReseaux,
    selectReseau,
    updateFormField,
    saveReseau,
    loadReseauData,
  } = useReseauFormData();

  const {
    integrations,
    isLoading: integLoading,
    isSaving: integSaving,
    loadForReseau,
    setBrevo,
    setZoho,
    setOpenAI,
    saveIntegration,
  } = useReseauIntegrations();

  const [isEditingGeneral, setIsEditingGeneral] = useState(false);
  const [isEditingBrevo, setIsEditingBrevo] = useState(false);
  const [isEditingZoho, setIsEditingZoho] = useState(false);
  const [isEditingOpenAI, setIsEditingOpenAI] = useState(false);
  const [isEditingFichiers, setIsEditingFichiers] = useState(false);

  const logoInputRef = useRef<HTMLInputElement | null>(null);
  const docsInputRef = useRef<HTMLInputElement | null>(null);
  const [selectedLogo, setSelectedLogo] = useState<File | null>(null);
  const [selectedDocs, setSelectedDocs] = useState<File[]>([]);

  useEffect(() => { loadReseaux(); }, [loadReseaux]);
  useEffect(() => { if (selectedReseauId) loadForReseau(selectedReseauId); }, [selectedReseauId, loadForReseau]);

  const handleSaveGeneral = async () => {
    if (!selectedReseauId) return;
    const success = await saveReseau({
      reseau_nom: formData.reseau_nom,
      reseau_identite_commerciale: formData.reseau_identite_commerciale,
      reseau_adresse: formData.reseau_adresse,
      reseau_code_postal: formData.reseau_code_postal,
      reseau_ville: formData.reseau_ville,
      reseau_siret: formData.reseau_siret,
    });
    if (success) setIsEditingGeneral(false);
  };

  const handleSaveBrevo = async () => { if (!selectedReseauId) return; const ok = await saveIntegration(selectedReseauId, 'brevo'); if (ok) setIsEditingBrevo(false); };
  const handleSaveZoho = async () => { if (!selectedReseauId) return; const ok = await saveIntegration(selectedReseauId, 'zoho'); if (ok) setIsEditingZoho(false); };
  const handleSaveOpenAI = async () => { if (!selectedReseauId) return; const ok = await saveIntegration(selectedReseauId, 'openai'); if (ok) setIsEditingOpenAI(false); };

  const reloadAll = async () => {
    if (selectedReseauId) {
      await loadReseauData(selectedReseauId);
      await loadForReseau(selectedReseauId);
      setSelectedLogo(null);
      setSelectedDocs([]);
    }
  };

  const uploadFile = async (type: 'logo' | 'document', file: File, reseauId: string) => {
    const fd = new FormData();
    fd.append('file', file);
    fd.append('type', type);
    fd.append('reseauId', reseauId);
    const { data, error } = await supabase.functions.invoke('upload-reseau-files', { body: fd });
    if (error) throw error;
    return (data as any)?.filePath as string;
  };

  const handleSaveLogo = async () => {
    if (!selectedReseauId || !selectedLogo) { setIsEditingFichiers(false); return; }
    try {
      const path = await uploadFile('logo', selectedLogo, selectedReseauId);
      await supabase.functions.invoke('update-reseau', {
        body: JSON.stringify({ reseauId: selectedReseauId, generalData: { reseau_logo: path } }),
      });
      toast({ title: 'Succ√®s', description: 'Logo mis √† jour' });
      await reloadAll();
      setIsEditingFichiers(false);
    } catch {
      toast({ title: 'Erreur', description: "Impossible d'uploader le logo", variant: 'destructive' });
    }
  };

  const handleSaveDocuments = async () => {
    if (!selectedReseauId) { setIsEditingFichiers(false); return; }
    try {
      const paths: string[] = [];
      for (const f of selectedDocs) { paths.push(await uploadFile('document', f, selectedReseauId)); }
      const next = Array.isArray(formData.reseau_documents) ? [...formData.reseau_documents, ...paths] : paths;
      await supabase.functions.invoke('update-reseau', {
        body: JSON.stringify({ reseauId: selectedReseauId, generalData: { reseau_documents: next } }),
      });
      toast({ title: 'Succ√®s', description: 'Documents mis √† jour' });
      await reloadAll();
      setIsEditingFichiers(false);
    } catch {
      toast({ title: 'Erreur', description: "Impossible d'uploader les documents", variant: 'destructive' });
    }
  };

  const removeStoragePath = async (path: string) => {
    await supabase.storage.from('bucket-table-reseau').remove([path]);
  };

  const handleDeleteLogo = async () => {
    if (!selectedReseauId || !formData.reseau_logo) return;
    try {
      await removeStoragePath(formData.reseau_logo);
      await supabase.functions.invoke('update-reseau', {
        body: JSON.stringify({ reseauId: selectedReseauId, generalData: { reseau_logo: null } }),
      });
      toast({ title: 'Succ√®s', description: 'Logo supprim√©' });
      await reloadAll();
    } catch {
      toast({ title: 'Erreur', description: 'Suppression logo impossible', variant: 'destructive' });
    }
  };

  const handleDeleteDocument = async (docPath: string) => {
    if (!selectedReseauId) return;
    try {
      await removeStoragePath(docPath);
      const remaining = (formData.reseau_documents || []).filter(p => p !== docPath);
      await supabase.functions.invoke('update-reseau', {
        body: JSON.stringify({ reseauId: selectedReseauId, generalData: { reseau_documents: remaining } }),
      });
      toast({ title: 'Succ√®s', description: 'Document supprim√©' });
      await reloadAll();
    } catch {
      toast({ title: 'Erreur', description: 'Suppression document impossible', variant: 'destructive' });
    }
  };

  const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); };

  return (
    <div className="space-y-6">
      <ReseauSelector
        reseaux={reseaux}
        selectedReseauId={selectedReseauId}
        onSelect={selectReseau}
        isLoading={isLoading}
      />

      <Tabs defaultValue="general" className="w-full">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="general" className="text-base font-semibold">G√©n√©ral</TabsTrigger>
          <TabsTrigger value="integrations" className="text-base font-semibold">Int√©grations</TabsTrigger>
          <TabsTrigger value="fichiers" className="text-base font-semibold">Fichiers</TabsTrigger>
        </TabsList>

        <form onSubmit={handleSubmit}>
          <TabsContent value="general" className="space-y-6">
            <Card>
              <CardHeader>
                <div className="flex justify-between items-center">
                  <CardTitle className="text-2xl font-bold">Informations G√©n√©rales</CardTitle>
                  <GraphBoutonModifier 
                    onSave={handleSaveGeneral}
                    onCancel={reloadAll}
                    onEditingChange={setIsEditingGeneral}
                    isLoading={isSaving}
                  />
                </div>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className="space-y-4">
                    <div>
                      <Label htmlFor="reseau_nom">Nom du R√©seau *</Label>
                      <Input 
                        id="reseau_nom" 
                        value={formData.reseau_nom || ''} 
                        onChange={e => updateFormField('reseau_nom', e.target.value)} 
                        placeholder="Nom du R√©seau"
                        disabled={!isEditingGeneral}
                        required 
                      />
                    </div>
                    <div>
                      <Label htmlFor="reseau_identite_commerciale">Identit√© Commerciale du R√©seau</Label>
                      <Input 
                        id="reseau_identite_commerciale" 
                        value={formData.reseau_identite_commerciale || ''} 
                        onChange={e => updateFormField('reseau_identite_commerciale', e.target.value)} 
                        placeholder="Optionnel. Si Nom Commercial diff√©rent"
                        disabled={!isEditingGeneral}
                      />
                    </div>
                    <div>
                      <Label htmlFor="reseau_adresse">Adresse *</Label>
                      <Input 
                        id="reseau_adresse" 
                        value={formData.reseau_adresse || ''} 
                        onChange={e => updateFormField('reseau_adresse', e.target.value)} 
                        placeholder="Adresse. Si√®ge R√©seau"
                        disabled={!isEditingGeneral}
                        required 
                      />
                    </div>
                    <div>
                      <Label htmlFor="reseau_code_postal">Code Postal *</Label>
                      <Input 
                        id="reseau_code_postal" 
                        value={formData.reseau_code_postal || ''} 
                        onChange={e => updateFormField('reseau_code_postal', e.target.value)} 
                        placeholder="Code Postal. Si√®ge R√©seau"
                        disabled={!isEditingGeneral}
                        required 
                      />
                    </div>
                  </div>
                  <div className="space-y-4">
                    <div>
                      <Label htmlFor="reseau_ville">Ville *</Label>
                      <Input 
                        id="reseau_ville" 
                        value={formData.reseau_ville || ''} 
                        onChange={e => updateFormField('reseau_ville', e.target.value)} 
                        placeholder="Ville. Si√®ge R√©seau"
                        disabled={!isEditingGeneral}
                        required 
                      />
                    </div>
                    <div>
                      <Label htmlFor="reseau_siret">Siret *</Label>
                      <Input 
                        id="reseau_siret" 
                        value={formData.reseau_siret || ''} 
                        onChange={e => updateFormField('reseau_siret', e.target.value)} 
                        placeholder="N¬∞ Siret du R√©seau"
                        disabled={!isEditingGeneral}
                        required 
                      />
                    </div>
                    <div className="relative">
                      <Label htmlFor="reseau_telephone">T√©l√©phone Direction *</Label>
                      <Input 
                        id="reseau_telephone" 
                        value={formData.direction_telephone || ''}
                        placeholder="T√©l. Reseau Direction" 
                        disabled={true}
                        className="bg-muted"
                      />
                      <p className="text-sm text-muted-foreground mt-1">
                        Ce champ correspond aux informations du ReseauDirection.
                        √Ä modifier dans le formulaire R√âSEAU Direction
                      </p>
                    </div>
                    <div className="relative">
                      <Label htmlFor="reseau_email">Email Direction *</Label>
                      <Input 
                        id="reseau_email" 
                        type="email" 
                        value={formData.direction_email || ''}
                        placeholder="Email. Reseau Direction" 
                        disabled={true}
                        className="bg-muted"
                      />
                      <p className="text-sm text-muted-foreground mt-1">
                        Ce champ correspond aux informations du ReseauDirection.
                        √Ä modifier dans le formulaire R√âSEAU Direction
                      </p>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="integrations" className="space-y-6">
            <Card>
              <CardHeader>
                <div className="flex justify-between items-center">
                  <CardTitle className="text-2xl font-bold flex items-center gap-2">
                    Int√©gration Brevo
                  </CardTitle>
                  <GraphBoutonModifier 
                    onSave={handleSaveBrevo}
                    onCancel={reloadAll}
                    onEditingChange={setIsEditingBrevo}
                    isLoading={integSaving}
                  />
                </div>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div>
                    <Label htmlFor="brevo_api_key">Cl√© API Brevo *</Label>
                    <Input 
                      id="brevo_api_key" 
                      type="password"
                      placeholder="Renseigner. N¬∞ Cl√© API " 
                      value={integrations.brevo.brevo_api_key || ''}
                      onChange={e => setBrevo({ brevo_api_key: e.target.value })}
                      disabled={!isEditingBrevo}
                    />
                  </div>
                  <div>
                    <Label htmlFor="brevo_email_compte">Email Compte Brevo *</Label>
                    <Input 
                      id="brevo_email_compte" 
                      type="email"
                      placeholder="Renseigner. Email associ√© compte Brevo" 
                      value={integrations.brevo.brevo_email_compte || ''}
                      onChange={e => setBrevo({ brevo_email_compte: e.target.value })}
                      disabled={!isEditingBrevo}
                    />
                  </div>
                  <div>
                    <Label htmlFor="brevo_nom_compte">Nom Compte Brevo *</Label>
                    <Input 
                      id="brevo_nom_compte" 
                      placeholder="Renseigner.Nom compte Brevo" 
                      value={integrations.brevo.brevo_nom_compte || ''}
                      onChange={e => setBrevo({ brevo_nom_compte: e.target.value })}
                      disabled={!isEditingBrevo}
                    />
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <div className="flex justify-between items-center">
                  <CardTitle className="text-2xl font-bold flex items-center gap-2">
                    Int√©gration Zoho
                  </CardTitle>
                  <GraphBoutonModifier 
                    onSave={handleSaveZoho}
                    onCancel={reloadAll}
                    onEditingChange={setIsEditingZoho}
                    isLoading={integSaving}
                  />
                </div>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div>
                    <Label htmlFor="zoho_api_key">Cl√© API Zoho *</Label>
                    <Input 
                      id="zoho_api_key" 
                      type="password"
                      placeholder="Renseigner. Cl√© API Zoho" 
                      value={integrations.zoho.zoho_api_key || ''}
                      onChange={e => setZoho({ zoho_api_key: e.target.value })}
                      disabled={!isEditingZoho}
                    />
                  </div>
                  <div>
                    <Label htmlFor="zoho_email_compte">Email Compte Zoho *</Label>
                    <Input 
                      id="zoho_email_compte" 
                      type="email"
                      placeholder="Renseigner. Email associ√© compte Zoho" 
                      value={integrations.zoho.zoho_email_compte || ''}
                      onChange={e => setZoho({ zoho_email_compte: e.target.value })}
                      disabled={!isEditingZoho}
                    />
                  </div>
                  <div>
                    <Label htmlFor="zoho_nom_compte">Nom Compte Zoho *</Label>
                    <Input 
                      id="zoho_nom_compte" 
                      placeholder="Renseigner. Nom compte Zoho" 
                      value={integrations.zoho.zoho_nom_compte || ''}
                      onChange={e => setZoho({ zoho_nom_compte: e.target.value })}
                      disabled={!isEditingZoho}
                    />
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <div className="flex justify-between items-center">
                  <CardTitle className="text-2xl font-bold flex items-center gap-2">
                    Int√©gration OpenAI
                  </CardTitle>
                  <GraphBoutonModifier 
                    onSave={handleSaveOpenAI}
                    onCancel={reloadAll}
                    onEditingChange={setIsEditingOpenAI}
                    isLoading={integSaving}
                  />
                </div>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <Label htmlFor="openai_api_key">Cl√© API OpenAI *</Label>
                    <Input 
                      id="openai_api_key" 
                      type="password"
                      placeholder="Renseigner. Cl√© API OpenAI " 
                      value={integrations.openai.openai_api_key || ''}
                      onChange={e => setOpenAI({ openai_api_key: e.target.value })}
                      disabled={!isEditingOpenAI}
                    />
                  </div>
                  <div>
                    <Label htmlFor="openai_email_compte">Email Compte OpenAI *</Label>
                    <Input 
                      id="openai_email_compte" 
                      type="email"
                      placeholder="Renseigner. Email associ√© compte OpenAI" 
                      value={integrations.openai.openai_email_compte || ''}
                      onChange={e => setOpenAI({ openai_email_compte: e.target.value })}
                      disabled={!isEditingOpenAI}
                    />
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="fichiers" className="space-y-6">
            <Card>
              <CardHeader>
                <div className="flex justify-between items-center">
                  <CardTitle className="text-2xl font-bold">
                    Logo du R√©seau
                  </CardTitle>
                  <GraphBoutonModifier 
                    onSave={handleSaveLogo}
                    onCancel={reloadAll}
                    onEditingChange={setIsEditingFichiers}
                  />
                </div>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div className="space-y-2">
                    <Label htmlFor="reseau_logo_upload">T√©l√©charger le Logo du R√©seau</Label>
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center cursor-pointer" onClick={() => logoInputRef.current?.click()}>
                      <div className="space-y-2">
                        <div className="mx-auto w-12 h-12 text-muted-foreground">
                          <Upload className="h-6 w-6" />
                        </div>
                        <div>
                          <p className="text-sm">Cliquer pour s√©lectionner le logo</p>
                          <p className="text-xs text-muted-foreground">PNG, JPG, SVG - Max 2MB</p>
                        </div>
                      </div>
                    </div>
                    <input
                      ref={logoInputRef}
                      id="reseau_logo_upload"
                      type="file"
                      accept="image/*"
                      hidden
                      disabled={!isEditingFichiers}
                      onChange={e => setSelectedLogo(e.target.files?.[0] || null)}
                    />
                  </div>

                  <div className="space-y-2">
                    <Label>Logo actuel</Label>
                    <div className="border rounded-lg p-4 bg-muted/20">
                      {formData.reseau_logo ? (
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-3">
                            <div className="w-16 h-16 border rounded bg-white flex items-center justify-center">
                              <Upload className="h-5 w-5 text-muted-foreground" />
                            </div>
                            <div>
                              <p className="font-medium break-all">{formData.reseau_logo}</p>
                            </div>
                          </div>
                          <div className="flex gap-2">
                            <Button type="button" variant="destructive" size="sm" onClick={handleDeleteLogo} disabled={!isEditingFichiers}>
                              Supprimer
                            </Button>
                          </div>
                        </div>
                      ) : (
                        <span className="text-muted-foreground text-sm">Aucun logo upload√©</span>
                      )}
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <div className="flex justify-between items-center">
                  <CardTitle className="text-2xl font-bold">
                    Documents Institutionnels
                  </CardTitle>
                  <GraphBoutonModifier 
                    onSave={handleSaveDocuments}
                    onCancel={reloadAll}
                    onEditingChange={setIsEditingFichiers}
                  />
                </div>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div className="space-y-2">
                    <Label>T√©l√©charger les documents</Label>
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center cursor-pointer" onClick={() => docsInputRef.current?.click()}>
                      <div className="space-y-2">
                        <div className="mx-auto w-12 h-12 text-muted-foreground">
                          <Download className="h-6 w-6" />
                        </div>
                        <div>
                          <p className="text-sm">Cliquer pour s√©lectionner les documents</p>
                          <p className="text-xs text-muted-foreground">PDF, DOC, DOCX - Max 10MB par fichier</p>
                        </div>
                      </div>
                    </div>
                    <input
                      ref={docsInputRef}
                      type="file"
                      multiple
                      accept=".pdf,.doc,.docx,.xls,.xlsx"
                      hidden
                      disabled={!isEditingFichiers}
                      onChange={e => setSelectedDocs(e.target.files ? Array.from(e.target.files) : [])}
                    />
                  </div>

                  <div className="space-y-2">
                    <Label>Supprimer un fichier existant</Label>
                    <div className="border rounded-lg p-4 bg-muted/20 space-y-3">
                      {formData.reseau_documents && formData.reseau_documents.length > 0 ? (
                        <>
                          {formData.reseau_documents.map((p) => (
                            <div key={p} className="flex items-center justify-between p-3 border rounded bg-white">
                              <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-blue-100 rounded flex items-center justify-center">
                                  <Download className="h-4 w-4 text-blue-600" />
                                </div>
                                <div className="max-w-[60ch]">
                                  <p className="font-medium break-all">{p}</p>
                                </div>
                              </div>
                              <div className="flex gap-2">
                                <Button
                                  type="button"
                                  variant="outline"
                                  size="sm"
                                  onClick={async () => {
                                    const { data } = await supabase.storage
                                      .from('bucket-table-reseau')
                                      .createSignedUrl(p, 60);
                                    if (data?.signedUrl) window.open(data.signedUrl, '_blank');
                                  }}
                                >
                                  <Eye className="h-4 w-4 mr-1" />
                                  Voir
                                </Button>
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => handleDeleteDocument(p)}
                                  disabled={!isEditingFichiers}
                                >
                                  <Trash2 className="h-4 w-4 mr-1" />
                                  Supprimer
                                </Button>
                              </div>
                            </div>
                          ))}
                        </>
                      ) : (
                        <span className="text-muted-foreground text-sm">Aucun document upload√©</span>
                      )}
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </form>
      </Tabs>

      {onBack && (
        <div className="pt-6">
          <Button type="button" variant="outline" onClick={onBack}>
            ‚Üê Retour
          </Button>
        </div>
      )}
    </div>
  );
};

export default FormReseauGestion;

```

---

## 5. Edge Functions

### üìÑ supabase/functions/update-reseau/index.ts

```typescript
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

const supabase = createClient(
  Deno.env.get('SUPABASE_URL')!,
  Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
);

Deno.serve(async (req) => {
  try {
    const { reseauId, generalData } = await req.json();

    if (!reseauId || !generalData) {
      return new Response(JSON.stringify({ error: 'Param√®tres manquants' }), { status: 400 });
    }

    const { error } = await supabase
      .from('reseau')
      .update(generalData)
      .eq('reseau_id', reseauId);

    if (error) {
      return new Response(JSON.stringify({ error: error.message }), { status: 500 });
    }

    return new Response(JSON.stringify({ success: true }), { status: 200 });
  } catch {
    return new Response(JSON.stringify({ error: 'Erreur interne update-reseau' }), { status: 500 });
  }
});

```

### üìÑ supabase/functions/upload-reseau-files/index.ts

```typescript
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

const supabase = createClient(
  Deno.env.get('SUPABASE_URL')!,
  Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
);

Deno.serve(async (req) => {
  try {
    const formData = await req.formData();
    const file = formData.get('file') as File;
    const type = formData.get('type') as string; // 'logo' | 'document'
    const reseauId = formData.get('reseauId') as string;

    if (!file || !type || !reseauId) {
      return new Response(JSON.stringify({ error: 'Param√®tres manquants' }), { status: 400 });
    }

    const folder = type === 'logo' ? '1-logos' : '2-documents-institutionnels';
    const filePath = `reseau-${reseauId}/${folder}/${Date.now()}-${file.name}`;

    const { error: uploadError } = await supabase
      .storage
      .from('bucket-table-reseau')
      .upload(filePath, file.stream(), {
        contentType: file.type,
        upsert: true,
      });

    if (uploadError) {
      return new Response(JSON.stringify({ error: uploadError.message }), { status: 500 });
    }

    return new Response(JSON.stringify({ success: true, filePath }), { status: 200 });
  } catch {
    return new Response(JSON.stringify({ error: 'Erreur interne upload-reseau-files' }), { status: 500 });
  }
});

```

---

## 6. Migration corrig√©e

```sql
-- Bucket unique multi-tenant
insert into storage.buckets (id, name, public)
values ('bucket-table-reseau', 'bucket-table-reseau', false)
on conflict (id) do nothing;

-- Supprime la policy si elle existe (idempotent)
do $$
begin
  if exists (select 1 from pg_policies where polname = 'RLS reseau files') then
    execute 'drop policy "RLS reseau files" on storage.objects';
  end if;
end $$;
```


---
## Policy isolation multi-tenant
```typescript
create policy "RLS reseau files" on storage.objects
for all using (auth.role() = 'authenticated' and (bucket_id = 'bucket-table-reseau'));
```

---

## 7. Mapping global

| Onglet       | Fichiers front                   | Tables Supabase                              | Edge Functions         |
|--------------|----------------------------------|----------------------------------------------|------------------------|
| G√©n√©ral      | useReseauFormData, FormGestion   | reseau, reseau_direction (lecture seule)     | update-reseau          |
| Int√©grations | useReseauIntegrations, FormGestion | reseau, brevo_connexion, zoho_connexion, openai_connexion | update-reseau          |
| Fichiers     | FormGestion                      | reseau (logo/docs), storage (bucket unique)  | upload-reseau-files    |

---


## Arborescence cible
```typescript
src/
‚îî‚îÄ components/
‚îú‚îÄ HOOKS-STRATEGIQUE/
‚îÇ ‚îî‚îÄ 6.HOOKS-GestionCompteAdminPresenca/1.Reseau/
‚îÇ ‚îú‚îÄ hooks/
‚îÇ ‚îÇ ‚îú‚îÄ types.ts
‚îÇ ‚îÇ ‚îú‚îÄ useReseauFormData.ts
‚îÇ ‚îÇ ‚îî‚îÄ useReseauIntegrations.ts
‚îÇ ‚îî‚îÄ components/
‚îÇ ‚îî‚îÄ ReseauSelector.tsx
‚îî‚îÄ ADMIN-PRESENCA/9-CreationComptesUtilisateurs/1-Formulaires/1.Reseau/
‚îî‚îÄ 0.V17.9.2025-FormGestion.tsx

supabase/
‚îî‚îÄ functions/
‚îú‚îÄ update-reseau/index.ts
‚îî‚îÄ upload-reseau-files/index.ts

supabase/migrations/
‚îî‚îÄ 20250917_bucket_table_reseau.sql
```

---
